{
  HashSet<String> existing=null;
  if (myState == state) {
    existing=new HashSet<String>();
    collectExisting(getRootNode(),existing);
  }
  myState=state;
  rebuildNow();
  expandAll();
  if (existing != null) {
    List<TreePath> newNodes=new ArrayList<TreePath>();
    collectNew(new TreePath(getRootNode()),existing,newNodes);
    setSelectionPaths(newNodes.toArray(new TreePath[newNodes.size()]));
  }
}
