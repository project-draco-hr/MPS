{
synchronized (LOCK) {
    try {
      isNotifying=true;
      for (      JavaPsiListener l : myListeners) {
        l.psiChanged(event);
      }
    }
  finally {
      isNotifying=false;
      if (!toBeAdded.isEmpty()) {
        myListeners.addAll(toBeAdded);
      }
      if (!toBeRemoved.isEmpty()) {
        myListeners.removeAll(toBeRemoved);
      }
      toBeAdded.clear();
      toBeRemoved.clear();
    }
  }
}
