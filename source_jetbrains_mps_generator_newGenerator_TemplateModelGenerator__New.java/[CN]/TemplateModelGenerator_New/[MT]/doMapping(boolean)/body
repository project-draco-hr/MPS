{
  checkMonitorCanceled();
  int oldErrorCount=getErrorCount();
  RuleManager ruleManager=new RuleManager(this);
  RuleUtil ruleUtil=new RuleUtil(ruleManager);
  ruleManager.getReductionRuleManager().setRuleUtil(ruleUtil);
  if (isPrimary) {
    for (    CreateRootRule createRootRule : ruleManager.getCreateRootRules()) {
      ruleUtil.applyRootRule(createRootRule);
    }
  }
  checkMonitorCanceled();
  for (  MappingRule mappingRule : ruleManager.getMappingRules()) {
    ruleUtil.applyMappingRule(mappingRule);
  }
  checkMonitorCanceled();
  for (  Root_MappingRule rootMappingRule : ruleManager.getRoot_MappingRules()) {
    ruleUtil.applyRoot_MappingRule(rootMappingRule);
  }
  checkMonitorCanceled();
  List<SNode> copiedRoots=copyRootsFromInputModel(ruleManager);
  checkMonitorCanceled();
  for (  WeavingRule weavingRule : ruleManager.getWeavingRules()) {
    ruleUtil.applyWeavingRule(weavingRule);
  }
  checkMonitorCanceled();
  for (  Weaving_MappingRule weavingMappingRule : ruleManager.getWeaving_MappingRules()) {
    ruleUtil.applyWeavingMappingRule(weavingMappingRule);
  }
  checkMonitorCanceled();
  for (  SNode outputRootNode : copiedRoots) {
    ruleManager.getReductionRuleManager().applyReductionRules(findInputNodeByOutputNodeWithSameId(outputRootNode));
  }
  for (  SNode rootNode : myNewRootNodes) {
    myOutputModel.addRoot(rootNode);
  }
  checkMonitorCanceled();
  myDelayedChanges.doAllChanges();
  checkMonitorCanceled();
  validateReferencesInCopiedRoots(copiedRoots);
  updateAllReferences();
  checkMonitorCanceled();
  reportWasErrors(getErrorCount() - oldErrorCount);
}
