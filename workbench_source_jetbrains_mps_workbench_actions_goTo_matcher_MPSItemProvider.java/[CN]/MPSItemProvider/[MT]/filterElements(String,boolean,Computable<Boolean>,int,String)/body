{
  ArrayList<Object> res=new ArrayList<Object>();
  String[] names=myBase.getNames(everywhere);
  String namePattern=getNamePattern(pattern);
  List<String> namesList=getNamesByPattern(namePattern,names,cancelled);
  Collections.sort(namesList,new MatchesComparator(namePattern));
  for (  String name : namesList) {
    Set<Object> elems=myMatcher.getElementsByPattern(pattern,name,everywhere,cancelled);
    if (res.size() + elems.size() <= maxListSize) {
      res.addAll(elems);
    }
 else {
      Iterator<Object> iter=elems.iterator();
      while (res.size() < maxListSize) {
        res.add(iter.next());
      }
      res.add(extra);
      break;
    }
  }
  return res;
}
