{
  final List<SNode> childrenRightAfterEvent=event.getParent().getChildren(event.getChildRole());
  runUpdateTask(new _FunctionTypes._void_P0_E0(){
    public void invoke(){
      final SNodeId parentId=event.getParent().getSNodeId();
      final String role=event.getChildRole();
      removeChanges(parentId,NodeGroupChange.class,new _FunctionTypes._return_P1_E0<Boolean,NodeGroupChange>(){
        public Boolean invoke(        NodeGroupChange ch){
          return role.equals(ch.getRole());
        }
      }
);
      removeDescendantChanges(parentId,role);
      if (event.getModel().getNodeById(parentId) == null) {
        return;
      }
      myLastParentAndNewChildrenIds=MultiTuple.<SNodeId,List<SNodeId>>from(parentId,ListSequence.fromList(childrenRightAfterEvent).select(new ISelector<SNode,SNodeId>(){
        public SNodeId select(        SNode n){
          return n.getSNodeId();
        }
      }
).toListSequence());
      buildAndAddChanges(new _FunctionTypes._void_P1_E0<ChangeSetBuilder>(){
        public void invoke(        ChangeSetBuilder b){
          b.buildForNodeRole(getOldNode(parentId).getChildren(role),childrenRightAfterEvent);
        }
      }
);
    }
  }
,event.getParent());
}
