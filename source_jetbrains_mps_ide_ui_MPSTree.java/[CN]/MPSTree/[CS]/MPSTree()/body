{
  setCellRenderer(new DefaultTreeCellRenderer(){
    public Component getTreeCellRendererComponent(    JTree tree,    Object value,    boolean sel,    boolean expanded,    boolean leaf,    int row,    boolean hasFocus){
      super.getTreeCellRendererComponent(tree,value,sel,expanded,leaf,row,hasFocus);
      if (value instanceof MPSTreeNode) {
        MPSTreeNode node=(MPSTreeNode)value;
        setIcon(node.getIcon(expanded));
      }
      return this;
    }
  }
);
  addTreeWillExpandListener(new TreeWillExpandListener(){
    public void treeWillExpand(    TreeExpansionEvent event) throws ExpandVetoException {
      TreePath path=event.getPath();
      Object node=path.getLastPathComponent();
      MPSTreeNode treeNode=(MPSTreeNode)node;
      if (!treeNode.isInitialized()) {
        treeNode.init();
      }
    }
    public void treeWillCollapse(    TreeExpansionEvent event) throws ExpandVetoException {
    }
  }
);
  addMouseListener(new MouseAdapter(){
    public void mousePressed(    MouseEvent e){
      if (e.isPopupTrigger())       showPopup(e);
    }
    public void mouseClicked(    MouseEvent e){
      TreePath path=getPathForLocation(e.getX(),e.getY());
      if (path == null)       return;
      if (path.getLastPathComponent() instanceof MPSTreeNode && e.getClickCount() == 2) {
        setSelectionPath(path);
        MPSTreeNode node=(MPSTreeNode)path.getLastPathComponent();
        node.doubleClick();
        e.consume();
      }
    }
    public void mouseReleased(    MouseEvent e){
      if (e.isPopupTrigger())       showPopup(e);
    }
  }
);
}
