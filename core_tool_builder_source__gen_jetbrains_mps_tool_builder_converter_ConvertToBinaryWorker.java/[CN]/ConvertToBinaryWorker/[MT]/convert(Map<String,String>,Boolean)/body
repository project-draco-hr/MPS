{
  final MPSCore mpsCore=new MPSCore();
  mpsCore.init();
  final MPSPersistence mpsPersistence=new MPSPersistence();
  mpsPersistence.init();
  RuntimeFlags.setMergeDriverMode(true);
  PersistenceRegistry.getInstance().setModelEnvironmentInfo(new LightModelEnvironmentInfoImpl());
  RuntimeFlags.setPlayRefactoringsMode(false);
  try {
    ModelAccess.instance().runWriteAction(new Runnable(){
      public void run(){
        try {
          for (          Map.Entry<String,String> entry : map.entrySet()) {
            convertModelToBinary(entry.getKey(),entry.getValue(),stripImplementation);
          }
        }
 catch (        IOException ex) {
          throw new RuntimeException(ex);
        }
      }
    }
);
  }
  finally {
    PersistenceRegistry.getInstance().setModelEnvironmentInfo(null);
    mpsPersistence.dispose();
    mpsCore.dispose();
  }
}
