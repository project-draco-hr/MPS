{
  final MPSCore mpsCore=new MPSCore();
  mpsCore.init();
  PersistenceFacade persistenceFacade=mpsCore.getPersistenceFacade();
  final MPSPersistence mpsPersistence=new MPSPersistence(persistenceFacade);
  mpsPersistence.init();
  RuntimeFlags.setMergeDriverMode(true);
  PersistenceRegistry.getInstance().setModelEnvironmentInfo(new LightModelEnvironmentInfoImpl());
  try {
    ModelAccess.instance().runWriteAction(new Runnable(){
      public void run(){
        for (        Map.Entry<String,String> entry : map.entrySet()) {
          convertModelToBinary(entry.getKey(),entry.getValue(),stripImplementation);
        }
      }
    }
);
  }
  finally {
    PersistenceRegistry.getInstance().setModelEnvironmentInfo(null);
    mpsPersistence.dispose();
    mpsCore.dispose();
  }
}
