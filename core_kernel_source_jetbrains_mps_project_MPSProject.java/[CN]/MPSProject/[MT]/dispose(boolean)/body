{
  ModelAccess.instance().runWriteAction(new Runnable(){
    public void run(){
      MPSProjects projects=MPSProjects.instance();
      projects.removeProject(MPSProject.this);
      for (      ProjectDisposeListener listener : myListeners) {
        listener.onBeforeDispose();
      }
      MPSModuleRepository.getInstance().unRegisterModules(MPSProject.this);
      SModelRepository.getInstance().unRegisterModelDescriptors(MPSProject.this);
      MPSModuleRepository.getInstance().removeUnusedModules();
      SModelRepository.getInstance().removeUnusedDescriptors();
      if (reloadAll) {
        ClassLoaderManager.getInstance().reloadAll(new EmptyProgressIndicator());
      }
 else {
        if (!MPSCore.getInstance().isTestMode()) {
          ClassLoaderManager.getInstance().unloadAll(new EmptyProgressIndicator());
        }
      }
      CleanupManager.getInstance().cleanup();
      myListeners.clear();
    }
  }
);
  if (myProject != null) {
    if (MPSCore.getInstance().isTestMode()) {
      ProjectUtil.closeAndDispose(myProject);
    }
  }
}
