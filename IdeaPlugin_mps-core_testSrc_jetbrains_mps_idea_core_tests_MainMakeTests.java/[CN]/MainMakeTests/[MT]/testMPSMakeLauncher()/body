{
  ModuleRootManager mrm=ModuleRootManager.getInstance(myFacet.getModule());
  VirtualFile[] srs=mrm.getSourceRoots();
  assertTrue(srs.length == 2);
  assertEquals("models",srs[0].getName());
  VirtualFile[] children=srs[0].getChildren();
  assertTrue(children.length == 1);
  assertEquals("main.mps",children[0].getName());
  Set<File> modelsToMake=new HashSet<File>();
  modelsToMake.add(new File(children[0].getPath()));
  MPSMakeConfiguration makeConfiguration=new MPSMakeConfiguration();
  makeConfiguration.addConfiguredModels(modelsToMake);
  makeConfiguration.addConfiguredLibrary(myModule.getProject().getName(),new File(myModule.getProject().getBaseDir().getPath()),false);
  PluginLibrariesContributor pluginLibContributor=ApplicationManager.getApplication().getComponent(PluginLibrariesContributor.class);
  for (  LibDescriptor library : pluginLibContributor.getLibraries()) {
    makeConfiguration.addConfiguredLibrary(library.path,new File(library.path),false);
  }
  MPSMakeLauncher gl=new MPSMakeLauncher(makeConfiguration,myModule.getProject());
  gl.validate();
  assertTrue(gl.isValid());
  final List<File> files=new ArrayList<File>();
  final List<String> errors=new ArrayList<String>();
  gl.launch(new MPSMakeCallback(){
    @Override public void fileWritten(    String path){
      files.add(new File(path));
    }
    @Override public void error(    String text){
      errors.add(text);
    }
  }
);
  assertTrue(errors.toString(),errors.isEmpty());
  assertTrue(files.size() > 4);
}
