{
  myEventsManager.addGlobalModelListener(new SModelAdapter(){
    @Override public void modelReloaded(    SModelDescriptor sm){
      for (      SNode root : sm.getSModel().getRoots()) {
        final MPSNodeVirtualFile file=MPSNodesVirtualFileSystem.getInstance().getFileFor(root);
        for (        final Project p : myProjectManager.getOpenProjects()) {
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            public void run(){
              if (!p.isDisposed()) {
                ((UndoManagerImpl)UndoManager.getInstance(p)).clearUndoRedoQueueInTests(file);
              }
            }
          }
,ModalityState.NON_MODAL);
        }
      }
    }
  }
);
}
