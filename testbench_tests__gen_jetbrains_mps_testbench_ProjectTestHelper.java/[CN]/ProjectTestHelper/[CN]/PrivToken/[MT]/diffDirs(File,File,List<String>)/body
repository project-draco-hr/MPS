{
  Iterable<String> onames=Sequence.fromArray(orig.list());
  Iterable<String> rnames=Sequence.fromArray(revd.list());
  if (Sequence.<String>fromIterable(onames).disjunction(Sequence.<String>fromIterable(rnames)).isNotEmpty()) {
    Sequence.<String>fromIterable(onames).subtract(Sequence.<String>fromIterable(rnames)).visitAll(new IVisitor<String>(){
      public void visit(      String it){
        if ("trace.info".equals(it)) {
          return;
        }
        ListSequence.<String>fromList(diffs).addElement("Removed: " + new File(orig,it));
      }
    }
);
    Sequence.<String>fromIterable(rnames).subtract(Sequence.<String>fromIterable(onames)).visitAll(new IVisitor<String>(){
      public void visit(      String it){
        if ("trace.info".equals(it)) {
          return;
        }
        ListSequence.<String>fromList(diffs).addElement("Created: " + new File(orig,it));
      }
    }
);
  }
  for (  String name : Sequence.<String>fromIterable(onames).intersect(Sequence.<String>fromIterable(rnames))) {
    if ("trace.info".equals(name)) {
      continue;
    }
    File onext=new File(orig,name);
    File rnext=new File(revd,name);
    if (onext.isDirectory() == rnext.isDirectory()) {
      if (!(onext.isDirectory())) {
        List<String> olines=fileToStrings(onext);
        Patch patch=DiffUtils.diff(olines,fileToStrings(rnext));
        if (!(patch.getDeltas().isEmpty())) {
          ListSequence.<String>fromList(diffs).addSequence(ListSequence.<String>fromList(DiffUtils.generateUnifiedDiff(onext.getPath(),rnext.getPath(),olines,patch,5)));
        }
      }
 else {
        diffDirs(onext,rnext,diffs);
      }
    }
 else {
      ListSequence.<String>fromList(diffs).addElement("Something weird here: " + onext + " or here "+ rnext);
    }
  }
}
