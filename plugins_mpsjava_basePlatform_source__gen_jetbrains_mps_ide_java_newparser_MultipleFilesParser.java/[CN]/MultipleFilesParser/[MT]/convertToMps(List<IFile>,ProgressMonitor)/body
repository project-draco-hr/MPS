{
  progress.start("Converting...",31);
  final ProgressMonitor parseProgress=progress.subTask(1);
  parseProgress.start("Parsing...",ListSequence.fromList(files).count());
  myModelAccess.runReadAction(new Runnable(){
    public void run(){
      for (      IFile file : ListSequence.fromList(files)) {
        try {
          parseFile(file);
          parseProgress.advance(1);
          ListSequence.fromList(mySuccessfulFiles).addElement(file);
        }
 catch (        JavaParseException e) {
        }
catch (        IOException e) {
        }
      }
    }
  }
);
  parseProgress.done();
  final Wrappers._int rootCount=new Wrappers._int(0);
  runCommand("model creation pass",new Runnable(){
    public void run(){
      for (      String pakage : SetSequence.fromSet(MapSequence.fromMap(classesPerPackage).keySet())) {
        final SModel model=registerModelForPackage(pakage);
        Set<SNode> roots=MapSequence.fromMap(classesPerPackage).get(pakage);
        SetSequence.fromSet(roots).visitAll(new IVisitor<SNode>(){
          public void visit(          SNode it){
            model.addRootNode(it);
          }
        }
);
        rootCount.value=rootCount.value + SetSequence.fromSet(roots).count();
        ((SModelInternal)model).addLanguage(PersistenceFacade.getInstance().createModuleReference("f3061a53-9226-4cc5-a443-f952ceaf5816(jetbrains.mps.baseLanguage)"));
      }
      for (      String pakage : SetSequence.fromSet(MapSequence.fromMap(classesPerPackage).keySet())) {
        final SModel model=registerModelForPackage(pakage);
        Set<SNode> roots=MapSequence.fromMap(classesPerPackage).get(pakage);
        SetSequence.fromSet(roots).visitAll(new IVisitor<SNode>(){
          public void visit(          SNode it){
            model.addRootNode(it);
          }
        }
);
        rootCount.value=rootCount.value + SetSequence.fromSet(roots).count();
        ListSequence.fromList(myModels).addElement(model);
      }
      for (      SModel model : ListSequence.fromList(myModels)) {
        JavaParser.tryResolveUnknowns(SModelOperations.getRoots(model,null));
      }
    }
  }
);
  myRootCount=rootCount.value;
  ProgressMonitor resolveProgress=progress.subTask(30);
  resolveUpdatePass("top level refs",new _FunctionTypes._return_P1_E0<Iterable<SReference>,SNode>(){
    public Iterable<SReference> invoke(    SNode node){
      return getTopLevelRefs(SNodeOperations.cast(node,"jetbrains.mps.baseLanguage.structure.Classifier"));
    }
  }
,resolveProgress.subTask(10));
  resolveUpdatePass("field/method type refs",new _FunctionTypes._return_P1_E0<Iterable<SReference>,SNode>(){
    public Iterable<SReference> invoke(    SNode node){
      return getFieldAndMethodTypeRefs(SNodeOperations.cast(node,"jetbrains.mps.baseLanguage.structure.Classifier"));
    }
  }
,resolveProgress.subTask(10));
  resolveUpdatePass("all type refs",new _FunctionTypes._return_P1_E0<Iterable<SReference>,SNode>(){
    public Iterable<SReference> invoke(    SNode node){
      return getFieldAndMethodTypeRefs(SNodeOperations.cast(node,"jetbrains.mps.baseLanguage.structure.Classifier"));
    }
  }
,resolveProgress.subTask(10));
  progress.done();
}
