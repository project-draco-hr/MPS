{
  if (pack.equals(myModelLongName)) {
    if (myModel.isKnownRoot(targetTopClassifier)) {
      return jetbrains.mps.smodel.SReference.create(role,source,myModelReference,targetNodeId,resolveInfo);
    }
  }
  Collection<VisibleModel> possibleModels=findModels(new SModelName(pack,SModelStereotype.JAVA_STUB));
  if (possibleModels.isEmpty()) {
    return jetbrains.mps.smodel.SReference.create(role,source,null,targetNodeId,resolveInfo);
  }
  for (  VisibleModel vm : possibleModels) {
    final SModelReference modelRef=vm.getModelReference();
    if (myModelReference.equals(modelRef)) {
      continue;
    }
    if (vm.isKnownRoot(targetTopClassifier)) {
      addImport(modelRef);
      return jetbrains.mps.smodel.SReference.create(role,source,modelRef,targetNodeId,resolveInfo);
    }
  }
  if (possibleModels.size() == 1) {
    SModelReference targetModel=possibleModels.iterator().next().getModelReference();
    addImport(targetModel);
    return jetbrains.mps.smodel.SReference.create(role,source,targetModel,targetNodeId,resolveInfo);
  }
 else {
    for (    VisibleModel m : possibleModels) {
      addImport(m.getModelReference());
    }
    return DynamicReference.createDynamicReference(role,source,pack,resolveInfo);
  }
}
