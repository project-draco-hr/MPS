{
  if (node == null || SNodeOperations.getModel(node) == null) {
    return;
  }
  SModule module=check_bt3k2y_a0b0b(SNodeOperations.getModel(node));
  if (module == null) {
    return;
  }
  SNode concept=SNodeOperations.getConceptDeclaration(node);
  boolean executeImmediately=canExecuteImmediately(SNodeOperations.getModel(node),repository);
  for (  final SReference ref : SNodeOperations.getReferences(node)) {
    final SNode target=SLinkOperations.getTargetNode(ref);
    SNode ld=SLinkOperations.findLinkDeclaration(ref);
    if ((target == null) || ld == null) {
      continue;
    }
    component.addDependency(target);
    component.addDependency(ld);
    component.addDependency(node);
    component.addDependency(SNodeOperations.getParent(node));
    for (    SNode c : SNodeOperations.getChildren(node)) {
      component.addDependency(c);
    }
    final Scope refScope=component.runCheckingAction(new _FunctionTypes._return_P0_E0<Scope>(){
      public Scope invoke(){
        return ModelConstraints.getScope(ref);
      }
    }
);
    if (refScope instanceof ErrorScope) {
      component.addError(node,((ErrorScope)refScope).getMessage(),null,new ReferenceMessageTarget(SLinkOperations.getRole(ref)));
    }
 else     if (!(component.runCheckingAction(new _FunctionTypes._return_P0_E0<Boolean>(){
      public Boolean invoke(){
        return refScope.contains(target);
      }
    }
))) {
      String name=target.getName();
      ReferenceScopeProvider scopeProvider=ModelConstraintsManager.getNodeReferentSearchScopeProvider(concept,ref.getRole());
      SNode ruleNode=null;
      if (scopeProvider != null) {
        ruleNode=(scopeProvider.getSearchScopeValidatorNode() != null ? ((SNodePointer)scopeProvider.getSearchScopeValidatorNode()).resolve(MPSModuleRepository.getInstance()) : null);
      }
      component.addError(node,"reference" + ((name == null ? "" : " " + name)) + " ("+ SLinkOperations.getRole(ref)+ ") is out of search scope",ruleNode,new ReferenceMessageTarget(SLinkOperations.getRole(ref)),createResolveReferenceQuickfix(ref,repository,executeImmediately));
    }
  }
}
