{
  if (operationContext == null) {
    return;
  }
  if (SNodeUtil.getMetaLevel(node) != 0) {
    return;
  }
  SNode concept=SNodeOperations.getConceptDeclaration(node);
  for (  SReference ref : SNodeOperations.getReferences(node)) {
    SNode target=SLinkOperations.getTargetNode(ref);
    SNode ld=SLinkOperations.findLinkDeclaration(ref);
    if ((target == null) || ld == null) {
      continue;
    }
    component.addDependency(target);
    component.addDependency(ld);
    component.addDependency(node);
    component.addDependency(SNodeOperations.getParent(node));
    for (    SNode c : SNodeOperations.getChildren(node)) {
      component.addDependency(c);
    }
    Scope refScope=ModelConstraintsUtil.getScope(ref,operationContext);
    if (refScope instanceof ErrorScope) {
      component.addError(node,((ErrorScope)refScope).getMessage(),(SNode)null,new ReferenceMessageTarget(SLinkOperations.getRole(ref)));
    }
 else     if (!(refScope instanceof DefaultScope || refScope.getAvailableElements(null).contains(target))) {
      String name=target.getName();
      ReferenceScopeProvider scopeProvider=ModelConstraintsManager.getNodeReferentSearchScopeProvider(concept,ref.getRole());
      SNode ruleNode=(scopeProvider.getSearchScopeValidatorNode() != null ? scopeProvider.getSearchScopeValidatorNode().getNode() : null);
      component.addError(node,"reference" + ((name == null ? "" : " " + name)) + " ("+ SLinkOperations.getRole(ref)+ ") is out of search scope",ruleNode,new ReferenceMessageTarget(SLinkOperations.getRole(ref)));
    }
  }
}
