{
  MoveNodesUtil.NodeCopyTracker copyMap=MoveNodesUtil.NodeCopyTracker.get(refactoringSession);
  copyMap.copyAndTrack(nodeRoots);
  for (  SNode oldNode : ListSequence.fromList(nodeRoots)) {
    if (MapSequence.fromMap(ifKeepOldNodes).get(oldNode) == RefactoringParticipant.KeepOldNodes.REMOVE) {
      SNodeOperations.detachNode(oldNode);
    }
    myNodeLocation.insertNode(myProject.getRepository(),MapSequence.fromMap(copyMap.getCopyMap()).get(oldNode));
  }
}
