{
  for (  SNode root : rootNodes) {
    for (    SNode n : SNodeUtil.getDescendants(root)) {
      SConceptId conceptId=n.getConcept().getId();
      SConceptAdapter concept=new SConceptAdapter(conceptId);
      SNode conceptNode=concept.getConceptDeclarationNode();
      String conceptName=n.getConcept().getName();
      conceptIds.put(conceptId,conceptName);
      if (n.getParent() != null) {
        String roleName=n.getRoleInParent();
        SContainmentLinkAdapter role=new SContainmentLinkAdapter(findContainmentLinkId(n.getParent().getConcept(),roleName));
        SConceptId linkConceptId=role.getRoleId().getConceptId();
        SNode roleNode=role.getLinkNode();
        SNode linkConcept=roleNode.getContainingRoot();
        if (linkConcept != conceptNode) {
          String linkConceptName=linkConcept.getName();
          conceptIds.put(linkConceptId,linkConceptName);
        }
        roleIds.put((SContainmentLinkId)role.getRoleId(),roleName);
      }
      for (      String propName : n.getPropertyNames()) {
        SPropertyAdapter prop=new SPropertyAdapter(findPropertyId(concept,propName));
        SConceptId propConceptId=prop.getId().getConceptId();
        SNode propNode=prop.getPropertyNode();
        SNode propConcept=propNode.getContainingRoot();
        if (propConcept != conceptNode) {
          String propConceptName=propConcept.getName();
          conceptIds.put(propConceptId,propConceptName);
        }
        propIds.put(prop.getId(),propName);
      }
      for (      SReference ref : n.getReferences()) {
        String refName=ref.getRole();
        SReferenceLinkAdapter refRole=new SReferenceLinkAdapter(findReferenceLinkId(concept,refName));
        SNode refNode=refRole.getLinkNode();
        SConceptId refConceptId=refRole.getRoleId().getConceptId();
        SNode refConcept=refNode.getContainingRoot();
        if (refConcept != conceptNode) {
          String propConceptName=refConcept.getName();
          conceptIds.put(refConceptId,propConceptName);
        }
        refIds.put((SReferenceLinkId)refRole.getRoleId(),refName);
      }
    }
  }
}
