{
  if (SNodeOperations.isInstanceOf(matching,"jetbrains.mps.baseLanguage.structure.TypeVariableReference")) {
    (map=ClosureLiteralUtil.getMap(map)).put(SPropertyOperations.getString(SLinkOperations.getTarget(matching,"typeVariableDeclaration",false),"name"),realType);
  }
 else   if (SNodeOperations.isInstanceOf(matching,"jetbrains.mps.baseLanguage.structure.ClassifierType") && SNodeOperations.isInstanceOf(realType,"jetbrains.mps.baseLanguage.structure.ClassifierType")) {
    int idx=0;
    List<SNode> mptypes=SLinkOperations.getTargets(matching,"parameter",true);
    List<SNode> rptypes=SLinkOperations.getTargets(realType,"parameter",true);
    for (int i=0; i < mptypes.size() && i < rptypes.size(); i=i + 1) {
      map=ClosureLiteralUtil.matchType(mptypes.get(i),rptypes.get(i),ClosureLiteralUtil.getMap(map));
    }
  }
  return map;
}
