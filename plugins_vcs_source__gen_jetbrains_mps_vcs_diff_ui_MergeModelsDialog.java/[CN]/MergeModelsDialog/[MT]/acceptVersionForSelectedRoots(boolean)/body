{
  final List<ModelChange> changesToApply=ListSequence.fromList(new ArrayList<ModelChange>());
  final List<ModelChange> changesToExclude=ListSequence.fromList(new ArrayList<ModelChange>());
  for (  MergeModelsDialog.RootTreeNode rtn : Sequence.fromIterable(Sequence.fromArray(myMergeModelsTree.getSelectedNodes(MergeModelsDialog.RootTreeNode.class,null)))) {
    for (    ModelChange change : ListSequence.fromList(myMergeContext.getChangesForRoot(rtn.myRootId))) {
      if (!(myMergeContext.isChangeResolved(change))) {
        if (mine == myMergeContext.isMyChange(change)) {
          ListSequence.fromList(changesToApply).addElement(change);
        }
 else {
          ListSequence.fromList(changesToExclude).addElement(change);
        }
      }
    }
  }
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      myMergeContext.applyChanges(changesToApply);
      myMergeContext.excludeChanges(changesToExclude);
      myMergeModelsTree.rebuildNow();
    }
  }
);
}
