{
  if (attributeKind.equals(AttributeKind.Child.class)) {
    EditorCell editorCell=createEditorCell(modifications,ReferencedNodeContext.createNodeAttributeContext(roleAttribute));
    jetbrains.mps.openapi.editor.cells.EditorCell_Collection collection=EditorCell_Collection.createIndent2(myEditorContext,cellWithRole.getSNode());
    collection.addEditorCell(editorCell);
    collection.addEditorCell(cellWithRole);
    return collection;
  }
  Stack<EditorCell> stack=myAttributedClassesToAttributedCellStacksMap.get(attributeKind);
  if (stack == null) {
    stack=new Stack<EditorCell>();
    myAttributedClassesToAttributedCellStacksMap.put(attributeKind,stack);
  }
  stack.push(cellWithRole);
  Stack<EditorCell> nodeAttributeStack=null;
  if (attributeKind != AttributeKind.Node.class) {
    nodeAttributeStack=myAttributedClassesToAttributedCellStacksMap.get(AttributeKind.Node.class);
    if (nodeAttributeStack == null) {
      nodeAttributeStack=new Stack<EditorCell>();
      myAttributedClassesToAttributedCellStacksMap.put(AttributeKind.Node.class,nodeAttributeStack);
    }
    nodeAttributeStack.push(cellWithRole);
  }
  myAttributedCells.addLast(cellWithRole);
  EditorCell result=createEditorCell(modifications,ReferencedNodeContext.createNodeAttributeContext(roleAttribute));
  myAttributedCells.removeLast();
  EditorCell cellWithRolePopped=stack.pop();
  LOG.assertLog(cellWithRolePopped == cellWithRole,"Assertion failed.");
  if (nodeAttributeStack != null) {
    cellWithRolePopped=nodeAttributeStack.pop();
    LOG.assertLog(cellWithRolePopped == cellWithRole,"Assertion failed.");
  }
  return result;
}
