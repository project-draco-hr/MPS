{
  SNode nlayout=SNodeOperations.getAncestor(thisNode,"jetbrains.mps.build.structure.BuildNamedLayout",true,false);
  SNode parent=SNodeOperations.getAncestor(thisNode,"jetbrains.mps.build.structure.BuildLayout_ContainerAcceptingFileSet",false,false);
  String name;
  if (SNodeOperations.isInstanceOf(parent,"jetbrains.mps.lang.core.structure.INamedConcept")) {
    name=SPropertyOperations.getString(SNodeOperations.cast(parent,"jetbrains.mps.lang.core.structure.INamedConcept"),"name");
  }
 else {
    SNode ancestor=SNodeOperations.getAncestor(thisNode,"jetbrains.mps.lang.core.structure.INamedConcept",false,false);
    name=SPropertyOperations.getString(ancestor,"name");
  }
  if ((SPropertyOperations.getString(thisNode,"filemode") != null && SPropertyOperations.getString(thisNode,"filemode").length() > 0)) {
    name=name + "_f" + SPropertyOperations.getString(thisNode,"filemode");
  }
  if ((SPropertyOperations.getString(thisNode,"dirmode") != null && SPropertyOperations.getString(thisNode,"dirmode").length() > 0)) {
    name=name + "_d" + SPropertyOperations.getString(thisNode,"dirmode");
  }
  return context.getTempPath(thisNode,name,((nlayout != null) ? SPropertyOperations.getString(nlayout,"name") : "default"));
}
