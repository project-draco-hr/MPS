{
  final Language l1=createLanguage();
  final Language l2=createLanguage();
  final Language l3=createLanguage();
  myAccess.runWriteAction(new Runnable(){
    @Override public void run(){
      l1.addDependency(l2.getModuleReference(),false);
      l2.addDependency(l3.getModuleReference(),false);
      addClassTo(l2);
      l2.reload();
      Assert.assertTrue(classIsLoadableFromModule(l1));
      removeModule(l3);
      Assert.assertTrue(!classIsLoadableFromModule(l1));
      Assert.assertTrue(!myManager.getModulesWatcher().isModuleWatched(l3));
    }
  }
);
  Assert.assertTrue(!classIsLoadableFromModule(l1));
}
