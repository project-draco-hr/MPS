{
  final Solution solution=createSolution();
  addClassTo(solution);
  myAccess.runWriteAction(new Runnable(){
    @Override public void run(){
      solution.getModuleDescriptor().setKind(SolutionKind.NONE);
      ClassLoaderManager.getInstance().reloadModule(solution);
      Assert.assertTrue(myManager.getModulesWatcher().isModuleWatched(solution));
      Assert.assertFalse(classIsLoadableFromModule(solution));
      solution.getModuleDescriptor().setKind(SolutionKind.PLUGIN_CORE);
      ClassLoaderManager.getInstance().reloadModule(solution);
      Assert.assertTrue(classIsLoadableFromModule(solution));
      Assert.assertTrue(myManager.getModulesWatcher().isModuleWatched(solution));
      solution.getModuleDescriptor().setKind(SolutionKind.NONE);
      ClassLoaderManager.getInstance().reloadModule(solution);
      Assert.assertFalse(classIsLoadableFromModule(solution));
      Assert.assertTrue(myManager.getModulesWatcher().isModuleWatched(solution));
    }
  }
);
}
