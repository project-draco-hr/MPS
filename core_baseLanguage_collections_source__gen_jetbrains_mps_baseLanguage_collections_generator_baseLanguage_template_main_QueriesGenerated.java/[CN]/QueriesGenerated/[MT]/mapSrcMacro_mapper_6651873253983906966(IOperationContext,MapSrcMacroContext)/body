{
  SNode res=(SNode)CopyUtil.copy(SLinkOperations.getTarget(SLinkOperations.getTarget(_context.getNode(),"containerDeclaration",false),"factory",true));
  final List<SNode> tvDecls=ListSequence.<SNode>fromList(SLinkOperations.getTargets(SLinkOperations.getTarget(_context.getNode(),"containerDeclaration",false),"typeVariableDeclaration",true)).toListSequence();
  if (ListSequence.<SNode>fromList(tvDecls).isNotEmpty()) {
    final List<SNode> types=ListSequence.<SNode>fromList(new ArrayList<SNode>());
    if ((SLinkOperations.getTarget(_context.getNode(),"keyType",true) != null)) {
      ListSequence.<SNode>fromList(types).addElement(SLinkOperations.getTarget(_context.getNode(),"keyType",true));
    }
    if ((SLinkOperations.getTarget(_context.getNode(),"valueType",true) != null)) {
      ListSequence.<SNode>fromList(types).addElement(SLinkOperations.getTarget(_context.getNode(),"valueType",true));
    }
    ListSequence.<SNode>fromList(SNodeOperations.getDescendants(res,"jetbrains.mps.baseLanguage.structure.TypeVariableReference",false,new String[]{})).toListSequence().visitAll(new IVisitor<SNode>(){
      public void visit(      SNode tvr){
        SNodeOperations.replaceWithAnother(tvr,SNodeOperations.copyNode(ClassifierTypeUtil.getTypeCoercedToClassifierType(ListSequence.<SNode>fromList(types).getElement(ListSequence.<SNode>fromList(tvDecls).indexOf(SLinkOperations.getTarget(tvr,"typeVariableDeclaration",false))))));
      }
    }
);
  }
  return res;
}
