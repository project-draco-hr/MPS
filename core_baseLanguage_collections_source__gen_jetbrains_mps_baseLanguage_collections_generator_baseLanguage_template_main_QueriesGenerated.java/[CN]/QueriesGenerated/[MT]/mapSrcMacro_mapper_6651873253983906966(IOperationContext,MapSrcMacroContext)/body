{
  SNode res=(SNode)CopyUtil.copy(SLinkOperations.getTarget(SLinkOperations.getTarget(_context.getNode(),"containerDeclaration",false),"factory",true));
  final List<SNode> tvDecls=ListSequence.fromList(SLinkOperations.getTargets(SLinkOperations.getTarget(_context.getNode(),"containerDeclaration",false),"typeVariableDeclaration",true)).toListSequence();
  if (ListSequence.fromList(tvDecls).isNotEmpty()) {
    final List<SNode> types=ListSequence.fromList(new ArrayList<SNode>());
    if ((SLinkOperations.getTarget(_context.getNode(),"keyType",true) != null)) {
      ListSequence.fromList(types).addElement(SLinkOperations.getTarget(_context.getNode(),"keyType",true));
    }
    if ((SLinkOperations.getTarget(_context.getNode(),"valueType",true) != null)) {
      ListSequence.fromList(types).addElement(SLinkOperations.getTarget(_context.getNode(),"valueType",true));
    }
    ListSequence.fromList(SNodeOperations.getDescendants(res,"jetbrains.mps.baseLanguage.structure.TypeVariableReference",false,new String[]{})).toListSequence().visitAll(new IVisitor<SNode>(){
      public void visit(      SNode tvr){
        SNodeOperations.replaceWithAnother(tvr,ClassifierTypeUtil.getTypeCoercedToClassifierType(ListSequence.fromList(types).getElement(ListSequence.fromList(tvDecls).indexOf(SLinkOperations.getTarget(tvr,"typeVariableDeclaration",false)))));
      }
    }
);
  }
  return res;
}
