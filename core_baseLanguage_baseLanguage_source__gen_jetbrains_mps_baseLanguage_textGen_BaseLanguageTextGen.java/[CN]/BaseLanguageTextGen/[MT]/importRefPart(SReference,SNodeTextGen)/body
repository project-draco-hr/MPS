{
  if (ref == null) {
    return;
  }
  String shortName;
  String packageName;
  if (ref instanceof DynamicReference) {
    shortName=ref.getResolveInfo();
    SModelReference modelReference=ref.getTargetSModelReference();
    int dot=shortName.lastIndexOf(".");
    if (modelReference != null) {
      packageName=modelReference.getLongName();
    }
 else     if (dot >= 0) {
      packageName=shortName.substring(0,dot);
      shortName=shortName.substring(dot + 1);
      if (shortName.indexOf('$') >= 0) {
        shortName=shortName.replace('$','.');
      }
    }
 else {
      SModelReference sModelReference=ref.getSourceNode().getModel().getSModelReference();
      packageName=(sModelReference != null ? sModelReference.getLongName() : "");
    }
  }
 else {
    SNode target=ref.getTargetNodeSilently();
    if (target == null) {
      return;
    }
    shortName=(SNodeOperations.isInstanceOf(target,"jetbrains.mps.baseLanguage.structure.Classifier") ? SPropertyOperations.getString(SNodeOperations.cast(target,"jetbrains.mps.baseLanguage.structure.Classifier"),"nestedName") : target.getResolveInfo());
    packageName=BaseLanguageTextGen.getPackageName(target,textGen);
  }
  BaseLanguageTextGen.appendClsName(packageName,shortName,false,textGen);
}
