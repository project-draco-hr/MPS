{
  if (excludes == null) {
    excludes=new HashSet<IFile>();
  }
 else {
    excludes=new HashSet<IFile>(excludes);
  }
  List<ModuleHandle> result=new ArrayList<ModuleHandle>();
  if (refreshFiles) {
    LOG.debug("Refreshing recursively in the " + dir);
    new FileRefresh(dir).run();
  }
  LOG.debug("Reading modules from " + dir);
  readModuleDescriptors(dir,excludes,result,new DescriptorReader<ModuleHandle>(){
    @Override public ModuleHandle read(    ModuleHandle handle){
      return handle;
    }
  }
);
  return result;
}
