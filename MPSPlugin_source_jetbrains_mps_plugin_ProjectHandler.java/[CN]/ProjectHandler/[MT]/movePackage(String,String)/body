{
  new WriteCommandAction(myProject){
    protected void run(    Result result) throws Throwable {
      PsiPackage psiPackage=PsiManager.getInstance(myProject).findPackage(oldPackageName);
      RefactoringFactory refactoringFactory=RefactoringFactory.getInstance(myProject);
      MoveDestination newPackage=refactoringFactory.createSourceFolderPreservingMoveDestination(newLongPackageName);
      MoveClassesOrPackagesRefactoring moveClassesOrPackagesRefactoring=refactoringFactory.createMoveClassesOrPackages(new PsiElement[]{psiPackage},newPackage);
      moveClassesOrPackagesRefactoring.setSearchInComments(false);
      moveClassesOrPackagesRefactoring.setSearchInNonJavaFiles(false);
      moveClassesOrPackagesRefactoring.setPreviewUsages(false);
      moveClassesOrPackagesRefactoring.run();
    }
  }
.execute();
}
