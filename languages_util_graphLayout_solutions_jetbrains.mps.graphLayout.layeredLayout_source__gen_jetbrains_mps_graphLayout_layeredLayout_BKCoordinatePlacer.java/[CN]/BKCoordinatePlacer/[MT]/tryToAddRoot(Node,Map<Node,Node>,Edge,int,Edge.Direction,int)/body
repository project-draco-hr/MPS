{
  Node medianNode=edge.getTarget(dir);
  boolean after;
  if (layerDirection == LEFTMOST) {
    after=MapSequence.<Node,Integer>fromMap(myPosInLayer).get(medianNode) > curConnectedPos;
  }
 else {
    after=MapSequence.<Node,Integer>fromMap(myPosInLayer).get(medianNode) < curConnectedPos;
  }
  if (!(SetSequence.<Edge>fromSet(badEdges).contains(edge)) && after) {
    MapSequence.<Node,Node>fromMap(roots).put(node,MapSequence.<Node,Node>fromMap(roots).get(medianNode));
    curConnectedPos=MapSequence.<Node,Integer>fromMap(myPosInLayer).get(medianNode);
  }
  return curConnectedPos;
}
