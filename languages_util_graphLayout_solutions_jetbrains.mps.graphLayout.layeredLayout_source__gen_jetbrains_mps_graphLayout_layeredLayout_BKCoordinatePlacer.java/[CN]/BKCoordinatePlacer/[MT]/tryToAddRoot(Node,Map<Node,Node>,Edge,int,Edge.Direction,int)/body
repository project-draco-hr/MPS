{
  Node medianNode=edge.getTarget(dir);
  boolean after;
  if (layerDirection == LEFTMOST) {
    after=MapSequence.fromMap(myPosInLayer).get(medianNode) > curConnectedPos;
  }
 else {
    after=MapSequence.fromMap(myPosInLayer).get(medianNode) < curConnectedPos;
  }
  if (!(SetSequence.fromSet(badEdges).contains(edge)) && after) {
    MapSequence.fromMap(roots).put(node,MapSequence.fromMap(roots).get(medianNode));
    curConnectedPos=MapSequence.fromMap(myPosInLayer).get(medianNode);
  }
  return curConnectedPos;
}
