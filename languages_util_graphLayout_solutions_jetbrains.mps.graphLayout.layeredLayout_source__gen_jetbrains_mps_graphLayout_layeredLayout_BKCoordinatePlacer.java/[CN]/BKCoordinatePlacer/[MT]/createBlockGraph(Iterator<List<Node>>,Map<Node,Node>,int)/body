{
  Graph blockGraph=new Graph();
  myBlocks=MapSequence.<Node,Node>fromMap(new HashMap<Node,Node>());
  while (orderIterator.hasNext()) {
    Node prevBlock=null;
    Iterator<Node> nodeIterator=getListIterator(orderIterator.next(),layerDirection);
    while (nodeIterator.hasNext()) {
      Node node=nodeIterator.next();
      if (MapSequence.<Node,Node>fromMap(roots).get(node) == node) {
        MapSequence.<Node,Node>fromMap(myBlocks).put(node,blockGraph.createNode());
      }
      Node currentBlock=MapSequence.<Node,Node>fromMap(myBlocks).get(MapSequence.<Node,Node>fromMap(roots).get(node));
      if (prevBlock != null) {
        blockGraph.connect(prevBlock,currentBlock);
      }
      prevBlock=currentBlock;
    }
  }
  return blockGraph;
}
