{
  Edge.Direction dir;
  if (orderDir == TOP_TO_BOTTOM) {
    dir=Edge.Direction.BACK;
  }
 else {
    dir=Edge.Direction.FRONT;
  }
  Map<Node,Node> roots=computeBlocks(getOrderIterator(myOrder,orderDir),dir,layerDir);
  Graph blockGraph=createBlockGraph(getOrderIterator(myOrder,orderDir),roots,layerDir);
  Map<Node,Integer> layers=new BlockGraphProcessor().process(blockGraph);
  Map<Node,Integer> curCoords=new NodeMap<Integer>(myGraph);
  if (layerDir == LEFTMOST) {
    for (    Node node : ListSequence.<Node>fromList(myGraph.getNodes())) {
      MapSequence.<Node,Integer>fromMap(curCoords).put(node,MapSequence.<Node,Integer>fromMap(layers).get(MapSequence.<Node,Node>fromMap(myBlocks).get(MapSequence.<Node,Node>fromMap(roots).get(node))));
    }
  }
 else {
    int maxCoord=0;
    for (    Node block : ListSequence.<Node>fromList(blockGraph.getNodes())) {
      maxCoord=Math.max(maxCoord,MapSequence.<Node,Integer>fromMap(layers).get(block));
    }
    for (    Node node : ListSequence.<Node>fromList(myGraph.getNodes())) {
      MapSequence.<Node,Integer>fromMap(curCoords).put(node,maxCoord - MapSequence.<Node,Integer>fromMap(layers).get(MapSequence.<Node,Node>fromMap(myBlocks).get(MapSequence.<Node,Node>fromMap(roots).get(node))));
    }
  }
  return curCoords;
}
