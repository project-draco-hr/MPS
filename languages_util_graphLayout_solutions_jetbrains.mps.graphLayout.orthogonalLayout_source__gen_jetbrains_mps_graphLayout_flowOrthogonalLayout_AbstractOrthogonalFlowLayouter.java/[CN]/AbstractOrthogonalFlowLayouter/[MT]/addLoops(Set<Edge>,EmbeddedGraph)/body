{
  Map<Node,Face> facesMap=MapSequence.<Node,Face>fromMap(new HashMap<Node,Face>());
  for (  Edge edge : SetSequence.<Edge>fromSet(loops)) {
    Node node=edge.getSource();
    Face face=MapSequence.<Node,Face>fromMap(facesMap).get(node);
    if (face == null) {
      Face outerFace=embeddedGraph.getOuterFace();
      if (outerFace.contains(ListSequence.<Node>fromListAndArray(new ArrayList<Node>(),node))) {
        face=outerFace;
      }
 else {
        Edge nodeEdge=ListSequence.<Edge>fromList(node.getEdges()).first();
        face=ListSequence.<Face>fromList(embeddedGraph.getAdjacentFaces(nodeEdge)).first();
      }
    }
    List<Edge> newEdges=embeddedGraph.getGraph().splitEdge(edge);
    Face newFace=embeddedGraph.makeLoop(face,newEdges,node);
    MapSequence.<Node,Face>fromMap(facesMap).put(node,newFace);
  }
}
