{
  Map<Node,Face> facesMap=MapSequence.fromMap(new HashMap<Node,Face>());
  for (  Edge edge : SetSequence.fromSet(loops)) {
    Node node=edge.getSource();
    Face face=MapSequence.fromMap(facesMap).get(node);
    if (face == null) {
      Face outerFace=embeddedGraph.getOuterFace();
      if (outerFace.contains(ListSequence.fromListAndArray(new ArrayList<Node>(),node))) {
        face=outerFace;
      }
 else {
        Edge nodeEdge=ListSequence.fromList(node.getEdges()).first();
        face=ListSequence.fromList(embeddedGraph.getAdjacentFaces(nodeEdge)).first();
      }
    }
    List<Edge> newEdges=embeddedGraph.getGraph().splitEdge(edge);
    Face newFace=embeddedGraph.makeLoop(face,newEdges,node);
    MapSequence.fromMap(facesMap).put(node,newFace);
  }
}
