{
  IdeMain.setTestMode(false);
  configureMPS();
  final SModel baseModel=readModel(args[0]);
  final SModel mineModel=readModel(args[1]);
  final SModel newModel=readModel(args[2]);
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      final MergeModelsDialog dialog=ModelAccess.instance().runReadAction(new Computable<MergeModelsDialog>(){
        public MergeModelsDialog compute(){
          return new MergeModelsDialog(null,baseModel,mineModel,newModel);
        }
      }
);
      dialog.showDialog();
      final SModel result=dialog.getResultModel();
      if (result == null) {
        dialog.dispose();
        System.exit(0);
      }
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          IFile iFile=FileSystem.getFile(args[3]);
          if (!iFile.exists())           iFile.createNewFile();
          ModelPersistence.saveModel(result,iFile);
        }
      }
);
      dialog.dispose();
      System.exit(0);
    }
  }
);
}
