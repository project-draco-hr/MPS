{
  if (this.project != null) {
    final com.intellij.openapi.project.Project ideaProject=((this.project instanceof MPSProject) ? ((MPSProject)this.project).getProject() : null);
    int sourceGen=this.file.lastIndexOf(HandlerUtil.SOURCE_GEN);
    int unitNamePosition=(sourceGen == -1 ? 0 : sourceGen + HandlerUtil.SOURCE_GEN.length());
    int unitNameEndPostion=this.file.length() - ".java".length();
    final String unitName=this.file.substring(unitNamePosition,unitNameEndPostion).replace('/','.');
    final String namespace=unitName.substring(0,unitName.lastIndexOf("."));
    final String fileName=this.file.substring(this.file.lastIndexOf("/") + 1);
    this.project.getModelAccess().runWriteInEDT(new Runnable(){
      public void run(){
        Iterator<DebugInfo> it=new DefaultTraceInfoProvider(FileOpener_RequestHandler.this.project.getRepository()).debugInfo(namespace).iterator();
        while (it.hasNext()) {
          if (FileOpener_RequestHandler.this.line != null) {
            final SNodeReference nodeReference=new BaseLanguageNodeLookup(it.next()).getNodeAt(fileName,FileOpener_RequestHandler.this.line);
            if (nodeReference != null) {
              HandlerUtil.openNode(FileOpener_RequestHandler.this.project,nodeReference);
              FileOpener_RequestHandler.this.request.sendResponse(HttpResponseStatus.OK,"image/gif",Unpooled.copiedBuffer(HandlerUtil.SUCCESS_STREAM));
              HandlerUtil.requestFocus(FileOpener_RequestHandler.this.project);
              return;
            }
          }
 else {
            Iterable<DebugInfoRoot> debugInfoRoots=it.next().getRoots();
            SNodeReference nodeReference=Sequence.fromIterable(debugInfoRoots).where(new IWhereFilter<DebugInfoRoot>(){
              public boolean accept(              DebugInfoRoot debugInfoRoot){
                return debugInfoRoot.getFileNames().contains(fileName);
              }
            }
).first().getNodeRef();
            if (nodeReference != null) {
              HandlerUtil.openNode(FileOpener_RequestHandler.this.project,nodeReference);
              FileOpener_RequestHandler.this.request.sendResponse(HttpResponseStatus.OK,"image/gif",Unpooled.copiedBuffer(HandlerUtil.SUCCESS_STREAM));
              HandlerUtil.requestFocus(FileOpener_RequestHandler.this.project);
              return;
            }
          }
        }
        final VirtualFile virtualFile=FileOpenUtil.findFile(ideaProject,unitName,fileName);
        if (virtualFile != null) {
          FileOpenUtil.openFile(ideaProject,virtualFile,(FileOpener_RequestHandler.this.line == null ? 1 : FileOpener_RequestHandler.this.line));
          FileOpener_RequestHandler.this.request.sendResponse(HttpResponseStatus.OK,"image/gif",Unpooled.copiedBuffer(HandlerUtil.SUCCESS_STREAM));
          HandlerUtil.requestFocus(FileOpener_RequestHandler.this.project);
          return;
        }
        FileOpener_RequestHandler.this.request.sendResponse(HttpResponseStatus.OK,"image/gif",Unpooled.copiedBuffer(HandlerUtil.FAILURE_STREAM));
      }
    }
);
  }
 else {
    if (LOG.isEnabledFor(Level.ERROR)) {
      LOG.error("No project is available.");
    }
    this.request.sendResponse(HttpResponseStatus.OK,"image/gif",Unpooled.copiedBuffer(HandlerUtil.FAILURE_STREAM));
  }
}
