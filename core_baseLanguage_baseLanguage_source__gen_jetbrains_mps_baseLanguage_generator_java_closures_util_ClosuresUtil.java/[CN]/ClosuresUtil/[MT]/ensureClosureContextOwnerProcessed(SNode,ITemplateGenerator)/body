{
  if (!(isClosureContextOwner(node))) {
    throw new RuntimeException("node can't be owner of a closure context " + node.getDebugText());
  }
  if (getClosureContextData(node,generator) == null) {
    GenerationSessionContext sessionContext=generator.getGeneratorSessionContext();
    Map<SNode,ClosuresUtil.ClosureContextData> closureContexts=((Map<SNode,ClosuresUtil.ClosureContextData>)sessionContext.getTransientObject(CLOSURE_CONTEXT_DATA));
    if (closureContexts == null) {
      closureContexts=MapSequence.<SNode,ClosuresUtil.ClosureContextData>fromMap(new HashMap<SNode,ClosuresUtil.ClosureContextData>());
      sessionContext.putTransientObject(CLOSURE_CONTEXT_DATA,closureContexts);
    }
    MapSequence.<SNode,ClosuresUtil.ClosureContextData>fromMap(closureContexts).put(node,new ClosuresUtil.ClosureContextData());
    if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.baseLanguage.structure.BaseMethodDeclaration")) {
      processMethodDeclaration(SNodeOperations.cast(node,"jetbrains.mps.baseLanguage.structure.BaseMethodDeclaration"),generator);
    }
 else {
      processConceptFunction(SNodeOperations.cast(node,"jetbrains.mps.baseLanguage.structure.ConceptFunction"),generator);
    }
  }
}
