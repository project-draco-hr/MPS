{
  try {
    SNode nodesQuery=RuleUtil.getSourceNodesQuery(nodeMacro);
    if (nodesQuery != null) {
      return getNewInputNodes(currentInputNode,nodeMacro,nodesQuery,context,reductionContext);
    }
    SNode nodeQuery=RuleUtil.getSourceNodeQuery(nodeMacro);
    if (nodeQuery != null) {
      SNode newInputNode=getNewInputNode(currentInputNode,nodeMacro,nodeQuery,context,reductionContext);
      return wrapAsList(newInputNode);
    }
    if (requiredSourceNodesQuery.contains(nodeMacro.getConcept().getId())) {
      generator.showErrorMessage(currentInputNode,nodeMacro,"couldn't get input nodes");
      throw new GenerationFailureException();
    }
    return Collections.singletonList(currentInputNode);
  }
 catch (  Throwable t) {
    generator.getLogger().handleException(t);
    generator.showErrorMessage(currentInputNode,nodeMacro,"couldn't get input nodes (see exception)");
    throw new GenerationFailureException(t);
  }
}
