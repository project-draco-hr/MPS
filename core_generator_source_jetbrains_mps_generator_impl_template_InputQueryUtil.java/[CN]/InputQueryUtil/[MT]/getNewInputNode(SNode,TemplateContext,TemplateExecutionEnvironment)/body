{
  try {
    SNode query=RuleUtil.getSourceNodeQuery(nodeMacro);
    if (query != null) {
      return getNewInputNode(nodeMacro,query,context,env.getQueryExecutor());
    }
    return context.getInput();
  }
 catch (  Throwable t) {
    env.getLogger().handleException(t);
    env.getGenerator().showErrorMessage(context.getInput(),nodeMacro,"couldn't get new input node");
    throw new GenerationFailureException(t);
  }
}
