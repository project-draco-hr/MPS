{
  try {
    SNode nodesQuery=RuleUtil.getSourceNodesQuery(nodeMacro);
    if (nodesQuery != null) {
      return getNewInputNodes(nodeMacro,nodesQuery,context,env.getQueryExecutor());
    }
    SNode nodeQuery=RuleUtil.getSourceNodeQuery(nodeMacro);
    if (nodeQuery != null) {
      SNode newInputNode=getNewInputNode(nodeMacro,nodeQuery,context,env.getQueryExecutor());
      return wrapAsList(newInputNode);
    }
    if (requiredSourceNodesQuery.contains(nodeMacro.getConcept().getQualifiedName())) {
      env.getLogger().error(nodeMacro.getReference(),"couldn't get input nodes",GeneratorUtil.describeInput(context));
      throw new GenerationFailureException("couldn't get input nodes");
    }
    return Collections.singletonList(context.getInput());
  }
 catch (  Throwable t) {
    env.getLogger().handleException(t);
    env.getLogger().error(nodeMacro.getReference(),"couldn't get input nodes (see exception)",GeneratorUtil.describeInput(context));
    throw new GenerationFailureException(t);
  }
}
