{
  prepare();
  ListSequence.<SNodeId>fromList(myPreparedIdsToDelete).visitAll(new IVisitor<SNodeId>(){
    public void visit(    SNodeId id){
      model.getNodeById(id).delete();
    }
  }
);
  myPreparedIdsToDelete=null;
  List<SNode> nodesToAdd=ListSequence.<SNode>fromList(new ArrayList<SNode>());
  List<SNode> newChildren=getChangeSet().getNewModel().getNodeById(myParentNodeId).getChildren(myRole);
  for (int i=myResultBegin; i < myResultEnd; i++) {
    ListSequence.<SNode>fromList(nodesToAdd).addElement(nodeCopier.copyNode(newChildren.get(i)));
  }
  SNode anchor=(myPreparedAnchorId == null ? null : model.getNodeById(myPreparedAnchorId));
  SNode parent=model.getNodeById(myParentNodeId);
  for (  SNode newNode : ListSequence.<SNode>fromList(nodesToAdd).reversedList()) {
    parent.insertChild(anchor,myRole,newNode);
  }
}
