{
  myMinorStep=-1;
  List<TemplateMappingConfiguration> mappingConfigurations=new ArrayList<TemplateMappingConfiguration>(myGenerationPlan.getMappingConfigurations(myMajorStep));
  if (mappingConfigurations.isEmpty()) {
    if (inputModel.getRootNodes().iterator().hasNext()) {
      myLogger.warning("skip model \"" + inputModel.getReference().getModelName() + "\" : no generator available");
    }
    return inputModel;
  }
  if (myLogger.needsInfo()) {
    printGenerationStepData(inputModel);
  }
  mySessionContext=new GenerationSessionContext(mySessionContext);
  myLogger.setOperationContext(mySessionContext);
  Iterator<TemplateMappingConfiguration> it=mappingConfigurations.iterator();
  TemplateGenerator templateGenerator=new TemplateGenerator(mySessionContext,myProgressMonitor,null,inputModel,null,myDependenciesBuilder,ttrace);
  try {
    LinkedList<TemplateMappingConfiguration> drop=new LinkedList<TemplateMappingConfiguration>();
    while (it.hasNext()) {
      TemplateMappingConfiguration c=it.next();
      if (!c.isApplicable(templateGenerator)) {
        drop.add(c);
        it.remove();
      }
    }
    if (!drop.isEmpty()) {
      printMappingConfigurations("drop mapping configurations (not applicable):",drop);
    }
  }
 catch (  GenerationFailureException ex) {
    throw ex;
  }
catch (  GenerationException ex) {
    myLogger.handleException(ex);
    myLogger.error("Failed to evaluate MappingConfiguration.isApplicable");
    throw new GenerationFailureException(ex);
  }
  if (mappingConfigurations.isEmpty()) {
    return inputModel;
  }
  Collections.sort(mappingConfigurations,new Comparator<TemplateMappingConfiguration>(){
    @Override public int compare(    TemplateMappingConfiguration o1,    TemplateMappingConfiguration o2){
      TemplateModel m1=o1.getModel();
      TemplateModel m2=o2.getModel();
      int result=m1 == m2 ? 0 : m1.getLongName().compareTo(m2.getLongName());
      if (result != 0) {
        return result;
      }
      return o1.getName().compareTo(o2.getName());
    }
  }
);
  RuleManager ruleManager=new RuleManager(myGenerationPlan,mappingConfigurations,myLogger);
  SModel outputModel=executeMajorStepInternal(inputModel,ruleManager);
  if (myLogger.getErrorCount() > 0) {
    myLogger.warning("model \"" + inputModel.getReference().getModelName() + "\" has been generated with errors");
  }
  return outputModel;
}
