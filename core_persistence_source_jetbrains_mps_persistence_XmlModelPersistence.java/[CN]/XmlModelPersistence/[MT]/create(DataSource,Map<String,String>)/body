{
  if (!(dataSource instanceof StreamDataSource)) {
    throw new UnsupportedDataSourceException(dataSource);
  }
  String moduleRef=options.get(OPTION_MODULEREF);
  String relPath=options.get(OPTION_RELPATH);
  String modelName=options.get(OPTION_MODELNAME);
  if (relPath == null || moduleRef == null || modelName == null || !relPath.equals(NameUtil.pathFromNamespace(modelName) + "." + XML_EXTENSION)) {
    throw new IOException("cannot create xml model from " + dataSource.getLocation());
  }
  SModelId id=PersistenceFacade.getInstance().createModelId("path:" + relPath);
  SModuleReference mref=PersistenceFacade.getInstance().createModuleReference(moduleRef);
  if (mref == null) {
    throw new IOException("cannot create xml model for " + moduleRef);
  }
  SModelReference ref=PersistenceFacade.getInstance().createModelReference(mref,id,modelName);
  return new CustomPersistenceSModel(ref,(StreamDataSource)dataSource,this);
}
