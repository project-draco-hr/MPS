{
  try {
    myCellSwapInProgress=true;
    if (mySelectedCell != null)     myRecentlySelectedCellInfo=mySelectedCell.getCellInfo();
    Object memento=null;
    if (getEditorContext() != null) {
      memento=getEditorContext().createMemento();
    }
    myFoldedCells.clear();
    myBracesEnabledCells.clear();
    action.run();
    if (getEditorContext() != null) {
      getEditorContext().setMemento(memento);
    }
    myRecentlySelectedCellInfo=null;
  }
  finally {
    myCellSwapInProgress=false;
  }
}
