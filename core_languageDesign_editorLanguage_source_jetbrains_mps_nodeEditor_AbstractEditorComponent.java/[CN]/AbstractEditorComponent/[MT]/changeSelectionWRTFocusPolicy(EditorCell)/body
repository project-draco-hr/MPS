{
  EditorCell focusPolicyCell=FocusPolicyUtil.findCellToSelectDueToFocusPolicy(cell);
  EditorCell toSelect;
  if (focusPolicyCell == null || (focusPolicyCell == cell && !focusPolicyCell.hasFocusPolicy())) {
    toSelect=EditorUtil.findErrorOrEditableCell(cell);
    if (toSelect == null) {
      toSelect=EditorUtil.findFirstSelectableCell(cell);
    }
  }
 else {
    toSelect=focusPolicyCell;
  }
  if (toSelect == null)   toSelect=cell;
  changeSelection(toSelect);
  if (toSelect instanceof EditorCell_Label) {
    EditorCell_Label label=(EditorCell_Label)toSelect;
    if (label.getDefaultCaretPosition() != null) {
      if (label.getDefaultCaretPosition() == CaretPosition.FIRST) {
        label.getTextLine().home();
      }
      if (label.getDefaultCaretPosition() == CaretPosition.LAST) {
        label.getTextLine().end();
      }
    }
 else     if (!toSelect.isErrorState()) {
      label.getTextLine().end();
    }
  }
  return toSelect;
}
