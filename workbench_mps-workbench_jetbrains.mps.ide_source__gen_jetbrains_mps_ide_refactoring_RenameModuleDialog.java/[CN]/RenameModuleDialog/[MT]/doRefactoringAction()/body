{
  myProject.getRepository().getModelAccess().executeCommand(new Runnable(){
    public void run(){
      final String fqName=getCurrentValue();
      for (      final SModule module : myProject.getRepository().getModules()) {
        if (fqName.equals(module.getModuleName())) {
          setErrorText("Duplicate module name");
          return;
        }
      }
      if (myProject instanceof StandaloneMPSProject) {
        StandaloneMPSProject smp=(StandaloneMPSProject)myProject;
        String folder=smp.getFolderFor(myModule);
        String oldName=myModule.getDescriptorFile().getPath();
        Renamer.renameModule(myModule,fqName);
        final ProjectDescriptor projectDescriptor=smp.getProjectDescriptor();
        String virtualFolder=projectDescriptor.removeModulePath(new ModulePath(oldName));
        ModulePath modulePath=new ModulePath(myModule.getDescriptorFile().getPath(),virtualFolder);
        projectDescriptor.addModulePath(modulePath);
      }
 else {
        Renamer.renameModule(myModule,fqName);
      }
      callSuper();
    }
  }
);
}
