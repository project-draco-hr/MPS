{
  StructuralNodeSet<?> frontier=new StructuralNodeSet();
  StructuralNodeSet<?> newFrontier=new StructuralNodeSet();
  StructuralNodeSet<?> yetPassed=new StructuralNodeSet();
  Set<SNode> result=new HashSet<SNode>();
  frontier.add(left);
  while (!frontier.isEmpty()) {
    Set<SNode> yetPassedRaw=new HashSet<SNode>();
    StructuralNodeSet<?> ancestors=new StructuralNodeSet();
    for (    SNode node : frontier) {
      collectImmediateSuperTypes(node,true,ancestors,context);
      yetPassedRaw.add(node);
    }
    for (    SNode ancestor : ancestors) {
      if (isSubtype(right,ancestor,true)) {
        if (!isSuperType(ancestor,result)) {
          result.add(ancestor);
        }
      }
    }
    for (    SNode passedNodeRaw : yetPassedRaw) {
      yetPassed.add(passedNodeRaw);
    }
    for (    SNode passedNode : yetPassed) {
      ancestors.removeStructurally(passedNode);
    }
    for (    SNode resultNode : result) {
      ancestors.removeStructurally(resultNode);
    }
    newFrontier.addAllStructurally(ancestors);
    yetPassed.addAllStructurally(ancestors);
    frontier=newFrontier;
    newFrontier=new StructuralNodeSet();
  }
  return result;
}
