{
  for (  StructureModification.Entry d : ListSequence.fromList(data.getData())) {
    Sequence.fromIterable(d.getDependentModels()).visitAll(new IVisitor<SModelReference>(){
      public void visit(      SModelReference it){
        data.addDependencyModel(it);
      }
    }
);
  }
  for (  IMapping<SModelReference,Integer> d : MapSequence.fromMap(data.getDependencies())) {
    EditableSModelDescriptor model=(EditableSModelDescriptor)SModelRepository.getInstance().getModelDescriptor(d.key());
    StructureModificationHistory0 history=RefactoringsPersistence.load0(model.getModelFile());
    if (history == null) {
      history=new StructureModificationHistory0();
    }
    history.addStructureModification(data);
    model.setVersion(d.value() + 1);
    RefactoringsPersistence.save0(model.getModelFile(),history);
    SModelRepository.getInstance().markChanged(model,true);
  }
}
