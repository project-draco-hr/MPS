{
  Point[] cornerPoints=border.getCornerPoints();
  boolean foundOnBorder=false;
  Point p=null;
  List<Point> newRoute=ListSequence.fromList(new LinkedList<Point>());
  for (  Point q : ListSequence.fromList(route)) {
    if (foundOnBorder) {
      ListSequence.fromList(newRoute).addElement(q);
    }
 else {
      if (p == null || p.equals(q)) {
        p=q;
        continue;
      }
      Point bp=cornerPoints[3];
      for (      Point bq : cornerPoints) {
        Point res=jetbrains.mps.graphLayout.intGeom2D.GeomUtil.intersectGrid(p,q,bp,bq);
        if (res != null) {
          ListSequence.fromList(newRoute).addElement(res);
          if (!(res.equals(q))) {
            ListSequence.fromList(newRoute).addElement(q);
          }
          foundOnBorder=true;
          break;
        }
        bp=bq;
      }
      p=q;
    }
  }
  return newRoute;
}
