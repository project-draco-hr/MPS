{
  final SearchResults[] results=new SearchResults[1];
  ThreadUtils.runInUIThreadAndWait(new Runnable(){
    public void run(){
      ProgressManager.getInstance().run(new Modal(project,"Searching",true){
        public void run(        @NotNull final ProgressIndicator indicator){
          ModelAccess.instance().runReadAction(new Runnable(){
            public void run(){
              indicator.setIndeterminate(true);
              long time=provider.getEstimatedTime(query.getScope());
              results[0]=provider.getResults(query,indicator);
            }
          }
);
        }
      }
);
    }
  }
);
  return results[0];
}
