{
  CompilerManagerImpl.testSetup();
  ModuleRootManager mrm=ModuleRootManager.getInstance(myFacet.getModule());
  VirtualFile[] srs=mrm.getSourceRoots();
  assertTrue(srs.length == 2);
  VirtualFile models=srs[0];
  assertEquals("models",models.getName());
  assertTrue(models.getChildren().length == 1);
  assertExists(models,"broken.mps");
  final VirtualFile moduleDir=models.getParent();
  assertTrue(moduleDir.findChild("src") == null);
  CompilerManager cm=CompilerManager.getInstance(myFacet.getModule().getProject());
  assertCompiles(cm,4,0);
  MPSCompiler2[] mpscs=cm.getCompilers(MPSCompiler2.class);
  assertSame(1,mpscs.length);
  assertNotExists(moduleDir,"src");
  getVFS().refresh(false);
  assertNotExists(moduleDir,"source_gen");
  VirtualFile cachesOutputDir=getVFS().findFileByPath(MPSCompilerPaths.getCachesOutputPath(mpscs[0],myFacet.getModule(),false));
  assertNull(cachesOutputDir);
}
