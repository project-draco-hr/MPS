{
  if (child && role.equals(GeneratorUtilEx.link_BaseConcept_attrs)) {
    return null;
  }
  SNode concept=((jetbrains.mps.smodel.SNode)sourceNode).getConceptDeclarationNode();
  if (concept == null) {
    return new RoleValidationStatus(sourceNode,"cannot find concept '" + sourceNode.getConcept().getId() + "'");
  }
  SNode link=SModelSearchUtil.findMostSpecificLinkDeclaration(concept,role);
  if (link == null) {
    String relationKind=child ? "child" : "referent";
    return new RoleValidationStatus(sourceNode,"concept '" + concept.getName() + "' cannot have "+ relationKind+ " with role '"+ role+ "'",GeneratorUtil.describe(targetNode,relationKind + (child ? "" : " (hidden in editor)")));
  }
  if (!myShowBadChildWarning) {
    return null;
  }
  if (!SModelUtil.isAcceptableTarget(link,targetNode)) {
    if (child && targetNode.getUserObject(DelayedChanges.MAP_SRC_TEMP_NODE) != null) {
      return null;
    }
    SNode linkDeclarationTarget=SModelUtil.getLinkDeclarationTarget(link);
    String expected=linkDeclarationTarget != null ? linkDeclarationTarget.getName() : "<unknown>";
    String was=NameUtil.shortNameFromLongName(targetNode.getConcept().getId());
    String relationKind=child ? "child" : "referent";
    return new RoleValidationStatus(sourceNode,relationKind + " '" + expected+ "' is expected for role '"+ role+ "' but was '"+ was+ "'",GeneratorUtil.describe(targetNode,relationKind));
  }
  return null;
}
