{
  Set<SModelDescriptor> result=new LinkedHashSet<SModelDescriptor>();
  ModelGenerationStatusManager statusManager=ModelGenerationStatusManager.getInstance();
  for (  SModelDescriptor md : models) {
    if (!(md instanceof GeneratableSModelDescriptor))     continue;
    GeneratableSModelDescriptor sm=(GeneratableSModelDescriptor)md;
    if (!sm.isGeneratable())     continue;
    if (statusManager.generationRequired(sm,context)) {
      result.add(sm);
      continue;
    }
    if (!(SModelStereotype.DESCRIPTOR.equals(sm.getStereotype()) || LanguageAspect.BEHAVIOR.is(sm) || LanguageAspect.CONSTRAINTS.is(sm))) {
      continue;
    }
    GenerationDependencies oldDependencies=GenerationDependenciesCache.getInstance().get(sm);
    if (oldDependencies == null) {
      continue;
    }
    Map<String,String> externalHashes=oldDependencies.getExternalHashes();
    for (    Entry<String,String> entry : externalHashes.entrySet()) {
      String modelReference=entry.getKey();
      SModelDescriptor rmd=SModelRepository.getInstance().getModelDescriptor(SModelReference.fromString(modelReference));
      if (rmd == null) {
        result.add(sm);
        break;
      }
      String oldHash=entry.getValue();
      if (oldHash == null) {
        continue;
      }
      String newHash=ModelGenerationStatusManager.getInstance().currentHash(rmd,context);
      if (newHash == null || !oldHash.equals(newHash)) {
        result.add(sm);
        break;
      }
    }
  }
  return result;
}
