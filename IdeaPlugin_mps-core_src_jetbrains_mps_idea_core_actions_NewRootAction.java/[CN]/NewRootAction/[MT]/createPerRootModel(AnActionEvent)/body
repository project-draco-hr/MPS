{
  final PsiElement psiElement=e.getData(LangDataKeys.PSI_ELEMENT);
  if (psiElement == null || !(psiElement instanceof PsiDirectory)) {
    return true;
  }
  final VirtualFile targetDir=((PsiDirectory)psiElement).getVirtualFile();
  myModelDescriptor=new ModelAccessHelper(ProjectHelper.getModelAccess(myProject)).executeCommand(new Computable<EditableSModel>(){
    @Override public EditableSModel compute(){
      ModelRoot useModelRoot=null;
      String useSourceRoot=null;
      for (      ModelRoot root : myOperationContext.getModule().getModelRoots()) {
        if (!(root instanceof DefaultModelRoot))         continue;
        DefaultModelRoot modelRoot=(DefaultModelRoot)root;
        for (        String sourceRoot : modelRoot.getFiles(DefaultModelRoot.SOURCE_ROOTS)) {
          if (FileUtil.isSubPath(sourceRoot,targetDir.getPath())) {
            useModelRoot=root;
            useSourceRoot=targetDir.getPath();
            break;
          }
        }
      }
      if (useModelRoot == null)       return null;
      final String modelName=((PsiDirectory)psiElement).getPresentation().getLocationString();
      EditableSModel model=null;
      try {
        model=(EditableSModel)((DefaultModelRoot)useModelRoot).createModel(modelName,useSourceRoot,null,PersistenceRegistry.getInstance().getFolderModelFactory("file-per-root"));
      }
 catch (      IOException ioException) {
        LOG.error("Can't create per-root model " + modelName + " under "+ useSourceRoot,ioException);
      }
      model.setChanged(true);
      model.load();
      model.save();
      ModelsAutoImportsManager.doAutoImport(useModelRoot.getModule(),model);
      new MissingDependenciesFixer(model).fixModuleDependencies();
      return model;
    }
  }
);
  return false;
}
