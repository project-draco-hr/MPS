{
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      AbstractOperation rootDifference=myCurrentContext.getOperation();
      Object difference=newNode.getUserObject();
      if (myOldOperation == null) {
        myCurrentState.clear(false);
        myCurrentState.executeOperationsBeforeAnchor(rootDifference,difference);
      }
 else {
        myCurrentState.updateState(myOldOperation,(AbstractOperation)difference);
      }
      myParent.resetState(myCurrentState);
      AbstractOperation nextDiff=findUltimateConsequence((AbstractOperation)difference);
      if (nextDiff != null && nextDiff != difference) {
        myCurrentState.updateState((AbstractOperation)difference,(AbstractOperation)nextDiff);
        myParent.updateState(myCurrentState);
        myOldOperation=(AbstractOperation)nextDiff;
      }
 else {
        myOldOperation=(AbstractOperation)difference;
      }
    }
  }
);
}
