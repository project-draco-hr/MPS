{
  try {
    if (!isIncrementalMode() || refreshTypes) {
      clear();
    }
 else {
      myState.clearStateObjects();
      doInvalidate();
      myPartlyCheckedNodes.addAll(myFullyCheckedNodes);
      myFullyCheckedNodes.clear();
    }
    if (!loadTypesystemRules(nodeToCheck)) {
      return;
    }
    computeTypesForNode(nodeToCheck,forceChildrenCheck,additionalNodes);
    solveInequalitiesAndExpandTypes(finalExpansion);
    performActionsAfterChecking();
  }
  finally {
    myInvalidationWasPerformed=false;
  }
}
