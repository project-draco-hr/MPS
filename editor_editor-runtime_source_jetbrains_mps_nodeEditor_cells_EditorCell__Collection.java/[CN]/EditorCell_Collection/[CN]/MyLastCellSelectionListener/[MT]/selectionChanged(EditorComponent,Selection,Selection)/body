{
  if (myClosingBrace.isSelected() || myOpeningBrace.isSelected()) {
    enableBraces();
    return;
  }
  jetbrains.mps.openapi.editor.cells.EditorCell deepestSelection=editorComponent.getDeepestSelectedCell();
  jetbrains.mps.openapi.editor.cells.EditorCell lastSelectableLeaf=findChild(LAST_SELECTABLE_LEAF_EXCLUDING_BRACE);
  jetbrains.mps.openapi.editor.cells.EditorCell firstSelectableLeaf=findChild(FIRST_SELECTABLE_LEAF_EXCLUDING_BRACE);
  if (deepestSelection instanceof EditorCell_Brace) {
    EditorCell_Collection braceOwner=(EditorCell_Collection)deepestSelection.getParent();
    if (braceOwner.myClosingBrace == deepestSelection && braceOwner.findChild(LAST_SELECTABLE_LEAF_EXCLUDING_BRACE) == lastSelectableLeaf) {
      enableBraces();
      return;
    }
    if (braceOwner.myOpeningBrace == deepestSelection && braceOwner.findChild(FIRST_SELECTABLE_LEAF_EXCLUDING_BRACE) == firstSelectableLeaf) {
      enableBraces();
      return;
    }
  }
  if (lastSelectableLeaf == deepestSelection || firstSelectableLeaf == deepestSelection) {
    enableBraces();
  }
 else {
    disableBraces();
  }
}
