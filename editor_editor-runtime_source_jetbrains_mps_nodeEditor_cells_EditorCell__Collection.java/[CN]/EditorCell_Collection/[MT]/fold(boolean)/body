{
  if (!isFoldable())   return;
  if (isFolded()) {
    if (isInTree()) {
      getEditor().setFolded(this,true);
    }
    return;
  }
  setFolded(true);
  if (!isInTree()) {
    return;
  }
  if (!isUnderFolded()) {
    addUnfoldingListener();
    removeFoldingListenerForChildren();
  }
  if (!programmaticaly) {
    getContext().flushEvents();
    getEditor().relayout();
    adjustSelectionToFoldingState(getEditor());
  }
}
