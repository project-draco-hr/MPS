{
  List<Node> segments=ListSequence.<Node>fromList(new LinkedList<Node>());
  List<Direction2D> directions=ListSequence.<Direction2D>fromList(new LinkedList<Direction2D>());
  List<Integer> rotations=ListSequence.<Integer>fromList(new LinkedList<Integer>());
  Node prevSeg=null;
  for (  Dart dart : ListSequence.<Dart>fromList(face.getDarts())) {
    Direction2D dir=MapSequence.<Dart,Direction2D>fromMap(myDirections).get(dart);
    Node source=dart.getSource();
    Node seg;
    if (dir.isHorizontal()) {
      seg=MapSequence.<Node,Node>fromMap(myHorNodeMap).get(source);
    }
 else {
      seg=MapSequence.<Node,Node>fromMap(myVerNodeMap).get(source);
    }
    if (seg != prevSeg) {
      if (prevSeg != null) {
        ListSequence.<Integer>fromList(rotations).addElement(ListSequence.<Direction2D>fromList(directions).last().getTurn(dir));
      }
      ListSequence.<Node>fromList(segments).addElement(seg);
      ListSequence.<Direction2D>fromList(directions).addElement(dir);
    }
    prevSeg=seg;
  }
  if (prevSeg != ListSequence.<Node>fromList(segments).first()) {
    ListSequence.<Integer>fromList(rotations).addElement(ListSequence.<Direction2D>fromList(directions).last().getTurn(ListSequence.<Direction2D>fromList(directions).first()));
  }
 else {
    ListSequence.<Direction2D>fromList(directions).removeLastElement();
    ListSequence.<Node>fromList(segments).removeLastElement();
  }
  if (ConstraintsGraphProcessor.SHOW_INFO > 0) {
    System.out.println(face);
    for (int i=0; i < ListSequence.<Node>fromList(segments).count(); i++) {
      System.out.println(ListSequence.<Node>fromList(segments).getElement(i) + " dir = " + ListSequence.<Direction2D>fromList(directions).getElement(i)+ " rot = "+ ListSequence.<Integer>fromList(rotations).getElement(i));
    }
  }
  int numShifts=0;
  while (ListSequence.<Node>fromList(segments).count() > 4) {
    if (ListSequence.<Integer>fromList(rotations).getElement(0) == -1 && ListSequence.<Integer>fromList(rotations).getElement(1) == 1 && ListSequence.<Integer>fromList(rotations).getElement(2) == 1) {
      connectPattern(segments,directions);
      for (int i=0; i < 2; i++) {
        ListSequence.<Node>fromList(segments).removeElementAt(1);
        ListSequence.<Integer>fromList(rotations).removeElementAt(1);
        ListSequence.<Direction2D>fromList(directions).removeElementAt(1);
      }
      ListSequence.<Integer>fromList(rotations).setElement(0,1);
      numShifts=0;
    }
 else {
      ListSequence.<Node>fromList(segments).insertElement(0,ListSequence.<Node>fromList(segments).removeLastElement());
      ListSequence.<Integer>fromList(rotations).insertElement(0,ListSequence.<Integer>fromList(rotations).removeLastElement());
      ListSequence.<Direction2D>fromList(directions).insertElement(0,ListSequence.<Direction2D>fromList(directions).removeLastElement());
      numShifts++;
      if (numShifts > ListSequence.<Node>fromList(segments).count()) {
        throw new RuntimeException("error in segments");
      }
    }
  }
  if (ConstraintsGraphProcessor.DEBUG > 0) {
    for (    int rotation : ListSequence.<Integer>fromList(rotations)) {
      if (rotation != 1) {
        throw new RuntimeException("bad face completion result!");
      }
    }
  }
  connectPattern(segments,directions);
}
