{
  Node[] ends=getSegmentEnds(segment,direction);
  Map<Node,Node> nodeMap;
  if (direction.isHorizontal()) {
    nodeMap=myVerNodeMap;
  }
 else {
    nodeMap=myHorNodeMap;
  }
  for (int i=0; i < ends.length; i++) {
    ends[i]=MapSequence.<Node,Node>fromMap(nodeMap).get(ends[i]);
  }
  return ends;
}
