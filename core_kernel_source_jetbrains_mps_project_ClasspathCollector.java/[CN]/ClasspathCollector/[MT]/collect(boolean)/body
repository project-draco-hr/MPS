{
  Set<IModule> modules=new LinkedHashSet<IModule>();
  Set<Language> usedLanguages=new LinkedHashSet<Language>();
  for (  IModule m : myStart) {
    m.getDependenciesManager().collectAllCompileTimeDependencies(modules,usedLanguages);
  }
  for (  IModule module : modules) {
    addPart(module.getClassPathItem());
  }
  for (  Language l : usedLanguages) {
    addPart(l.getLanguageRuntimeClasspath());
  }
  CompositeClassPathItem result=new CompositeClassPathItem();
  if (includeStubSolutions) {
    result.add(CommonPaths.getJDKClassPath());
    result.add(CommonPaths.getMPSClassPath());
    result.add(CommonPaths.getTestbenchClassPath());
    for (    Solution s : MPSModuleRepository.getInstance().getAllSolutions()) {
      if (s.isStub()) {
        result.add(s.getClassPathItem());
      }
    }
  }
  for (  IClassPathItem item : myResult) {
    result.add(item);
  }
  return result.optimize();
}
