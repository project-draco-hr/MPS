{
  Runnable refresh=null;
  final VirtualFile vf=getVirtualFile();
  if (vf == null) {
    final LocalHistoryAction action=startLocalHistoryAction(revision);
    final VirtualFile vp=getVirtualParent();
    if (vp != null) {
      ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
        public void run(){
          vp.refresh(false,true,new Runnable(){
            public void run(){
              myFilePath.refresh();
              action.finish();
            }
          }
);
        }
      }
,"Refreshing files...",false,myProject);
    }
  }
 else {
    FileDocumentManager.getInstance().saveDocument(FileDocumentManager.getInstance().getDocument(vf));
  }
}
