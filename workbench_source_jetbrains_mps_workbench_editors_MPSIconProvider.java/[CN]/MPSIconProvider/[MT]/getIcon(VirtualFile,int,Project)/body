{
  if (file instanceof MPSNodeVirtualFile) {
    MPSNodeVirtualFile nodeFile=(MPSNodeVirtualFile)file;
    FileEditor[] editors=FileEditorManager.getInstance(project).getEditors(file);
    if (editors != null && editors.length > 0) {
      FileEditor editor=editors[0];
      if (editor instanceof MPSFileNodeEditor) {
        IEditor nodeEditor=((MPSFileNodeEditor)editor).getNodeEditor();
        if (nodeEditor instanceof TabbedEditor) {
          TabbedEditor tabbedEditor=(TabbedEditor)nodeEditor;
          EditorComponent tabEditor=tabbedEditor.getTabbedPane().getCurrentTab().getCurrentEditorComponent();
          if (tabEditor instanceof NodeEditorComponent) {
            SNode node=((NodeEditorComponent)tabEditor).getEditedNode();
            if (node != null) {
              return IconManager.getIconFor(node);
            }
          }
        }
      }
    }
    return IconManager.getIconFor(nodeFile.getNode());
  }
  if (file instanceof MPSLanguageVirtualFile) {
    return Icons.PROJECT_LANGUAGE_ICON;
  }
  return null;
}
