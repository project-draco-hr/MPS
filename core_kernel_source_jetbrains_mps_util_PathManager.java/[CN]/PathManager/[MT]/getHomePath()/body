{
  if (ourHomePath != null) {
    return ourHomePath;
  }
  String rootPath=getContainingJar(PathManager.class);
  File root=new File(rootPath);
  root=root.getAbsoluteFile();
  if (rootPath.endsWith(DOT_JAR)) {
    root=root.getParentFile();
    if (root != null) {
      root=root.getParentFile();
    }
  }
 else {
    while ((!isMpsDir(root)) && (root.getParentFile() != null)) {
      root=root.getParentFile();
    }
  }
  ourHomePath=root.getAbsolutePath();
  if (ourHomePath.equals("/")) {
    throw new IllegalStateException("cannot detect MPS location");
  }
  return ourHomePath;
}
