{
  Map<Edge,Edge> modifiedEdges=MapSequence.fromMap(new HashMap<Edge,Edge>());
  for (  Node node : SetSequence.fromSet(MapSequence.fromMap(nodesToProcess).keySet())) {
    MapSequence.fromMap(myCornerNodes).put(node,new Node[4]);
    List<Node> nodes=MapSequence.fromMap(nodesToProcess).get(node);
    if (ListSequence.fromList(nodes).count() == 0) {
      makeRectangleForSingleNode(node,modifiedEdges);
    }
 else {
      makeRectangleForSplittedNode(node,MapSequence.fromMap(nodesToProcess).get(node));
    }
    if (SHOW_INFO > 0) {
      System.out.println("corner nodes for node " + node + ":");
      for (      Direction2D dir : Direction2D.values()) {
        System.out.println(dir + " = " + MapSequence.fromMap(myCornerNodes).get(node)[dir.ordinal()]);
      }
    }
  }
  return modifiedEdges;
}
