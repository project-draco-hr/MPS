{
  if (ourCurrent == null) {
    Environment env=(config.doesLoadIdea() ? new IdeaEnvironment(config) : new MpsEnvironment(config));
    env.init();
  }
 else {
    if (config.doesLoadIdea() && !(ourCurrent instanceof IdeaEnvironment)) {
      throw new IllegalStateException("Still no support for interchanging lightweight and heavyweight environments");
    }
  }
  return EnvironmentContainer.ourCurrent;
}
