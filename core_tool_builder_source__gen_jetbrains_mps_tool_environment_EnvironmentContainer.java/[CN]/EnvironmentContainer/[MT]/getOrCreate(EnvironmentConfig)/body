{
  if (ourCurrent == null) {
    if (LOG.isInfoEnabled()) {
      LOG.info("Initializing environment");
    }
    ourCurrent=(config.doesLoadIdea() ? new IdeaEnvironment(config) : new MpsEnvironment(config));
    ourCurrent.init();
  }
 else {
    if (config.doesLoadIdea() && !(ourCurrent instanceof IdeaEnvironment)) {
      throw new IllegalStateException("Still no support for interchanging lightweight and heavyweight environments");
    }
  }
  return EnvironmentContainer.ourCurrent;
}
