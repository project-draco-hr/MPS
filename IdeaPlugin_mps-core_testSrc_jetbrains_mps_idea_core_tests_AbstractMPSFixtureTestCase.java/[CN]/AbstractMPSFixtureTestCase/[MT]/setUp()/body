{
  super.setUp();
  myProjectBuilder=IdeaTestFixtureFactory.getFixtureFactory().createFixtureBuilder(getName());
  myFixture=JavaTestFixtureFactory.getFixtureFactory().createCodeInsightFixture(myProjectBuilder.getFixture());
  final JavaModuleFixtureBuilder moduleFixtureBuilder=myProjectBuilder.addModule(CustomJavaModuleFixtureBuilder.class);
  moduleFixtureBuilder.addSourceContentRoot(myFixture.getTempDirPath());
  tuneFixture(moduleFixtureBuilder);
  myFixture.setUp();
  myFixture.setTestDataPath(getTestDataPath());
  myModule=moduleFixtureBuilder.getFixture().getModule();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final String jdkHome=SystemProperties.getJavaHome();
      final String versionName=ProjectBundle.message("sdk.java.name.template",SystemProperties.getJavaVersion());
      ProjectRootManager.getInstance(myModule.getProject()).setProjectSdk(JavaSdk.getInstance().createJdk(versionName,jdkHome));
    }
  }
);
  CompilerWorkspaceConfiguration.getInstance(myModule.getProject()).USE_COMPILE_SERVER=false;
  myFacet=addMPSFacet(myModule);
  if (TRACE_ON_HACK)   Logger.setFactory(LoggerFactory.getInstance());
}
