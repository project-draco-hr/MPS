{
  indicator.pushState();
  try {
    indicator.setText("Compiling...");
    indicator.setIndeterminate(true);
    Set<IModule> candidates=new DependencyCollector(modules,IModule.class).collect();
    indicator.setText2("Loading dependencies..");
    myDependencies=new Dependencies(candidates);
    indicator.setText2("Calculating modules to compile...");
    Set<IModule> toCompile=getModulesToCompile(candidates);
    int errorCount=0;
    int warnCount=0;
    boolean compiled=false;
    List<Set<IModule>> schedule=StronglyConnectedModules.getInstance().getStronglyConnectedComponents(toCompile);
    for (    Set<IModule> cycle : schedule) {
      if (indicator.isCanceled())       break;
      indicator.setText2("Compiling modules " + cycle + "...");
      jetbrains.mps.make.CompilationResult result=compile(cycle);
      errorCount+=result.getErrors();
      warnCount+=result.getWarnings();
      compiled=compiled || result.isCompiledAnything();
    }
    return new jetbrains.mps.make.CompilationResult(errorCount,warnCount,false,compiled);
  }
  finally {
    indicator.popState();
  }
}
