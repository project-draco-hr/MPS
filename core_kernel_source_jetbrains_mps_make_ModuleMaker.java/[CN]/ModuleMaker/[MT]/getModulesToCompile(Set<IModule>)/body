{
  Set<IModule> dirtyModules=new HashSet<IModule>();
  for (  IModule m : modules) {
    if (isDirty(m)) {
      dirtyModules.add(m);
    }
  }
  Map<IModule,Set<IModule>> backDependencies=new HashMap<IModule,Set<IModule>>();
  for (  IModule m : modules) {
    for (    IModule dep : (List<IModule>)new ArrayList<IModule>(m.getDependenciesManager().getDependOnModules())) {
      if (!backDependencies.containsKey(dep)) {
        backDependencies.put(dep,new HashSet<IModule>());
      }
      backDependencies.get(dep).add(m);
    }
  }
  Set<IModule> toCompile=new LinkedHashSet<IModule>();
  for (  IModule dirty : dirtyModules) {
    collectToCompile(dirty,toCompile,backDependencies);
  }
  return toCompile;
}
