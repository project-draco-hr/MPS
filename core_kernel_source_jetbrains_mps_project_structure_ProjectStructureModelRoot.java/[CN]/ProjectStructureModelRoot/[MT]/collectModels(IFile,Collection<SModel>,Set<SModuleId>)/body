{
  if (FileSystem.getInstance().isFileIgnored(dir.getName()))   return;
  if (!dir.isDirectory())   return;
  List<ModuleHandle> moduleHandles=ModulesMiner.getInstance().collectModules(dir,false);
  for (  ModuleHandle handle : moduleHandles) {
    if (!seen.add(handle.getDescriptor().getId()))     continue;
    FileDataSource source=new FileDataSource(handle.getFile(),this);
    String stereotype=SModelStereotype.getStubStereotypeForId("project");
    String longName=handle.getDescriptor().getModuleReference().getModuleName();
    SModelFqName fqname=new SModelFqName(getModule().getModuleName(),longName,stereotype);
    SModelId modelId=jetbrains.mps.smodel.SModelId.foreign(stereotype,getModule().getModuleId().toString(),longName);
    SModelReference ref=new SModelReference(fqname,modelId);
    models.add(new ModuleFileSModel(ref,source));
  }
}
