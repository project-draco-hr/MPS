{
  MPSPsiNode psiNode=factory.create(node.getNodeId(),node.getConcept().getQualifiedName(),node.getRoleInParent());
  nodes.put(node.getNodeId(),psiNode);
  for (  String key : node.getPropertyNames()) {
    psiNode.setProperty(key,node.getProperty(key));
  }
  for (  SReference ref : node.getReferences()) {
    if (ref instanceof StaticReference) {
      psiNode.addChild(null,new MPSPsiRef(ref.getRole(),ref.getTargetSModelReference(),ref.getTargetNodeId()));
    }
 else     if (ref instanceof DynamicReference) {
      psiNode.addChild(null,new MPSPsiRef(ref.getRole(),((DynamicReference)ref).getResolveInfo()));
    }
  }
  MPSPsiNode last=null;
  for (  SNode root : node.getChildren()) {
    MPSPsiNode psiChild=convert(root,factory);
    psiNode.addChild(last,psiChild);
    last=psiChild;
  }
  return psiNode;
}
