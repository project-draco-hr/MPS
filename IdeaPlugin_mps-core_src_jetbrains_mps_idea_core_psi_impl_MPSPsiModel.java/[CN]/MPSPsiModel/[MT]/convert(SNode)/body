{
  MPSPsiNode psiNode=MPSPsiProvider.getInstance(getProject()).create(node.getNodeId(),node.getConcept(),node.getRoleInParent());
  myNodes.put(node.getNodeId(),psiNode);
  for (  String key : node.getPropertyNames()) {
    psiNode.setProperty(key,node.getProperty(key));
  }
  for (  SReference ref : node.getReferences()) {
    SLink link=ref.getLink();
    SAbstractConcept linkTargetConcept=link.getTargetConcept();
    MPSPsiRef psiRef=null;
    if (ref instanceof StaticReference) {
      psiRef=MPSPsiProvider.getInstance(getProject()).createReferenceNode(ref.getRole(),linkTargetConcept,ref.getTargetSModelReference(),ref.getTargetNodeId());
    }
 else     if (ref instanceof DynamicReference) {
      psiRef=MPSPsiProvider.getInstance(getProject()).createReferenceNode(ref.getRole(),linkTargetConcept,((DynamicReference)ref).getResolveInfo());
    }
    if (psiRef != null) {
      psiNode.addChild(null,psiRef);
    }
  }
  MPSPsiNode last=null;
  for (  SNode root : node.getChildren()) {
    MPSPsiNode psiChild=convert(root);
    psiNode.addChild(last,psiChild);
    last=psiChild;
  }
  return psiNode;
}
