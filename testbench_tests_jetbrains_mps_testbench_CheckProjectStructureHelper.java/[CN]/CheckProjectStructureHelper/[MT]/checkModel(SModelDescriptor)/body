{
  final IScope scope=sm.getModule().getScope();
  StringBuilder errorMessages=new StringBuilder();
  List<String> validationResult=ModelAccess.instance().runReadAction(new Computable<List<String>>(){
    public List<String> compute(){
      return new ModelValidator(sm.getSModel()).validate(scope);
    }
  }
);
  if (!validationResult.isEmpty()) {
    errorMessages.append("errors in model: ").append(sm.getSModelReference().toString()).append("\n");
    for (    String item : validationResult) {
      errorMessages.append("\t");
      errorMessages.append(item);
      errorMessages.append("\n");
    }
  }
  for (  SNode node : sm.getSModel().nodes()) {
    Testbench.LOG.debug("Checking node " + node);
    if (SModelUtil.findConceptDeclaration(node.getConceptFqName(),GlobalScope.getInstance()) == null) {
      errorMessages.append("Unknown concept ");
      errorMessages.append(node.getConceptFqName());
      errorMessages.append("\n");
    }
  }
  for (  SNode node : sm.getSModel().nodes()) {
    for (    SReference ref : (List<SReference>)jetbrains.mps.util.SNodeOperations.getReferences(node)) {
      if (SNodeUtil.hasReferenceMacro(node,ref.getRole())) {
        continue;
      }
      if (ref.getTargetNodeSilently() == null) {
        errorMessages.append("Broken reference in model {").append(node.getModel().getLongName()).append("}").append(" node ").append(node.getSNodeId().toString()).append("(").append(node).append(")\n");
      }
    }
  }
  return errorMessages;
}
