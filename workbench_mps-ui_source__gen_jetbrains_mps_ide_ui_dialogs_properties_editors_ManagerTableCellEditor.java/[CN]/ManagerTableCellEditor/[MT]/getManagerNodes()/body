{
  final List<SNode> result=new ArrayList<SNode>();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      for (      Language l : ModuleRepositoryFacade.getInstance().getAllModules(Language.class)) {
        SModelDescriptor stubsAspect=LanguageAspect.STUBS.get(l);
        if (stubsAspect == null) {
          continue;
        }
        SModel model=stubsAspect.getSModel();
        result.addAll(SModelOperations.getRoots(model,"jetbrains.mps.lang.stubs.structure.ModelManagerDeclaration"));
      }
      for (      Solution s : ModuleRepositoryFacade.getInstance().getAllModules(Solution.class)) {
        if (!(SolutionKind.NONE.equals(s.getModuleDescriptor().getKind()))) {
          for (          SModelDescriptor smd : SModelRepository.getInstance().getModelDescriptors(s)) {
            if (jetbrains.mps.util.SNodeOperations.getModelLongName(smd).endsWith(".stubManagers")) {
              SModel m=smd.getSModel();
              ListSequence.fromList(result).addSequence(ListSequence.fromList(SModelOperations.getRoots(m,"jetbrains.mps.lang.stubs.structure.ModelManagerDeclaration")));
            }
          }
        }
      }
    }
  }
);
  return result;
}
