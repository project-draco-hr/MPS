{
  if (newSelection == null) {
    clearBracesSelection();
    return;
  }
  EditorCell cellToSelect=null;
  if (getMatchingLabelAndCell(newSelection) != null) {
    cellToSelect=newSelection;
  }
 else   if (newSelection instanceof EditorCell_Label) {
    EditorCell_Label editorCell=(EditorCell_Label)newSelection;
    if (editorCell.getCaretPosition() == 0) {
      jetbrains.mps.openapi.editor.cells.EditorCell cell=CellTraversalUtil.getPrevLeaf(editorCell);
      if (cell instanceof EditorCell_Label) {
        EditorCell_Label label=(EditorCell_Label)cell;
        if (label.getWidth() == 0 && editorCell.getLeftInset() == 0) {
          cellToSelect=label;
        }
      }
    }
 else     if (editorCell.getCaretPosition() == editorCell.getText().length()) {
      jetbrains.mps.openapi.editor.cells.EditorCell cell=CellTraversalUtil.getNextLeaf(editorCell);
      if (cell instanceof EditorCell_Label) {
        EditorCell_Label label=(EditorCell_Label)cell;
        if (label.getWidth() == 0 && editorCell.getRightInset() == 0) {
          cellToSelect=label;
        }
      }
    }
  }
  if (cellToSelect == null) {
    clearBracesSelection();
    return;
  }
  selectBraces(cellToSelect);
}
