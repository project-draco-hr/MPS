{
  EditorComponent nodeEditor=editorContext.getNodeEditorComponent();
  nodeEditor.hideMessageToolTip();
  if (keyEvent.isConsumed() || !editorContext.isEditable()) {
    return false;
  }
  if (processSelectedCell(editorContext,keyEvent,false)) {
    return true;
  }
  if (processKeyMaps(editorContext,keyEvent)) {
    return true;
  }
  if (processSideDeletes(editorContext,keyEvent)) {
    return true;
  }
  CellActionType actionType=editorContext.getNodeEditorComponent().getActionType(keyEvent,editorContext);
  EditorCell selectedCell=editorContext.getSelectedCell();
  if (selectedCell != null) {
    boolean endEditKeystroke=isEndEditKeystroke(keyEvent);
    boolean strictMatching=endEditKeystroke || CellActionType.RIGHT_TRANSFORM.equals(actionType) || CellActionType.LEFT_TRANSFORM.equals(actionType);
    if (selectedCell.isErrorState()) {
      if (endEditKeystroke || actionType == CellActionType.INSERT || actionType == CellActionType.INSERT_BEFORE) {
        if (selectedCell.validate(strictMatching,true)) {
          return true;
        }
      }
      if (actionType == CellActionType.RIGHT_TRANSFORM || actionType == CellActionType.LEFT_TRANSFORM) {
        if (selectedCell.validate(strictMatching,false)) {
          return true;
        }
      }
      selectedCell=editorContext.getNodeEditorComponent().getSelectedCell();
      if (selectedCell == null) {
        return true;
      }
    }
  }
  if (selectedCell != null) {
    if (selectedCell instanceof EditorCell_Label && !hasOneToManyRole(selectedCell) && (actionType == CellActionType.INSERT || actionType == CellActionType.INSERT_BEFORE)) {
      EditorCell cellWithRole=new ChildrenCollectionFinder(selectedCell,actionType == CellActionType.INSERT).find();
      if (cellWithRole == null && actionType == CellActionType.INSERT_BEFORE && selectedCell.isFirstPositionInBigCell()) {
        cellWithRole=new ChildrenCollectionFinder(selectedCell.getPrevLeaf(),true).find();
      }
      if (cellWithRole == null && actionType == CellActionType.INSERT && selectedCell.isLastPositionInBigCell()) {
        cellWithRole=new ChildrenCollectionFinder(selectedCell.getNextLeaf(),true).find();
      }
      if (cellWithRole != null && cellWithRole.executeAction(actionType)) {
        return true;
      }
    }
    if (actionType != null && actionType != CellActionType.DELETE) {
      if (selectedCell.executeAction(actionType)) {
        return true;
      }
    }
    if (!keyEvent.isConsumed()) {
      if (editorContext.getNodeEditorComponent().getNodeRangeSelection().isSelectionKeystroke(keyEvent)) {
        if (editorContext.getNodeEditorComponent().getNodeRangeSelection().activate(keyEvent)) {
          return true;
        }
      }
      if (selectedCell.processKeyPressed(keyEvent,true)) {
        return true;
      }
    }
    if (actionType == CellActionType.DELETE) {
      if (selectedCell.executeAction(actionType)) {
        return true;
      }
    }
  }
  if (keyEvent.getKeyCode() == KeyEvent.VK_UP && keyEvent.isControlDown() && !keyEvent.isAltDown() && !keyEvent.isShiftDown()) {
    keyEvent.consume();
  }
  return false;
}
