{
  EditorComponent nodeEditor=editorContext.getNodeEditorComponent();
  nodeEditor.hideMessageToolTip();
  if (keyEvent.isConsumed() || !editorContext.isEditable()) {
    return false;
  }
  if (processSelectedCell(editorContext,keyEvent,false)) {
    return true;
  }
  if (processKeyMaps(editorContext,keyEvent)) {
    return true;
  }
  CellActionType actionType=editorContext.getNodeEditorComponent().getActionType(keyEvent,editorContext);
  boolean dontExecuteRT=false;
  EditorCell selectedCell=editorContext.getSelectedCell();
  if (selectedCell != null) {
    boolean endEditKeystroke=isEndEditKeystroke(keyEvent);
    boolean strictMatching=endEditKeystroke || CellActionType.RIGHT_TRANSFORM.equals(actionType) || CellActionType.LEFT_TRANSFORM.equals(actionType);
    if (!!selectedCell.isErrorState()) {
      if (endEditKeystroke || actionType == CellActionType.INSERT || actionType == CellActionType.INSERT_BEFORE) {
        selectedCell.validate(strictMatching,true);
        return true;
      }
      if (actionType == CellActionType.RIGHT_TRANSFORM || actionType == CellActionType.LEFT_TRANSFORM) {
        if (selectedCell.validate(strictMatching,false)) {
          return true;
        }
      }
      selectedCell=editorContext.getNodeEditorComponent().getSelectedCell();
      if (selectedCell == null) {
        return true;
      }
    }
    if (actionType == CellActionType.RIGHT_TRANSFORM) {
      if (selectedCell instanceof EditorCell_Label && selectedCell.isErrorState()) {
        dontExecuteRT=true;
      }
    }
  }
  if (selectedCell != null) {
    if (selectedCell instanceof EditorCell_Label && selectedCell.getUserObject(EditorCell.ROLE) == null && (CellActionType.INSERT.equals(actionType) || CellActionType.INSERT_BEFORE.equals(actionType))) {
      EditorCell cellWithRole=new ChildrenCollectionFinder(selectedCell,actionType == CellActionType.INSERT).find();
      if (cellWithRole != null && cellWithRole.executeAction(actionType)) {
        return true;
      }
    }
    if (actionType != null && actionType != CellActionType.DELETE) {
      if (!(actionType == CellActionType.RIGHT_TRANSFORM && dontExecuteRT)) {
        if (selectedCell.executeAction(actionType)) {
          return true;
        }
      }
    }
    if (!keyEvent.isConsumed()) {
      if ((keyEvent.getKeyCode() == KeyEvent.VK_SPACE && keyEvent.isControlDown() && !(keyEvent.isAltDown() || keyEvent.isShiftDown())) || (keyEvent.getKeyCode() == KeyEvent.VK_ENTER && (!keyEvent.isAltDown()) && !(keyEvent.isControlDown() || keyEvent.isShiftDown()))) {
        if (editorContext.getNodeEditorComponent().activateNodeSubstituteChooser(selectedCell,keyEvent.getKeyCode() == KeyEvent.VK_ENTER)) {
          LOG.debug("SUBSTITUTE");
          return true;
        }
        LOG.debug("NO SUBSTITUTE");
      }
      if (editorContext.getNodeEditorComponent().getNodeRangeSelection().isSelectionKeystroke(keyEvent)) {
        if (editorContext.getNodeEditorComponent().getNodeRangeSelection().activate(keyEvent)) {
          return true;
        }
      }
      if (selectedCell.processKeyPressed(keyEvent,true)) {
        return true;
      }
    }
    if (actionType == CellActionType.DELETE) {
      if (selectedCell.executeAction(actionType)) {
        return true;
      }
    }
  }
  if (keyEvent.getKeyCode() == KeyEvent.VK_UP && keyEvent.isControlDown() && !keyEvent.isAltDown() && !keyEvent.isShiftDown()) {
    keyEvent.consume();
  }
  return false;
}
