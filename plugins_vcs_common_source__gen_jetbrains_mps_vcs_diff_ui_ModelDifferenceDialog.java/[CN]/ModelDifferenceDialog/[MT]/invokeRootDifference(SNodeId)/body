{
  if (myRootDifferenceDialog != null) {
    return;
  }
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      ModelChangeSet changeSet=(rootId == null ? myMetadataChangeSet : myChangeSet);
      SNodeId nodeId=(rootId == null ? ListSequence.fromList(SModelOperations.getRoots(((org.jetbrains.mps.openapi.model.SModel)myMetadataChangeSet.getOldModel().getModelDescriptor()),null)).first().getNodeId() : rootId);
      myRootId=rootId;
      myRootDifferenceDialog=new RootDifferenceDialog(myProject,changeSet,nodeId,myTree.getNameForRoot(rootId),myContentTitles,(isVisible() ? getWindow() : WindowManager.getInstance().getFrame(myProject)),myEditable,new ModelDifferenceDialog.MyGoToNeighbourRootActions().getActions(),null);
      myTree.getNameForRoot(rootId);
    }
  }
);
  myRootDifferenceDialog.show();
  if (myMetadataChangeSet != null && myEditable) {
    ModelAccess.instance().runWriteActionInCommand(new Runnable(){
      public void run(){
        MetadataUtil.applyMetadataChanges(myChangeSet.getNewModel(),myMetadataChangeSet.getNewModel());
      }
    }
);
  }
  myRootDifferenceDialog=null;
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      rebuildChangeSets();
    }
  }
);
}
