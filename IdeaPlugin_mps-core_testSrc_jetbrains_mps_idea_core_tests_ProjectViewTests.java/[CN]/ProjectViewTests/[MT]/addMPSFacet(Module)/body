{
  FacetManager facetManager=FacetManager.getInstance(module);
  FacetType<MPSFacet,MPSFacetConfiguration> facetType=FacetTypeRegistry.getInstance().findFacetType(MPSFacetType.ID);
  Assert.assertNotNull("MPS facet type is not found",facetType);
  MPSFacet facet=facetManager.createFacet(facetType,"MPS",null);
  final MPSFacetConfiguration configuration=facet.getConfiguration();
  String path=VirtualFileManager.extractPath(getContentRoot().findChild("src").getUrl());
  ArrayList<ModelRoot> roots=new ArrayList<ModelRoot>();
  roots.add(new ModelRoot(path));
  configuration.getState().setModelRoots(roots);
  final ModifiableFacetModel facetModel=facetManager.createModifiableModel();
  facetModel.addFacet(facet);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      facetModel.commit();
    }
  }
);
  return facet;
}
