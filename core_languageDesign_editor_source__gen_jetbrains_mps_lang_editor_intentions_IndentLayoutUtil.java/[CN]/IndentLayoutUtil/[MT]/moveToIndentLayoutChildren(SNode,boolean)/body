{
  List<SNode> result=ListOperations.<SNode>createList();
  if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.lang.editor.structure.CellModel_Collection")) {
    List<SNode> children=SLinkOperations.getTargets(node,"childCellModel",true);
    for (int i=0; i < ListSequence.fromList(children).count(); i++) {
      ListSequence.fromList(result).addSequence(ListSequence.fromList(moveToIndentLayoutChildren(ListSequence.fromList(children).getElement(i),isLast && (i == ListSequence.fromList(children).count() - 1))));
    }
  }
 else   if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.lang.editor.structure.CellModel_Indent")) {
    SNode classItem=SConceptOperations.createNewNode("jetbrains.mps.lang.editor.structure.IndentLayoutIndentStyleClassItem",null);
    SPropertyOperations.set(classItem,"flag","" + true);
    SLinkOperations.addChild(SNodeOperations.getNextSibling(node),"styleItem",classItem);
  }
 else {
    ListSequence.fromList(result).addElement(node);
    if (isLast) {
      SNode classItem=SConceptOperations.createNewNode("jetbrains.mps.lang.editor.structure.IndentLayoutNewLineStyleClassItem",null);
      SPropertyOperations.set(classItem,"flag","" + true);
      SLinkOperations.addChild(node,"styleItem",classItem);
    }
  }
  return result;
}
