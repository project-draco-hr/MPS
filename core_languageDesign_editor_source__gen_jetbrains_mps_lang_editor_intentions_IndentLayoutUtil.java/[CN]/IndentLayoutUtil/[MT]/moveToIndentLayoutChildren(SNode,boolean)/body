{
  List<SNode> result=new ArrayList<SNode>();
  if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.lang.editor.structure.CellModel_Collection")) {
    SNode collection=SNodeOperations.cast(node,"jetbrains.mps.lang.editor.structure.CellModel_Collection");
    if (SLinkOperations.getTarget(collection,"renderingCondition",true) != null || EditorCellModel_Behavior.call_isIndented_1237383418148(node) || CellModel_Collection_Behavior.call_isVertical_1237380214915(collection) || SLinkOperations.getTarget(ListSequence.fromList(SLinkOperations.getTargets(collection,"childCellModel",true)).last(),"renderingCondition",true) != null) {
      moveToIndentLayout(SNodeOperations.cast(node,"jetbrains.mps.lang.editor.structure.CellModel_Collection"));
      if (isLast) {
        SNode classItem=SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.IndentLayoutNewLineStyleClassItem",null);
        SPropertyOperations.set(classItem,"flag","" + true);
        ListSequence.fromList(SLinkOperations.getTargets(node,"styleItem",true)).addElement(classItem);
      }
      ListSequence.fromList(result).addElement(node);
    }
 else {
      List<SNode> children=SLinkOperations.getTargets(SNodeOperations.cast(node,"jetbrains.mps.lang.editor.structure.CellModel_Collection"),"childCellModel",true);
      for (int i=0; i < ListSequence.fromList(children).count(); i++) {
        ListSequence.fromList(result).addSequence(ListSequence.fromList(moveToIndentLayoutChildren(ListSequence.fromList(children).getElement(i),isLast && (i == ListSequence.fromList(children).count() - 1))));
      }
    }
  }
 else   if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.lang.editor.structure.CellModel_Indent")) {
    IndentLayoutUtil.makeIndent(SNodeOperations.cast(SNodeOperations.getNextSibling(node),"jetbrains.mps.lang.editor.structure.EditorCellModel"));
  }
 else {
    ListSequence.fromList(result).addElement(node);
    if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.lang.editor.structure.CellModel_RefNodeList")) {
      if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SNodeOperations.cast(node,"jetbrains.mps.lang.editor.structure.CellModel_RefNodeList"),"cellLayout",true),"jetbrains.mps.lang.editor.structure.CellLayout_Vertical")) {
        SNode classItem=SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.IndentLayoutNewLineChildrenStyleClassItem",null);
        ListSequence.fromList(SLinkOperations.getTargets(node,"styleItem",true)).addElement(classItem);
      }
      SLinkOperations.setTarget(SNodeOperations.cast(node,"jetbrains.mps.lang.editor.structure.CellModel_RefNodeList"),"cellLayout",SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellLayout_Indent",null),true);
    }
    if (isLast) {
      SNode classItem=SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.IndentLayoutNewLineStyleClassItem",null);
      SPropertyOperations.set(classItem,"flag","" + true);
      ListSequence.fromList(SLinkOperations.getTargets(node,"styleItem",true)).addElement(classItem);
    }
  }
  return result;
}
