{
  DiffContent[] contents=request.getContents();
  try {
    final SModel oldModel=readModel(contents[0],getFilePath(request));
    final SModel newModel=readModel(contents[1],getFilePath(request));
    final ModelDifferenceDialog d=ModelAccess.instance().runReadAction(new Computable<ModelDifferenceDialog>(){
      public ModelDifferenceDialog compute(){
        MPSProject project=request.getProject().getComponent(MPSProjectHolder.class).getMPSProject();
        IOperationContext context=new ModuleContext(oldModel.getModelDescriptor().getModule(),project);
        return new ModelDifferenceDialog(context,WindowManager.getInstance().getFrame(request.getProject()),oldModel,newModel,request.getWindowTitle(),!request.getHints().contains(DiffTool.HINT_SHOW_FRAME));
      }
    }
);
    AnAction action=new AnAction("View As Text","View As Text",Icons.TEXT_ICON){
      public void actionPerformed(      AnActionEvent e){
        DiffTool ideaDiffTool=DiffManager.getInstance().getIdeaDiffTool();
        if (ideaDiffTool.canShow(request)) {
          d.dispose();
          ideaDiffTool.show(request);
        }
      }
    }
;
    d.addAction(action);
    d.showDialog();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
catch (  ReadException e) {
    LOG.warning("Can't read models. Using text based merge...",e);
    DiffTool ideaDiffTool=DiffManager.getInstance().getIdeaDiffTool();
    if (ideaDiffTool.canShow(request)) {
      ideaDiffTool.show(request);
    }
  }
}
