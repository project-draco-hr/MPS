{
  List<T> list=map.remove(ptr);
  if (list == null) {
    return false;
  }
  ListSequence.<T>fromList(list).visitAll(new IVisitor<T>(){
    public void visit(    T it){
      f.invoke(it);
    }
  }
);
  MapSequence.<SNodePointer,List<T>>fromMap(map).put(newPtr,list);
  return true;
}
