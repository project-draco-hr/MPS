{
  TemplateContext applyContext=myArguments.length == 0 ? context : context.subContext(getArgumentsAsMap());
  if (myTemplateNode.getConcept().isSubConceptOf(SConceptRepository.getInstance().getConcept(RuleUtil.concept_TemplateDeclaration))) {
    TemplateContainer tc=new TemplateContainer(new TemplateProcessor(environment),myTemplateNode);
    if (!tc.initialize(context,null)) {
      environment.getGenerator().showErrorMessage(context.getInput(),myTemplateNode,"error processing template declaration");
      return null;
    }
    environment.getTracer().pushTemplateNode(new jetbrains.mps.smodel.SNodePointer(myTemplateNode));
    return tc.applyFailFast();
  }
 else {
    return new TemplateProcessor(environment).apply(null,myTemplateNode,applyContext);
  }
}
