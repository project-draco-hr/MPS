{
  String theElementName=elementName;
  if (theElementName == null) {
    theElementName=ModelPersistence.NODE;
  }
  Element element=new Element(theElementName);
  DocUtil.setNotNullAttribute(element,ModelPersistence.ROLE,node.getRole());
  element.setAttribute(ModelPersistence.TYPE,node.getConceptFqName());
  element.setAttribute(ModelPersistence.ID,node.getId());
  Map<String,String> properties=node.getProperties();
  Set<String> keys=properties.keySet();
  for (  String propertyName : keys) {
    Element propertyElement=new Element(ModelPersistence.PROPERTY);
    element.addContent(propertyElement);
    propertyElement.setAttribute(ModelPersistence.NAME,propertyName);
    DocUtil.setNotNullAttribute(propertyElement,ModelPersistence.VALUE,node.getPersistentProperty(propertyName));
  }
  List<SReference> references=node.getReferences();
  IReferencePersister referencePersister=getReferencePersister();
  for (  SReference reference : references) {
    referencePersister.saveReference(element,reference,useUIDs,visibleModelElements);
  }
  List<SNode> children=node.getChildren();
  for (  SNode childNode : children) {
    saveNode(element,null,childNode,useUIDs,visibleModelElements);
  }
  parentElement.addContent(element);
}
