{
  if (originalValue.getValue() instanceof ObjectReference) {
    ValueWrapperFactory factory=null;
    long uniqueID=getValueId(originalValue);
    String factoryId=MapSequence.fromMap(myObjectIdToFactory).get(uniqueID);
    if ((factoryId != null && factoryId.length() > 0)) {
      factory=MapSequence.fromMap(myFactories).get(factoryId);
    }
    if (factory == null) {
      Set<ValueWrapperFactory> factories=getValueWrapperFactories(originalValue);
      if (factories.isEmpty()) {
        return null;
      }
      factory=factories.iterator().next();
      factoryId=factory.getClass().getName();
      MapSequence.fromMap(myObjectIdToFactory).put(uniqueID,factoryId);
    }
    return factory.createValueWrapper(originalValue);
  }
  return null;
}
