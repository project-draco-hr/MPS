{
  final Exception[] thrown=new Exception[1];
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      try {
        EditorTests.super.setUp();
      }
 catch (      Exception e) {
        thrown[0]=e;
      }
    }
  }
);
  if (thrown[0] != null)   throw thrown[0];
  ApplicationManagerEx.getApplicationEx().doNotSave();
  SModelRoot sModelRoot=myFacet.getSolution().getSModelRoots().iterator().next();
  final IFile modelFile=FileSystem.getInstance().getFileByPath(sModelRoot.getPath() + "/test.mps");
  final List<SNode> roots=new ArrayList<SNode>();
  ModelAccess.instance().runReadAction(new Runnable(){
    @Override public void run(){
      SModelDescriptor descr=SModelRepository.getInstance().findModel(modelFile);
      if (descr == null) {
        thrown[0]=new IllegalStateException("model not found");
        return;
      }
      SModel model=descr.getSModel();
      if (model != null) {
        for (        SNode root : model.roots()) {
          roots.add(root);
        }
      }
      for (      SNode r : roots) {
        if ("EditorTestCase".equals(r.getConceptShortName())) {
          try {
            Class<?> cls=Class.forName(model.getLongName() + "." + r.getName()+ "_Test");
            Method mth=cls.getMethod("test_" + r.getName());
            BaseTransformationTest4 btt=(BaseTransformationTest4)cls.newInstance();
            btt.setTestRunner(new SimpleTransformationTestRunner(r,mth));
            tests.add(btt);
          }
 catch (          Exception e) {
            thrown[0]=e;
          }
        }
      }
    }
  }
);
  Logger.setFactory(TestLoggerFactory.getInstance());
  if (thrown[0] != null)   throw thrown[0];
}
