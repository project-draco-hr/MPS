{
  List<SModel> modelsList=new ArrayList<SModel>();
  modelsList.add(sModel);
  List<SModel> modelDescriptors=jetbrains.mps.smodel.SModelOperations.allImportedModels(sModel,scope);
  for (  SModel descriptor : modelDescriptors) {
    modelsList.add(descriptor);
  }
  List<SNode> resultNodes=new ArrayList<SNode>();
  for (  SModel aModel : modelsList) {
    Iterable<? extends SNode> nodes=(roots ? aModel.getRootNodes() : new NodesIterable(aModel));
    if (concept == null) {
      resultNodes.addAll(IterableUtil.asList(nodes));
    }
 else     if (roots) {
      resultNodes.addAll(IterableUtil.asList(new ConditionalIterable(nodes,new IsInstanceCondition(concept))));
    }
 else {
      resultNodes.addAll(IterableUtil.asList(((SModelInternal)aModel).getFastNodeFinder().getNodes(NameUtil.nodeFQName(concept),true)));
    }
  }
  return resultNodes;
}
