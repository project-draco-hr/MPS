{
  List<SModel> modelsList=new ArrayList<SModel>();
  modelsList.add(sModel);
  List<SModelDescriptor> modelDescriptors=jetbrains.mps.smodel.SModelOperations.allImportedModels(sModel,scope);
  for (  SModelDescriptor descriptor : modelDescriptors) {
    modelsList.add(descriptor.getSModel());
  }
  List<SNode> resultNodes=new ArrayList<SNode>();
  for (  SModel aModel : modelsList) {
    Iterable<SNode> nodes=(roots ? aModel.roots() : aModel.nodes());
    Iterable<SNode> iter=(condition == null ? nodes : new ConditionalIterable<SNode>(nodes,condition));
    for (    SNode node : iter) {
      resultNodes.add(node);
    }
  }
  return resultNodes;
}
