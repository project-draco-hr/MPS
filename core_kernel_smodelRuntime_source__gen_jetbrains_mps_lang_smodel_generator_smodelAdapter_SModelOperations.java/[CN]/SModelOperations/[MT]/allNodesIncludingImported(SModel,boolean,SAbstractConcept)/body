{
  List<SModel> modelsList=new ArrayList<SModel>();
  modelsList.add(sModel);
  List<SModel> modelDescriptors=jetbrains.mps.smodel.SModelOperations.allImportedModels(sModel);
  for (  SModel descriptor : modelDescriptors) {
    modelsList.add(descriptor);
  }
  List<SNode> resultNodes=new ArrayList<SNode>();
  final Condition<SNode> instanceCondition=(concept == null ? null : new InstanceOfCondition(concept));
  for (  SModel aModel : modelsList) {
    if (concept == null || roots) {
      ConditionalIterable<SNode> nodes=new ConditionalIterable<SNode>((roots ? aModel.getRootNodes() : SNodeUtil.getDescendants(aModel)),instanceCondition);
      resultNodes.addAll(IterableUtil.asList(nodes));
    }
 else {
      resultNodes.addAll(jetbrains.mps.smodel.SModelOperations.getNodes(aModel,concept));
    }
  }
  return resultNodes;
}
