{
  boolean showNode=showNode(operation);
  List<TypeSystemTraceTreeNode> children=new ArrayList<TypeSystemTraceTreeNode>();
  if (withChildren) {
    for (    AbstractOperation consequence : operation.getConsequences()) {
      TypeSystemTraceTreeNode node=create(consequence,showNode || showParent,false);
      if (node != null) {
        children.add(node);
      }
    }
  }
  if (!(filterNodeType(operation))) {
    return null;
  }
  if (!(showParent)) {
    if (!(showNode) && children.isEmpty()) {
      return null;
    }
  }
  TypeSystemTraceTreeNode result=new TypeSystemTraceTreeNode(operation,myOperationContext,myCurrentContext.getState(),myEditorComponent);
  for (  TypeSystemTraceTreeNode node : children) {
    result.add(node);
  }
  if (operation instanceof AddErrorOperation || operation instanceof TraceWarningOperation) {
    myErrorNodes.add(result);
  }
  return result;
}
