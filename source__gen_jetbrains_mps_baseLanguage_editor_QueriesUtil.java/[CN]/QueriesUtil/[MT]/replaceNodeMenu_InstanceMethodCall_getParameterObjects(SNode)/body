{
  SNode instance=SLinkOperations.getTarget(referenceNode,"instance",true);
  SNode instanceType=TypeChecker.getInstance().getRuntimeSupport().coerce(TypeChecker.getInstance().getTypeOf(instance),HUtil.createMatchingPatternByConceptFQName("jetbrains.mps.baseLanguage.structure.ClassifierType"),false);
  if (instanceType == null) {
    return new ArrayList<SNode>();
  }
  ISearchScope hierarchyScope=new ClassifierAndSuperClassifiersScope(((Classifier)SNodeOperations.getAdapter(SLinkOperations.getTarget(instanceType,"classifier",false))),IClassifiersSearchScope.INSTANCE_FIELD);
  ISearchScope visibleFieldsScope=new VisibleClassifierMembersScope(hierarchyScope,((InstanceMethodCall)SNodeOperations.getAdapter(referenceNode)));
  return (List<SNode>)visibleFieldsScope.getNodes();
}
