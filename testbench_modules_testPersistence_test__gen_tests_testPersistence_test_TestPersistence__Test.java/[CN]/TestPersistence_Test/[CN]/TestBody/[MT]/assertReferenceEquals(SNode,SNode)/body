{
  Set<String> roles=new HashSet<String>();
  roles.addAll(SNodeOperations.getReferenceRoles(expectedNode));
  roles.addAll(SNodeOperations.getReferenceRoles(actualNode));
  Map<String,Set<SReference>> expRoleToReferenceMap=this.createRoleToReferenceMap(expectedNode);
  Map<String,Set<SReference>> actRoleToReferenceMap=this.createRoleToReferenceMap(actualNode);
  for (  String role : roles) {
    Assert.assertEquals(this.getErrorString("different number of referents in role " + role,expectedNode,actualNode),expRoleToReferenceMap.get(role).size(),actRoleToReferenceMap.get(role).size());
    SReference expectedReference=expectedNode.getReference(role);
    SReference actualReference=actualNode.getReference(role);
    this.assertReferenceEquals(this.getErrorString("reference in role " + role,expectedNode,actualNode),expectedReference,actualReference);
  }
}
