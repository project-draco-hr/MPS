{
  if (((Object)refactoringContext.getParameter("target")) instanceof SNode) {
    SNode targetNode=((SNode)((Object)refactoringContext.getParameter("target")));
    SNode concept=SNodeOperations.getConceptDeclaration(targetNode);
    ConceptAndSuperConceptsScope superConceptsScope=new ConceptAndSuperConceptsScope(((AbstractConceptDeclaration)SNodeOperations.getAdapter(concept)));
    List<LinkDeclaration> linkDeclarations=superConceptsScope.getLinkDeclarationsExcludingOverridden();
    Iterable<SNode> childLinkDeclarations=ListSequence.fromList(linkDeclarations).where(new IWhereFilter<LinkDeclaration>(){
      public boolean accept(      LinkDeclaration it){
        return SPropertyOperations.hasValue(SNodeOperations.cast(it.getNode(),"jetbrains.mps.lang.structure.structure.LinkDeclaration"),"metaClass","aggregation","reference");
      }
    }
).<SNode>select(new ISelector<LinkDeclaration,SNode>(){
      public SNode select(      LinkDeclaration it){
        return SNodeOperations.cast(it.getNode(),"jetbrains.mps.lang.structure.structure.LinkDeclaration");
      }
    }
);
    Iterable<String> childLinksRoles=Sequence.fromIterable(childLinkDeclarations).<String>select(new ISelector<SNode,String>(){
      public String select(      SNode it){
        return SModelUtil.getGenuineLinkRole(it);
      }
    }
);
    for (    SNode node : refactoringContext.getSelectedNodes()) {
      String childRole=node.getRole_();
      if (!(Sequence.fromIterable(childLinksRoles).contains(childRole))) {
        return false;
      }
      for (      SNode linkDeclaration : childLinkDeclarations) {
        if (SPropertyOperations.getString(linkDeclaration,"role").equals(childRole)) {
          if (!(SConceptOperations.isSuperConceptOf(SLinkOperations.getTarget(linkDeclaration,"target",false),NameUtil.nodeFQName(SNodeOperations.getConceptDeclaration(node))))) {
            return false;
          }
        }
      }
    }
    return true;
  }
  if (((Object)refactoringContext.getParameter("target")) instanceof SModelDescriptor) {
    for (    SNode node : refactoringContext.getSelectedNodes()) {
      if (!(SPropertyOperations.getBoolean(SNodeOperations.getConceptDeclaration(node),"rootable"))) {
        return false;
      }
    }
    return true;
  }
  return false;
}
