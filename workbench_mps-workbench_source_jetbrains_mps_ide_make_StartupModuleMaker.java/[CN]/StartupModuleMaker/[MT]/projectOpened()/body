{
  final MPSProjectMigrationState migrationState=myProject.getComponent(MPSProjectMigrationState.class);
  if (migrationState.isMigrationRequired() && migrationState.hasMigrationAgent()) {
    migrationState.addMigrationListener(new MPSProjectMigrationListener.DEFAULT(){
      @Override public void migrationFinished(      Project mpsProject){
        migrationState.removeMigrationListener(this);
        compileProjectModulesWithProgress(false);
      }
      @Override public void migrationAborted(      Project project){
        migrationState.removeMigrationListener(this);
      }
    }
);
    reloadClasses(new EmptyProgressIndicator(),true);
  }
 else {
    compileProjectModulesWithProgress(true);
  }
}
