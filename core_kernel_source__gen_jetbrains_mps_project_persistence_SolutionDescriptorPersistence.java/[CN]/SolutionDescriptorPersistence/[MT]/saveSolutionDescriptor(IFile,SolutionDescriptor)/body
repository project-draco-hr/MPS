{
  if (file.isReadOnly()) {
    if (log.isErrorEnabled()) {
      log.error("Can't save " + file.getPath());
    }
    return;
  }
  final Macros macros=Macros.solutionDescriptor();
  Element solElem=new _FunctionTypes._return_P0_E0<Element>(){
    public Element invoke(){
      Element result_3591_11=new Element("solution");
      if (descriptor.getNamespace() != null) {
        String result_3591_12=descriptor.getNamespace();
        result_3591_11.setAttribute("name","" + result_3591_12);
      }
      if (descriptor.getUUID() != null) {
        String result_3591_13=descriptor.getUUID();
        result_3591_11.setAttribute("uuid","" + result_3591_13);
      }
      boolean result_3591_14=descriptor.isExternallyVisible();
      result_3591_11.setAttribute("extenallyVisible","" + result_3591_14);
      if (descriptor.isDontLoadClasses()) {
        boolean result_3591_15=true;
        result_3591_11.setAttribute("dontLoadClasses","" + result_3591_15);
      }
      boolean result_3591_16=descriptor.getCompileInMPS();
      result_3591_11.setAttribute("compileInMPS","" + result_3591_16);
      boolean result_3591_17=descriptor.getEnableJavaStubs();
      result_3591_11.setAttribute("java-stubs-enabled","" + result_3591_17);
      if (descriptor.getOutputPath() != null) {
        String result_3591_18=macros.shrinkPath(descriptor.getOutputPath(),file);
        result_3591_11.setAttribute("generatorOutputPath","" + result_3591_18);
      }
      Element result_3591_19=new Element("models");
      ModuleDescriptorPersistence.saveModelRoots(result_3591_19,descriptor.getModelRoots(),file,macros);
      result_3591_11.addContent(result_3591_19);
      Element result_3591_20=new Element("classPath");
      for (      ClassPathEntry entry : ListSequence.fromList(descriptor.getClassPaths())) {
        Element result_3591_21=new Element("entry");
        String result_3591_22=macros.shrinkPath(entry.getPath(),file);
        result_3591_21.setAttribute("path","" + result_3591_22);
        boolean result_3591_23=entry.isIncludedInVCS();
        result_3591_21.setAttribute("include","" + result_3591_23);
        result_3591_20.addContent(result_3591_21);
      }
      result_3591_11.addContent(result_3591_20);
      Element result_3591_24=new Element("sourcePath");
      for (      String p : ListSequence.fromList(descriptor.getSourcePaths())) {
        Element result_3591_25=new Element("source");
        String result_3591_26=macros.shrinkPath(p,file);
        result_3591_25.setAttribute("path","" + result_3591_26);
        result_3591_24.addContent(result_3591_25);
      }
      result_3591_11.addContent(result_3591_24);
      ModuleDescriptorPersistence.saveDependencies(result_3591_11,descriptor);
      return result_3591_11;
    }
  }
.invoke();
  try {
    OutputStream os=file.openOutputStream();
    JDOMUtil.writeDocument(new Document(solElem),os);
  }
 catch (  Exception e) {
    if (log.isErrorEnabled()) {
      log.error("",e);
    }
  }
  ModuleDescriptorPersistence.setTimestamp(descriptor,file,true);
}
