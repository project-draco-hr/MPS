{
  String[] names=getNames(everywhere);
  String namePattern=getNamePattern(pattern);
  List<String> namesList=getNamesByPattern(namePattern,names,cancelled);
  Collections.sort(namesList,new MatchesComparator(namePattern));
  for (  String name : namesList) {
    Set<Object> elems=myMatcher.getElementsByPattern(pattern,name,everywhere,cancelled);
    if (elementsArray.size() + elems.size() <= maxListSize) {
      elementsArray.addAll(elems);
    }
 else {
      Iterator<Object> iter=elems.iterator();
      while (elementsArray.size() < maxListSize) {
        elementsArray.add(iter.next());
      }
      elementsArray.add(extra);
      break;
    }
  }
}
