{
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      SModelRepository.getInstance().saveAll();
    }
  }
);
  boolean isOneTarget=!(myRefactoring.getRefactoringTarget().allowMultipleTargets());
  final RefactoringContext context=new RefactoringContext(myRefactoring);
  context.setCurrentOperationContext(e.getData(MPSCommonDataKeys.OPERATION_CONTEXT));
  context.setSelectedNode(e.getData(MPSCommonDataKeys.NODE));
  context.setSelectedNodes(getNodes(e,isOneTarget));
  context.setSelectedModel(e.getData(MPSCommonDataKeys.CONTEXT_MODEL));
  context.setSelectedModels(getModels(e,isOneTarget));
  context.setSelectedModule(e.getData(MPSDataKeys.MODULE));
  context.setSelectedModules(getModules(e,isOneTarget));
  context.setSelectedProject(ProjectHelper.toMPSProject(e.getData(PlatformDataKeys.PROJECT)));
  context.setCurrentScope(e.getData(MPSCommonDataKeys.SCOPE));
  new Thread(){
    public void run(){
      context.setRefactoring(myRefactoring);
      RefactoringAccess.getInstance().getRefactoringFacade().executeInThread(context);
    }
  }
.start();
}
