{
  final BaseModuleModel languagesData=new BaseModuleModel(myProject,"language"){
    @Override public SModuleReference[] find(    SearchScope scope){
      ArrayList<SModuleReference> res=new ArrayList<SModuleReference>();
      for (      SModule m : scope.getModules()) {
        if (!(m instanceof Language))         continue;
        res.add(m.getModuleReference());
      }
      return res.toArray(new SModuleReference[res.size()]);
    }
  }
;
  languagesData.setPromptText("Import language:");
  ChooseByNamePopup popup=MpsPopupFactory.createPackagePopup(myProject.getProject(),languagesData,null);
  if (myShortcut != null) {
    popup.setCheckBoxShortcut(myShortcut);
  }
  popup.invoke(new Callback(){
    private SModuleReference myModuleRef;
    @Override public void elementChosen(    Object element){
      myModuleRef=languagesData.getModelObject(element);
    }
    @Override public void onClose(){
      if (myModuleRef != null) {
        addLanguageAction.call(MetaAdapterFactory.getLanguage(myModuleRef));
      }
      if (myOnCloseActivity != null) {
        myOnCloseActivity.run();
      }
    }
  }
,ModalityState.current(),false);
}
