{
  if (RuntimeFlags.getTestMode().isInsideTestEnvironment()) {
    return;
  }
  if (!(myState.migrationRequired)) {
    addListeners();
    StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
      public void run(){
        checkMigrationNeeded();
      }
    }
);
  }
 else {
    saveAndSetTipsState();
    StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
      public void run(){
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            VirtualFileUtils.refreshSynchronouslyRecursively(myProject.getBaseDir());
            VirtualFileManager.getInstance().syncRefresh();
            ReloadManager.getInstance().flush();
          }
        }
);
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            myState.migrationRequired=false;
            myMpsProject.getRepository().getModelAccess().runWriteAction(new Runnable(){
              public void run(){
                updateUsedLanguagesVersions(MigrationsUtil.getMigrateableModulesFromProject(myMpsProject));
              }
            }
);
            final MigrationAssistantWizard wizard=new MigrationAssistantWizard(myProject,myMigrationManager,MigrationTrigger.this);
            boolean finished=wizard.showAndGet();
            restoreTipsState();
            if (!(finished)) {
              return;
            }
            if (myErrors == null) {
              ApplicationManager.getApplication().runWriteAction(new Runnable(){
                public void run(){
                  ProjectManagerEx.getInstance().reloadProject(myProject);
                }
              }
);
            }
 else {
              MigrationErrorWizardStep lastStep=as_feb5zp_a0a0a0k0a0a0a0b0a0a0a0b0a3a52(wizard.getCurrentStepObject(),MigrationErrorWizardStep.class);
              if (lastStep == null) {
                return;
              }
              StartupManager.getInstance(myProject).runWhenProjectIsInitialized(new Runnable(){
                public void run(){
                  ApplicationManager.getApplication().invokeLater(new Runnable(){
                    public void run(){
                      myMpsProject.getRepository().getModelAccess().runReadAction(new Runnable(){
                        public void run(){
                          MigrationOutputUtil.showProblems(myProject,myErrors.getProblems());
                        }
                      }
);
                    }
                  }
,ModalityState.NON_MODAL);
                }
              }
);
            }
          }
        }
);
      }
    }
);
  }
}
