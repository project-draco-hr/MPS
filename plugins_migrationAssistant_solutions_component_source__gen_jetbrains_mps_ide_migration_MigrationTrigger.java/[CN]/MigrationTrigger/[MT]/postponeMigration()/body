{
  if (myBlocked.get() != 0) {
    return;
  }
  final Project ideaProject=myProject;
  final Iterable<SModule> allModules=MigrationsUtil.getMigrateableModulesFromProject(myMpsProject);
  saveAndSetTipsState();
  StartupManager.getInstance(ideaProject).runWhenProjectIsInitialized(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          if (!(myMigrationManager.isMigrationRequired())) {
            return;
          }
          boolean doMigration=MigrationDialogUtil.showMigrationConfirmation(myMpsProject,allModules,myMigrationManager);
          restoreTipsState();
          myState.migrationRequired=doMigration;
          if (!(doMigration)) {
            return;
          }
          syncRefresh();
          if (!(myMigrationManager.isMigrationRequired())) {
            MigrationDialogUtil.showNoMigrationMessage(myProject);
            return;
          }
          VirtualFileManager.getInstance().asyncRefresh(new Runnable(){
            public void run(){
              final Application application=ApplicationManager.getApplication();
              application.invokeLater(new Runnable(){
                public void run(){
                  application.getComponent(ReloadManager.class).flush();
                  ProjectManagerEx.getInstance().reloadProject(ideaProject);
                }
              }
);
            }
          }
);
        }
      }
);
    }
  }
);
  myMigrationQueued=true;
}
