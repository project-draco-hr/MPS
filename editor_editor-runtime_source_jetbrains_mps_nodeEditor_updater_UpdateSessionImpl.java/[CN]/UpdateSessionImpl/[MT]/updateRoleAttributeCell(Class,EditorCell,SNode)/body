{
  if (attributeKind != AttributeKind.Reference.class && getCurrentContext().hasRoles()) {
    return cellWithRole;
  }
  final EditorContext editorContext=getUpdater().getEditorContext();
  editorContext.getCellFactory().pushCellContext();
  editorContext.getCellFactory().removeCellContextHints(EditorCellFactoryImpl.BASE_REFLECTIVE_EDITOR_HINT);
  final boolean isNodeAttribute=attributeKind == Node.class;
  if (isNodeAttribute) {
    myCurrentUpdateInfo=myCurrentUpdateInfo.insertNewParent(new UpdateInfoNode(ReferencedNodeContext.createNodeAttributeContext(roleAttribute)));
  }
 else {
    myCurrentUpdateInfo=new UpdateInfoNode(getCurrentContext().sameContextButAnotherNode(roleAttribute),myCurrentUpdateInfo);
  }
  try {
    return runWithExplicitEditorHints(editorContext,roleAttribute,new Computable<EditorCell>(){
      @Override public EditorCell compute(){
        return EditorManager.getInstanceFromContext(editorContext).doCreateRoleAttributeCell(attributeKind,cellWithRole,getCurrentContext(),myModelModifications);
      }
    }
);
  }
  finally {
    editorContext.getCellFactory().popCellContext();
    if (!isNodeAttribute) {
      myCurrentUpdateInfo=myCurrentUpdateInfo.getParent();
    }
  }
}
