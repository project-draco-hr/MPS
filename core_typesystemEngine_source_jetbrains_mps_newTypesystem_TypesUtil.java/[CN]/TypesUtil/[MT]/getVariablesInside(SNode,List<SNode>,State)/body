{
  if (node == null) {
    return;
  }
  if (state != null) {
    node=state.getRepresentative(node);
  }
  if (isVariable(node)) {
    result.add(node);
    return;
  }
  for (  SNode child : node.getChildren()) {
    getVariablesInside(child,result,state);
  }
  for (  SNode referent : getNodeReferents(node)) {
    if (state != null) {
      referent=state.getRepresentative(referent);
    }
    if (referent != null && isVariable(referent)) {
      result.add(referent);
    }
  }
}
