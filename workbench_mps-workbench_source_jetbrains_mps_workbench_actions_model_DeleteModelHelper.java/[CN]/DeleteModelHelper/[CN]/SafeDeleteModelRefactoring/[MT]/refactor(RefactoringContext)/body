{
  SModel modelDescriptor=refactoringContext.getSelectedModel();
  SModule modelOwner=SModelRepository.getInstance().getOwner(modelDescriptor);
  if (modelOwner instanceof Language) {
    deleteModelFromLanguage((Language)modelOwner,modelDescriptor);
  }
 else   if (modelOwner instanceof Solution) {
    deleteModelFromSolution((Solution)modelOwner,modelDescriptor);
  }
 else   if (modelOwner instanceof Generator) {
    deleteModelFromGenerator((Generator)modelOwner,modelDescriptor);
  }
 else   if (modelOwner != null) {
    LOG.warning("Module type " + modelOwner.getClass().getSimpleName() + " is not supported by delete refactoring. Changes will not be saved automatically for modules of this type.");
  }
  Set<SModel> usages=FindUsagesManager.getInstance().findUsages(Collections.singleton((SModelReference)modelDescriptor.getReference()),SearchType.MODEL_USAGES,GlobalScope.getInstance(),new EmptyProgressMonitor());
  for (  SModel md : usages) {
    if (SModelStereotype.isUserModel(md)) {
      ((jetbrains.mps.smodel.SModel)md.getSModel()).deleteModelImport(modelDescriptor.getReference());
    }
  }
  if (myDeleteFiles) {
    SModelRepository.getInstance().deleteModel(modelDescriptor);
  }
  if (modelOwner instanceof AbstractModule) {
    ((AbstractModule)modelOwner).save();
  }
}
