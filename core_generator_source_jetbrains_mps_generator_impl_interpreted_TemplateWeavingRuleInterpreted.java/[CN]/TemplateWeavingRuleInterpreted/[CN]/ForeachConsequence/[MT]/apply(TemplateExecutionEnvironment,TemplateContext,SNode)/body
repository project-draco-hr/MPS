{
  if (query == null) {
    environment.getGenerator().showErrorMessage(context.getInput(),ruleNode,"weaving rule: cannot create list of source nodes");
    return false;
  }
  Collection<SNode> queryNodes=environment.getReductionContext().getQueryExecutor().evaluateSourceNodesQuery(context.getInput(),ruleNode,null,query,context);
  if (queryNodes.isEmpty()) {
    return false;
  }
  for (  SNode queryNode : queryNodes) {
    weaveTemplateDeclaration(outputContextNode,GeneratorUtil.createConsequenceContext(queryNode,null,environment.getReductionContext(),consequenceNode,queryNode,environment.getGenerator()),environment);
  }
  return true;
}
