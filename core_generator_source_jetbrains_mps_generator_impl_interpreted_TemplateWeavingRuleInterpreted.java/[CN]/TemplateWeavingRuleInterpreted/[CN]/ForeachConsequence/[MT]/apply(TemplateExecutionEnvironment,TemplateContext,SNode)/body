{
  if (query == null) {
    environment.getGenerator().showErrorMessage(context.getInput(),ruleNode,"weaving rule: cannot create list of source nodes");
    return false;
  }
  Collection<SNode> queryNodes=environment.getQueryExecutor().evaluateSourceNodesQuery(context.getInput(),ruleNode,null,query,context);
  if (queryNodes.isEmpty()) {
    return false;
  }
  mapWeaveContentNodeToTemplateDeclarationContentNode(environment,outputContextNode,context.getInput());
  for (  SNode queryNode : queryNodes) {
    weaveTemplateDeclaration(outputContextNode,GeneratorUtil.createConsequenceContext(new DefaultTemplateContext(queryNode),environment,consequenceNode),environment);
  }
  return true;
}
