{
  if (query == null) {
    environment.getLogger().error(getRuleNode(),"weaving rule: cannot create list of source nodes",GeneratorUtil.describeInput(context));
    return false;
  }
  final SourceNodesQuery snq=environment.getQueryProvider(getRuleNode()).getSourceNodesQuery(query);
  Collection<SNode> queryNodes=environment.getQueryExecutor().evaluate(snq,new SourceSubstituteMacroNodesContext(context,query.getReference()));
  if (queryNodes.isEmpty()) {
    return false;
  }
  mapWeaveContentNodeToTemplateDeclarationContentNode(environment,outputContextNode,context.getInput());
  for (  SNode queryNode : queryNodes) {
    weaveTemplateDeclaration(outputContextNode,new DefaultTemplateContext(environment,queryNode,null));
  }
  return true;
}
