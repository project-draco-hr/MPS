{
  if (query == null) {
    environment.getLogger().error(getRuleNode(),"weaving rule: cannot create list of source nodes",GeneratorUtil.describeInput(context));
    return false;
  }
  Collection<SNode> queryNodes=environment.getQueryExecutor().evaluateSourceNodesQuery(context.getInput(),myRuleNode,null,query,context);
  if (queryNodes.isEmpty()) {
    return false;
  }
  mapWeaveContentNodeToTemplateDeclarationContentNode(environment,outputContextNode,context.getInput());
  for (  SNode queryNode : queryNodes) {
    weaveTemplateDeclaration(outputContextNode,GeneratorUtil.createConsequenceContext(new DefaultTemplateContext(queryNode),environment,myConsequenceNode),environment);
  }
  return true;
}
