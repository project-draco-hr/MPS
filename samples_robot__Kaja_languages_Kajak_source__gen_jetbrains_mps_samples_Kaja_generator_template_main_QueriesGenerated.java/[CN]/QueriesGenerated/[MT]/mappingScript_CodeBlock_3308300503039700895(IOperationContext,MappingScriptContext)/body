{
  List<SNode> roots=SModelOperations.getRoots(_context.getModel(),"jetbrains.mps.samples.Kaja.structure.Script");
  ListSequence.fromList(roots).translate(new ITranslator2<SNode,SNode>(){
    public Iterable<SNode> translate(    SNode it){
      return ListSequence.fromList(SLinkOperations.getTargets(SLinkOperations.getTarget(it,"body",true),"commands",true)).where(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return SNodeOperations.isInstanceOf(it,"jetbrains.mps.samples.Kaja.structure.RoutineDefinition");
        }
      }
);
    }
  }
).visitAll(new IVisitor<SNode>(){
    public void visit(    SNode it){
      SNode script=SNodeOperations.getAncestor(it,"jetbrains.mps.samples.Kaja.structure.Script",false,false);
      SNodeOperations.detachNode(it);
      ListSequence.fromList(SLinkOperations.getTargets(script,"definitions",true)).addElement(SNodeOperations.cast(it,"jetbrains.mps.samples.Kaja.structure.RoutineDefinition"));
    }
  }
);
}
