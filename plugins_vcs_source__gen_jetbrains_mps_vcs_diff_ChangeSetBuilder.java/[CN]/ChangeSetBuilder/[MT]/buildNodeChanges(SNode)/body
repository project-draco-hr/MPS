{
  SNodeId nodeId=oldNode.getSNodeId();
  SNode newNode=myNewModel.getNodeById(nodeId);
  buildPropertyChanges(oldNode,newNode);
  buildReferenceChanges(oldNode,newNode);
  for (  String role : SetSequence.fromSetWithValues(new HashSet<String>(),ListSequence.fromList(SNodeOperations.getChildren(oldNode)).concat(ListSequence.fromList(SNodeOperations.getChildren(newNode))).select(new ISelector<SNode,String>(){
    public String select(    SNode ch){
      return SNodeOperations.getContainingLinkRole(ch);
    }
  }
))) {
    buildNodeRoleChanges(oldNode,newNode,role);
  }
}
