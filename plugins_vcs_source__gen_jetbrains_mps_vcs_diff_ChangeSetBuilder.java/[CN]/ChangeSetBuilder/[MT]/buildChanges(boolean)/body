{
  Iterable<SNodeId> allRootIds=ListSequence.fromList(SModelOperations.getRoots(myOldModel,null)).concat(ListSequence.fromList(SModelOperations.getRoots(myNewModel,null))).select(new ISelector<SNode,SNodeId>(){
    public SNodeId select(    SNode n){
      return n.getSNodeId();
    }
  }
);
  for (  SNodeId rootId : SetSequence.fromSetWithValues(new HashSet<SNodeId>(),allRootIds)) {
    buildNodeChanges(myOldModel.getNodeById(rootId),myNewModel.getNodeById(rootId));
  }
  buildMetadataChanges();
  if (withOpposite) {
    myChangeSet.buildOppositeChangeSet();
  }
}
