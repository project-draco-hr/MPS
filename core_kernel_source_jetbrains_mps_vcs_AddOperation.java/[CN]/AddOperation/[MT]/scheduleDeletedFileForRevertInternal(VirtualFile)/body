{
  if (file.exists()) {
    AbstractVcs vcs=myManager.getVcsFor(file);
    if (vcs != null) {
      RollbackEnvironment ri=vcs.getRollbackEnvironment();
      if (ri != null) {
        ArrayList<VcsException> result=new ArrayList<VcsException>();
        Change change=myVirtualFilesToRevertDeletedStatus.get(file);
        if (change != null) {
          try {
            byte[] contents=file.contentsToByteArray();
            ri.rollbackChanges(Collections.singletonList(change),result,RollbackProgressListener.EMPTY);
            for (            VcsException e : result) {
              LOG.error(e);
            }
            file.setBinaryContent(contents);
            myVcsDirtyScopeManager.fileDirty(file);
          }
 catch (          IOException e) {
            LOG.error("Could not add file " + file + ": it was scheduled for deletion.",e);
          }
        }
 else {
          LOG.error("Could not add file " + file + ": it was scheduled for deletion.");
        }
      }
    }
  }
}
