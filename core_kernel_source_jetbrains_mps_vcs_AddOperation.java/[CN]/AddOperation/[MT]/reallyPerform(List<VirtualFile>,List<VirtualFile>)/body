{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      for (      VirtualFile vf : virtualFilesToRevert) {
        if (vf == null) {
          continue;
        }
        scheduleDeletedFileForRevertInternal(vf);
      }
      for (      VirtualFile vf : virtualFilesToAdd) {
        if (vf == null) {
          continue;
        }
        List<VirtualFile> path=getPathMaxUnversionedParent(vf);
        if (path.size() != 0 && DirectoryIndex.getInstance(myProject).isProjectExcludeRoot(path.get(0))) {
          continue;
        }
        for (        VirtualFile f : path) {
          scheduleUnversionedFileForAdditionInternal(f);
        }
      }
    }
  }
);
}
