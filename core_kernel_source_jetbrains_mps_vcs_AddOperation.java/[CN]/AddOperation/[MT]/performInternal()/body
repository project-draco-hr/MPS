{
  for (  File f : myFilesToAdd) {
    VirtualFile virtualFile=VFileSystem.refreshAndGetFile(f);
    if (virtualFile != null && !isIgnored(virtualFile)) {
      if (ChangeListManager.getInstance(myProject).getStatus(virtualFile).equals(FileStatus.DELETED)) {
        myVirtualFilesToRevert.add(virtualFile);
      }
 else {
        myVirtualFilesToAdd.add(virtualFile);
      }
    }
 else     if (f.exists()) {
      LOG.error("Cannot find virtual file for IO file " + f);
    }
  }
  if (myRecursive) {
    myVirtualFilesToAdd.addAll(getAllChildren(myVirtualFilesToAdd,new LinkedHashSet<VirtualFile>()));
    myVirtualFilesToRevert.addAll(getAllChildren(myVirtualFilesToRevert,new LinkedHashSet<VirtualFile>()));
  }
  askAndPerform();
}
