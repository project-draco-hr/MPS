{
  jetbrains.mps.TestMain.configureMPS();
  URL resource=MergeReferencesTest.class.getResource(pathToZip);
  final File zipfile=new File(resource.getFile());
  final SModel[] models=MergeTestUtil.loadTestModels(zipfile);
  Merger merger=new Merger(getBase(models),getMine(models),getRepo(models));
  merger.doRebuild(new Runnable(){
    public void run(){
    }
  }
);
  final SModel resultModel=merger.getResultModel();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      if (saveResult) {
        String fileToSave=zipfile.getParent() + File.separator + zipfile.getName()+ ".result";
        MergeTestUtil.saveTestModel(resultModel,new File(fileToSave));
      }
      ModelAssert.assertDeepModelEquals(getExpected(models),resultModel);
    }
  }
);
}
