{
  if (myStepNode == null) {
    return;
  }
  for (  Pair<SNodeReference,SNodeReference> p : myGroupedChanges.keySet()) {
    TraceNodeUI in=new TraceNodeUI(Kind.INPUT,p.o1);
    TraceNodeUI out=new TraceNodeUI(Kind.OUTPUT,p.o2);
    for (    TraceNodeUI templates : compactTemplates(myGroupedChanges.get(p))) {
      out.addChild(templates);
    }
    in.addChild(out);
    myStepNode.addChild(in);
  }
  if (myGroupByStep) {
    myResult.add(myStepNode);
  }
 else {
    for (    TraceNodeUI n : myStepNode.getChildren()) {
      myResult.add(n);
    }
  }
  myStepNode=null;
}
