{
  final Module module2=addModuleAndSetupFixture(myProjectBuilder);
  final MPSFacet mpsFacet2=addMPSFacet(module2);
  int originalDependCount=runModelRead(new Computable<Integer>(){
    @Override public Integer compute(){
      return mpsFacet2.getSolution().getDependencies().size();
    }
  }
);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      ModifiableRootModel rootModel=ModuleRootManager.getInstance(module2).getModifiableModel();
      rootModel.addModuleOrderEntry(myModule);
      rootModel.commit();
    }
  }
);
  flushEDT();
  List<Dependency> solution2Dependencies=runModelRead(new Computable<List<Dependency>>(){
    @Override public List<Dependency> compute(){
      return mpsFacet2.getSolution().getDependencies();
    }
  }
);
  assertEquals(originalDependCount + 1,solution2Dependencies.size());
  boolean found=false;
  for (  Dependency dependency : solution2Dependencies) {
    if (myFacet.getSolution().getModuleReference().equals(dependency.getModuleRef())) {
      found=true;
      break;
    }
  }
  assertTrue("Cross-Module dependency was not exposed in faced dependencies",found);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      ModifiableRootModel rootModel=ModuleRootManager.getInstance(module2).getModifiableModel();
      for (      OrderEntry orderEntry : rootModel.getOrderEntries()) {
        if (orderEntry instanceof ModuleOrderEntry && myModule.equals(((ModuleOrderEntry)orderEntry).getModule())) {
          rootModel.removeOrderEntry(orderEntry);
          break;
        }
      }
      rootModel.commit();
    }
  }
);
  flushEDT();
  int finalDependenciesCount=runModelRead(new Computable<Integer>(){
    @Override public Integer compute(){
      return mpsFacet2.getSolution().getDependencies().size();
    }
  }
);
  assertEquals(originalDependCount,finalDependenciesCount);
}
