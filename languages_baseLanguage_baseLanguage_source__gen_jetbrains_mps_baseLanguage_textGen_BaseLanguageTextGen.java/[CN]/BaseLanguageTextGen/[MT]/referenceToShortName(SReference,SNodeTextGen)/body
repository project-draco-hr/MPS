{
  if (reference == null) {
    if (LOG.isEnabledFor(Level.ERROR)) {
      LOG.error("null reference");
    }
    textGen.append("???");
    return;
  }
  String name=null;
  final SReference ref=reference;
  if (ref instanceof jetbrains.mps.smodel.SReference) {
    name=((jetbrains.mps.smodel.SReference)ref).getResolveInfo();
  }
  if (name == null) {
    SNode targetNode=ref.getTargetNode();
    if (targetNode == null) {
      if (LOG.isEnabledFor(Level.ERROR)) {
        LOG.error(String.format("Unknown target for role %s",ref.getLink()));
      }
      textGen.append("???");
      return;
    }
    name=SNodeUtil.getResolveInfo(targetNode);
    if (name == null) {
      if (LOG.isEnabledFor(Level.ERROR)) {
        LOG.error(String.format("No resolve info for node %s",targetNode));
      }
      name=targetNode.getName();
    }
  }
  if (name == null) {
    textGen.append("???");
  }
 else {
    textGen.append(name);
  }
}
