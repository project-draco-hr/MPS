{
  final TextGenSupport tgs=new TextGenSupport(ctx);
  SReference reference=classifierRef;
  if (reference == null) {
    tgs.reportError("null reference");
    return null;
  }
  String shortName="";
  String packageName="";
  if (reference instanceof DynamicReference) {
    shortName=((jetbrains.mps.smodel.SReference)reference).getResolveInfo();
    if (shortName.startsWith("[")) {
      return MultiTuple.<String,String>from(shortName.substring(1,shortName.lastIndexOf("]")).trim(),shortName.substring(shortName.lastIndexOf("]") + 1).trim());
    }
 else {
      final SModelReference modelReference=reference.getTargetSModelReference();
      if (modelReference != null) {
        packageName=modelReference.getName().getLongName();
        if (LOG.isEnabledFor(Level.WARN)) {
          LOG.warn("generating classifier reference with target model reference " + modelReference + " @ "+ classifierRef);
        }
      }
 else {
        int lastDot=shortName.lastIndexOf('.');
        if (lastDot >= 0) {
          packageName=shortName.substring(0,lastDot);
          shortName=shortName.substring(lastDot + 1).replace('$','.');
        }
 else {
          SModel sModel=classifierRef.getSourceNode().getModel();
          packageName=(sModel != null ? sModel.getName().getLongName() : "");
        }
      }
      return MultiTuple.<String,String>from(packageName,shortName);
    }
  }
 else {
    SNode targetNode=jetbrains.mps.util.SNodeOperations.getTargetNodeSilently(reference);
    if (targetNode == null) {
      tgs.reportError("Target node is null for reference to classifier with role " + SLinkOperations.getRole(classifierRef) + "; resolve info "+ SLinkOperations.getResolveInfo(classifierRef)+ "; "+ jetbrains.mps.util.SNodeOperations.getDebugText(classifierRef.getSourceNode()));
      return null;
    }
    return MultiTuple.<String,String>from(SModelOperations.getModelName(SNodeOperations.getModel(targetNode)),(SNodeOperations.isInstanceOf(targetNode,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x101d9d3ca30L,"jetbrains.mps.baseLanguage.structure.Classifier")) ? SPropertyOperations.getString(SNodeOperations.cast(targetNode,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x101d9d3ca30L,"jetbrains.mps.baseLanguage.structure.Classifier")),MetaAdapterFactory.getProperty(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x101d9d3ca30L,0x11a134c900dL,"nestedName")) : jetbrains.mps.util.SNodeOperations.getResolveInfo(targetNode)));
  }
}
