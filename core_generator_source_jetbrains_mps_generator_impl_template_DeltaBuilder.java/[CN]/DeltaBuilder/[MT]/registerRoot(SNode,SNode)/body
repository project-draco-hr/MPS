{
  if (oldRoot == null) {
    NewRoot r=new NewRoot(newRoot);
    myDelta.add(r);
    myNewRoots.add(r);
    fillNodeMap(newRoot);
  }
 else   if (oldRoot == newRoot) {
    CopyRoot cr=null;
    for (    CopyRoot r : myCopyRoots) {
      if (r.myRoot == newRoot) {
        cr=r;
        break;
      }
    }
    if (cr == null) {
      throw new IllegalStateException();
    }
    myDelta.add(cr);
    cr.fillNodeMap(myNewNodes);
  }
 else {
    ReplacedRoot rr=null;
    for (    ReplacedRoot r : myReplacedRoots) {
      if (r.myReplacedRoot == oldRoot) {
        rr=r;
        break;
      }
    }
    if (rr == null) {
      myDelta.add(rr=new ReplacedRoot(oldRoot,newRoot));
      myReplacedRoots.add(rr);
    }
 else {
      rr.myReplacements.add(newRoot);
    }
    fillNodeMap(newRoot);
  }
}
