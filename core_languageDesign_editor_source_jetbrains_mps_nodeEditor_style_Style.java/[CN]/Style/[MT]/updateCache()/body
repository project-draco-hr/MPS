{
  Map<StyleAttribute,Object> oldCachedValues=myCachedAttributeValues;
  myCachedAttributeValues=new HashMap<StyleAttribute,Object>();
  Set<StyleAttribute> attributes=new HashSet<StyleAttribute>();
  attributes.addAll(myAttributeValues.keySet());
  if (getParentStyle() != null) {
    for (    StyleAttribute sa : getParentStyle().myCachedAttributeValues.keySet()) {
      if (!(sa instanceof SimpleStyleAttribute)) {
        attributes.add(sa);
      }
    }
  }
  boolean changed=false;
  for (  StyleAttribute attribute : attributes) {
    Object parentValue=getParentStyle() == null ? null : getParentStyle().get(attribute);
    Object currentValue=myAttributeValues.get(attribute);
    if (currentValue instanceof AttributeCalculator) {
      currentValue=((AttributeCalculator)currentValue).calculate(myEditorCell);
    }
    Object newValue=attribute.combine(parentValue,currentValue);
    if (!EqualUtil.equals(newValue,oldCachedValues.get(attribute))) {
      changed=true;
    }
    if (newValue != null) {
      myCachedAttributeValues.put(attribute,newValue);
    }
  }
  if (changed) {
    for (    Style style : myChildren) {
      style.updateCache();
    }
  }
}
