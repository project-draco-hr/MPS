{
  FileInputStream baseIS=null;
  FileInputStream localIS=null;
  FileInputStream latestIS=null;
  OutputStream out=null;
  try {
    baseIS=new FileInputStream(baseFile);
    localIS=new FileInputStream(localFile);
    latestIS=new FileInputStream(latestFile);
    byte[] baseContent=ReadUtil.read(baseIS);
    byte[] localContent=ReadUtil.read(localIS);
    byte[] latestContent=ReadUtil.read(latestIS);
    FileUtil.closeFileSafe(localIS);
    out=getResultStream(localFile);
    String baseAsString=contentAsString(baseContent);
    String localAsString=contentAsString(localContent);
    String latestAsString=contentAsString(latestContent);
    if (baseAsString.equals(localAsString)) {
      out.write(latestContent);
      return MERGED;
    }
    if (baseAsString.equals(latestAsString) || localAsString.equals(latestAsString)) {
      out.write(localContent);
      return MERGED;
    }
    out.write(extractHeader(localContent));
    out.write(myConflictStart);
    out.write(LINE_SEPARATOR);
    out.write(localContent);
    out.write(mySeparator);
    out.write(LINE_SEPARATOR);
    out.write(baseContent);
    out.write(mySeparator);
    out.write(LINE_SEPARATOR);
    out.write(latestContent);
    out.write(myConflictEnd);
    out.write(LINE_SEPARATOR);
    return CONFLICTS;
  }
 catch (  IOException e) {
    e.printStackTrace();
    return FATAL_ERROR;
  }
 finally {
    FileUtil.closeFileSafe(baseIS);
    FileUtil.closeFileSafe(localIS);
    FileUtil.closeFileSafe(latestIS);
    FileUtil.closeFileSafe(out);
  }
}
