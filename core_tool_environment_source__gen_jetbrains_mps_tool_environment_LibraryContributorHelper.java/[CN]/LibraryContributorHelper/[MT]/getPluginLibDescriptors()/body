{
  Set<LibDescriptor> paths=new LinkedHashSet<LibDescriptor>();
  for (  PluginDescriptor descriptor : myConfig.getPlugins()) {
    String pluginFolder=descriptor.getPath();
    for (    String pluginsPath : Arrays.asList(PathManager.getPluginsPath(),PathManager.getPreInstalledPluginsPath())) {
      File pluginDirectory=new File(pluginsPath,pluginFolder);
      File libFolder=new File(pluginDirectory,"lib");
      UrlClassLoader pluginCL=null;
      if (libFolder.exists() && libFolder.isDirectory()) {
        pluginCL=createPluginClassLoader(libFolder);
        for (        File jar : libFolder.listFiles(jetbrains.mps.util.PathManager.JAR_FILE_FILTER)) {
          paths.add(new LibDescriptor(new IoFileSystem().getFile(jar.getAbsolutePath() + MODULES_PREFIX),pluginCL));
        }
      }
      File languagesFolder=new File(pluginDirectory,"languages");
      if (languagesFolder.exists() && languagesFolder.isDirectory()) {
        paths.add(new LibDescriptor(new IoFileSystem().getFile(languagesFolder.getAbsolutePath()),pluginCL));
      }
      File classesFolder=new File(pluginDirectory,"classes");
      if (classesFolder.exists() && classesFolder.isDirectory()) {
        paths.add(new LibDescriptor(new IoFileSystem().getFile(classesFolder.getAbsolutePath()),pluginCL));
      }
    }
  }
  return Collections.unmodifiableSet(paths);
}
