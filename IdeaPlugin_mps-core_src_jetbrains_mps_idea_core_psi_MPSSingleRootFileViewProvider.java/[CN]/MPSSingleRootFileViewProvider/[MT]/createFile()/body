{
  VirtualFile virtualFile=getVirtualFile();
  if (virtualFile instanceof LightVirtualFile) {
    virtualFile=((LightVirtualFile)virtualFile).getOriginalFile();
  }
  if (virtualFile == null || virtualFile.getFileType() != MPSFileTypeFactory.MPS_FILE_TYPE) {
    return null;
  }
  final IFile modelFile=FileSystem.getInstance().getFileByPath(virtualFile.getPath());
  SRepository repository=ProjectHelper.getProjectRepository(getManager().getProject());
  FileSourcePsiFile psiFile=new ModelAccessHelper(repository.getModelAccess()).runReadAction(new Computable<FileSourcePsiFile>(){
    @Override public FileSourcePsiFile compute(){
      SModel descr=SModelFileTracker.getInstance(repository).findModel(modelFile);
      if (descr != null) {
        MPSPsiProvider mpsPsiProvider=MPSPsiProvider.getInstance(getManager().getProject());
        MPSPsiModel psiModel=mpsPsiProvider.getPsi(descr);
        return new FileSourcePsiFile(MPSSingleRootFileViewProvider.this,descr.getReference(),descr.getModelName());
      }
      return null;
    }
  }
);
  return psiFile;
}
