{
  Queue<Node> queue=QueueSequence.fromQueue(new LinkedList<Node>());
  QueueSequence.fromQueue(queue).addLastElement(node);
  MapSequence.fromMap(myLayers).put(node,0);
  int nodeClass=MapSequence.fromMap(myClasses).get(node);
  myShift[nodeClass]=Integer.MAX_VALUE;
  while (QueueSequence.fromQueue(queue).count() > 0) {
    Node cur=QueueSequence.fromQueue(queue).removeFirstElement();
    for (    Edge edge : ListSequence.fromList(cur.getOutEdges())) {
      Node target=edge.getTarget();
      if (MapSequence.fromMap(myClasses).get(node) == MapSequence.fromMap(myClasses).get(target)) {
        MapSequence.fromMap(myNumInEdges).put(target,MapSequence.fromMap(myNumInEdges).get(target) - 1);
        if (MapSequence.fromMap(myNumInEdges).get(target) == 0) {
          MapSequence.fromMap(myLayers).put(target,MapSequence.fromMap(myLayers).get(cur) + 1);
          QueueSequence.fromQueue(queue).addLastElement(target);
        }
      }
 else {
        myShift[nodeClass]=Math.min(myShift[nodeClass],myLayers.get(target) - myLayers.get(cur) - 1);
      }
    }
  }
}
