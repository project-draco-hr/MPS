{
  Project p=PlatformDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext(this));
  IdeFocusManager focusManager;
  if (p != null) {
    focusManager=IdeFocusManager.getInstance(p);
  }
 else {
    focusManager=IdeFocusManagerHeadless.INSTANCE;
  }
  focusManager.requestFocus(this,true);
  TreePath path=getClosestPathForLocation(e.getX(),e.getY());
  if (path == null)   return;
  Object lastPathComponent=path.getLastPathComponent();
  MPSTreeNode nodeToClick=null;
  if (lastPathComponent instanceof MPSTreeNode && ((MPSTreeNode)lastPathComponent).canBeOpened()) {
    nodeToClick=(MPSTreeNode)lastPathComponent;
    if ((e.getClickCount() == 1 && isAutoOpen())) {
      autoscroll(nodeToClick);
    }
 else     if (e.getClickCount() == 2) {
      e.consume();
    }
  }
 else   if (e.getButton() == MouseEvent.BUTTON3) {
    if (!isPathSelected(path)) {
      setSelectionPath(path);
    }
  }
  final MPSTreeNode node2dc=e.getClickCount() == 2 ? nodeToClick : null;
  focusManager.doWhenFocusSettlesDown(new Runnable(){
    @Override public void run(){
      if (node2dc != null) {
        doubleClick(node2dc);
      }
      if (e.isPopupTrigger())       showPopup(e.getX(),e.getY());
    }
  }
);
}
