{
  if (myExpandingNodes.contains(node))   return;
  myExpandingNodes.add(node);
  try {
    TextTreeNode progressNode=null;
    if (!myLoadingDisabled && node.isLoadingEnabled()) {
      progressNode=new TextTreeNode("loading...");
      node.add(progressNode);
      ((DefaultTreeModel)getModel()).nodeStructureChanged(node);
      expandPath(new TreePath(progressNode.getPath()));
      Graphics g=getGraphics();
      if (g != null && g.getClipBounds() != null)       paint(g);
    }
    ModelAccess.instance().runReadAction(new Runnable(){
      @Override public void run(){
        node.init();
      }
    }
);
    if (!myLoadingDisabled && node.isLoadingEnabled() && node.hasChild(progressNode)) {
      node.remove(progressNode);
      ((DefaultTreeModel)getModel()).nodeStructureChanged(node);
    }
  }
  finally {
    myExpandingNodes.remove(node);
  }
}
