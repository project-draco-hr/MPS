{
  Set<VirtualFile> roots=new HashSet<VirtualFile>();
  for (  Project p : myProjectManager.getOpenProjects()) {
    roots.add(p.getBaseDir());
    ProjectLibraryManager projectLibraryManager=p.getComponent(ProjectLibraryManager.class);
    if (projectLibraryManager != null) {
      for (      Library lib : projectLibraryManager.getUILibraries()) {
        VirtualFile file=VFileSystem.getFile(lib.getPath());
        if (file != null) {
          roots.add(file);
        }
      }
    }
    ProjectLevelVcsManager manager=ProjectLevelVcsManager.getInstance(p);
    if (manager != null) {
      roots.addAll(Arrays.asList(manager.getAllVersionedRoots()));
    }
  }
  LibraryManager libraryManager=LibraryManager.getInstance();
  for (  Library lib : libraryManager.getUILibraries()) {
    VirtualFile file=VFileSystem.getFile(lib.getPath());
    if (file != null) {
      roots.add(file);
    }
  }
  return roots;
}
