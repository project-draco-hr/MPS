{
  Program p=DataFlowManager.getInstance().buildProgramFor(node);
  Map<SNode,NullableVariableState> result=MapSequence.fromMap(new HashMap<SNode,NullableVariableState>());
  AnalysisResult<Map<SNode,NullableVariableState>> analysisResult=p.analyze(new NullableAnalyzer<SNode>());
  for (  SNode reference : ListSequence.fromList(SNodeOperations.getDescendants(node,"jetbrains.mps.baseLanguage.structure.LocalVariableReference",false))) {
    if (!(p.getInstructionsFor(reference).isEmpty())) {
      Instruction instruction=p.getInstructionsFor(reference).get(0);
      NullableVariableState state=MapSequence.fromMap(analysisResult.get(instruction)).get(SLinkOperations.getTarget(reference,"variableDeclaration",false));
      if (state != null) {
        MapSequence.fromMap(result).put(reference,state);
      }
    }
  }
  return result;
}
