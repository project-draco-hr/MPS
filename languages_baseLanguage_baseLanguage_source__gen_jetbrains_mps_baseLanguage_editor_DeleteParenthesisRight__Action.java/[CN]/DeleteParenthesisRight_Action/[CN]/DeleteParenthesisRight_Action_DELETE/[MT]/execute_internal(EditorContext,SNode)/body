{
  int unmatchedLeftParens=((AttributeOperations.getAttribute(node,new IAttributeDescriptor.NodeAttribute("jetbrains.mps.baseLanguage.structure.IncompleteLeftParen")) != null) ? SPropertyOperations.getInteger(AttributeOperations.getAttribute(node,new IAttributeDescriptor.NodeAttribute("jetbrains.mps.baseLanguage.structure.IncompleteLeftParen")),"count") : 0);
  int unmatchedRightParens=((AttributeOperations.getAttribute(node,new IAttributeDescriptor.NodeAttribute("jetbrains.mps.baseLanguage.structure.IncompleteRightParen")) != null) ? SPropertyOperations.getInteger(AttributeOperations.getAttribute(node,new IAttributeDescriptor.NodeAttribute("jetbrains.mps.baseLanguage.structure.IncompleteRightParen")),"count") : 0);
  SNode replacing=SLinkOperations.getTarget(node,"expression",true);
  SNode leftMostNode=EditorParenthesisUtil.findRightmostOrLeftmostLeafExpression(replacing,false);
  SNodeOperations.replaceWithAnother(node,replacing);
  SNode rightMostNode=EditorParenthesisUtil.findRightmostOrLeftmostLeafExpression(replacing,true);
  ParenthesisUtil.checkWholeExpressionPriorities(replacing);
  ParenthesisUtil.createUnmatchedLeftParenthesis(leftMostNode);
  if (unmatchedLeftParens > 0) {
    for (int i=0; i < unmatchedLeftParens; i++) {
      ParenthesisUtil.createUnmatchedLeftParenthesis(leftMostNode);
    }
  }
  if (unmatchedRightParens > 0) {
    for (int i=0; i < unmatchedRightParens; i++) {
      ParenthesisUtil.createUnmatchedRightParenthesis(rightMostNode);
    }
  }
  SelectionUtil.selectLabelCellAnSetCaret(editorContext,rightMostNode,SelectionManager.LAST_CELL,-1);
}
