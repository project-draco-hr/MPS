{
  try {
    SNode classConcept=GenerateConstructor_Action.this.getClassConcept(_params);
    SNode superclass;
    SNodeReference[] ctors=null;
    boolean needsShowConstructorsDialog=false;
    SNodeReference[] selectedConstructors=null;
    SNodeReference[] selectedFields=null;
    superclass=SNodeOperations.as(SLinkOperations.getTarget(SLinkOperations.getTarget(classConcept,"superclass",true),"classifier",false),"jetbrains.mps.baseLanguage.structure.ClassConcept");
    if (superclass == null) {
      superclass=SNodeOperations.getNode("f:java_stub#6354ebe7-c22a-4a0f-ac54-50b52ab9b065#java.lang(JDK/java.lang@java_stub)","~Object");
    }
    if (Sequence.fromIterable(BehaviorReflection.invokeNonVirtual((Class<Iterable<SNode>>)((Class)Object.class),superclass,"jetbrains.mps.baseLanguage.structure.ClassConcept","call_constructors_5292274854859503373",new Object[]{})).count() > 1) {
      needsShowConstructorsDialog=true;
      ctors=Sequence.fromIterable(BehaviorReflection.invokeNonVirtual((Class<Iterable<SNode>>)((Class)Object.class),superclass,"jetbrains.mps.baseLanguage.structure.ClassConcept","call_constructors_5292274854859503373",new Object[]{})).select(new ISelector<SNode,SNodePointer>(){
        public SNodePointer select(        SNode it){
          return new SNodePointer(it);
        }
      }
).toGenericArray(SNodePointer.class);
    }
 else {
      selectedConstructors=new SNodeReference[]{new SNodePointer(Sequence.fromIterable(BehaviorReflection.invokeNonVirtual((Class<Iterable<SNode>>)((Class)Object.class),superclass,"jetbrains.mps.baseLanguage.structure.ClassConcept","call_constructors_5292274854859503373",new Object[]{})).first())};
    }
    if (needsShowConstructorsDialog) {
      SelectConstructorsDialog selectConstructorsDialog=new SelectConstructorsDialog(ctors,((EditorContext)MapSequence.fromMap(_params).get("editorContext")).getOperationContext().getProject());
      selectConstructorsDialog.setTitle("Choose Super Class Constructor");
      selectConstructorsDialog.show();
      if (!(selectConstructorsDialog.isOK())) {
        return;
      }
      List<SNodeReference> selectedElements=selectConstructorsDialog.getSelectedElements();
      selectedConstructors=(selectedElements != null ? selectedElements.toArray(new SNodeReference[selectedElements.size()]) : new SNodeReference[0]);
    }
    boolean needsShowFieldsDialog=false;
    SNodeReference[] fields=null;
    if (Sequence.fromIterable(BehaviorReflection.invokeNonVirtual((Class<Iterable<SNode>>)((Class)Object.class),classConcept,"jetbrains.mps.baseLanguage.structure.ClassConcept","call_fields_5292274854859383272",new Object[]{})).isNotEmpty()) {
      needsShowFieldsDialog=true;
      fields=Sequence.fromIterable(BehaviorReflection.invokeNonVirtual((Class<Iterable<SNode>>)((Class)Object.class),classConcept,"jetbrains.mps.baseLanguage.structure.ClassConcept","call_fields_5292274854859383272",new Object[]{})).select(new ISelector<SNode,SNodePointer>(){
        public SNodePointer select(        SNode it){
          return new SNodePointer(it);
        }
      }
).toGenericArray(SNodePointer.class);
    }
 else {
      selectedFields=new SNodeReference[0];
    }
    if (needsShowFieldsDialog) {
      SelectFieldsDialog selectFieldsDialog=new SelectFieldsDialog(fields,true,((EditorContext)MapSequence.fromMap(_params).get("editorContext")).getOperationContext().getProject());
      selectFieldsDialog.setTitle("Choose Fields to Initialize by Constructor");
      selectFieldsDialog.show();
      if (!(selectFieldsDialog.isOK())) {
        return;
      }
      selectedFields=Sequence.fromIterable(((Iterable<SNodeReference>)selectFieldsDialog.getSelectedElements())).toGenericArray(SNodeReference.class);
    }
    SNode constructorDeclaration=null;
    Project project=((EditorContext)MapSequence.fromMap(_params).get("editorContext")).getOperationContext().getProject();
    for (    SNodeReference ptr : selectedConstructors) {
      SNode selectedSuperConstructor=SNodeOperations.cast(((SNodePointer)ptr).resolve(MPSModuleRepository.getInstance()),"jetbrains.mps.baseLanguage.structure.ConstructorDeclaration");
      SNode constructor=SNodeFactoryOperations.addNewChild(classConcept,"member","jetbrains.mps.baseLanguage.structure.ConstructorDeclaration");
      constructorDeclaration=constructor;
      SNodeFactoryOperations.setNewChild(constructor,"body","jetbrains.mps.baseLanguage.structure.StatementList");
      if (ListSequence.fromList(SLinkOperations.getTargets(selectedSuperConstructor,"parameter",true)).isNotEmpty()) {
        SNode invocation=SNodeFactoryOperations.addNewChild(SLinkOperations.getTarget(constructor,"body",true),"statement","jetbrains.mps.baseLanguage.structure.SuperConstructorInvocation");
        SLinkOperations.setTarget(invocation,"baseMethodDeclaration",selectedSuperConstructor,false);
        for (        SNode superParam : SLinkOperations.getTargets(selectedSuperConstructor,"parameter",true)) {
          final SNode parameter=SNodeFactoryOperations.addNewChild(constructor,"parameter","jetbrains.mps.baseLanguage.structure.ParameterDeclaration");
          SPropertyOperations.set(parameter,"name",SPropertyOperations.getString(superParam,"name"));
          SLinkOperations.setTarget(parameter,"type",SNodeOperations.copyNode(SLinkOperations.getTarget(superParam,"type",true)),true);
          ListSequence.fromList(SLinkOperations.getTargets(superParam,"annotation",true)).visitAll(new IVisitor<SNode>(){
            public void visit(            SNode it){
              ListSequence.fromList(SLinkOperations.getTargets(parameter,"annotation",true)).addElement(SNodeOperations.copyNode(it));
            }
          }
);
          SNode paramReference=SNodeFactoryOperations.addNewChild(invocation,"actualArgument","jetbrains.mps.baseLanguage.structure.VariableReference");
          SLinkOperations.setTarget(paramReference,"variableDeclaration",parameter,false);
        }
      }
      for (      SNodeReference fieldPtr : selectedFields) {
        SNode field=SNodeOperations.cast(((SNodePointer)fieldPtr).resolve(MPSModuleRepository.getInstance()),"jetbrains.mps.baseLanguage.structure.FieldDeclaration");
        SNode parameterDeclaration=_quotation_createNode_yl16du_a0b0f0r0a(SNodeOperations.copyNode(SLinkOperations.getTarget(field,"type",true)),GenerateGettersAndSettersUtil.getParameterNameForField(field,project));
        ListSequence.fromList(SLinkOperations.getTargets(constructor,"parameter",true)).addElement(parameterDeclaration);
        SNode expressionStatement=SNodeFactoryOperations.addNewChild(SLinkOperations.getTarget(constructor,"body",true),"statement","jetbrains.mps.baseLanguage.structure.ExpressionStatement");
        SNode assignmentExpression=SNodeFactoryOperations.setNewChild(expressionStatement,"expression","jetbrains.mps.baseLanguage.structure.AssignmentExpression");
        SLinkOperations.setTarget(assignmentExpression,"lValue",_quotation_createNode_yl16du_a0a5a5a71a0(field),true);
        SLinkOperations.setTarget(assignmentExpression,"rValue",_quotation_createNode_yl16du_a0a6a5a71a0(parameterDeclaration),true);
      }
    }
    if (constructorDeclaration != null) {
      ((EditorContext)MapSequence.fromMap(_params).get("editorContext")).select(constructorDeclaration);
    }
  }
 catch (  Throwable t) {
    if (LOG.isEnabledFor(Level.ERROR)) {
      LOG.error("User's action execute method failed. Action:" + "GenerateConstructor",t);
    }
  }
}
