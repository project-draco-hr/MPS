{
  try {
    SModel migrationModel=((SModel)MapSequence.fromMap(_params).get("migrationModel"));
    if (migrationModel == null) {
      migrationModel=MigrationsUtil.getMigrationModel(((SModule)MapSequence.fromMap(_params).get("module")));
    }
    if (migrationModel == null) {
      migrationModel=AddMigration_Action.this.createMigrationModel(_params);
    }
    if (migrationModel == null) {
      return;
    }
    SModule module=migrationModel.getModule();
    int currentVersion=((Language)module).getLanguageVersion();
    if ((SModel)migrationModel instanceof SModelInternal) {
      ((SModelInternal)(SModel)migrationModel).addLanguage(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("90746344-04fd-4286-97d5-b46ae6a81709(jetbrains.mps.migration)"),Language.class));
      ((AbstractModule)module).addUsedLanguage(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("90746344-04fd-4286-97d5-b46ae6a81709(jetbrains.mps.migration)"),Language.class).getModuleReference());
      ((SModelInternal)(SModel)migrationModel).addLanguage(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("28f9e497-3b42-4291-aeba-0a1039153ab1(jetbrains.mps.lang.plugin)"),Language.class));
      ((AbstractModule)module).addUsedLanguage(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("28f9e497-3b42-4291-aeba-0a1039153ab1(jetbrains.mps.lang.plugin)"),Language.class).getModuleReference());
      ((SModelInternal)(SModel)migrationModel).addDevKit(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("fbc25dd2-5da4-483a-8b19-70928e1b62d7(jetbrains.mps.devkit.general-purpose)")).getModuleReference());
      ((AbstractModule)module).addUsedDevkit(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("fbc25dd2-5da4-483a-8b19-70928e1b62d7(jetbrains.mps.devkit.general-purpose)")).getModuleReference());
      ((SModelInternal)(SModel)migrationModel).addModelImport(SModelRepository.getInstance().getModelDescriptor("org.jetbrains.mps.openapi.language@java_stub").getReference(),true);
      ((AbstractModule)module).addDependency(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("8865b7a8-5271-43d3-884c-6fd1d9cfdd34(MPS.OpenAPI)")).getModuleReference(),false);
      ((SModelInternal)(SModel)migrationModel).addModelImport(SModelRepository.getInstance().getModelDescriptor("jetbrains.mps.smodel.adapter").getReference(),true);
      ((AbstractModule)module).addDependency(ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("2d3c70e9-aab2-4870-8d8d-6036800e4103(jetbrains.mps.kernel)")).getModuleReference(),false);
    }
    SNode script=SModelOperations.createNewRootNode(migrationModel,"jetbrains.mps.migration.structure.MigrationScript",null);
    SPropertyOperations.set(script,"fromVersion","" + (currentVersion));
    SLanguageAdapter lang=new SLanguageAdapter(IdHelper.getLanguageId((Language)module));
    SLinkOperations.setTarget(script,"body",_quotation_createNode_sorkti_a0k0a(),true);
    SLinkOperations.setTarget(script,"applicable",_quotation_createNode_sorkti_a0l0a(lang.getId().serialize(),lang.getQualifiedName()),true);
    ((Language)module).getModuleDescriptor().setVersion(currentVersion + 1);
  }
 catch (  Throwable t) {
    if (LOG.isEnabledFor(Level.ERROR)) {
      LOG.error("User's action execute method failed. Action:" + "AddMigration",t);
    }
  }
}
