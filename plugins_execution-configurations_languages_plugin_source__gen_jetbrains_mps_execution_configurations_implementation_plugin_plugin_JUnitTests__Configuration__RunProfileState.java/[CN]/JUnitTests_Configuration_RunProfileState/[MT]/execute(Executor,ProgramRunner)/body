{
  Project project=myEnvironment.getProject();
  JUnitSettings_Configuration jUnitSettings=myRunConfiguration.getJUnitSettings();
  boolean debugExecutor=executor.getId().equals(DefaultDebugExecutor.EXECUTOR_ID);
  jUnitSettings.setDebug(debugExecutor);
  MPSProject mpsProject=ProjectHelper.fromIdeaProject(project);
  List<ITestNodeWrapper> testNodes=jUnitSettings.getTests(mpsProject);
  TestRunState runState=new TestRunState(testNodes,mpsProject);
  TestEventsDispatcher eventsDispatcher=new TestEventsDispatcher(runState);
  jetbrains.mps.execution.configurations.implementation.plugin.plugin.Executor processExecutor;
  if (jUnitSettings.canExecuteInProcess(testNodes)) {
    processExecutor=new JUnitInProcessExecutor(testNodes,eventsDispatcher);
  }
 else {
    processExecutor=new JUnitExecutor(project,executor,jUnitSettings,myDebuggerSettings,myRunConfiguration.getJavaRunParameters(),testNodes);
  }
  ProcessHandler process=processExecutor.execute();
  final UnitTestViewComponent testViewComponent=myRunConfiguration.createTestViewComponent(runState,process);
  ProcessListener listener=new UnitTestProcessListener(eventsDispatcher);
  _FunctionTypes._void_P0_E0 disposeHandler=new _FunctionTypes._void_P0_E0(){
    public void invoke(){
      testViewComponent.dispose();
    }
  }
;
{
    ProcessHandler _processHandler=process;
    _processHandler.addProcessListener(listener);
    return new DefaultExecutionResult(_processHandler,new DefaultExecutionConsole(testViewComponent,disposeHandler));
  }
}
