{
  Project project=myEnvironment.getProject();
  boolean canExecuteLightly=JUnitLightExecutor.acquireLock();
  JUnitSettings_Configuration jUnitSettings=myRunConfiguration.getJUnitSettings();
  List<ITestNodeWrapper> testNodes=jUnitSettings.getTests(ProjectHelper.toMPSProject(project),canExecuteLightly);
  TestRunState runState=new TestRunState(testNodes);
  TestEventsDispatcher eventsDispatcher=new TestEventsDispatcher(runState);
  jetbrains.mps.execution.configurations.implementation.plugin.plugin.Executor processExecutor;
  if (canExecuteLightly && jUnitSettings.canLightExecute(testNodes)) {
    processExecutor=new JUnitLightExecutor(testNodes,eventsDispatcher);
  }
 else {
    JUnitLightExecutor.releaseLock();
    processExecutor=new JUnitExecutor(jUnitSettings,myRunConfiguration.getJavaRunParameters(),testNodes);
  }
  ProcessHandler process=processExecutor.execute();
  final UnitTestViewComponent testViewComponent=myRunConfiguration.createTestViewComponent(runState,process);
  ProcessListener listener=new UnitTestProcessListener(eventsDispatcher);
  _FunctionTypes._void_P0_E0 disposeHandler=new _FunctionTypes._void_P0_E0(){
    public void invoke(){
      testViewComponent.dispose();
    }
  }
;
{
    ProcessHandler _processHandler=process;
    _processHandler.addProcessListener(listener);
    return new DefaultExecutionResult(_processHandler,new DefaultExecutionConsole(testViewComponent,disposeHandler));
  }
}
