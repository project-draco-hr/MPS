{
  try {
    FeatureUsageTracker.getInstance().triggerFeatureUsed("editing.deleteLine");
    if (((EditorCell)MapSequence.fromMap(_params).get("currentCell")) instanceof EditorCell_Collection) {
      EditorCell_Collection collection=(EditorCell_Collection)((EditorCell)MapSequence.fromMap(_params).get("currentCell"));
      Queue<EditorCell_Collection> collections=QueueSequence.fromQueue(new LinkedList<EditorCell_Collection>());
      QueueSequence.fromQueue(collections).addLastElement(collection);
      while (QueueSequence.fromQueue(collections).isNotEmpty()) {
        EditorCell_Collection nextCollection=QueueSequence.fromQueue(collections).removeFirstElement();
        if (nextCollection.getCellLayout() instanceof CellLayout_Vertical) {
          return;
        }
        for (        jetbrains.mps.openapi.editor.cells.EditorCell childCell : Sequence.fromIterable(nextCollection)) {
          if (childCell instanceof EditorCell_Collection) {
            QueueSequence.fromQueue(collections).addLastElement((EditorCell_Collection)childCell);
          }
        }
      }
    }
    EditorCell current=((EditorCell)MapSequence.fromMap(_params).get("currentCell"));
    List<SNode> nodesToDelete=new ArrayList<SNode>();
    EditorCell cellToSelect=null;
    while (true) {
      if (current.getParent() == null) {
        break;
      }
      jetbrains.mps.openapi.editor.cells.CellLayout layout=current.getParent().getCellLayout();
      if (layout instanceof CellLayout_Indent) {
        SNode currentNode=current.getSNode();
        if (SNodeOperations.isInstanceOf(currentNode,"jetbrains.mps.baseLanguage.structure.Statement") || (SNodeOperations.getAncestor(currentNode,"jetbrains.mps.baseLanguage.structure.Statement",false,false) == null)) {
          EditorCell root=current.getRootParent();
          boolean iteratingTroughNextSiblings=false;
          for (          jetbrains.mps.openapi.editor.cells.EditorCell cell : current.getParent()) {
            if (iteratingTroughNextSiblings) {
              ListSequence.fromList(nodesToDelete).addElement(cell.getSNode());
              if (CellLayout_Indent.isNewLineAfter(root,cell)) {
                cellToSelect=((EditorCell)cell).getNextLeaf(CellConditions.SELECTABLE);
                break;
              }
            }
 else             if (cell == current) {
              iteratingTroughNextSiblings=true;
            }
          }
          if (cellToSelect == null) {
            cellToSelect=current.getNextLeaf(CellConditions.SELECTABLE);
          }
          break;
        }
      }
 else       if (layout instanceof CellLayout_Vertical) {
        if (current.isBigCell()) {
          ListSequence.fromList(nodesToDelete).addElement(current.getSNode());
          cellToSelect=current.getNextLeaf(CellConditions.SELECTABLE);
          break;
        }
      }
      current=(EditorCell)current.getParent();
    }
    for (    SNode nodeToDelete : nodesToDelete) {
      if ((nodeToDelete != null) && SNodeOperations.getParent(nodeToDelete) != null) {
        SNodeOperations.deleteNode(nodeToDelete);
      }
    }
    if (cellToSelect != null) {
      ((EditorComponent)MapSequence.fromMap(_params).get("editorComponent")).changeSelection(cellToSelect);
      cellToSelect.home();
    }
  }
 catch (  Throwable t) {
    LOG.error("User's action execute method failed. Action:" + "DeleteLine",t);
  }
}
