{
  for (  SNode inputNode : inputNodes) {
    if (inputNode == null) {
      continue;
    }
    SNode outputNode=mapping.get(inputNode);
    for (    SReference ref : inputNode.getReferences()) {
      SNode inputTargetNode=ref.getTargetNode();
      if (inputTargetNode == null) {
        if (ref instanceof StaticReference) {
          StaticReference staticReference=(StaticReference)ref;
          outputNode.addReference(new StaticReference(staticReference.getRole(),staticReference.getSourceNode(),staticReference.getTargetSModelReference(),staticReference.getTargetNodeId(),staticReference.getResolveInfo()));
        }
      }
 else       if (mapping.containsKey(inputTargetNode)) {
        LinkDeclaration linkDeclaration=new ConceptAndSuperConceptsScope(inputNode.getConceptDeclarationAdapter()).getLinkDeclarationByRole(ref.getRole());
        if (linkDeclaration != null && linkDeclaration.getOuter()) {
          outputNode.setReferent(ref.getRole(),inputTargetNode,false);
        }
 else {
          outputNode.setReferent(ref.getRole(),mapping.get(inputTargetNode),false);
        }
      }
 else {
        outputNode.setReferent(ref.getRole(),inputTargetNode,false);
      }
    }
    addReferences(inputNode.getChildren(copyAttributes),mapping,copyAttributes);
  }
}
