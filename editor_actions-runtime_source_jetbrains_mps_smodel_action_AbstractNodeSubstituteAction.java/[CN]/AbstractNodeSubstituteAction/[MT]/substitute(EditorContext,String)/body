{
  final SNode[] newNode=new SNode[1];
  Runnable runnable=new Runnable(){
    public void run(){
      newNode[0]=doSubstitute(context,pattern);
      if (context != null) {
        if (newNode[0] == null) {
          context.flushEvents();
          EditorCell selectedCell=(EditorCell)context.getSelectedCell();
          if (selectedCell != null) {
            selectedCell.getContainingBigCell().synchronizeViewWithModel();
          }
          if (selectedCell instanceof EditorCell_Label && ((EditorCell_Label)selectedCell).isEditable()) {
            EditorCell_Label cell=(EditorCell_Label)selectedCell;
            cell.end();
          }
        }
 else {
          context.selectWRTFocusPolicy(newNode[0],true);
        }
      }
    }
  }
;
  if (context != null) {
    context.executeCommand(runnable);
  }
 else {
    ModelAccess.instance().executeCommand(runnable,null);
  }
  return newNode[0];
}
