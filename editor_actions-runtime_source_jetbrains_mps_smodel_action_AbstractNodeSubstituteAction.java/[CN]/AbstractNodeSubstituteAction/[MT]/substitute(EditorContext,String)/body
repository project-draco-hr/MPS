{
  final SNode[] newNode=new SNode[1];
  Runnable runnable=new Runnable(){
    public void run(){
      if (context != null) {
        EditorCell selectedCell=(EditorCell)context.getSelectedCell();
        if (selectedCell != null) {
          selectedCell.getContainingBigCell().synchronizeViewWithModel();
        }
      }
      newNode[0]=doSubstitute(context,pattern);
      if (context != null && newNode[0] != null) {
        context.selectWRTFocusPolicy(newNode[0],true);
      }
    }
  }
;
  if (context != null) {
    context.executeCommand(runnable);
  }
 else {
    ModelAccess.instance().executeCommand(runnable,null);
  }
  return newNode[0];
}
