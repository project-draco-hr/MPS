{
  Color backgroundColor;
  Color textColor;
  Color textBackgroundColor;
  FontMetrics metrics=getFontMetrics();
  backgroundColor=getBackgroundColor();
  if (forcedTextColor != null) {
    textColor=forcedTextColor;
    textBackgroundColor=null;
  }
 else {
    if (mySelected) {
      textColor=getEffectiveSelectedTextColor();
      textBackgroundColor=getSelectedTextBackgroundColor();
    }
 else {
      textColor=getEffectiveTextColor();
      textBackgroundColor=getTextBackgroundColor();
    }
  }
  if (backgroundColor != null && !g.getColor().equals(backgroundColor) && !mySelected) {
    g.setColor(backgroundColor);
    g.fillRect(shiftX + getPaddingLeft(),shiftY + getPaddingTop(),myWidth - 1,myTextHeight - 1);
  }
  if (textBackgroundColor != null) {
    g.setColor(textBackgroundColor);
    g.fillRect(shiftX + getPaddingLeft(),shiftY + getPaddingTop(),myWidth - 1,myTextHeight - 1);
  }
  g.setFont(getFont());
  if (!g.getColor().equals(textColor)) {
    g.setColor(textColor);
  }
  int deltaShiftX_EndSelection=(myEndTextSelectionPosition <= myText.length()) ? getCaretX(0,myEndTextSelectionPosition) : getPaddingLeft();
  int deltaShiftX_StartSelection=getCaretX(0,myStartTextSelectionPosition);
  int endLine=getCaretX(shiftX,myText.length());
  int baselineY=shiftY + myHeight - myDescent - getPaddingBottom() - getPaddingTop();
  int centerLineY=shiftY + (myHeight - getPaddingBottom() + getPaddingTop()) / 2;
  if (myStartTextSelectionPosition > 0) {
    g.drawString(myText.substring(0,myStartTextSelectionPosition),shiftX + getPaddingLeft(),baselineY);
    if (isUnderlined()) {
      g.drawLine(shiftX + getPaddingLeft(),baselineY + 1,shiftX + deltaShiftX_StartSelection,baselineY + 1);
    }
    if (isStrikeOut()) {
      drawStrikeOutLine(g,shiftX + getPaddingLeft(),shiftX + deltaShiftX_StartSelection,centerLineY);
    }
  }
  if (myEndTextSelectionPosition <= myText.length()) {
    g.drawString(myText.substring(myEndTextSelectionPosition),shiftX + deltaShiftX_EndSelection,baselineY);
    if (isUnderlined()) {
      g.drawLine(shiftX + deltaShiftX_EndSelection,baselineY + 1,endLine,baselineY + 1);
    }
    if (isStrikeOut()) {
      drawStrikeOutLine(g,shiftX + deltaShiftX_EndSelection,endLine,centerLineY);
    }
  }
  if (myStartTextSelectionPosition < myEndTextSelectionPosition) {
    Rectangle2D selectedStringBounds=metrics.getStringBounds(getTextuallySelectedText(),g);
    g.setColor(myTextSelectedBackgroundColor);
    g.fillRect(shiftX + deltaShiftX_StartSelection + 1,shiftY + getPaddingTop() + 1,(int)selectedStringBounds.getWidth() - 1,myTextHeight - 1);
    g.setColor(myTextSelectedTextColor);
    g.drawString(getTextuallySelectedText(),shiftX + deltaShiftX_StartSelection,baselineY);
    if (isUnderlined()) {
      g.drawLine(shiftX + deltaShiftX_StartSelection,baselineY + 1,shiftX + deltaShiftX_EndSelection,baselineY + 1);
    }
    if (isStrikeOut()) {
      drawStrikeOutLine(g,shiftX + deltaShiftX_StartSelection,shiftX + deltaShiftX_EndSelection,centerLineY);
    }
    g.setColor(textColor);
  }
  if (myShowCaret) {
    drawCaret(g,shiftX,shiftY);
  }
}
