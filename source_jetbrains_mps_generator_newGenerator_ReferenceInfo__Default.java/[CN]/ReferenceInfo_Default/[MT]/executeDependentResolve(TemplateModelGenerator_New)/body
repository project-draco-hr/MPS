{
  IReferenceResolver referenceResolver=loadReferenceResolver(generator.getScope());
  if (referenceResolver != null) {
    SNode outputTargetNode=referenceResolver.resolveTarget_New(myTemplateReference,new SimpleNodeBuilder(generator,myOutputNode,myTemplateSourceNode,myInputNode));
    if (outputTargetNode != null) {
      myOutputNode.addReferent(myTemplateReference.getRole(),outputTargetNode);
      setSuccess(true);
      return;
    }
  }
  SNode leastCommonParent_template=myTemplateSourceNode.findLeastCommonParent(myTemplateTargetNode);
  if (leastCommonParent_template != null) {
    SNode leastCommonOutputNode=myOutputNode;
    while (leastCommonOutputNode != null && generator.findTemplateNodeByOutputNode(leastCommonOutputNode) != leastCommonParent_template) {
      leastCommonOutputNode=leastCommonOutputNode.getParent();
    }
    if (leastCommonOutputNode != null) {
      SNode outputTargetNode=findOutputNodeByTemplateTarget(generator,leastCommonOutputNode);
      if (outputTargetNode != null) {
        myOutputNode.addReferent(myTemplateReference.getRole(),outputTargetNode);
        setSuccess(true);
      }
    }
  }
}
