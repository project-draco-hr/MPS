{
  SNode referentNode=generator.findOutputNodeByTemplateNodeAndInputNode(myTemplateTargetNode,myInputNode);
  if (referentNode != null) {
    myOutputNode.addReferent(myTemplateReference.getRole(),referentNode);
    setSuccess(true);
    return;
  }
  SNode templateTargetNode=myTemplateSourceNode.getParent();
  SNode outputTargetNode=myOutputNode.getParent();
  while (templateTargetNode != null && outputTargetNode != null) {
    if (templateTargetNode.equals(myTemplateTargetNode)) {
      myOutputNode.addReferent(myTemplateReference.getRole(),outputTargetNode);
      setSuccess(true);
      return;
    }
    templateTargetNode=templateTargetNode.getParent();
    outputTargetNode=outputTargetNode.getParent();
  }
  IReferenceResolver referenceResolver=loadReferenceResolver(generator.getScope());
  if (referenceResolver != null) {
    outputTargetNode=referenceResolver.resolveTarget_New(myTemplateReference,new SimpleNodeBuilder(generator,myOutputNode,myTemplateSourceNode,myInputNode));
    if (outputTargetNode != null) {
      myOutputNode.addReferent(myTemplateReference.getRole(),outputTargetNode);
      setSuccess(true);
    }
  }
}
