{
  for (  SNode child : ListSequence.fromList(SNodeOperations.getChildren(node)).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return !(SNodeOperations.isAttribute(it));
    }
  }
)) {
    SNode link=SNodeOperations.getContainingLinkDeclaration(child);
    if (link != null && SPropertyOperations.hasValue(link,"metaClass","aggregation","reference")) {
      component.addDependency(link);
      if (!(SConceptOperations.isSuperConceptOf(SLinkOperations.getTarget(link,"target",false),NameUtil.nodeFQName(SNodeOperations.getConceptDeclaration(child))))) {
        component.addError(child,"incompatible target concept in role \"" + SNodeOperations.getContainingLinkRole(child) + "\": subconcept of \""+ SLinkOperations.getTarget(link,"target",false)+ "\" expected, \""+ SNodeOperations.getConceptDeclaration(child)+ "\" found",null);
      }
    }
  }
  for (  SReference reference : Sequence.fromIterable(SNodeOperations.getReferences(node))) {
    SNode link=SLinkOperations.findLinkDeclaration(reference);
    if (link == null || !(SPropertyOperations.hasValue(link,"metaClass","reference","reference"))) {
      continue;
    }
    SNode target=SLinkOperations.getTargetNode(reference);
    if (target == null) {
      continue;
    }
    component.addDependency(link);
    if (!(SConceptOperations.isSuperConceptOf(SLinkOperations.getTarget(link,"target",false),NameUtil.nodeFQName(SNodeOperations.getConceptDeclaration(target))))) {
      component.addError(node,"incompatible target concept in role \"" + SLinkOperations.getRole(reference) + "\": subconcept of \""+ SLinkOperations.getTarget(link,"target",false)+ "\" expected, \""+ SNodeOperations.getConceptDeclaration(target)+ "\" found",null,new ReferenceMessageTarget(SPropertyOperations.getString(link,"role")));
    }
  }
}
