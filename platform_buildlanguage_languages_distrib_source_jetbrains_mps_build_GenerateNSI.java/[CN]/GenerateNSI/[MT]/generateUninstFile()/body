{
  BufferedWriter uninstWriter=new BufferedWriter(new FileWriter(myOutput));
  try {
    List<File> allFiles=getAllFiles();
    Collections.sort(allFiles,new FileComparator());
    for (    File file : allFiles) {
      uninstWriter.newLine();
      uninstWriter.write("Delete \"$INSTDIR\\" + getRelativePath(file.getAbsolutePath()) + "\"");
    }
    uninstWriter.newLine();
    List<File> dirs=getAllDirs();
    Collections.sort(dirs,new FileComparator());
    for (int i=dirs.size() - 1; i >= 0; i--) {
      final File dir=dirs.get(i);
      if (dir.getAbsolutePath().length() == 0)       continue;
      uninstWriter.newLine();
      uninstWriter.write("RmDir \"$INSTDIR\\" + getRelativePath(dir.getAbsolutePath()) + "\"");
    }
    uninstWriter.newLine();
    uninstWriter.write("RmDir \"$INSTDIR\"");
  }
  finally {
    uninstWriter.close();
  }
}
