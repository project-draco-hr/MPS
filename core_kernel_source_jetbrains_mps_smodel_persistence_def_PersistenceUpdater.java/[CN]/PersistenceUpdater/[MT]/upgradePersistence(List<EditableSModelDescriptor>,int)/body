{
  for (  final EditableSModelDescriptor modelDescriptor : modelDescriptors) {
    boolean wasInitialized=modelDescriptor.isInitialized();
    IFile file=modelDescriptor.getModelFile();
    if (file.isReadOnly())     continue;
    if (wasInitialized) {
      ModelAccess.instance().executeCommand(new Runnable(){
        @Override public void run(){
          modelDescriptor.save();
        }
      }
);
    }
    if (modelDescriptor.getPersistenceVersion() < toVersion) {
      SModel model=wasInitialized ? modelDescriptor.getSModel() : ModelPersistence.readModel(file);
      if (model.getPersistenceVersion() < toVersion) {
        ModelPersistence.upgradePersistence(file,model,model.getPersistenceVersion(),toVersion);
        if (wasInitialized) {
          modelDescriptor.reloadFromDisk();
        }
      }
    }
  }
}
