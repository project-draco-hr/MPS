{
  if (myTrait == null) {
    myTrait=new ViewTraitBuilder().on(ViewEvents.MOUSE_DRAGGED,new ViewEventHandler<MouseEvent>(){
      @Override public void handle(      View view,      MouseEvent event){
        if (!(myDiagramCell.hasConnectionDragFeedback())) {
          View sourceView=view.viewAt(event.location());
          if (sourceView == null || !(check_lbjacb_a0a1a0a0a0b0a0a0a0a0f(sourceView.prop(JetpadUtils.CONNECTION_SOURCE).get()))) {
            return;
          }
          myDiagramCell.showConnectionDragFeedback(sourceView);
        }
        myDiagramCell.updateConnectionDragFeedback(event.location());
      }
    }
).on(ViewEvents.MOUSE_RELEASED,new ViewEventHandler<MouseEvent>(){
      @Override public void handle(      View view,      MouseEvent event){
        if (!(myDiagramCell.hasConnectionDragFeedback())) {
          return;
        }
        myDiagramCell.hideConnectionDragFeedback();
        final DiagramCell.ConnectionInfo connectionInfo=myDiagramCell.getConnectionInfo();
        final Wrappers._boolean result=new Wrappers._boolean(false);
        ModelAccess.instance().runReadAction(new Runnable(){
          public void run(){
            if (connectionInfo.isValid() && SNodeOperations.isInstanceOf(connectionInfo.getFromNode(),MetaAdapterFactory.getConcept(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec43f49dL,"jetbrains.mps.testHybridEditor.structure.BlockInstance")) && connectionInfo.getFromId() instanceof SNode&& SNodeOperations.isInstanceOf(connectionInfo.getToNode(),MetaAdapterFactory.getConcept(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec43f49dL,"jetbrains.mps.testHybridEditor.structure.BlockInstance"))&& connectionInfo.getToId() instanceof SNode&& eq_lbjacb_a0a0a0a0a0a4a0a0b0a0a0a0a5(SNodeOperations.getContainingLinkDeclaration(((SNode)connectionInfo.getToId())),SLinkOperations.findLinkDeclaration(MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec40c2c8L,0x20a804e2ec410486L,"inMetaPorts")))) {
              result.value=true;
            }
          }
        }
);
        if (!(result.value)) {
          return;
        }
        ModelAccess.instance().runWriteActionInCommand(new Runnable(){
          public void run(){
            SNode connectorInstance=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec441516L,"jetbrains.mps.testHybridEditor.structure.ConnectorInstance"));
            SLinkOperations.setTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec441516L,0x49664459198225c0L,"source"),SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x4966445919822461L,"jetbrains.mps.testHybridEditor.structure.ConnectorEndInstance")));
            SLinkOperations.setTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec441516L,0x49664459198225c6L,"target"),SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x4966445919822461L,"jetbrains.mps.testHybridEditor.structure.ConnectorEndInstance")));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec441516L,0x49664459198225c0L,"source")),MetaAdapterFactory.getReferenceLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x4966445919822461L,0x49664459198225bcL,"block"),SNodeOperations.cast(connectionInfo.getFromNode(),MetaAdapterFactory.getConcept(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec43f49dL,"jetbrains.mps.testHybridEditor.structure.BlockInstance")));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec441516L,0x49664459198225c0L,"source")),MetaAdapterFactory.getReferenceLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x4966445919822461L,0x49664459198225bdL,"metaPort"),((SNode)connectionInfo.getFromId()));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec441516L,0x49664459198225c6L,"target")),MetaAdapterFactory.getReferenceLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x4966445919822461L,0x49664459198225bcL,"block"),SNodeOperations.cast(connectionInfo.getToNode(),MetaAdapterFactory.getConcept(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec43f49dL,"jetbrains.mps.testHybridEditor.structure.BlockInstance")));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x20a804e2ec441516L,0x49664459198225c6L,"target")),MetaAdapterFactory.getReferenceLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0x4966445919822461L,0x49664459198225bdL,"metaPort"),((SNode)connectionInfo.getToId()));
            ListSequence.fromList(SLinkOperations.getChildren(((SNode)myDiagramCell.getSNode()),MetaAdapterFactory.getContainmentLink(0x913a1d639e1948faL,0xad03e33ecccd3814L,0xa10615a65702ec1L,0x20a804e2ec4425e0L,"newConnectors"))).addElement(connectorInstance);
          }
        }
);
        event.consume();
      }
    }
).build();
  }
  return myTrait;
}
