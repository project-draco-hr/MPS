{
  if (myTrait == null) {
    myTrait=new ViewTraitBuilder().on(ViewEvents.MOUSE_DRAGGED,new ViewEventHandler<MouseEvent>(){
      @Override public void handle(      View view,      MouseEvent event){
        if (!(myDiagramCell.hasConnectionDragFeedback())) {
          View sourceView=view.viewAt(event.location());
          if (sourceView == null || !(check_lbjacb_a0a1a0a0a0b0a0a0a0a0f(sourceView.prop(JetpadUtils.CONNECTION_SOURCE).get()))) {
            return;
          }
          myDiagramCell.showConnectionDragFeedback(sourceView);
        }
        myDiagramCell.updateConnectionDragFeedback(event.location());
      }
    }
).on(ViewEvents.MOUSE_RELEASED,new ViewEventHandler<MouseEvent>(){
      @Override public void handle(      View view,      MouseEvent event){
        if (!(myDiagramCell.hasConnectionDragFeedback())) {
          return;
        }
        myDiagramCell.hideConnectionDragFeedback();
        final DiagramCell.ConnectionInfo connectionInfo=myDiagramCell.getConnectionInfo();
        final Wrappers._boolean result=new Wrappers._boolean(false);
        ModelAccess.instance().runReadAction(new Runnable(){
          public void run(){
            if (connectionInfo.isValid() && SNodeOperations.isInstanceOf(connectionInfo.getFromNode(),MetaAdapterFactory.getConcept(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974080669l,"jetbrains.mps.testHybridEditor.structure.BlockInstance")) && connectionInfo.getFromId() instanceof SNode&& SNodeOperations.isInstanceOf(connectionInfo.getToNode(),MetaAdapterFactory.getConcept(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974080669l,"jetbrains.mps.testHybridEditor.structure.BlockInstance"))&& connectionInfo.getToId() instanceof SNode&& eq_lbjacb_a0a0a0a0a0a4a0a0b0a0a0a0a5(SNodeOperations.getContainingLinkDeclaration(((SNode)connectionInfo.getToId())),SLinkOperations.findLinkDeclaration(MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177973871304l,2353136177973888134l,"inMetaPorts")))) {
              result.value=true;
            }
          }
        }
);
        if (!(result.value)) {
          return;
        }
        ModelAccess.instance().runWriteActionInCommand(new Runnable(){
          public void run(){
            SNode connectorInstance=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974088982l,"jetbrains.mps.testHybridEditor.structure.ConnectorInstance"));
            SLinkOperations.setTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974088982l,5288989961863964096l,"source"),SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(new UUID(-7982035075869357830l,-5979686021354407916l),5288989961863963745l,"jetbrains.mps.testHybridEditor.structure.ConnectorEndInstance")));
            SLinkOperations.setTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974088982l,5288989961863964102l,"target"),SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(new UUID(-7982035075869357830l,-5979686021354407916l),5288989961863963745l,"jetbrains.mps.testHybridEditor.structure.ConnectorEndInstance")));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974088982l,5288989961863964096l,"source")),MetaAdapterFactory.getReferenceLink(new UUID(-7982035075869357830l,-5979686021354407916l),5288989961863963745l,5288989961863964092l,"block"),SNodeOperations.cast(connectionInfo.getFromNode(),MetaAdapterFactory.getConcept(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974080669l,"jetbrains.mps.testHybridEditor.structure.BlockInstance")));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974088982l,5288989961863964096l,"source")),MetaAdapterFactory.getReferenceLink(new UUID(-7982035075869357830l,-5979686021354407916l),5288989961863963745l,5288989961863964093l,"metaPort"),((SNode)connectionInfo.getFromId()));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974088982l,5288989961863964102l,"target")),MetaAdapterFactory.getReferenceLink(new UUID(-7982035075869357830l,-5979686021354407916l),5288989961863963745l,5288989961863964092l,"block"),SNodeOperations.cast(connectionInfo.getToNode(),MetaAdapterFactory.getConcept(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974080669l,"jetbrains.mps.testHybridEditor.structure.BlockInstance")));
            SLinkOperations.setTarget(SLinkOperations.getTarget(connectorInstance,MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),2353136177974088982l,5288989961863964102l,"target")),MetaAdapterFactory.getReferenceLink(new UUID(-7982035075869357830l,-5979686021354407916l),5288989961863963745l,5288989961863964093l,"metaPort"),((SNode)connectionInfo.getToId()));
            ListSequence.fromList(SLinkOperations.getChildren(((SNode)myDiagramCell.getSNode()),MetaAdapterFactory.getContainmentLink(new UUID(-7982035075869357830l,-5979686021354407916l),725186580883451585l,2353136177974093280l,"newConnectors"))).addElement(connectorInstance);
          }
        }
);
        event.consume();
      }
    }
).build();
  }
  return myTrait;
}
