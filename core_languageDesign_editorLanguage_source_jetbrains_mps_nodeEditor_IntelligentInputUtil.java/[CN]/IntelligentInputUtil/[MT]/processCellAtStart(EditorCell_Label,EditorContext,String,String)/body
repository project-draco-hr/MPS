{
  NodeSubstituteInfo info=cell.getSubstituteInfo();
  if (info == null) {
    info=new NullSubstituteInfo();
  }
  EditorCell cellForNewNode;
  SNode newNode;
  boolean sourceCellRemains=false;
  if (cell.isValidText(smallPattern) && !"".equals(smallPattern) && info.hasExactlyNActions(head + smallPattern,false,0)) {
    newNode=cell.getSNode();
    cellForNewNode=cell;
    sourceCellRemains=true;
  }
 else   if (canCompleteSmallPatternImmediately(info,smallPattern,"") && info.getMatchingActions(head,false).isEmpty()) {
    newNode=info.getMatchingActions(smallPattern,true).get(0).substitute(editorContext,smallPattern);
    if (newNode == null)     return;
    cellForNewNode=editorContext.createNodeCellInAir(newNode,ourServiceEditorManager);
  }
 else   if (canCompleteTheWholeStringImmediately(info,head + smallPattern) || canCompleteTheWholeStringImmediately(info,head + smallPattern.trim())) {
    if (!canCompleteTheWholeStringImmediately(info,head + smallPattern) && canCompleteTheWholeStringImmediately(info,head + smallPattern.trim())) {
      smallPattern=smallPattern.trim();
    }
    List<INodeSubstituteAction> matchingActions=info.getMatchingActions(head + smallPattern,true);
    INodeSubstituteAction item=matchingActions.get(0);
    item.substitute(editorContext,head + smallPattern);
    return;
  }
 else {
    return;
  }
  EditorCellAction ltAction=cellForNewNode.findChild(CellFinders.LAST_SELECTABLE_LEAF,true).getApplicableCellAction(CellActionType.LEFT_TRANSFORM);
  TypeChecker.getInstance().setTypeCheckingMode(TypeCheckingMode.COMPLETION);
  boolean hasSideActions=hasSideActions(cellForNewNode,CellSide.LEFT,head);
  TypeChecker.getInstance().resetTypeCheckingMode();
  if (ltAction == null || !hasSideActions) {
    CellInfo cellInfo=cellForNewNode.getCellInfo();
    if (!sourceCellRemains) {
      putTextInErrorChild(cellInfo,head + smallPattern,editorContext);
    }
    return;
  }
  if (sourceCellRemains) {
    cell.changeText(smallPattern);
    editorContext.getNodeEditorComponent().relayout();
  }
  ltAction.execute(editorContext);
  EditorCell newCellForNewNode=editorContext.createNodeCellInAir(newNode,ourServiceEditorManager);
  prepareSTCell(editorContext,newCellForNewNode,head);
}
