{
  System.out.println("adding files to vcs " + files);
  final List<VirtualFile> inVCS=new LinkedList<VirtualFile>();
  List<File> notInVCS=new LinkedList<File>();
  final ProjectLevelVcsManager manager=myProject.getComponent(ProjectLevelVcsManager.class);
  for (  VirtualFile f : files) {
    if (f != null) {
      AbstractVcs vcs=manager.getVcsFor(f);
      if (vcs != null) {
        inVCS.add(f);
      }
 else {
        File iofile=VFileSystem.toFile(f);
        if (iofile != null) {
          notInVCS.add(iofile);
        }
      }
    }
  }
  boolean result=true;
  invokeLater(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          for (          VirtualFile vf : inVCS) {
            if (vf == null) {
              continue;
            }
            AbstractVcs vcs=manager.getVcsFor(vf);
            if (vcs != null) {
              CheckinEnvironment ci=vcs.getCheckinEnvironment();
              if (ci != null && !isUnderVCS(myProject,vf)) {
                List<VirtualFile> vfs=new ArrayList<VirtualFile>();
                vfs.add(vf);
                List<VcsException> result=ci.scheduleUnversionedFilesForAddition(vfs);
                VcsDirtyScopeManager.getInstance(myProject).fileDirty(vf);
              }
            }
          }
        }
      }
);
    }
  }
);
  IProjectHandler projectHandler=myProject.getComponent(MPSProjectHolder.class).getMPSProject().getProjectHandler();
  if (projectHandler != null) {
    try {
      projectHandler.addFilesToVCS(notInVCS);
    }
 catch (    RemoteException e) {
      LOG.error(e);
      return false;
    }
  }
  return result;
}
