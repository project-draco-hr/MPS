{
  SNode result=ModelPersistence.createNodeInstance(node.getClass().getName(),targetModel);
  mapping.put(node,result);
  for (  String property : node.getProperties().keySet()) {
    result.setProperty(property,node.getProperty(property));
  }
  for (  SReference reference : node.getReferences()) {
    result.addReferent(reference.getRole(),reference.getTargetNode());
  }
  for (  SNode child : node.getChildren()) {
    result.addChild(node.getRoleOf(child),clone(child,targetModel,mapping));
  }
  return result;
}
