{
  com.intellij.openapi.project.Project project=ProjectHelper.toIdeaProject(mpsProject);
  SearchResults sr=nodesToRefactoringResult(nodes);
  RefactoringAccess.getInstance().showRefactoringView(project,new RefactoringViewAction(){
    public void performAction(    final RefactoringViewItem refactoringViewItem){
      refactoringViewItem.close();
      ModelAccess.instance().runWriteActionInCommand(new Runnable(){
        public void run(){
          Iterable<SNode> includedNodes;
          if (refactoringViewItem instanceof RefactoringViewItemImpl) {
            List<SNodeReference> nodeRefs=as_bb8vid_a0a0a0a1a0a0a0a1a0a0b0a2a5(refactoringViewItem,RefactoringViewItemImpl.class).getUsagesView().getIncludedResultNodes();
            includedNodes=ListSequence.fromList(nodeRefs).select(new ISelector<SNodeReference,SNode>(){
              public SNode select(              SNodeReference it){
                return it.resolve(MPSModuleRepository.getInstance());
              }
            }
);
          }
 else {
            includedNodes=nodes;
          }
          for (          SNode resultNode : Sequence.fromIterable(includedNodes)) {
            if (resultNode != null) {
              closure.invoke(resultNode);
            }
          }
        }
      }
);
    }
  }
,sr,false,"refactor");
}
