{
synchronized (myModel) {
    ModelLoadingState oldState=myModel.getState();
    SModel res=myModel.getModel(ModelLoadingState.ROOTS_LOADED);
    if (res == null)     return null;
    ((jetbrains.mps.smodel.SModel)res).setModelDescriptor(this);
    if (oldState != myModel.getState()) {
      fireModelStateChanged(oldState,myModel.getState());
    }
    return res;
  }
}
