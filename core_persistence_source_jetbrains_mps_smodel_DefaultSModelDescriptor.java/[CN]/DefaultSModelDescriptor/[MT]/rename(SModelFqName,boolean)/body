{
  ModelAccess.assertLegalWrite();
  SModelFqName oldFqName=getSModelReference().getSModelFqName();
  SModel model=getSModel();
  fireBeforeModelRenamed(new SModelRenamedEvent(model,oldFqName,newModelFqName));
  SModelReference newModelReference=new SModelReference(newModelFqName,myModelReference.getSModelId());
  model.changeModelReference(newModelReference);
  if (!changeFile) {
    save();
  }
 else {
    IFile oldFile=getSource().getFile();
    SModelRoot root=ModelRootUtil.getSModelRoot(this);
    IFile newFile=DefaultModelPersistence.createFileForModelUID(root,newModelFqName,DefaultModelPersistence.isLanguageAspect(root,getModule(),newModelFqName));
    newFile.getParent().mkdirs();
    newFile.createNewFile();
    changeModelFile(newFile);
    save();
    oldFile.delete();
  }
  myModelReference=newModelReference;
  fireModelRenamed(new SModelRenamedEvent(model,oldFqName,newModelFqName));
}
