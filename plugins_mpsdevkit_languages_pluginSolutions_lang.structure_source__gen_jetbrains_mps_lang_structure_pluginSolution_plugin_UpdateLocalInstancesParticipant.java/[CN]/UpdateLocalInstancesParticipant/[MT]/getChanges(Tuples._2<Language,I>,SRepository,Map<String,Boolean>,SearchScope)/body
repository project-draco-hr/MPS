{
  if (initialState == null || !(MapSequence.fromMap(options).get(getDescription()))) {
    return ListSequence.fromList(new ArrayList<RefactoringParticipant.Change<Tuples._2<Language,I>,Tuples._2<Language,F>>>());
  }
  Collection<SNode> instances=myStructureSpecialization.findInstances(initialState._1(),searchScope);
  return CollectionSequence.fromCollection(instances).select(new ISelector<SNode,RefactoringParticipant.Change<Tuples._2<Language,I>,Tuples._2<Language,F>>>(){
    public RefactoringParticipant.Change<Tuples._2<Language,I>,Tuples._2<Language,F>> select(    SNode instance){
      final SNodeReference nodeRef=instance.getReference();
      final SearchResults searchResults=new SearchResults();
      searchResults.add(new SearchResult<SNode>(instance,"instance"));
      RefactoringParticipant.Change<Tuples._2<Language,I>,Tuples._2<Language,F>> change=new RefactoringParticipant.Change<Tuples._2<Language,I>,Tuples._2<Language,F>>(){
        public MoveNodeRefactoringParticipant<Tuples._2<Language,I>,Tuples._2<Language,F>> getParticipant(){
          return UpdateLocalInstancesParticipant.this;
        }
        public SearchResults getSearchResults(){
          return searchResults;
        }
        public boolean needsToPreserveOldNode(){
          return false;
        }
        public void confirm(        final Tuples._2<Language,F> finalState,        final SRepository repository,        final RefactoringSession refactoringSession){
          refactoringSession.registerChange(new Runnable(){
            public void run(){
              SNode node=nodeRef.resolve(repository);
              MoveNodesDefault.CopyMapObject copyMap=MoveNodesDefault.CopyMapObject.getCopyMap(refactoringSession);
              if (node == null || MapSequence.fromMap(copyMap.getCopyMap()).containsKey(node)) {
                myStructureSpecialization.doReplaceInstance(MapSequence.fromMap(copyMap.getCopyMap()).get(node),initialState._1(),finalState._1());
              }
              myStructureSpecialization.doReplaceInstance(node,initialState._1(),finalState._1());
            }
          }
);
        }
      }
;
      return change;
    }
  }
).toListSequence();
}
