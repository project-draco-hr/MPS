{
  final Iterable<RefactoringParticipant.ParticipantState<?,?,IP,FP,IS,FS>> participantStates=askParticipantChanges(factory,refactoringUI,repository,scope,participants,initialStates);
  if (participantStates == null) {
    return;
  }
  SearchResults searchResults=new SearchResults();
  for (  RefactoringParticipant.ParticipantState<?,?,IP,FP,IS,FS> participantState : Sequence.fromIterable(participantStates)) {
    List<? extends List<? extends RefactoringParticipant.Change<?,?>>> participantChanges=participantState.getChanges();
    for (    List<? extends RefactoringParticipant.Change<?,?>> nodeChanges : ListSequence.fromList(participantChanges)) {
      for (      RefactoringParticipant.Change<?,?> change : ListSequence.fromList(nodeChanges)) {
        searchResults.addAll(change.getSearchResults());
      }
    }
  }
  refactoringUI.runRefactoring(new Runnable(){
    public void run(){
      final _FunctionTypes._return_P1_E0<? extends FS,? super IS> getFinalObject=doRefactor.invoke(participantStates,refactoringSession);
      if (getFinalObject == null) {
        return;
      }
      for (      RefactoringParticipant.ParticipantState<?,?,IP,FP,IS,FS> participantState : Sequence.fromIterable(participantStates)) {
        participantState.doRefactor(ListSequence.fromList(initialStates).select(new ISelector<IS,FS>(){
          public FS select(          IS it){
            return getFinalObject.invoke(it);
          }
        }
).toListSequence(),repository,refactoringSession);
      }
    }
  }
,refactoringName,searchResults,refactoringSession);
}
