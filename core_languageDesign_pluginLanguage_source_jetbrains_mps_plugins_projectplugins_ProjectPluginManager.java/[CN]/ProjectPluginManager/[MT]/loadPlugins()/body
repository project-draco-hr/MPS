{
  if (myLoaded)   return;
  Set<Language> languages=new HashSet<Language>();
  Set<DevKit> devkits=new HashSet<DevKit>();
  final MPSProject mpsProject=myProject.getComponent(MPSProjectHolder.class).getMPSProject();
  final List<BaseProjectPlugin> plugins=new ArrayList<BaseProjectPlugin>();
synchronized (myPluginsLock) {
    for (    Solution s : mpsProject.getProjectSolutions()) {
      languages.addAll(s.getScope().getVisibleLanguages());
      devkits.addAll(s.getScope().getVisibleDevkits());
    }
    for (    Language l : mpsProject.getProjectLanguages()) {
      languages.add(l);
    }
    languages.addAll(LibraryManager.getInstance().getGlobalModules(Language.class));
    devkits.addAll(LibraryManager.getInstance().getGlobalModules(DevKit.class));
    for (    DevKit dk : mpsProject.getProjectDevKits()) {
      devkits.add(dk);
    }
    for (    Language language : languages) {
      if (language.getPluginModelDescriptor() != null) {
        Class pluginClass=language.getClass(language.getGeneratedPluginClassLongName());
        if (pluginClass != null) {
          BaseProjectPlugin plugin=createPlugin(language,language.getGeneratedPluginClassLongName());
          if (plugin != null) {
            myPlugins.add(plugin);
          }
        }
      }
    }
    for (    DevKit dk : devkits) {
      if (dk.getDevKitPluginClass() != null) {
        BaseProjectPlugin plugin=createPlugin(dk,dk.getDevKitPluginClass());
        if (plugin != null) {
          myPlugins.add(plugin);
        }
      }
    }
    addIdePlugin();
    plugins.addAll(myPlugins);
  }
  for (  BaseProjectPlugin plugin : plugins) {
    try {
      plugin.initNonEDT(mpsProject);
    }
 catch (    Throwable t1) {
      LOG.error("Plugin " + plugin + " threw an exception during initialization ",t1);
    }
  }
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      for (      BaseProjectPlugin plugin : plugins) {
        try {
          plugin.init(mpsProject);
        }
 catch (        Throwable t1) {
          LOG.error("Plugin " + plugin + " threw an exception during initialization ",t1);
        }
      }
      spreadState(plugins);
    }
  }
);
  myLoaded=true;
}
