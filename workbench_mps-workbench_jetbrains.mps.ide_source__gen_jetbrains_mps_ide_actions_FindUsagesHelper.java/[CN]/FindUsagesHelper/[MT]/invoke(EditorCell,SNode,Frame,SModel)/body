{
  final Wrappers._T<SNode> operationNode=new Wrappers._T<SNode>();
  final Wrappers._T<String> concept=new Wrappers._T<String>();
  final ModelAccess modelAccess=myProject.getModelAccess();
  modelAccess.runReadAction(new Runnable(){
    public void run(){
      operationNode.value=(cell == null ? node : APICellAdapter.getSNodeWRTReference(cell));
      concept.value=operationNode.value.getConcept().getQualifiedName();
    }
  }
);
  final Wrappers._T<ScopeEditor> scopeEditor=new Wrappers._T<ScopeEditor>();
  final Wrappers._T<FindersEditor> findersEditor=new Wrappers._T<FindersEditor>();
  final Wrappers._T<ViewOptionsEditor> viewOptionsEditor=new Wrappers._T<ViewOptionsEditor>();
  final Wrappers._T<FindUsagesOptions> options=new Wrappers._T<FindUsagesOptions>(getDefaultOptions().getDefaultSearchOptions(concept.value));
  modelAccess.runReadAction(new Runnable(){
    public void run(){
      scopeEditor.value=new ScopeEditor(options.value.getScopeOptions(),myProject.getRepository());
      findersEditor.value=new FindersEditor(options.value.getFindersOptions(),node){
        public void goToFinder(        ReloadableFinder finder){
        }
      }
;
      viewOptionsEditor.value=new ViewOptionsEditor(options.value.getViewOptions());
    }
  }
);
  options.value=new FindUsagesOptions(findersEditor.value.getOptions(),scopeEditor.value.getOptions(),viewOptionsEditor.value.getOptions());
  if (myWithDialog) {
    FindUsagesDialog dialog=new FindUsagesDialog(options.value,operationNode.value,myIdeaProject,myWithDialog);
    dialog.show();
    if (dialog.isCancelled()) {
      return;
    }
    options.value=dialog.getResult();
  }
  final Wrappers._T<IResultProvider> provider=new Wrappers._T<IResultProvider>();
  final Wrappers._T<SearchQuery> query=new Wrappers._T<SearchQuery>();
  final Wrappers._T<ViewOptions> viewOptions=new Wrappers._T<ViewOptions>();
  modelAccess.runReadAction(new Runnable(){
    public void run(){
      provider.value=options.value.getFindersOptions().getResult();
      query.value=new SearchQuery(operationNode.value,options.value.getScopeOptions().getScope(myProject));
      viewOptions.value=options.value.getViewOptions();
    }
  }
);
  UsageToolOptions opt=new UsageToolOptions().allowRunAgain(true).navigateIfSingle(!(viewOptions.value.myShowOneResult)).forceNewTab(viewOptions.value.myNewTab).notFoundMessage("No usages for that node");
  UsagesViewTool.showUsages(myIdeaProject,provider.value,query.value,opt);
}
