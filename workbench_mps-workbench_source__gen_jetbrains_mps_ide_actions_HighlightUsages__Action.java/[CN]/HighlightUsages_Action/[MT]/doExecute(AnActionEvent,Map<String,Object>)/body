{
  try {
    FeatureUsageTracker.getInstance().triggerFeatureUsed("editing.highlightUsages");
    ModelAccess.instance().runReadAction(new Runnable(){
      public void run(){
        NodeHighlightManager highlightManager=((EditorComponent)MapSequence.fromMap(_params).get("editorComponent")).getHighlightManager();
        EditorMessageOwner messageOwner=((EditorComponent)MapSequence.fromMap(_params).get("editorComponent")).getHighlightMessagesOwner();
        SNode node=((EditorCell)MapSequence.fromMap(_params).get("editorCell")).getSNodeWRTReference();
        Set<org.jetbrains.mps.openapi.model.SReference> usages=FindUsagesManager.getInstance().findUsages(Collections.<org.jetbrains.mps.openapi.model.SNode>singleton(node),SearchType.USAGES,new ModelsOnlyScope(((SModelDescriptor)MapSequence.fromMap(_params).get("model"))),null);
        boolean highlight=highlightManager.getMessagesFor(node,messageOwner).isEmpty();
        if (SNodeOperations.getContainingRoot(node) == ((EditorComponent)MapSequence.fromMap(_params).get("editorComponent")).getRootCell().getSNode().getTopmostAncestor()) {
          if (highlight) {
            highlightManager.mark(node,HighlightConstants.NODE_COLOR,"source node",messageOwner);
          }
 else {
            for (            EditorMessage message : ListSequence.fromList(highlightManager.getMessagesFor(node,messageOwner))) {
              highlightManager.unmark(message);
            }
          }
        }
        for (        org.jetbrains.mps.openapi.model.SReference ref : SetSequence.fromSet(usages)) {
          if (ref.getSourceNode().getTopmostAncestor() == ((EditorComponent)MapSequence.fromMap(_params).get("editorComponent")).getRootCell().getSNode().getTopmostAncestor()) {
            if (highlight) {
              highlightManager.mark(((SNode)ref.getSourceNode()),HighlightConstants.USAGES_COLOR,"usage",messageOwner);
            }
 else {
              for (              EditorMessage message : ListSequence.fromList(highlightManager.getMessagesFor(((SNode)ref.getSourceNode()),messageOwner))) {
                highlightManager.unmark(message);
              }
            }
          }
        }
        highlightManager.repaintAndRebuildEditorMessages();
      }
    }
);
  }
 catch (  Throwable t) {
    LOG.error("User's action execute method failed. Action:" + "HighlightUsages",t);
  }
}
