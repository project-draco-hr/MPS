{
  Iterable<SModule> allModules=getAllModules();
  LOG.info("Checking " + IterableUtil.asCollection(allModules).size() + " modules");
  for (  SModule module : allModules) {
    if (module instanceof Solution) {
      JavaModuleFacet javaModuleFacet=module.getFacet(JavaModuleFacet.class);
      if (javaModuleFacet == null) {
        continue;
      }
      CustomClassLoadingFacet facet=module.getFacet(CustomClassLoadingFacet.class);
      if (facet != null) {
        Assert.assertTrue("Unknown kind of facet " + facet + " in module "+ module,facet instanceof IdeaPluginModuleFacet);
        Assert.assertTrue("Facet of the module " + module + " is not valid",facet.isValid());
        Assert.assertTrue("The module " + module + " has enabled both idea plugin facet and java compilation in MPS",!javaModuleFacet.isCompileInMps());
      }
 else {
        Assert.assertTrue("The module " + module + " has neither idea plugin facet nor java compilation enabled",javaModuleFacet.isCompileInMps());
      }
    }
  }
}
