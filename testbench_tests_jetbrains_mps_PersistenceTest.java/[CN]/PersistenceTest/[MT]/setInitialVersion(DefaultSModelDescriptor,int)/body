{
  boolean correctPersistenceVersion=true;
  ModelLoadResult result=null;
  boolean wasException=false;
  try {
    if (fromVersion > START_PERSISTENCE_TEST_VERSION) {
      upgradePersistence(testModel,fromVersion);
      correctPersistenceVersion=testModel.getPersistenceVersion() == fromVersion;
    }
    result=ModelPersistence.readModel(SModelHeader.create(fromVersion),(StreamDataSource)testModel.getSource(),ModelLoadingState.FULLY_LOADED);
  }
 catch (  ModelReadException e) {
    e.printStackTrace();
    wasException=true;
  }
  assertFalse(wasException);
  assertTrue(correctPersistenceVersion);
  assertNotNull(result);
  assertTrue(result.getState() == ModelLoadingState.FULLY_LOADED);
  return result;
}
