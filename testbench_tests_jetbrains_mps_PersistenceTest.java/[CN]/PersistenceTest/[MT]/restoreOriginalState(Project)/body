{
  final boolean[] wasException={false};
  final boolean[] correctVersion={true};
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    @Override public void run(){
      ModelAccess.instance().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            DefaultSModelDescriptor model=getModel(project);
            ModelPersistence.saveModel(myModelBackup,((StreamDataSource)model.getSource()),START_PERSISTENCE_TEST_VERSION);
            model.reloadFromSource();
            correctVersion[0]=(START_PERSISTENCE_TEST_VERSION == model.getPersistenceVersion());
          }
 catch (          IOException e) {
            e.printStackTrace();
            wasException[0]=true;
          }
        }
      }
);
    }
  }
,ModalityState.NON_MODAL);
  assertTrue(correctVersion[0]);
  assertFalse(wasException[0]);
  refreshVfs();
  waitEDT();
}
