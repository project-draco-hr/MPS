{
  ModelLoadResult result=null;
  boolean wasException=false;
  boolean correctVersion;
  upgradePersistence(testModel,finalToVersion);
  correctVersion=testModel.getPersistenceVersion() == finalToVersion;
  try {
    result=ModelPersistence.readModel(SModelHeader.create(finalToVersion),(StreamDataSource)testModel.getSource(),ModelLoadingState.FULLY_LOADED);
  }
 catch (  ModelReadException e) {
    e.printStackTrace();
    wasException=true;
  }
  assertTrue(correctVersion);
  assertFalse(wasException);
  assertNotNull(result);
  assertTrue(result.getState().equals(ModelLoadingState.FULLY_LOADED));
  ModelAssert.assertDeepModelEquals(resultFrom.getModel(),result.getModel());
}
