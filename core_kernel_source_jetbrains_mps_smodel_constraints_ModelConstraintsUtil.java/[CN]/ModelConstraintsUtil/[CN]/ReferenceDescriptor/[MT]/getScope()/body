{
  return TypeContextManager.getInstance().runResolveAction(new Computable<Scope>(){
    @Override public Scope compute(){
      try {
        if (myScopeProvider != null) {
          ISearchScope searchScope=myScopeProvider.createSearchScope(myOperationContext,myReferentConstraintContext);
          if (!(searchScope instanceof UndefinedSearchScope)) {
            return myReference != null ? new RefAdapter(searchScope,myReference) : new Adapter(searchScope);
          }
        }
        return new DefaultScope(myReferentConstraintContext.getModel(),myOperationContext.getScope(),NameUtil.nodeFQName(myReferentConstraintContext.getLinkTarget()));
      }
 catch (      Exception t) {
        LOG.error(t,myReferentConstraintContext.getReferenceNode() != null ? myReferentConstraintContext.getReferenceNode() : myReferentConstraintContext.getEnclosingNode());
        return new ErrorScope("can't create search scope for role `" + myRefRole + "' in '"+ myRefConcept.getName()+ "'");
      }
    }
  }
);
}
