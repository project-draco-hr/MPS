{
  if (node == null)   return null;
  SNode type;
  NodeTypesComponent currentTypesComponent=myNodeTypesComponent;
  if (currentTypesComponent != null) {
    currentTypesComponent.addNodeToFrontier(node);
    if (addDependency) {
      currentTypesComponent.addDependcyOnCurrent(node);
    }
    if (ruleModel != null && ruleId != null) {
      currentTypesComponent.markNodeAsAffectedByRule(node,ruleModel,ruleId);
    }
    type=currentTypesComponent.getRawTypeFromContext(node);
    if (type != null)     return getRepresentatorIfNecessary(type);
  }
  if (currentTypesComponent == null || currentTypesComponent.getNode() != node.getContainingRoot()) {
    NodeTypesComponent nodeTypesComponent=NodeTypesComponentsRepository.getInstance().getNodeTypesComponent(node.getContainingRoot());
    if (nodeTypesComponent != null && nodeTypesComponent != currentTypesComponent) {
      type=nodeTypesComponent.getType(node);
      if (type != null)       return type;
    }
  }
  SNode var=createNewRuntimeTypesVariable();
  type=TypeChecker.asType(var);
  getMainContext().put(node,type);
  return getRepresentatorIfNecessary(type);
}
