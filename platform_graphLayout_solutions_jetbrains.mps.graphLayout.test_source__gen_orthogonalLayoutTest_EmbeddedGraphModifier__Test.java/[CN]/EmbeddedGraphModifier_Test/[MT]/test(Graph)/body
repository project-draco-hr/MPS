{
  Map<Node,List<Node>> nodeMap=MapSequence.fromMap(new LinkedHashMap<Node,List<Node>>(16,(float)0.75,false));
  EmbeddedGraphModifier modifier=prepare(graph,nodeMap);
  modifier.makeRectanglesForNodes(nodeMap);
  EmbeddedGraph embeddedGraph=modifier.getEmbeddedGraph();
  CheckEmbeddedGraph.checkEmbeddedGraph(embeddedGraph);
  Map<Dart,Direction2D> dartDirections=modifier.getDartDirections();
  for (  Edge edge : ListSequence.fromList(graph.getEdges())) {
    List<Dart> darts=embeddedGraph.getDarts(edge);
    Assert.assertTrue(ListSequence.fromList(darts).count() == 2);
    for (    Dart dart : ListSequence.fromList(darts)) {
      Assert.assertTrue(MapSequence.fromMap(dartDirections).containsKey(dart));
    }
  }
  Assert.assertTrue(SetSequence.fromSet(MapSequence.fromMap(dartDirections).keySet()).count() == ListSequence.fromList(graph.getEdges()).count() * 2);
}
