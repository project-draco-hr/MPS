{
  List<Node> nodes=ListSequence.fromList(new ArrayList<Node>());
  ListSequence.fromList(nodes).addSequence(ListSequence.fromList(graph.getNodes()));
  for (  Node node : ListSequence.fromList(nodes)) {
    MapSequence.fromMap(nodeMap).put(node,ListSequence.fromList(new ArrayList<Node>()));
  }
  EmbeddedGraph embeddedGraph=new ShortestPathEmbeddingFinder(new PQPlanarizationFinder()).find(graph);
  EmbeddedGraphModifier modifier=new EmbeddedGraphModifier(embeddedGraph);
  Set<Edge> edges=modifier.reduceNodesDegree(nodeMap,MapSequence.fromMap(new HashMap<Edge,Edge>()));
  Map<Dart,Integer> bends=MapSequence.fromMap(new HashMap<Dart,Integer>());
  Map<Dart,Integer> angles=MapSequence.fromMap(new HashMap<Dart,Integer>());
  OrthogonalRepresentation.getRepresentation(embeddedGraph,edges,bends,angles);
  OrthogonalRepresentation.replaceBendsByNodes(embeddedGraph,bends,angles);
  Map<Dart,Direction2D> directions=OrthogonalRepresentation.getDirections(embeddedGraph,angles);
  modifier.setDartDirections(directions);
  return modifier;
}
