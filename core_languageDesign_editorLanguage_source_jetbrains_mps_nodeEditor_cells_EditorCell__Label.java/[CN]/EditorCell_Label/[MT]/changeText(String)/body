{
  final String oldText=getText();
  final AbstractEditorComponent editor=getEditor();
  final CellInfo cellInfo=getCellInfo();
  setText(text);
  if (!isValidText(text) && CommandProcessor.getInstance().getCurrentCommand() != null) {
    UndoUtil.addUndoableAction(new SNodeUndoableAction(getSNode()){
      protected void doUndo(){
        EditorCell_Label cell=(EditorCell_Label)cellInfo.findCell(editor);
        if (cell != null) {
          cell.changeText(oldText);
        }
      }
      protected void doRedo(){
        EditorCell_Label cell=(EditorCell_Label)cellInfo.findCell(editor);
        if (cell != null) {
          cell.changeText(text);
        }
      }
    }
);
    if (getSNode().getContainingRoot() != null) {
      MPSNodesVirtualFileSystem.getInstance().getFileFor(getSNode().getContainingRoot()).setModificationStamp(LocalTimeCounter.currentTime());
    }
  }
}
