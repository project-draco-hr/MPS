{
  if (!(resourcePath.startsWith("/") || resourcePath.startsWith("\\"))) {
    throw new BuildException("cannot detect jar location: precondition failed for" + resourcePath);
  }
  String protocol=resourceURL.getProtocol();
  String resultPath=null;
  if (MPSClasspathUtil.FILE.equals(protocol)) {
    String path=resourceURL.getFile();
    String testPath=path.replace('\\','/').toLowerCase();
    String testResourcePath=resourcePath.replace('\\','/').toLowerCase();
    if (testPath.endsWith(testResourcePath)) {
      resultPath=path.substring(0,path.length() - resourcePath.length());
    }
  }
 else   if (MPSClasspathUtil.JAR.equals(protocol)) {
    String fullPath=resourceURL.getFile();
    int delimiter=fullPath.indexOf(MPSClasspathUtil.JAR_DELIMITER);
    if (delimiter >= 0) {
      String archivePath=fullPath.substring(0,delimiter);
      if (archivePath.startsWith(MPSClasspathUtil.FILE + MPSClasspathUtil.PROTOCOL_DELIMITER)) {
        resultPath=archivePath.substring(MPSClasspathUtil.FILE.length() + MPSClasspathUtil.PROTOCOL_DELIMITER.length());
      }
    }
  }
  if (resultPath == null) {
    throw new BuildException("cannot detect jar location: url=`" + resourceURL.toString() + "'");
  }
  if (resultPath.endsWith(File.separator)) {
    resultPath=resultPath.substring(0,resultPath.length() - 1);
  }
  return replace(resultPath,"%20"," ");
}
