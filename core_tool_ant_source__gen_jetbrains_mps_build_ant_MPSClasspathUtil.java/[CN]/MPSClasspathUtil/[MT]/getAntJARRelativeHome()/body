{
  String containingJar=getAntMPSJar();
  if (!(containingJar.toLowerCase().endsWith(".jar"))) {
    throw new BuildException("cannot detect jar location: got `" + containingJar + "'");
  }
  File current=new File(containingJar);
  for (int i=0; i < 3; i++) {
    current=current.getParentFile();
    if (current == null) {
      throw new BuildException("cannot detect jar location, no parent: got `" + containingJar + "'");
    }
    if (new File(current,"mps-core.jar").isFile()) {
      return current;
    }
  }
  throw new BuildException("cannot detect jar location, no mps-core.jar `" + containingJar + "'");
}
