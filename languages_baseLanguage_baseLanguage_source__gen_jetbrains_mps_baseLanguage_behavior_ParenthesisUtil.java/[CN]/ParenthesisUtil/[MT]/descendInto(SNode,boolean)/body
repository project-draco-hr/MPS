{
  List<SNode> path=ListSequence.fromListAndArray(new ArrayList<SNode>(),null,expr);
  List<SNode> result=ListSequence.fromList(new ArrayList<SNode>());
  SNode current=expr;
  while (ListSequence.fromList(path).isNotEmpty()) {
    if (SNodeOperations.isInstanceOf(current,MetaAdapterFactory.getInterfaceConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x182da1771714863eL,"jetbrains.mps.baseLanguage.structure.IBinaryLike"))) {
      if (eq_a65dpo_a0a0a0e0r(ListSequence.fromList(path).last(),current)) {
        SNode left=IBinaryLike_BehaviorDescriptor.getSyntacticallyLeftSideExpression_id1wHCnsn590c.invoke(SNodeOperations.cast(current,MetaAdapterFactory.getInterfaceConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x182da1771714863eL,"jetbrains.mps.baseLanguage.structure.IBinaryLike")));
        if (left != null) {
          ListSequence.fromList(path).addElement(left);
          current=left;
        }
 else {
          current=ListSequence.fromList(path).removeLastElement();
        }
      }
 else {
        ListSequence.fromList(result).addElement(current);
        SNode right=IBinaryLike_BehaviorDescriptor.getSyntacticallyRightSideExpression_id1wHCnsn590i.invoke(SNodeOperations.cast(current,MetaAdapterFactory.getInterfaceConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x182da1771714863eL,"jetbrains.mps.baseLanguage.structure.IBinaryLike")));
        if (right != null) {
          ListSequence.fromList(path).addElement(right);
          current=right;
        }
 else {
          current=ListSequence.fromList(path).removeLastElement();
        }
      }
    }
 else {
      ListSequence.fromList(result).addElement(current);
      if (eq_a65dpo_a0b0a0a4a71(ListSequence.fromList(path).last(),current)) {
        ListSequence.fromList(path).removeLastElement();
      }
      current=ListSequence.fromList(path).removeLastElement();
    }
  }
  if (!(completingByRightParen)) {
    result=ListSequence.fromList(result).reversedList();
  }
  result=ListSequence.fromList(result).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return completingByRightParen && (AttributeOperations.getAttribute(it,new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x64a1ef64cd9b42ceL,"jetbrains.mps.baseLanguage.structure.IncompleteLeftParen"))) != null) || !(completingByRightParen) && (AttributeOperations.getAttribute(it,new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x2052c4520af308e1L,"jetbrains.mps.baseLanguage.structure.IncompleteRightParen"))) != null);
    }
  }
).toListSequence();
  return result;
}
