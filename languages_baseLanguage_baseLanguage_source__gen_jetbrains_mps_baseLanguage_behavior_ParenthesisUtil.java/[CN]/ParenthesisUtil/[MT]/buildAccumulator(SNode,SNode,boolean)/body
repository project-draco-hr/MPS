{
  SNode accumulator;
  if (turn != null && neq_a65dpo_a0a1a12(turn,firstCommonAncestor)) {
    accumulator=(left ? BehaviorReflection.invokeVirtual((Class<SNode>)((Class)Object.class),turn,"virtual_getSyntacticallyRightSideExpression_7583777362095256690",new Object[]{}) : BehaviorReflection.invokeVirtual((Class<SNode>)((Class)Object.class),turn,"virtual_getSyntacticallyLeftSideExpression_7583777362095214544",new Object[]{}));
    SNodeOperations.detachNode(accumulator);
    SNode current=SNodeOperations.cast(SNodeOperations.getParent(turn),"jetbrains.mps.baseLanguage.structure.Expression");
    SNode previous=turn;
    while (neq_a65dpo_a0f0b0v(current,firstCommonAncestor)) {
      SNode sideExpression=(left ? BehaviorReflection.invokeVirtual((Class<SNode>)((Class)Object.class),current,"virtual_getSyntacticallyLeftSideExpression_7583777362095214544",new Object[]{}) : BehaviorReflection.invokeVirtual((Class<SNode>)((Class)Object.class),current,"virtual_getSyntacticallyRightSideExpression_7583777362095256690",new Object[]{}));
      if (sideExpression != null && eq_a65dpo_a0a1a5a1a12(sideExpression,previous)) {
        SNodeOperations.replaceWithAnother(current,previous);
        if (left) {
          BehaviorReflection.invokeVirtual(Void.class,current,"virtual_setSyntacticallyLeftSideExpression_7583777362102629706",new Object[]{accumulator});
        }
 else {
          BehaviorReflection.invokeVirtual(Void.class,current,"virtual_setSyntacticallyRightSideExpression_7583777362102706555",new Object[]{accumulator});
        }
        accumulator=current;
      }
 else {
        previous=current;
      }
      current=SNodeOperations.cast(SNodeOperations.getParent(previous),"jetbrains.mps.baseLanguage.structure.Expression");
    }
  }
 else {
    SNode firstCommonAncestorChild=(left ? BehaviorReflection.invokeVirtual((Class<SNode>)((Class)Object.class),firstCommonAncestor,"virtual_getSyntacticallyLeftSideExpression_7583777362095214544",new Object[]{}) : BehaviorReflection.invokeVirtual((Class<SNode>)((Class)Object.class),firstCommonAncestor,"virtual_getSyntacticallyRightSideExpression_7583777362095256690",new Object[]{}));
    if (firstCommonAncestorChild != null) {
      accumulator=firstCommonAncestorChild;
      SNodeOperations.detachNode(accumulator);
    }
 else {
      accumulator=firstCommonAncestor;
    }
  }
  return accumulator;
}
