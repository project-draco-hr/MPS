{
  Graph copy=new Graph();
  Map<Node,Node> nodeMap=MapSequence.<Node,Node>fromMap(new HashMap<Node,Node>());
  Map<Edge,Edge> edgeMap=MapSequence.<Edge,Edge>fromMap(new HashMap<Edge,Edge>());
  for (  Node node : ListSequence.<Node>fromList(graph.getNodes())) {
    MapSequence.<Node,Node>fromMap(nodeMap).put(node,copy.createNode());
  }
  for (  Edge edge : ListSequence.<Edge>fromList(graph.getEdges())) {
    MapSequence.<Edge,Edge>fromMap(edgeMap).put(edge,copy.connect(MapSequence.<Node,Node>fromMap(nodeMap).get(edge.getSource()),MapSequence.<Node,Node>fromMap(nodeMap).get(edge.getTarget())));
  }
  EdgesHistoryManager historyManager=new EdgesHistoryManager(copy);
  EmbeddedGraph embeddedGraph=new ShortestPathEmbeddingFinder(new PQPlanarizationFinder()).find(copy);
  Map<Edge,List<Edge>> history=MapSequence.<Edge,List<Edge>>fromMap(new HashMap<Edge,List<Edge>>());
  for (  Edge edge : ListSequence.<Edge>fromList(graph.getEdges())) {
    Edge copyEdge=MapSequence.<Edge,Edge>fromMap(edgeMap).get(edge);
    MapSequence.<Edge,List<Edge>>fromMap(history).put(edge,historyManager.getHistory(copyEdge));
    if (copyEdge.getSource() != MapSequence.<Node,Node>fromMap(nodeMap).get(edge.getSource())) {
      MapSequence.<Edge,List<Edge>>fromMap(history).put(edge,ListSequence.<Edge>fromList(MapSequence.<Edge,List<Edge>>fromMap(history).get(edge)).reversedList());
    }
  }
  Map<Node,List<Node>> newNodes=MapSequence.<Node,List<Node>>fromMap(new HashMap<Node,List<Node>>());
  Map<Edge,Edge> replacedEdges=MapSequence.<Edge,Edge>fromMap(new HashMap<Edge,Edge>());
  EmbeddedGraphModifier modifier=new EmbeddedGraphModifier(embeddedGraph);
  modifier.reduceNodesDegree(newNodes,replacedEdges,true);
  updateHistory(replacedEdges,history);
  Map<Dart,Integer> bends=MapSequence.<Dart,Integer>fromMap(new HashMap<Dart,Integer>());
  Map<Dart,Integer> angles=MapSequence.<Dart,Integer>fromMap(new HashMap<Dart,Integer>());
  OrthogonalRepresentationWithNodesProcessing.getRepresentation(embeddedGraph,MapSequence.fromMap(modifier.getNodeFaces()).values(),bends,angles);
  OrthogonalRepresentationWithNodesProcessing.replaceBendsByNodes(embeddedGraph,bends,angles);
  Map<Dart,Direction2D> directions=OrthogonalRepresentation.getDirections(embeddedGraph,angles);
  return null;
}
