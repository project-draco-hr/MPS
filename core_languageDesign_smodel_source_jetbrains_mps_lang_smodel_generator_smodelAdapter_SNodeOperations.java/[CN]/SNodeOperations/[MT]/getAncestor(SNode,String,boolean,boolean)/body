{
  if (node == null)   return null;
  if (ancestorConceptFqName == null) {
    if (inclusion) {
      return node;
    }
    if (root) {
      return node.getContainingRoot();
    }
    return node.getParent();
  }
  if (root) {
    SNode rootParent=node.getContainingRoot();
    if (rootParent != null && rootParent.isInstanceOfConcept(ancestorConceptFqName)) {
      return rootParent;
    }
    return null;
  }
  SNode outputNode;
  if (inclusion) {
    outputNode=node;
  }
 else {
    outputNode=node.getParent();
  }
  if (outputNode == null)   return null;
  if (outputNode.isInstanceOfConcept(ancestorConceptFqName))   return outputNode;
  while ((outputNode=outputNode.getParent()) != null) {
    if (outputNode.isInstanceOfConcept(ancestorConceptFqName))     break;
  }
  return outputNode;
}
