{
  List<SNode> classifiers=new ArrayList<SNode>();
  for (  SModelDescriptor model : Sequence.fromIterable(getVisibleModels())) {
    SModelFqName modelFqName=model.getSModelReference().getSModelFqName();
    if (!(modelFqName.getLongName().equals(modelname))) {
      continue;
    }
    if (stereotype != null && !(modelFqName.getStereotype().equals(stereotype))) {
      continue;
    }
    ListSequence.fromList(classifiers).addSequence(ListSequence.fromList(getClassifiersByRefName(model.getSModel(),nestedClassName)));
  }
  if (ListSequence.fromList(classifiers).isEmpty()) {
    return null;
  }
  if (ListSequence.fromList(classifiers).count() > 1) {
    for (    SNode cls : ListSequence.fromList(classifiers)) {
      if (SNodeOperations.getModel(cls) == model) {
        return cls;
      }
      if (check_npo0wh_a0b0a0e0g_0(check_npo0wh_a0a1a0a4a6_0(model)) == check_npo0wh_a0b0a0e0g(check_npo0wh_a0a1a0a4a6(SNodeOperations.getModel(cls)))) {
        return cls;
      }
    }
    Iterable<SNode> userClassifiers=ListSequence.fromList(classifiers).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return SModelStereotype.isUserModel(SNodeOperations.getModel(it));
      }
    }
);
    if ((int)Sequence.fromIterable(userClassifiers).count() == 1) {
      return Sequence.fromIterable(userClassifiers).first();
    }
    SModelDescriptor stub=getStubModelByName(modelname);
    if (stub != null) {
      Iterable<SNode> stubClassifiers=getClassifiersByRefName(stub.getSModel(),nestedClassName);
      if ((int)Sequence.fromIterable(stubClassifiers).count() == 1) {
        return Sequence.fromIterable(stubClassifiers).first();
      }
    }
    final StringBuilder warning=new StringBuilder();
    warning.append("reference can't be resolved: ");
    warning.append(nestedClassName);
    warning.append(" in ");
    warning.append(model.getLongName());
    warning.append(" can reference nodes from models: ");
    ListSequence.fromList(classifiers).visitAll(new IVisitor<SNode>(){
      public void visit(      SNode it){
        warning.append(SNodeOperations.getModel(it).getSModelReference()).append("; ");
      }
    }
);
    LOG.warning(warning.toString());
    return null;
  }
  return ListSequence.fromList(classifiers).getElement(0);
}
