{
  for (  SNode node : nodes) {
    for (    SReference ref : node.getReferences()) {
      SNode target=jetbrains.mps.util.SNodeOperations.getTargetNodeSilently(ref);
      SNode restored=mapping.get(target);
      if (restored != null) {
        node.setReference(ref.getRole(),new StaticReference(ref.getRole(),ref.getSourceNode(),restored));
      }
    }
  }
}
