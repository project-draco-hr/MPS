{
  checkNotDisposed();
  if (myDisposed)   return;
  enforceFullLoad();
  SNodeId id=node.getSNodeId();
  org.jetbrains.mps.openapi.model.SNode existingNode=id != null ? myIdToNodeMap.get(id) : null;
  if (id == null || existingNode != null && existingNode != node) {
    id=generateUniqueId();
    while (myIdToNodeMap.containsKey(id)) {
      resetIdCounter();
      id=generateUniqueId();
    }
    node.setId(id);
  }
  myIdToNodeMap.put(id,node);
}
