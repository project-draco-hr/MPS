{
  checkNotDisposed();
  if (myDisposed)   return;
  enforceFullLoad();
  org.jetbrains.mps.openapi.model.SNodeId id=node.getNodeId();
  if (id == null) {
    assignNewId(node);
    return;
  }
  org.jetbrains.mps.openapi.model.SNode existingNode=myIdToNodeMap.get(id);
  if (existingNode == null) {
    myIdToNodeMap.put(node.getNodeId(),node);
  }
  if (existingNode != null && existingNode != node) {
    assignNewId(node);
  }
}
