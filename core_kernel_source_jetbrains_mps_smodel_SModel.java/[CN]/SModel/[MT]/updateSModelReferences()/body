{
  ModelChange.assertLegalChange(this);
  enforceFullLoad();
  boolean changed=false;
  for (  org.jetbrains.mps.openapi.model.SNode n : myIdToNodeMap.values()) {
    if (!(n instanceof SNode))     continue;
    SNode node=(SNode)n;
    for (    SReference reference : node.getReferences()) {
      SModelReference oldReference=reference.getTargetSModelReference();
      if (oldReference == null)       continue;
      SModelReference newRef=oldReference.update();
      if (newRef.differs(oldReference)) {
        changed=true;
        ((jetbrains.mps.smodel.SReference)reference).setTargetSModelReference(newRef);
      }
    }
  }
  for (  ImportElement e : myImports) {
    SModelReference oldReference=e.myModelReference;
    SModelReference newRef=oldReference.update();
    if (newRef.differs(oldReference)) {
      changed=true;
      e.myModelReference=newRef;
    }
  }
  for (  ImportElement e : myImplicitImports) {
    SModelReference oldReference=e.myModelReference;
    SModelReference newRef=oldReference.update();
    if (newRef.differs(oldReference)) {
      changed=true;
      e.myModelReference=newRef;
    }
  }
  return changed;
}
