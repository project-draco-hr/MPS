{
  ModelChange.assertLegalChange(this);
  enforceFullLoad();
  boolean changed=false;
  for (  SNode node : myIdToNodeMap.values()) {
    for (    SReference reference : (List<SReference>)jetbrains.mps.util.SNodeOperations.getReferences(node)) {
      SModelReference oldReference=reference.getTargetSModelReference();
      if (oldReference == null)       continue;
      SModelReference newRef=oldReference.update();
      if (newRef.differs(oldReference)) {
        changed=true;
        reference.setTargetSModelReference(newRef);
      }
    }
  }
  for (  ImportElement e : myImports) {
    SModelReference oldReference=e.myModelReference;
    SModelReference newRef=oldReference.update();
    if (newRef.differs(oldReference)) {
      changed=true;
      e.myModelReference=newRef;
    }
  }
  for (  ImportElement e : myImplicitImports) {
    SModelReference oldReference=e.myModelReference;
    SModelReference newRef=oldReference.update();
    if (newRef.differs(oldReference)) {
      changed=true;
      e.myModelReference=newRef;
    }
  }
  return changed;
}
