{
  final ModuleReference[] result=new ModuleReference[1];
  ModelAccess.instance().runReadAction(new Runnable(){
    @Override public void run(){
      if (ref instanceof SLanguageAdapterById) {
        result[0]=new ModuleReference(ref.getQualifiedName(),ModuleId.regular(((SLanguageAdapterById)ref).getId().getIdValue()));
      }
 else {
        result[0]=(ModuleReference)ref.getSourceModule().getModuleReference();
      }
    }
  }
);
  return result[0];
}
