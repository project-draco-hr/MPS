{
  final THashMap<String,Object> params=new THashMap<String,Object>();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      collectActionData(event,params);
    }
  }
);
  final ModelAccess access=ModelAccess.instance();
  if (myExecuteOutsideCommand) {
    doExecute(event,params);
  }
 else {
    Project project=getEventProject(event);
    if (project != null) {
      access.runWriteActionInCommand(new Runnable(){
        public void run(){
          doExecute(event,params);
        }
      }
,getTemplatePresentation().getText(),null,false,project.getComponent(MPSProject.class));
    }
 else {
      access.runWriteActionInCommand(new Runnable(){
        public void run(){
          doExecute(event,params);
        }
      }
);
    }
  }
}
