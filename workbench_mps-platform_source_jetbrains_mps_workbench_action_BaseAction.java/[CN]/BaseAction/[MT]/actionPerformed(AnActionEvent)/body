{
  final THashMap<String,Object> params=new THashMap<String,Object>();
  ModelAccess.instance().runReadAction(new Runnable(){
    @Override public void run(){
      collectActionData(event,params);
    }
  }
);
  if (myExecuteOutsideCommand) {
    doExecute(event,params);
  }
 else {
    final Runnable r=new UndoRunnable.Base(getTemplatePresentation().getText(),null){
      @Override public void run(){
        doExecute(event,params);
      }
    }
;
    Project project=getEventProject(event);
    if (project != null) {
      ProjectHelper.getModelAccess(project).executeCommand(r);
    }
 else {
      MPSModuleRepository.getInstance().getModelAccess().runWriteAction(r);
    }
  }
}
