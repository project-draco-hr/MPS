{
  if (!(state instanceof BaseEditorState))   return;
  final BaseEditorState s=(BaseEditorState)state;
  if (s.myMemento != null) {
    getEditorContext().setMemento(s.myMemento);
  }
  if (s.myInspectorMemento != null) {
    final NodeEditorComponent editorComponent=(NodeEditorComponent)getCurrentEditorComponent();
    if (editorComponent != null) {
      if (editorComponent.getInspector() != null) {
        editorComponent.getInspector().getEditorContext().setMemento(s.myInspectorMemento);
      }
 else {
        SwingUtilities.invokeLater(new Runnable(){
          int tries=0;
          @Override public void run(){
            EditorComponent inspector=editorComponent.getInspector();
            if (inspector != null) {
              inspector.getEditorContext().setMemento(s.myInspectorMemento);
            }
 else             if ((tries++) < 3) {
              try {
                Thread.sleep(tries * 500);
              }
 catch (              InterruptedException ignore) {
              }
              SwingUtilities.invokeLater(this);
            }
 else {
              LOG.error("couln't restore inspector state: no inspector tool");
            }
          }
        }
);
      }
    }
  }
}
