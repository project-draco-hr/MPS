{
  if (!(state instanceof BaseEditorState)) {
    return;
  }
  final BaseEditorState s=(BaseEditorState)state;
  final EditorContext editorContext=getEditorContext();
  final EditorComponent editorComponent=getCurrentEditorComponent();
  if (s.myMemento == null || editorContext == null || editorComponent == null) {
    return;
  }
  final IdeFocusManager focusManager=myProject.getComponent(IdeFocusManager.class);
  executeInEDT(new PrioritizedTask(TaskType.EDITOR_MEMENTO,myType2TaskMap){
    @Override public void performTask(){
      if (editorComponent.isDisposed()) {
        return;
      }
      editorContext.setMemento(s.myMemento);
      editorComponent.getFocusTracker().setEffectiveFocusState(s.myEditorFocused);
      if (s.myEditorFocused && focusManager != null) {
        focusManager.requestFocus(editorComponent,true);
      }
    }
  }
);
  if (s.myInspectorMemento == null || !(editorComponent instanceof NodeEditorComponent)) {
    return;
  }
  final NodeEditorComponent nodeEditorComponent=(NodeEditorComponent)editorComponent;
  final EditorComponent inspectorEditorComponent=nodeEditorComponent.getInspector();
  if (inspectorEditorComponent == null) {
    LOG.error("No inspector - memento will not be restored");
    return;
  }
  final EditorContext inspectorEditorContext=inspectorEditorComponent.getEditorContext();
  executeInEDT(new PrioritizedTask(TaskType.INSPECTOR_MEMENTO,myType2TaskMap){
    @Override public void performTask(){
      inspectorEditorContext.setMemento(s.myInspectorMemento);
      inspectorEditorComponent.getFocusTracker().setEffectiveFocusState(s.myInspectorFocused);
      if (s.myInspectorFocused && focusManager != null) {
        InspectorTool inspectorTool=myProject.getComponent(InspectorTool.class);
        if (inspectorTool != null && inspectorTool.isAvailable()) {
          inspectorTool.activate();
        }
        focusManager.requestFocus(inspectorEditorComponent,true);
      }
    }
  }
);
}
