{
  INodeBuilder builder=null;
  NodeMacro nodeMacro=(NodeMacro)templateNode.getChild(ITemplateGenerator.ROLE_NODE_MAKRO);
  if (nodeMacro != null) {
    if (nodeMacro instanceof SwitchMacro) {
      TemplateSwitch templateSwitch=((SwitchMacro)nodeMacro).getTemplateSwitch();
      SemanticNode templateNodeFromSwitch=getTemplateNodeFromSwitch(sourceNode,templateSwitch,generator);
      if (templateNodeFromSwitch != null) {
        builder=createNodeBuilder(sourceNode,templateNodeFromSwitch,mappingName,generator);
        if (builder != null) {
          builder.setRoleInParent(templateNode.getRole_());
        }
      }
    }
 else {
      String targetBuilderAspectMethodName=nodeMacro.getTargetBuilderAspectMethodName();
      if (targetBuilderAspectMethodName != null) {
        String methodName="templateTargetBuilder_" + targetBuilderAspectMethodName;
        Object[] args=new Object[]{sourceNode,templateNode,mappingName,generator};
        builder=(INodeBuilder)AspectMethod.invoke(methodName,args,nodeMacro.getModel());
      }
    }
  }
  if (builder != null) {
    return builder;
  }
  builder=loadNodeBuilder(sourceNode,templateNode,mappingName,generator);
  if (builder != null) {
    return builder;
  }
  return new DefaultNodeBuilder(sourceNode,templateNode,mappingName,generator);
}
