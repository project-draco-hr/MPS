{
  NodeMacro nodeMacro=(NodeMacro)templateNode.getChild(ITemplateGenerator.ROLE_NODE_MAKRO);
  List<SNode> result=new LinkedList<SNode>();
  if (nodeMacro instanceof CopySrcNodeMacro) {
    CopySrcNodeMacro copySrcNodeMacro=((CopySrcNodeMacro)nodeMacro);
    String sourceNodeQueryId=copySrcNodeMacro.getSourceNodeQueryId();
    if (sourceNodeQueryId == null) {
      generator.showErrorMessage(nodeMacro,"Source query is not defined");
    }
 else {
      String methodName="templateSourceNodeQuery_" + sourceNodeQueryId;
      Object[] args=new Object[]{parentSourceNode,generator};
      SNode srcNodeToCopy=(SNode)QueryMethod.invoke(methodName,args,nodeMacro.getModel());
      if (srcNodeToCopy != null) {
        result.add(srcNodeToCopy);
      }
      checkNodesFromQuery(result,copySrcNodeMacro,generator);
      return result;
    }
  }
 else   if (nodeMacro instanceof MapSrcNodeMacro) {
    MapSrcNodeMacro mapSrcNodeMacro=((MapSrcNodeMacro)nodeMacro);
    String sourceNodeQueryId=mapSrcNodeMacro.getSourceNodeQueryId();
    if (sourceNodeQueryId != null) {
      String methodName="templateSourceNodeQuery_" + sourceNodeQueryId;
      Object[] args=new Object[]{parentSourceNode,generator};
      SNode srcNodeToCopy=(SNode)QueryMethod.invoke(methodName,args,nodeMacro.getModel());
      if (srcNodeToCopy != null) {
        result.add(srcNodeToCopy);
      }
      checkNodesFromQuery(result,mapSrcNodeMacro,generator);
      return result;
    }
  }
 else   if (nodeMacro instanceof IfMacro) {
    IfMacro ifMacro=(IfMacro)nodeMacro;
    String conditionAspectId=ifMacro.getConditionAspectId();
    if (conditionAspectId == null) {
      generator.showErrorMessage(nodeMacro,"Condition is not defined");
    }
 else {
      String methodName="semanticNodeCondition_" + conditionAspectId;
      Object[] args=new Object[]{parentSourceNode};
      Boolean conditionStatus=(Boolean)QueryMethod.invokeWithOptionalArg(methodName,args,nodeMacro.getModel(),generator.getGeneratorSessionContext());
      List<SNode> sourceNodes=new LinkedList<SNode>();
      if (conditionStatus) {
        sourceNodes.add(parentSourceNode);
      }
      return sourceNodes;
    }
  }
  if (nodeMacro != null) {
    String sourceQueryAspectMethodName=nodeMacro.getSourceQueryAspectMethodName();
    if (sourceQueryAspectMethodName != null) {
      String methodName="templateSourceQuery_" + sourceQueryAspectMethodName;
      Object[] args=new Object[]{parentSourceNode,generator};
      try {
        List<SNode> sourceNodes=(List<SNode>)QueryMethod.invoke(methodName,args,nodeMacro.getModel());
        checkNodesFromQuery(sourceNodes,nodeMacro,generator);
        return sourceNodes;
      }
 catch (      Exception e) {
        generator.showErrorMessage(parentSourceNode,nodeMacro,"Error invocation method: \"" + methodName + "\" : "+ e.getMessage());
        throw new RuntimeException("Error invocation method: \"" + methodName + "\"",e);
      }
    }
  }
  List<SNode> list=new LinkedList<SNode>();
  list.add(parentSourceNode);
  return list;
}
