{
  SourceSubstituteMacro_SourceNodesQuery function=loopMacro.getSourceNodesQuery();
  if (function != null) {
    String methodName=TemplateFunctionMethodName.sourceSubstituteMacro_SourceNodesQuery(function);
    Object[] args=new Object[]{sourceNode,generator.getSourceModel(),generator,generator.getScope(),generator.getGeneratorSessionContext()};
    try {
      List<SNode> sourceNodes=(List<SNode>)QueryMethodGenerated.invoke(methodName,args,loopMacro.getModel());
      checkNodesFromQuery(sourceNodes,loopMacro,generator);
      return sourceNodes;
    }
 catch (    Exception e) {
      generator.showErrorMessage(sourceNode,null,loopMacro,"couldn't evaluate loop-macro query - try to generate template models");
      e.printStackTrace();
      return new LinkedList<SNode>();
    }
  }
  String sourceQueryAspectMethodName=loopMacro.getSourceQueryAspectMethodName();
  if (sourceQueryAspectMethodName != null) {
    String methodName="templateSourceQuery_" + sourceQueryAspectMethodName;
    Object[] args=new Object[]{sourceNode,generator};
    try {
      List<SNode> sourceNodes=(List<SNode>)QueryMethod.invoke(methodName,args,loopMacro.getModel());
      checkNodesFromQuery(sourceNodes,loopMacro,generator);
      return sourceNodes;
    }
 catch (    Exception e) {
      generator.showErrorMessage(sourceNode,null,loopMacro,"couldn't evaluate loop-macro query: " + NameUtil.shortNameFromLongName(e.getClass().getName()) + " : "+ e.getMessage());
      e.printStackTrace();
      return new LinkedList<SNode>();
    }
  }
  throw new GenerationFailedException(new GenerationFailueInfo("couldn't evaluate loop-macro query",sourceNode,loopMacro,null,generator.getGeneratorSessionContext()));
}
