{
  super(project);
  myRootManager=rootManager;
  myProjectManager=projectManager;
  myIndex=index;
  final MPSUnIndexedFilesUpdater updater=new MPSUnIndexedFilesUpdater(myIndex,myRootManager,project);
  final StartupManagerEx startupManager=(StartupManagerEx)StartupManager.getInstance(myProject);
  if (startupManager == null)   return;
  startupManager.registerPreStartupActivity(new Runnable(){
    @Override public void run(){
      startupManager.registerCacheUpdater(updater);
      myIndex.registerIndexableSet(MPSFileBasedIndexProjectHandler.this,myProject);
      LOG.debug("Queueing cache update");
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          DumbServiceImpl.getInstance(myProject).queueCacheUpdate(Collections.<CacheUpdater>singletonList(updater));
        }
      }
);
    }
  }
);
}
