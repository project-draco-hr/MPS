{
  return new LibraryRootsComponentDescriptor(){
    @Override public OrderRootTypePresentation getRootTypePresentation(    @NotNull OrderRootType type){
      if (type == ModuleXmlRootDetector.SOLUTION_MODULE_XML) {
        return ModuleXmlRootDetector.getPresentation();
      }
      return null;
    }
    @Override public OrderRootType[] getRootTypes(){
      ArrayList<OrderRootType> types=new ArrayList<OrderRootType>();
      types.addAll(Arrays.asList(super.getRootTypes()));
      types.add(ModuleXmlRootDetector.SOLUTION_MODULE_XML);
      return types.toArray(new OrderRootType[types.size()]);
    }
    @NotNull @Override public List<? extends RootDetector> getRootDetectors(){
      return Arrays.asList(ModuleXmlRootDetector.getInstance());
    }
    @NotNull @Override public List<? extends AttachRootButtonDescriptor> createAttachButtons(){
      return Arrays.asList(new AttachRootButtonDescriptor(OrderRootType.CLASSES,MPSBundle.message("library.attach.mps.solution")){
        @Override public VirtualFile[] selectFiles(        @NotNull JComponent parent,        @Nullable VirtualFile initialSelection,        @Nullable final Module contextModule,        @NotNull final LibraryEditor libraryEditor){
          final List<ModuleReference> availableSolutions=new ArrayList<ModuleReference>();
          final Set<VirtualFile> libraryFiles=new HashSet<VirtualFile>(Arrays.asList(libraryEditor.getFiles(OrderRootType.CLASSES)));
          ModelAccess.instance().runReadAction(new Runnable(){
            @Override public void run(){
              for (              Solution solution : ModuleRepositoryFacade.getInstance().getAllModules(Solution.class)) {
                if (solution instanceof SolutionIdea || solution instanceof StubSolution) {
                  continue;
                }
                if (libraryFiles.contains(getJarFile(solution.getBundleHome().getPath()))) {
                  continue;
                }
                availableSolutions.add(solution.getModuleReference());
              }
            }
          }
);
          ChooseElementsDialog<ModuleReference> chooser=new ModuleReferenceChooserDialog(parent,availableSolutions);
          chooser.show();
          List<ModuleReference> chosenElements=chooser.getChosenElements();
          final Set<VirtualFile> roots=new LinkedHashSet<VirtualFile>();
          for (          ModuleReference module : chosenElements) {
            for (            VirtualFile virtualFile : getSolutionJars((Solution)ModuleRepositoryFacade.getInstance().getModule(module))) {
              roots.add(virtualFile);
            }
          }
          return roots.toArray(new VirtualFile[roots.size()]);
        }
      }
);
    }
  }
;
}
