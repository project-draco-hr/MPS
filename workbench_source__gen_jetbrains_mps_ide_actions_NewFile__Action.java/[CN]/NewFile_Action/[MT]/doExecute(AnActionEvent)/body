{
  try {
    final VirtualFile dir=(NewFile_Action.this.selectedFile.isDirectory() ? NewFile_Action.this.selectedFile : NewFile_Action.this.selectedFile.getParent());
    final VirtualFile[] result=new VirtualFile[1];
    InputValidator validator=new InputValidator(){
      public boolean checkInput(      String p){
        return true;
      }
      public boolean canClose(      final String p){
        if (p.length() == 0) {
          return false;
        }
        if (p.contains(System.getProperty("file.separator"))) {
          return false;
        }
        ModelAccess.instance().runWriteAction(new Runnable(){
          public void run(){
            try {
              result[0]=dir.createChildData(null,p);
            }
 catch (            IOException e) {
            }
          }
        }
);
        return true;
      }
    }
;
    Messages.showInputDialog(NewFile_Action.this.project,IdeBundle.message("prompt.enter.new.file.name"),IdeBundle.message("title.new.file"),Messages.getQuestionIcon(),"",validator);
    if (result[0] != null) {
      ProjectView.getInstance(NewFile_Action.this.project).getProjectViewPaneById(BaseDirectoryProjectView.ID).select(null,result[0],true);
    }
  }
 catch (  Throwable t) {
    if (log.isErrorEnabled()) {
      log.error("User's action execute method failed. Action:" + "NewFile",t);
    }
  }
}
