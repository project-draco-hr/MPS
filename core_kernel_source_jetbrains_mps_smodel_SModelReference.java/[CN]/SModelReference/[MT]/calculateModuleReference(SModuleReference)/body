{
  if (moduleReference == null) {
    SModel modelDescriptor=SModelRepository.getInstance().getModelDescriptor(myModelId);
    if (modelDescriptor != null) {
      return modelDescriptor.getModule().getModuleReference();
    }
 else {
      return null;
    }
  }
  SModuleId moduleId=moduleReference.getModuleId();
  String moduleName=moduleReference.getModuleName();
  SModule module=null;
  if (moduleId == null && moduleName != null) {
    module=MPSModuleRepository.getInstance().getModuleByFqName(moduleName);
  }
 else   if (moduleId != null && moduleName == null) {
    module=MPSModuleRepository.getInstance().getModule(moduleId);
  }
  if (module != null) {
    return module.getModuleReference();
  }
 else {
    return moduleReference;
  }
}
