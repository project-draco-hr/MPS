{
  String role;
  SNode sourceNode;
  jetbrains.mps.baseLanguage.structure.Expression result;
  ReferenceBinding declaredClassBinding=getDeclaredClassBinding(fieldBinding);
  if (fieldBinding.isStatic()) {
    INodeAdapter fieldAdapter=myTypesProvider.getRaw(fieldBinding);
    if (fieldAdapter instanceof EnumConstantDeclaration) {
      EnumConstantReference enumConstantReference=EnumConstantReference.newInstance(myCurrentModel);
      role=EnumConstantReference.ENUM_CONSTANT_DECLARATION;
      sourceNode=enumConstantReference.getNode();
      enumConstantReference.getNode().addReference(myTypesProvider.createClassifierReference(declaredClassBinding,EnumConstantReference.ENUM_CLASS,sourceNode));
      result=enumConstantReference;
    }
 else     if (myCurrentClass == myTypesProvider.getRaw(declaredClassBinding)) {
      role=LocalStaticFieldReference.VARIABLE_DECLARATION;
      LocalStaticFieldReference lsfr=LocalStaticFieldReference.newInstance(myCurrentModel);
      sourceNode=lsfr.getNode();
      result=lsfr;
    }
 else {
      StaticFieldReference sfr=StaticFieldReference.newInstance(myCurrentModel);
      sourceNode=sfr.getNode();
      role=StaticFieldReference.VARIABLE_DECLARATION;
      sfr.getNode().addReference(myTypesProvider.createClassifierReference(declaredClassBinding,StaticFieldReference.CLASSIFIER,sourceNode));
      result=sfr;
    }
  }
 else {
    role=FieldReferenceOperation.FIELD_DECLARATION;
    jetbrains.mps.baseLanguage.structure.Expression instance;
    if (instanceExpression == null) {
      ThisExpression thisExpression=ThisExpression.newInstance(myCurrentModel);
      if (myCurrentClass != myTypesProvider.getRaw(declaredClassBinding)) {
        if (!isSubtype(myCurrentTypeDeclaration.binding,declaredClassBinding)) {
          thisExpression.getNode().addReference(myTypesProvider.createClassifierReference(declaredClassBinding,ThisExpression.CLASS_CONCEPT,thisExpression.getNode()));
        }
      }
      instance=thisExpression;
    }
 else {
      instance=instanceExpression;
    }
    if (declaredClassBinding == null) {
      return createArrayLengthExpression(instance,fieldBinding);
    }
    FieldReferenceOperation fieldRef=FieldReferenceOperation.newInstance(myCurrentModel);
    DotExpression dotExpression=DotExpression.newInstance(myCurrentModel);
    dotExpression.setOperation(fieldRef);
    dotExpression.setOperand(instance);
    sourceNode=fieldRef.getNode();
    result=dotExpression;
  }
  SReference fieldReference=myTypesProvider.createFieldReference(fieldBinding,role,sourceNode);
  sourceNode.addReference(fieldReference);
  return result;
}
