{
  String role;
  SNode sourceNode;
  jetbrains.mps.baseLanguage.structure.Expression result;
  if (fieldBinding.isStatic()) {
    if (myCurrentClass == myTypesProvider.getRaw(fieldBinding.declaringClass)) {
      role=LocalStaticFieldReference.VARIABLE_DECLARATION;
      LocalStaticFieldReference lsfr=LocalStaticFieldReference.newInstance(myCurrentModel);
      sourceNode=lsfr.getNode();
      result=lsfr;
    }
 else {
      StaticFieldReference sfr=StaticFieldReference.newInstance(myCurrentModel);
      sourceNode=sfr.getNode();
      role=StaticFieldReference.VARIABLE_DECLARATION;
      sfr.getNode().addReference(myTypesProvider.createClassifierReference(fieldBinding.declaringClass,StaticFieldReference.CLASSIFIER,sourceNode));
      result=sfr;
    }
  }
 else {
    role=FieldReferenceOperation.FIELD_DECLARATION;
    jetbrains.mps.baseLanguage.structure.Expression instance;
    if (instanceExpression == null) {
      ThisExpression thisExpression=ThisExpression.newInstance(myCurrentModel);
      ReferenceBinding declaredClassBinding=fieldBinding.declaringClass;
      if (myCurrentClass != myTypesProvider.getRaw(declaredClassBinding)) {
        thisExpression.getNode().addReference(myTypesProvider.createClassifierReference(declaredClassBinding,ThisExpression.CLASS_CONCEPT,thisExpression.getNode()));
      }
      instance=thisExpression;
    }
 else {
      instance=instanceExpression;
    }
    if (fieldBinding.declaringClass == null) {
      return createArrayLengthExpression(instance,fieldBinding);
    }
    FieldReferenceOperation fieldRef=FieldReferenceOperation.newInstance(myCurrentModel);
    DotExpression dotExpression=DotExpression.newInstance(myCurrentModel);
    dotExpression.setOperation(fieldRef);
    dotExpression.setOperand(instance);
    sourceNode=fieldRef.getNode();
    result=dotExpression;
  }
  SReference fieldReference=myTypesProvider.createFieldReference(fieldBinding,role,sourceNode);
  sourceNode.addReference(fieldReference);
  return result;
}
