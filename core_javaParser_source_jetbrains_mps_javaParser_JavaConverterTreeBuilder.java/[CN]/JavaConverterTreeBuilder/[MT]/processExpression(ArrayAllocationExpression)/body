{
  Type type=createType(x.resolvedType);
  if (!(type instanceof ArrayType)) {
    throw new JavaConverterException("a type of array allocation should be an array type");
  }
  ArrayType arrayType=(ArrayType)type;
  if (x.initializer != null) {
    List<jetbrains.mps.baseLanguage.structure.Expression> initializers=new ArrayList<jetbrains.mps.baseLanguage.structure.Expression>();
    if (x.initializer.expressions != null) {
      for (      Expression expression : x.initializer.expressions) {
        initializers.add(processExpressionRefl(expression));
      }
    }
    ArrayCreatorWithInitializer arrayCreator=ArrayCreatorWithInitializer.newInstance(myCurrentModel);
    for (    jetbrains.mps.baseLanguage.structure.Expression initializer : initializers) {
      arrayCreator.addInitValue(initializer);
    }
    arrayCreator.setComponentType(CopyUtil.copy(arrayType.getComponentType()));
    GenericNewExpression genericNewExpression=GenericNewExpression.newInstance(myCurrentModel);
    genericNewExpression.setCreator(arrayCreator);
    return genericNewExpression;
  }
 else {
    List<jetbrains.mps.baseLanguage.structure.Expression> dims=new ArrayList<jetbrains.mps.baseLanguage.structure.Expression>();
    for (    Expression dimension : x.dimensions) {
      if (dimension == null) {
        dims.add(null);
      }
 else {
        dims.add(processExpressionRefl(dimension));
      }
    }
    ArrayCreator arrayCreator=ArrayCreator.newInstance(myCurrentModel);
    for (    jetbrains.mps.baseLanguage.structure.Expression dim : dims) {
      DimensionExpression dimensionExpression=DimensionExpression.newInstance(myCurrentModel);
      arrayCreator.addDimensionExpression(dimensionExpression);
      if (dim != null) {
        dimensionExpression.setExpression(dim);
      }
    }
    Type deepestComponentType=arrayType.getComponentType();
    while (deepestComponentType instanceof ArrayType) {
      deepestComponentType=((ArrayType)deepestComponentType).getComponentType();
    }
    arrayCreator.setComponentType(CopyUtil.copy(deepestComponentType));
    GenericNewExpression genericNewExpression=GenericNewExpression.newInstance(myCurrentModel);
    genericNewExpression.setCreator(arrayCreator);
    return genericNewExpression;
  }
}
