{
  super("Migrate attributes concept properties and links");
  this.addRefactoring(new AbstractMigrationRefactoring(operationContext){
    public String getName(){
      return "Migrate attribute declarations";
    }
    public String getAdditionalInfo(){
      return "Migrate attribute declarations";
    }
    public String getFqNameOfConceptToSearchInstances(){
      return "jetbrains.mps.lang.structure.structure.ConceptDeclaration";
    }
    public boolean isApplicableInstanceNode(    SNode node){
      return AttributeDesignTimeOperations.isAttributeDeclaration(node) && (AttributeOperations.getAttribute(node,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.structure.structure.AttributeInfo"))) == null);
    }
    public void doUpdateInstanceNode(    SNode node){
      SNode info=SConceptOperations.createNewNode("jetbrains.mps.lang.structure.structure.AttributeInfo",null);
      SPropertyOperations.set(info,"role","");
      SNode multiple=SNodeOperations.as(ListSequence.fromList(SLinkOperations.getTargets(node,"conceptProperty",true)).where(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return SLinkOperations.getTarget(it,"conceptPropertyDeclaration",false) == SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)","5169995583184591167");
        }
      }
).first(),"jetbrains.mps.lang.structure.structure.BooleanConceptProperty");
      if ((multiple != null)) {
        SLinkOperations.setTarget(info,"multiple",SConceptOperations.createNewNode("jetbrains.mps.lang.structure.structure.AttributeInfo_IsMultiple",null),true);
        SPropertyOperations.set(SLinkOperations.getTarget(info,"multiple",true),"value","" + (true));
      }
      SNode role=SNodeOperations.as(ListSequence.fromList(SLinkOperations.getTargets(node,"conceptProperty",true)).where(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return SLinkOperations.getTarget(it,"conceptPropertyDeclaration",false) == SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)","5169995583184591164");
        }
      }
).first(),"jetbrains.mps.lang.structure.structure.StringConceptProperty");
      if ((role != null)) {
        SPropertyOperations.set(info,"role",SPropertyOperations.getString(role,"value"));
      }
      Iterable<SNode> attributed=ListSequence.fromList(SLinkOperations.getTargets(node,"conceptLink",true)).where(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return SLinkOperations.getTarget(it,"conceptLinkDeclaration",false) == SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)","5169995583184591169") && SNodeOperations.isInstanceOf(it,"jetbrains.mps.lang.structure.structure.ReferenceConceptLink");
        }
      }
).select(new ISelector<SNode,SNode>(){
        public SNode select(        SNode it){
          return SNodeOperations.as(SLinkOperations.getTarget(SNodeOperations.cast(it,"jetbrains.mps.lang.structure.structure.ReferenceConceptLink"),"target",false),"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration");
        }
      }
).where(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return (it != null);
        }
      }
);
      for (      SNode concept : Sequence.fromIterable(attributed)) {
        ListSequence.fromList(SLinkOperations.getTargets(info,"attributed",true)).addElement(createAttributeInfo_AttributedConcept_91cv71_a0a0a01a0a(concept));
      }
      AttributeOperations.setAttribute(node,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.structure.structure.AttributeInfo")),info);
      ListSequence.fromList(SLinkOperations.getTargets(node,"conceptProperty",true)).removeWhere(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return ListSequence.fromList(SLinkOperations.getTargets(SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)","5169995583184591161"),"conceptPropertyDeclaration",true)).contains(SLinkOperations.getTarget(it,"conceptPropertyDeclaration",false));
        }
      }
);
      ListSequence.fromList(SLinkOperations.getTargets(node,"conceptLink",true)).removeWhere(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return ListSequence.fromList(SLinkOperations.getTargets(SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)","5169995583184591161"),"conceptLinkDeclaration",true)).contains(SLinkOperations.getTarget(it,"conceptLinkDeclaration",false));
        }
      }
);
    }
    public boolean isShowAsIntention(){
      return false;
    }
  }
);
}
