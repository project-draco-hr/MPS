{
  String path=moduleFile.getAbsolutePath();
  if (!path.endsWith(MPSExtentions.DOT_LANGUAGE) && !path.endsWith(MPSExtentions.DOT_SOLUTION) && !path.endsWith(MPSExtentions.DOT_DEVKIT))   return;
  List<IModule> tmpmodules;
  IModule moduleByFile=ModelAccess.instance().runReadAction(new Computable<IModule>(){
    public IModule compute(){
      return MPSModuleRepository.getInstance().getModuleByFile(FileSystem.getInstance().getFileByPath(moduleFile.getAbsolutePath()));
    }
  }
);
  if (moduleByFile != null) {
    tmpmodules=Collections.singletonList(moduleByFile);
  }
 else {
    tmpmodules=ModelAccess.instance().runWriteAction(new Computable<List<IModule>>(){
      public List<IModule> compute(){
        IFile file=FileSystem.getInstance().getFileByPath(moduleFile.getPath());
        return MPSModuleRepository.getInstance().readModuleDescriptors(file.isDirectory() ? file : file.getParent(),new MPSModuleOwner(){
        }
);
      }
    }
);
  }
  modules.addAll(tmpmodules);
  for (  IModule module : tmpmodules) {
    info("Loaded module " + module);
    if (module.isPackaged())     continue;
    if (module instanceof Language) {
      Language language=(Language)module;
      for (      Generator gen : language.getGenerators()) {
        modules.add(gen);
      }
    }
  }
}
