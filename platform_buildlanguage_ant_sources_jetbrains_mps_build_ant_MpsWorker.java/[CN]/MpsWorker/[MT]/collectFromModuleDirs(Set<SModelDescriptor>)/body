{
  for (  final File f : myWhatToGenerate.getModuleDirectories()) {
    List<IModule> modules=ModelAccess.instance().runWriteAction(new Computable<List<IModule>>(){
      public List<IModule> compute(){
        return MPSModuleRepository.getInstance().readModuleDescriptors(FileSystem.getFile(f.getPath()),new MPSModuleOwner(){
        }
);
      }
    }
);
    for (    IModule module : modules) {
      info("Loaded module " + module);
      if (module.isPackaged())       continue;
      List<SModelDescriptor> modelDescriptorList=module.getOwnModelDescriptors();
      for (      SModelDescriptor sm : modelDescriptorList) {
        if (SModelStereotype.isUserModel(sm)) {
          modelDescriptors.add(sm);
        }
      }
      if (module instanceof Language) {
        Language language=(Language)module;
        for (        jetbrains.mps.smodel.Generator gen : language.getGenerators()) {
          modelDescriptors.addAll(gen.getOwnModelDescriptors());
        }
      }
    }
  }
}
