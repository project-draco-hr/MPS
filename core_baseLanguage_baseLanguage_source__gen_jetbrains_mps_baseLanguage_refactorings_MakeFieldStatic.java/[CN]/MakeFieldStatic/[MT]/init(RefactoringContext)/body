{
  final SNode node=refactoringContext.getSelectedNode();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.baseLanguage.structure.FieldDeclaration")) {
        refactoringContext.setParameter("declaration",SNodeOperations.cast(node,"jetbrains.mps.baseLanguage.structure.FieldDeclaration"));
      }
 else {
        refactoringContext.setParameter("declaration",SNodeOperations.cast(Sequence.fromIterable(SNodeOperations.getReferences(node)).first().getTargetNode(),"jetbrains.mps.baseLanguage.structure.FieldDeclaration"));
      }
      refactoringContext.setParameter("usages",FindUtils.getSearchResults(new EmptyProgressIndicator(),((SNode)refactoringContext.getParameter("declaration")),GlobalScope.getInstance(),"jetbrains.mps.baseLanguage.findUsages.FieldUsages_Finder"));
      refactoringContext.setParameter("hasExternalUsages",false);
      for (      SearchResult<SNode> result : ListSequence.fromList(((SearchResults<SNode>)refactoringContext.getParameter("usages")).getSearchResults())) {
        if (SNodeOperations.getContainingRoot(result.getObject()) != SNodeOperations.getContainingRoot(((SNode)refactoringContext.getParameter("declaration")))) {
          refactoringContext.setParameter("hasExternalUsages",true);
        }
      }
    }
  }
);
  return true;
}
