{
  addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent p0){
      final FindUsagesFacade findUsegesManager=FindUsagesFacade.getInstance();
      DataContext dataContext=DataManager.getInstance().getDataContext(NodeChooser.this);
      Project project=MPSDataKeys.PROJECT.getData(dataContext);
      final MPSProject mpsProject=MPSDataKeys.MPS_PROJECT.getData(dataContext);
      if (mpsProject == null) {
        return;
      }
      final Wrappers._T<List<SNodeReference>> toChooseFrom=new Wrappers._T<List<SNodeReference>>();
      ProgressManager.getInstance().run(new Task.Modal(project,"Searching for nodes",false){
        public void run(        @NotNull final ProgressIndicator indicator){
          mpsProject.getModelAccess().runReadAction(new Runnable(){
            public void run(){
              toChooseFrom.value=ListSequence.fromList(findToChooseFromOnInit(findUsegesManager,new ProgressMonitorAdapter(indicator))).select(new ISelector<SNode,SNodeReference>(){
                public SNodeReference select(                SNode it){
                  return SNodeOperations.getPointer(it);
                }
              }
).toListSequence();
            }
          }
);
        }
      }
);
      NodeChooserDialog chooserDialog=new NodeChooserDialog(project,toChooseFrom.value);
      chooserDialog.show();
      final SNodeReference result=chooserDialog.getResult();
      if (result != null) {
        mpsProject.getModelAccess().runReadAction(new Runnable(){
          public void run(){
            SNode resultNode=result.resolve(mpsProject.getRepository());
            if (resultNode != null) {
              setNode(resultNode);
            }
          }
        }
);
      }
    }
  }
);
  addKeyListener(new KeyAdapter(){
    @Override public void keyReleased(    KeyEvent event){
      final String text=getText();
      if ((text == null || text.length() == 0)) {
        setNode(null);
        return;
      }
      final int lastDot=text.lastIndexOf(".");
      if (lastDot <= 0) {
        setNode(null);
        return;
      }
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          Iterable<SModel> models=getModels(text.substring(0,lastDot));
          SNode foundNode=null;
          for (          SModel model : Sequence.fromIterable(models)) {
            Iterable<SNode> nodes=findNodes(model,text);
            if (!(Sequence.fromIterable(nodes).isEmpty())) {
              foundNode=Sequence.fromIterable(nodes).first();
              break;
            }
          }
          setNode(foundNode);
        }
      }
);
    }
  }
);
}
