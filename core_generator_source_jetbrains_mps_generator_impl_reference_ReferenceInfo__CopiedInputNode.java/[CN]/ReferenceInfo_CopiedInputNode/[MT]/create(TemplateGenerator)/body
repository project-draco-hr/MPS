{
  if (myInputTargetNode != null) {
    SNode ultimateTarget=generator.findCopiedOutputNodeForInputNode_unique(myInputTargetNode);
    if (ultimateTarget != null) {
      return createStaticReference(ultimateTarget);
    }
    String resolveInfo=jetbrains.mps.util.SNodeOperations.getResolveInfo(myInputTargetNode);
    if (resolveInfo != null) {
      final SReference dr=createDynamicReference(resolveInfo,getTargetModelReference(generator),null);
      generator.registerDynamicReference(dr);
      return dr;
    }
    SNode ambiguousTarget=generator.findCopiedOutputNodeForInputNode(myInputTargetNode);
    if (ambiguousTarget != null) {
      if (checkResolvedTarget(generator,ambiguousTarget)) {
        return createStaticReference(ambiguousTarget);
      }
 else {
        return jetbrains.mps.smodel.SReference.create(getReferenceRole(),getOutputSourceNode(),generator.getOutputModel().getReference(),null,null);
      }
    }
  }
  return createInvalidReference(generator,null);
}
