{
  Element element=new Element(ModelPersistence.NODE);
  DocUtil.setNotNullAttribute(element,ModelPersistence.ROLE,myHelper.genRole(node));
  DocUtil.setNotNullAttribute(element,ModelPersistence.ROLE_ID,myHelper.genRoleId(node));
  element.setAttribute(ModelPersistence.TYPE,myHelper.genType(node));
  DocUtil.setNotNullAttribute(element,ModelPersistence.TYPE_ID,myHelper.genTypeId(node));
  element.setAttribute(ModelPersistence.ID,node.getId());
  for (  String propertyName : node.getProperties().keySet()) {
    Element propertyElement=new Element(ModelPersistence.PROPERTY);
    propertyElement.setAttribute(ModelPersistence.NAME,myHelper.genName(node,propertyName));
    DocUtil.setNotNullAttribute(propertyElement,ModelPersistence.NAME_ID,myHelper.genNameId(node,propertyName));
    DocUtil.setNotNullAttribute(propertyElement,ModelPersistence.VALUE,node.getPersistentProperty(propertyName));
    element.addContent(propertyElement);
  }
  for (  SReference reference : node.getReferencesIterable()) {
    Element linkElement=new Element(ModelPersistence.LINK);
    linkElement.setAttribute(ModelPersistence.ROLE,myHelper.genRole(reference));
    DocUtil.setNotNullAttribute(linkElement,ModelPersistence.ROLE_ID,myHelper.genRoleId(reference));
    linkElement.setAttribute(ModelPersistence.TARGET_NODE_ID,myHelper.genTarget(reference));
    DocUtil.setNotNullAttribute(linkElement,ModelPersistence.RESOLVE_INFO,reference.getResolveInfo());
    element.addContent(linkElement);
  }
  if (saveChildren) {
    for (    SNode childNode : node.getChildren()) {
      saveNode(element,childNode,true);
    }
  }
  parentElement.addContent(element);
}
