{
  try {
    MPSProject mpsProject=((Project)MapSequence.fromMap(_params).get("project")).getComponent(MPSProject.class);
    List<SModule> allModules=ListSequence.fromListWithValues(new ArrayList<SModule>(),mpsProject.getModulesWithGenerators());
    for (    SModule module : ListSequence.fromList(allModules)) {
      ModuleDescriptor descriptor=((IModule)module).getModuleDescriptor();
      if (descriptor == null) {
        continue;
      }
      for (      SModel _model : Sequence.fromIterable(module.getModels())) {
        if (SModelStereotype.isStubModelStereotype(SModelStereotype.getStereotype(_model))) {
          continue;
        }
        SModel model=_model;
        Set<SModelReference> dependencies=SetSequence.fromSet(new HashSet<SModelReference>());
        for (        SNode node : ListSequence.fromList(SModelOperations.getNodes(model,null))) {
          SNode nodeToImport=ImportModelsWithUsedClassifiers_Action.this.getNodeToImport(node,_params);
          SModelReference mref=check_rft9c_a0b0f0d0e0a(SNodeOperations.getModel(nodeToImport));
          if (mref == null) {
            continue;
          }
          SetSequence.fromSet(dependencies).addElement(mref);
        }
        SetSequence.fromSet(dependencies).removeElement(_model.getReference());
        for (        SModel importedModel : ListSequence.fromList(jetbrains.mps.smodel.SModelOperations.allImportedModels(model,GlobalScope.getInstance()))) {
          SetSequence.fromSet(dependencies).removeElement(importedModel.getReference());
        }
        for (        SModelReference modelToImport : SetSequence.fromSet(dependencies)) {
          ((SModelInternal)model).addModelImport(modelToImport,false);
        }
      }
    }
  }
 catch (  Throwable t) {
    if (LOG.isEnabledFor(Priority.ERROR)) {
      LOG.error("User's action execute method failed. Action:" + "ImportModelsWithUsedClassifiers",t);
    }
  }
}
