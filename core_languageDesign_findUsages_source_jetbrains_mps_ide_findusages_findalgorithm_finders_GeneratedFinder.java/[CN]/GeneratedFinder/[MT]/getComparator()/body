{
  return new Comparator<SNode>(){
    private void check(    int index,    SNode searchedNode,    SNode editorNode){
      if (index == -1) {
        System.err.println("\"" + searchedNode.getRole_() + "\" can't found in "+ editorNode);
      }
    }
    private boolean fromSameCollection(    SNode node1,    SNode node2){
      return EqualUtil.equals(node1.getRole_(),node2.getRole_());
    }
    private int compareWithoutEditor(    SNode ancestor,    SNode node1,    SNode node2){
      Integer index1=ancestor.getIndexOfChild(node1);
      Integer index2=ancestor.getIndexOfChild(node2);
      return index1.compareTo(index2);
    }
    private Pair<Integer,Boolean> indexInEditor(    SNode editorNode,    String role,    Pair<Integer,Boolean> index){
      index.o1++;
      if (editorNode.toString().startsWith("%" + role + "%")) {
        return new Pair(index.o1,true);
      }
      for (      SNode childEditorNode : editorNode.getChildren()) {
        Pair<Integer,Boolean> result=indexInEditor(childEditorNode,role,index);
        if (result.o2)         return result;
      }
      return new Pair(-1,false);
    }
    private int searchInEditors(    SNode ancestor,    SNode searchedNode){
      AbstractConceptDeclaration conceptDeclaration=ancestor.getConceptDeclarationAdapter();
      SModel structureModel=conceptDeclaration.getModel();
      Language language=(Language)structureModel.getModelDescriptor().getModule();
      SModel editorModel=language.getEditorModelDescriptor().getSModel();
      ConceptEditorDeclaration conceptEditorDeclaration=GoToEditorDeclarationHelper.findEditorDeclaration(editorModel,conceptDeclaration);
      SNode editorNode=conceptEditorDeclaration.getNode();
      int index=indexInEditor(editorNode,searchedNode.getRole_(),new Pair(-1,false)).o1;
      if (index != -1 || ancestor.getParent() == null) {
        check(index,searchedNode,searchedNode.getContainingRoot());
        return index;
      }
      return searchInEditors(ancestor.getParent(),searchedNode);
    }
    private int compareWithEditor(    SNode ancestor,    SNode node1,    SNode node2){
      Integer index1=searchInEditors(ancestor,node1);
      Integer index2=searchInEditors(ancestor,node2);
      return index1.compareTo(index2);
    }
    public int compare(    SNode o1,    SNode o2){
      SNode root1=o1.getContainingRoot();
      SNode root2=o2.getContainingRoot();
      if (!EqualUtil.equals(root1,root2)) {
        return root1.toString().compareTo(root2.toString());
      }
      List<SNode> anc1=o1.getAncestors(true);
      List<SNode> anc2=o2.getAncestors(true);
      for (int i1=0; i1 < anc1.size(); i1++) {
        if (i1 == 0)         continue;
        for (int i2=0; i2 < anc2.size(); i2++) {
          if (i2 == 0)           continue;
          if (EqualUtil.equals(anc1.get(i1),anc2.get(i2))) {
            SNode ancestor=anc1.get(i1);
            SNode node1=anc1.get(i1 - 1);
            SNode node2=anc2.get(i2 - 1);
            if (fromSameCollection(node1,node2)) {
              return compareWithoutEditor(ancestor,node1,node2);
            }
 else {
              return compareWithEditor(ancestor,node1,node2);
            }
          }
        }
      }
      return 0;
    }
  }
;
}
