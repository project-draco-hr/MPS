{
  if (SNodeOperations.getContainingLinkRole(n1) == null) {
    return n1.getPresentation().compareTo(n2.getPresentation());
  }
  if (SNodeOperations.getContainingLinkRole(n1).equals(SNodeOperations.getContainingLinkRole(n2))) {
    return SNodeOperations.getIndexInParent(n1) - SNodeOperations.getIndexInParent(n2);
  }
  SNode l1=SNodeOperations.getContainingLinkDeclaration(n1);
  SNode l2=SNodeOperations.getContainingLinkDeclaration(n2);
  for (SNode p=SNodeOperations.getParent(n1); (p != null); p=SNodeOperations.getParent(p)) {
    SNode editor=((SNode)BehaviorManager.getInstance().invoke(Object.class,SNodeOperations.getConceptDeclaration(p),"call_findConceptAspect_8360039740498068384",new Class[]{SNode.class,LanguageAspect.class},LanguageAspect.EDITOR));
    for (    SNode cell : ListSequence.fromList(SNodeOperations.getDescendants(editor,"jetbrains.mps.lang.editor.structure.CellModel_WithRole",false,new String[]{}))) {
      if (SLinkOperations.getTarget(cell,"relationDeclaration",false) == l1) {
        return -1;
      }
      if (SLinkOperations.getTarget(cell,"relationDeclaration",false) == l2) {
        return 1;
      }
    }
  }
  return SNodeOperations.getContainingLinkRole(n1).compareTo(SNodeOperations.getContainingLinkRole(n2));
}
