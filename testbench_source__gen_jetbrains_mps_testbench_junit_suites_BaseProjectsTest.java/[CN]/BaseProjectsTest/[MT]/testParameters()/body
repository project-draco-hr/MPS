{
  EnvironmentConfig defaultConfig=EnvironmentConfig.defaultConfig();
  defaultConfig.addPlugin(MIGRATION_PLUGIN,MIGRATION_PLUGIN_ID);
  ourEnv=IdeaEnvironment.getOrCreate(defaultConfig);
  String projectsDir=System.getProperty("projects_dir");
  VirtualFile projectsRoot=LocalFileSystem.getInstance().findFileByPath(projectsDir);
  final List<Object[]> projects=new ArrayList<Object[]>();
  VfsUtil.processFilesRecursively(projectsRoot,new Processor<VirtualFile>(){
    public boolean process(    VirtualFile file){
      if (!(file.isValid()) || !(file.isDirectory())) {
        return true;
      }
      if (!(file.getName().equals(com.intellij.openapi.project.Project.DIRECTORY_STORE_FOLDER))) {
        return true;
      }
      projects.add(new String[]{file.getParent().getPath()});
      return true;
    }
  }
);
  TestMakeUtil.make(null);
  return projects;
}
