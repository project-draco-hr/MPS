{
  myProject=ourEnv.openProject(new File(myProjectDir));
  ourEnv.flushAllEvents();
  com.intellij.openapi.project.Project ideaProject=ProjectHelper.toIdeaProject(myProject);
  StartupManager.getInstance(ideaProject).registerPostStartupActivity(new Runnable(){
    public void run(){
      checkPostStartup=true;
    }
  }
);
  DumbService.getInstance(ideaProject).runWhenSmart(new Runnable(){
    public void run(){
      checkSmartMode=true;
    }
  }
);
  while (!(checkPostStartup) || !(checkSmartMode)) {
    ourEnv.flushAllEvents();
  }
}
