{
  final Wrappers._T<MPSCompilationResult> mpsCompilationResult=new Wrappers._T<MPSCompilationResult>();
  (p == null ? MPSModuleRepository.getInstance() : p.getRepository()).getModelAccess().runReadAction(new Runnable(){
    public void run(){
      ModuleMaker maker=new ModuleMaker();
      mpsCompilationResult.value=maker.make(IterableUtil.asCollection(MPSModuleRepository.getInstance().getModules()),new EmptyProgressMonitor(),JavaCompilerOptionsComponent.DEFAULT_JAVA_COMPILER_OPTIONS);
    }
  }
);
  if (mpsCompilationResult.value.isReloadingNeeded()) {
    ModelAccess.instance().runWriteAction(new Runnable(){
      public void run(){
        ClassLoaderManager.getInstance().reloadModules(mpsCompilationResult.value.getChangedModules());
      }
    }
);
  }
}
