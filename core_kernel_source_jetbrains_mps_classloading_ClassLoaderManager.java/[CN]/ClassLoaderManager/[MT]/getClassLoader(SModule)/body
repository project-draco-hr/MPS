{
  CustomClassLoadingFacet customClassLoadingFacet=module.getFacet(CustomClassLoadingFacet.class);
  if (customClassLoadingFacet != null) {
    if (customClassLoadingFacet.isValid()) {
      return customClassLoadingFacet.getClassLoader();
    }
 else {
      return null;
    }
  }
  if (!ModuleClassLoaderSupport.canCreate(module)) {
    return null;
  }
  if (!module.getFacet(JavaModuleFacet.class).isCompileInMps()) {
    LOG.warning("Module " + module.getModuleName() + " is not compiled in mps and doesn't have nonreloadable facet");
    return ClassLoaderManager.class.getClassLoader();
  }
  return myClassLoaders.get(module);
}
