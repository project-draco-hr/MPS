{
  TargetRange.TargetRefs refs=MapSequence.<ITarget.Name,TargetRange.TargetRefs>fromMap(allRefs).get(trg.getName());
  if (refs == null) {
    refs=new TargetRange.TargetRefs();
    MapSequence.<ITarget.Name,TargetRange.TargetRefs>fromMap(allRefs).put(trg.getName(),refs);
  }
  ListSequence.<ITarget.Name>fromList(refs.before).addSequence(Sequence.<ITarget.Name>fromIterable(trg.before()).concat(Sequence.<ITarget.Name>fromIterable(trg.notAfter())));
  ListSequence.<ITarget.Name>fromList(refs.after).addSequence(Sequence.<ITarget.Name>fromIterable(trg.after()).concat(Sequence.<ITarget.Name>fromIterable(trg.notBefore())));
  for (  ITarget.Name bf : ListSequence.<ITarget.Name>fromList(refs.before)) {
    if (MapSequence.fromMap(allRefs).containsKey(bf)) {
      ListSequence.<ITarget.Name>fromList(MapSequence.<ITarget.Name,TargetRange.TargetRefs>fromMap(allRefs).get(bf).after).addElement(trg.getName());
    }
  }
  for (  ITarget.Name bf : ListSequence.<ITarget.Name>fromList(refs.after)) {
    if (MapSequence.fromMap(allRefs).containsKey(bf)) {
      ListSequence.<ITarget.Name>fromList(MapSequence.<ITarget.Name,TargetRange.TargetRefs>fromMap(allRefs).get(bf).before).addElement(trg.getName());
    }
  }
  for (  IMapping<ITarget.Name,TargetRange.TargetRefs> m : MapSequence.<ITarget.Name,TargetRange.TargetRefs>fromMap(allRefs)) {
    if (ListSequence.<ITarget.Name>fromList(m.value().before).contains(trg.getName()) && !(ListSequence.<ITarget.Name>fromList(refs.after).contains(m.key()))) {
      ListSequence.<ITarget.Name>fromList(refs.after).addElement(m.key());
    }
    if (ListSequence.<ITarget.Name>fromList(m.value().after).contains(trg.getName()) && !(ListSequence.<ITarget.Name>fromList(refs.before).contains(m.key()))) {
      ListSequence.<ITarget.Name>fromList(refs.before).addElement(m.key());
    }
  }
}
