{
  removeAll();
  ActionEventData data=new ActionEventData(event);
  List<Language> modelLanguages=data.getModelDescriptor() == null ? new ArrayList<Language>() : data.getModelDescriptor().getSModel().getLanguages(data.getOperationContext().getScope());
  if (modelLanguages.size() == 0) {
    add(new BaseAction("<NO LANGUAGES>"){
      protected void doExecute(      AnActionEvent e){
      }
    }
);
  }
  LanguageAspect aspect=Language.getModelAspect(data.getModelDescriptor());
  if (aspect != null) {
    ModuleReference ref=aspect.getMainLanguage();
    Language lang=data.getScope().getLanguage(ref);
    modelLanguages.remove(lang);
    for (    ConceptDeclaration conceptDeclaration : lang.getConceptDeclarations()) {
      if (ModelConstraintsManager.getInstance().canBeARoot(data.getOperationContext(),NameUtil.nodeFQName(conceptDeclaration),data.getModelDescriptor().getSModel())) {
        add(newRootNodeAction(new SNodePointer(conceptDeclaration),data.getModelDescriptor()));
      }
    }
    addSeparator();
  }
  Collections.sort(modelLanguages,new ToStringComparator());
  boolean plain=myPlain || modelLanguages.size() == 1;
  for (  final Language language : modelLanguages) {
    String name=language.getNamespace();
    Icon icon=IconManager.getIconFor(language.getNamespace());
    BaseGroup langRootsGroup;
    if (!plain) {
      langRootsGroup=new BaseGroup(name,name,icon);
      langRootsGroup.setPopup(true);
    }
 else {
      langRootsGroup=this;
    }
    boolean hasChildren=false;
    for (    ConceptDeclaration conceptDeclaration : language.getConceptDeclarations()) {
      if (ModelConstraintsManager.getInstance().canBeARoot(data.getOperationContext(),NameUtil.nodeFQName(conceptDeclaration),data.getModelDescriptor().getSModel())) {
        langRootsGroup.add(newRootNodeAction(new SNodePointer(conceptDeclaration),data.getModelDescriptor()));
        hasChildren=true;
      }
    }
    if (hasChildren) {
      if (!plain) {
        this.add(langRootsGroup);
      }
 else {
        this.addSeparator();
      }
    }
  }
  Integer selectedItemsCount=MPSDataKeys.SELECTED_ITEMS_NUM.getData(event.getDataContext());
  boolean enabled=selectedItemsCount != null && selectedItemsCount == 1;
  setEnabledState(event.getPresentation(),enabled);
}
