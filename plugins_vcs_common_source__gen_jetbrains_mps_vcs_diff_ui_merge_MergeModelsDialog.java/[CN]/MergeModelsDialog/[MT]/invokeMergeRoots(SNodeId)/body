{
  if (myMergeRootsDialog != null) {
    return;
  }
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      MergeSession mergeSession=(rootId == null ? myMetadataMergeSession : myMergeSession);
      SNodeId nodeId=(rootId == null ? ListSequence.fromList(SModelOperations.getRoots(myMetadataMergeSession.getBaseModel(),null)).first().getNodeId() : rootId);
      myRootId=rootId;
      myMergeRootsDialog=new MergeRootsDialog(myProject,mergeSession,nodeId,myMergeTree.getNameForRoot(rootId),getContentTitles(),getWindow(),new MergeModelsDialog.MyGoToNeighbourRootActions().getActions());
    }
  }
);
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      myMergeRootsDialog.toFront();
    }
  }
);
  boolean isOk=myMergeRootsDialog.showAndGet();
  if (!(isOk)) {
    ModelAccess.instance().runWriteActionInCommand(new Runnable(){
      public void run(){
        myMergeRootsDialog.restoreState();
      }
    }
);
  }
  applyMetadataChanges();
  myMergeRootsDialog=null;
  rebuildLater();
}
