{
  List<ModelChange> changes=(rootTreeNode.getRootId() == null ? ListSequence.fromList(myMergeSession.getMetadataChanges()).select(new ISelector<ModelChange,ModelChange>(){
    public ModelChange select(    ModelChange ch){
      return (ModelChange)ch;
    }
  }
).toListSequence() : myMergeSession.getChangesForRoot(rootTreeNode.getRootId()));
  changes=ListSequence.fromList(changes).where(new IWhereFilter<ModelChange>(){
    public boolean accept(    ModelChange ch){
      return !(myMergeSession.isChangeResolved(ch));
    }
  }
).toListSequence();
  int conflictedCount=ListSequence.fromList(changes).where(new IWhereFilter<ModelChange>(){
    public boolean accept(    ModelChange ch){
      return Sequence.fromIterable(myMergeSession.getConflictedWith(ch)).isNotEmpty();
    }
  }
).count();
  int nonConflictedCount=ListSequence.fromList(changes).count() - conflictedCount;
  ChangeType compositeChangeType=null;
  rootTreeNode.setTooltipText(generateUnresolvedChangesText(ListSequence.fromList(changes).count(),conflictedCount));
  if (conflictedCount != 0) {
    compositeChangeType=ChangeType.CONFLICTED;
    rootTreeNode.setAdditionalText("with conflicts");
  }
 else {
    if (nonConflictedCount == 0) {
      if (rootTreeNode.getRootId() != null && myMergeSession.getResultModel().getNodeById(rootTreeNode.getRootId()) == null) {
        rootTreeNode.setTextStyle(SimpleTextAttributes.STYLE_STRIKEOUT);
      }
    }
 else {
      compositeChangeType=ChangeType.CHANGE;
      if (ListSequence.fromList(changes).all(new IWhereFilter<ModelChange>(){
        public boolean accept(        ModelChange ch){
          return ch instanceof AddRootChange || ch instanceof DeleteRootChange;
        }
      }
)) {
        compositeChangeType=ListSequence.fromList(changes).first().getType();
      }
      int myChangesCount=ListSequence.fromList(changes).where(new IWhereFilter<ModelChange>(){
        public boolean accept(        ModelChange ch){
          return myMergeSession.isMyChange(ch);
        }
      }
).count();
      if (myChangesCount == nonConflictedCount) {
        rootTreeNode.setAdditionalText("local");
      }
 else       if (myChangesCount == 0) {
        rootTreeNode.setAdditionalText("remote");
      }
 else {
        rootTreeNode.setAdditionalText("both modified");
      }
    }
  }
  if (compositeChangeType != null) {
    rootTreeNode.setColor(ChangeColors.getForTree(compositeChangeType));
  }
}
