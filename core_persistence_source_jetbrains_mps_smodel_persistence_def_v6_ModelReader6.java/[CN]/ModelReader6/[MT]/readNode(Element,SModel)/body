{
  String conceptFqName=myHelper.readType(nodeElement.getAttributeValue(ModelPersistence.TYPE));
  jetbrains.mps.smodel.SNode node=new jetbrains.mps.smodel.SNode(InternUtil.intern(conceptFqName));
  String idValue=nodeElement.getAttributeValue(ModelPersistence.ID);
  if (idValue != null) {
    SNodeId id=jetbrains.mps.smodel.SNodeId.fromString(idValue);
    if (id == null) {
      LOG.error("invalid id string");
      return null;
    }
    node.setId(id);
  }
  for (  Element element : (List<Element>)nodeElement.getChildren(ModelPersistence.PROPERTY)) {
    String propertyName=myHelper.readName(element.getAttributeValue(ModelPersistence.NAME));
    String propertyValue=element.getAttributeValue(ModelPersistence.VALUE);
    if (propertyValue != null) {
      SNodeAccessUtil.setProperty(node,propertyName,propertyValue);
    }
  }
  for (  Element link : (List<Element>)nodeElement.getChildren(ModelPersistence.LINK)) {
    String role=link.getAttributeValue(ModelPersistence.ROLE);
    String target=link.getAttributeValue(ModelPersistence.TARGET_NODE_ID);
    String resolveInfo=link.getAttributeValue(ModelPersistence.RESOLVE_INFO);
    SReference reference=myHelper.readLink(node,role,target,resolveInfo);
    if (reference != null)     node.setReference(reference.getRole(),reference);
  }
  for (  Element child : (List<Element>)nodeElement.getChildren(ModelPersistence.NODE)) {
    String role=myHelper.readRole(child.getAttributeValue(ModelPersistence.ROLE));
    SNode childNode=readNode(child,model);
    if (role == null || childNode == null) {
      LOG.errorWithTrace("Error reading child node in node " + SNodeUtil.getDebugText(node));
    }
 else {
      node.addChild(role,childNode);
    }
  }
  return node;
}
