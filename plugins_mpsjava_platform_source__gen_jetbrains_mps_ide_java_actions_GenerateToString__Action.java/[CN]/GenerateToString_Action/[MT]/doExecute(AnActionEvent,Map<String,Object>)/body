{
  final SNode classConcept=GenerateToString_Action.this.getClassConcept(_params);
  final Wrappers._T<SNodeReference[]> fields=new Wrappers._T<SNodeReference[]>();
  ((EditorContext)MapSequence.fromMap(_params).get("editorContext")).getRepository().getModelAccess().runReadAction(new Runnable(){
    public void run(){
      fields.value=Sequence.fromIterable(((Iterable<SNode>)BHReflection.invoke(classConcept,SMethodTrimmedId.create("fields",MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8c108ca66L,"jetbrains.mps.baseLanguage.structure.ClassConcept"),"4_LVZ3pC27C")))).select(new ISelector<SNode,SNodeReference>(){
        public SNodeReference select(        SNode it){
          return SNodeOperations.getPointer(it);
        }
      }
).toGenericArray(SNodeReference.class);
    }
  }
);
  SelectFieldsDialog selectFieldsDialog=new SelectFieldsDialog(fields.value,true,((MPSProject)MapSequence.fromMap(_params).get("mpsProject")));
  selectFieldsDialog.setTitle("Generate toString");
  selectFieldsDialog.show();
  if (!(selectFieldsDialog.isOK())) {
    return;
  }
  SNodeReference[] selectedFields=Sequence.fromIterable(((Iterable<SNodeReference>)selectFieldsDialog.getSelectedElements())).toGenericArray(SNodeReference.class);
  final SNode rightmostExpression;
  SNodeReference firstField=(selectedFields != null && selectedFields.length > 0 ? selectedFields[0] : null);
  SNode currentExpression=null;
  for (  SNodeReference fieldPtr : selectedFields) {
    SNode field=SNodeOperations.cast(fieldPtr.resolve(((MPSProject)MapSequence.fromMap(_params).get("mpsProject")).getRepository()),MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8c108ca68L,"jetbrains.mps.baseLanguage.structure.FieldDeclaration"));
    SNode fieldRef=SNodeFactoryOperations.createNewNode(SNodeFactoryOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8c77f1e98L,"jetbrains.mps.baseLanguage.structure.VariableReference")),null);
    SLinkOperations.setTarget(fieldRef,MetaAdapterFactory.getReferenceLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8c77f1e98L,0xf8cc6bf960L,"variableDeclaration"),field);
    SNode item=_quotation_createNode_satqj4_a0d0p0a(((fieldPtr == firstField ? "" : ", ")) + SPropertyOperations.getString(field,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name")) + "=");
    if (fieldPtr == firstField) {
      currentExpression=_quotation_createNode_satqj4_a0a0e0p0a(SPropertyOperations.getString(classConcept,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name")) + "{",item);
      currentExpression=_quotation_createNode_satqj4_a0b0e0p0a(fieldRef,currentExpression);
    }
 else {
      currentExpression=_quotation_createNode_satqj4_a0a0a4a51a0(item,currentExpression);
      currentExpression=_quotation_createNode_satqj4_a0b0a4a51a0(fieldRef,currentExpression);
    }
  }
  if (selectedFields == null || selectedFields.length == 0) {
    rightmostExpression=_quotation_createNode_satqj4_a0a0q0a(SPropertyOperations.getString(classConcept,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name")) + "{}");
  }
 else {
    rightmostExpression=_quotation_createNode_satqj4_a0a0a61a0(currentExpression);
  }
  SNode method=ListSequence.fromList(SLinkOperations.getChildren(classConcept,MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x101d9d3ca30L,0x4a9a46de59132803L,"member"))).addElement(_quotation_createNode_satqj4_a0a0r0a(rightmostExpression));
  ((EditorContext)MapSequence.fromMap(_params).get("editorContext")).select(method);
}
