{
  final String fqName=getCurrentValue();
  if (!((SourceVersion.isName(SModelStereotype.withoutStereotype(fqName))))) {
    setErrorText("Model name should be valid Java package");
    return;
  }
  if (!((fqName.equals(myModelDescriptor.getSModelReference().getSModelFqName())))) {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        DeleteModelHelper.deleteGeneratedFiles(myModelDescriptor);
      }
    }
);
    final ModelRenamer renamer=new ModelRenamer(myModelDescriptor,fqName,!(myUpdateAllReferences.getModel().isSelected()));
    ModelAccess.instance().runWriteActionInCommand(new Runnable(){
      public void run(){
        renamer.rename();
      }
    }
);
    ProgressManager.getInstance().run(new Task.Modal(myProject,"Updating model usages...",false){
      @Override public void run(      @NotNull ProgressIndicator indicator){
        indicator.pushState();
        indicator.setIndeterminate(true);
        try {
          ModelAccess.instance().runWriteAction(new Runnable(){
            public void run(){
              renamer.updateReferencesIfNeeded();
            }
          }
);
        }
  finally {
          indicator.popState();
        }
      }
    }
);
  }
  super.doRefactoringAction();
}
