{
  if (!(node.getConcept().isValid())) {
    return IdeIcons.UNKNOWN_ICON;
  }
  boolean withoutAdditional=false;
  Icon mainIcon=null;
  SNode concept=SNodeOperations.getConceptDeclaration(node);
  if (SNodeOperations.isInstanceOf(concept,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979ba0450L,"jetbrains.mps.lang.structure.structure.ConceptDeclaration"))) {
    SNode cd=((SNode)concept);
    String alternativeIconPath=ConceptRegistry.getInstance().getConstraintsDescriptor(NameUtil.nodeFQName(concept)).getAlternativeIcon(node);
    if (alternativeIconPath != null) {
      mainIcon=getIcon(SModelUtil.getDeclaringLanguage(concept),alternativeIconPath);
    }
    if (mainIcon == null) {
      mainIcon=getIcon(concept);
    }
  }
  if (mainIcon == null) {
    if (jetbrains.mps.util.SNodeOperations.isRoot(node)) {
      return IdeIcons.DEFAULT_ROOT_ICON;
    }
 else {
      return IdeIcons.DEFAULT_NODE_ICON;
    }
  }
  SModel model=SNodeOperations.getModel(node);
  if (model == null || jetbrains.mps.util.SNodeOperations.isModelDisposed(model)) {
    return mainIcon;
  }
  if (!(SModelStereotype.isUserModel(model)) || model instanceof EditableSModel && model.isReadOnly()) {
    mainIcon=new LayeredIcon(mainIcon,PlatformIcons.LOCKED_ICON);
  }
  RowIcon result=new RowIcon(2);
  result.setIcon(mainIcon,0);
  if (!(withoutAdditional)) {
    result.setIcon(BehaviorReflection.invokeVirtual(Icon.class,node,"virtual_getAdditionalIcon_5017341185733863694",new Object[]{}),1);
  }
  List<Icon> markIcons=BehaviorReflection.invokeVirtual((Class<List<Icon>>)((Class)Object.class),node,"virtual_getMarkIcons_3923831204883340393",new Object[]{});
  if (markIcons != null) {
    LayeredIcon layeredIcon=new LayeredIcon(markIcons.size() + 1);
    layeredIcon.setIcon(result,0);
    for (int i=0; i < markIcons.size(); i++) {
      layeredIcon.setIcon(markIcons.get(i),i + 1);
    }
    return layeredIcon;
  }
  return result;
}
