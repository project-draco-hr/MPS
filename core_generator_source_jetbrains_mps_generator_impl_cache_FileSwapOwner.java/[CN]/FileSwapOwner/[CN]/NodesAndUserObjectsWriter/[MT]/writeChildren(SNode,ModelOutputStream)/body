{
  Map<Object,Object> userObjects=node.getUserObjects();
  ArrayList<Object> knownUserObject=new ArrayList<Object>();
  for (  Object key : userObjects.keySet()) {
    Object value=userObjects.get(key);
    if (isKnownUserObject(key) && isKnownUserObject(value)) {
      knownUserObject.add(key);
      knownUserObject.add(value);
    }
 else {
      LOG.debug("Going to loose user object " + key + " = "+ value+ " for node "+ node+ " since key or value is not Serializable or not known to MPS.");
    }
  }
  os.writeInt(knownUserObject.size());
  for (int i=0; i < knownUserObject.size(); i+=2) {
    writeUserObject(os,knownUserObject.get(i));
    writeUserObject(os,knownUserObject.get(i + 1));
  }
  super.writeChildren(node,os);
}
