{
  NodesWriter writer=new NodesWriter(node.getModel().getReference(),null);
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  ModelOutputStream mos=new ModelOutputStream(os);
  writer.writeNode(node,mos);
  mos.close();
  NodesReader reader=new NodesReader(node.getModel().getReference(),null,false);
  ByteArrayInputStream is=new ByteArrayInputStream(os.toByteArray());
  return reader.readNode(((jetbrains.mps.smodel.SNode)node).getPersistentModel(),new ModelInputStream(is)).o2;
}
