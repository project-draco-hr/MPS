{
  final SModelReference modelReference=node.getModel().getReference();
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  ModelOutputStream mos=new ModelOutputStream(os);
  BareNodeWriter writer=new BareNodeWriter(modelReference,mos);
  writer.writeNode(node);
  mos.close();
  ByteArrayInputStream is=new ByteArrayInputStream(os.toByteArray());
  BareNodeReader reader=new BareNodeReader(modelReference,new ModelInputStream(is));
  return reader.readNode(null);
}
