{
  myResults=new SearchResults<SNode>();
  IScope queryScope=query.getScope();
  List<BaseMigrationScript> scriptInstances=MigrationScriptUtil.getScriptInstances(myScripts,myOperationContext);
  monitor.start("Searching applicable nodes",scriptInstances.size());
  try {
    for (    BaseMigrationScript scriptInstance : scriptInstances) {
      if (monitor.isCanceled()) {
        break;
      }
      List<AbstractMigrationRefactoring> refactorings=scriptInstance.getRefactorings();
      for (      AbstractMigrationRefactoring migrationRefactoring : refactorings) {
        if (monitor.isCanceled()) {
          break;
        }
        monitor.step(scriptInstance.getName() + " [" + migrationRefactoring.getAdditionalInfo()+ "]");
        Set<SNode> instances=FindUsagesManager.getInstance().findInstances(MigrationScriptUtil.getApplicableConcept(migrationRefactoring),queryScope,null,false);
        for (        SNode instance : instances) {
          if (monitor.isCanceled()) {
            break;
          }
          if (MigrationScriptUtil.isApplicableRefactoring(instance,migrationRefactoring)) {
            String category=TreeTextUtil.toHtml(scriptInstance.getName()) + " </b>[" + TreeTextUtil.toHtml(migrationRefactoring.getAdditionalInfo())+ "]<b>";
            SearchResult<SNode> result=new SearchResult<SNode>(instance,category);
            myMigrationBySearchResult.put(result,migrationRefactoring);
            myResults.getSearchResults().add(result);
          }
        }
      }
      monitor.advance(1);
    }
    if (myMigrationScriptsView != null) {
      myMigrationScriptsView.searchResultsChanged();
    }
    return myResults;
  }
  finally {
    monitor.done();
  }
}
