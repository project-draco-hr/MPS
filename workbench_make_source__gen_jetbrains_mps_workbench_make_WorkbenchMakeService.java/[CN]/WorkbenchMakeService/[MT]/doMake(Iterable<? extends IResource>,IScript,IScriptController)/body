{
  String scrName=((cleanMake ? "Rebuild" : "Make"));
  WorkbenchMakeService.MessageHandler mh=new WorkbenchMakeService.MessageHandler("Make");
  mh.clear();
  if (Sequence.fromIterable(inputRes).isEmpty()) {
    if (cleanMake) {
      String msg=scrName + " aborted: nothing to do";
      this.showError(mh,msg);
      this.displayInfo(msg);
      return new FutureValue(new IResult.FAILURE(null));
    }
 else {
      this.displayInfo("Everything up to date");
      return new FutureValue(new IResult.SUCCESS(null));
    }
  }
  if (!(script.isValid())) {
    String msg=scrName + " failed";
    showError(mh,msg + ". Invalid script.");
    this.displayInfo(msg);
    return new FutureValue(new IResult.FAILURE(null));
  }
  final Wrappers._T<Iterable<? extends Iterable<IResource>>> clInput=new Wrappers._T<Iterable<? extends Iterable<IResource>>>();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      clInput.value=new ModulesClusterizer().clusterize(Sequence.fromIterable(inputRes).<IResource>select(new ISelector<IResource,IResource>(){
        public IResource select(        IResource r){
          return (IResource)r;
        }
      }
));
    }
  }
);
  IScriptController ctl=this.completeController(scrName,mh,controller);
  final WorkbenchMakeService.MakeTask task=new WorkbenchMakeService.MakeTask(context.getProject(),scrName,script,scrName,clInput.value,ctl,mh);
  doExecute(new Runnable(){
    public void run(){
      ThreadUtils.runInUIThreadAndWait(new Runnable(){
        public void run(){
          IdeEventQueue.getInstance().flushQueue();
          ProgressManager.getInstance().run(task);
        }
      }
);
    }
  }
);
  return task;
}
