{
  SNodeId id=getNodeIdForChange(change);
  if (id != null) {
    myNodesToChanges.put(id,change);
  }
 else {
    SetSequence.fromSet(myMetadataChanges).addElement((MetadataChange)change);
  }
  if (change instanceof AddRootChange) {
    MapSequence.fromMap(myAddedNodesToChanges).put(change.getRootId(),change);
  }
 else   if (change instanceof NodeGroupChange) {
    for (    SNodeId nodeId : Sequence.fromIterable(getNodeIdsForNodeGroupChange((NodeGroupChange)change,myLastParentAndNewChildrenIds))) {
      MapSequence.fromMap(myAddedNodesToChanges).put(nodeId,change);
    }
  }
}
