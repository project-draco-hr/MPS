{
  assertCanChange();
  myLanguageDescriptor=newDescriptor;
  SModuleReference reference=new jetbrains.mps.project.structure.modules.ModuleReference(myLanguageDescriptor.getNamespace(),myLanguageDescriptor.getId());
  setModuleReference(reference);
  setChanged();
  reloadAfterDescriptorChange();
  fireChanged();
  if (reloadClasses) {
    ClassLoaderManager.getInstance().reloadAll(new EmptyProgressMonitor());
  }
  MPSModuleRepository.getInstance().invalidateCaches();
  if (getStructureModelDescriptor() != null && myCachesInvalidator == null) {
    SModelListener listener=myCachesInvalidator=new CachesInvalidator();
    ((SModelInternal)getStructureModelDescriptor()).addModelListener(listener);
  }
  dependenciesChanged();
}
