{
  if (SNodeOperations.isInstanceOf(ListSequence.<SNode>fromList(parameteres.getNodesToRefactor()).first(),"jetbrains.mps.baseLanguage.structure.Expression")) {
    return new ExtractMethodFromExpressionRefactoring(parameteres);
  }
  if (ListSequence.<SNode>fromList(parameteres.getAnalyzer().getOutputVariables()).count() > 0) {
    return new ExtractMethodWithOutputVariable(parameteres);
  }
  SNode containerType=parameteres.getAnalyzer().getExtractMethodReafactoringProcessor().getContainerReturnType();
  if (parameteres.getAnalyzer().isAlwaysReturns() && containerType != null && !(SNodeOperations.isInstanceOf(containerType,"jetbrains.mps.baseLanguage.structure.VoidType"))) {
    return new ExtractMethodWithReturn(parameteres);
  }
  if (parameteres.getAnalyzer().hasExitPoints()) {
    return new ExtractMethodWithExitPoints(parameteres);
  }
  return new ExtractMethodFromStatementsRefactoring(parameteres);
}
