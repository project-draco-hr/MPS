{
  assertCanChange();
  ModuleDescriptor md=getModuleDescriptor();
  if (md == null) {
    return;
  }
  Map<SLanguage,Integer> oldLanguageVersions=md.getLanguageVersions();
  Map<SLanguage,Integer> newLanguageVersions=new HashMap<SLanguage,Integer>();
  Set<SLanguage> usedLanguages=new LinkedHashSet<SLanguage>();
  Set<SModuleReference> devkits=new LinkedHashSet<SModuleReference>();
  collectLanguagesAndDevkits(usedLanguages,devkits);
  final Set<SLanguage> allUsedLanguages=new SLanguageHierarchy(usedLanguages).getExtended();
  if (!md.hasLanguageVersions()) {
    for (    SLanguage lang : allUsedLanguages) {
      newLanguageVersions.put(lang,0);
    }
    md.getUsedDevkits().addAll(devkits);
    md.setHasLanguageVersions(true);
  }
 else {
    for (    SLanguage lang : allUsedLanguages) {
      if (oldLanguageVersions.containsKey(lang)) {
        newLanguageVersions.put(lang,oldLanguageVersions.get(lang));
      }
 else {
        checkModelVersionsAreValid(lang);
        newLanguageVersions.put(lang,lang.getLanguageVersion());
        if (md.hasDependencyVersions()) {
          setChanged();
        }
      }
    }
    if (!md.getUsedDevkits().containsAll(devkits)) {
      md.getUsedDevkits().addAll(devkits);
      setChanged();
    }
    if (!oldLanguageVersions.equals(newLanguageVersions)) {
      if (md.hasDependencyVersions()) {
        setChanged();
      }
    }
  }
  oldLanguageVersions.clear();
  oldLanguageVersions.putAll(newLanguageVersions);
}
