{
  IdeaPluginModuleFacetImpl facet=new IdeaPluginModuleFacetImpl();
  facet.setModule(module);
  facet.setPluginId(pluginId);
  Memento memento=new MementoImpl();
  facet.save(memento);
  ModuleFacetDescriptor facetDescriptor=new ModuleFacetDescriptor(facet.getFacetType(),memento);
  Iterator<ModuleFacetDescriptor> iterator=((AbstractModule)module).getModuleDescriptor().getModuleFacetDescriptors().iterator();
  while (iterator.hasNext()) {
    if (facet.getFacetType().equals(iterator.next().getType())) {
      iterator.remove();
      break;
    }
  }
  ((AbstractModule)module).getModuleDescriptor().getModuleFacetDescriptors().add(facetDescriptor);
  ((AbstractModule)module).save();
}
