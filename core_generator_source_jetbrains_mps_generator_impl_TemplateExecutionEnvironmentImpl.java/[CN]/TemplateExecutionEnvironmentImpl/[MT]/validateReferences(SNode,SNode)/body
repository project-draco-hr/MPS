{
  node.visitReferences(new ReferenceVisitor(){
    public boolean visitReference(    String role,    org.jetbrains.mps.openapi.model.SReference ref){
      SReference reference=(SReference)ref;
      if (generator.getInputModel().getSModelReference().equals(reference.getTargetSModelReference())) {
        ReferenceInfo_CopiedInputNode refInfo=new ReferenceInfo_CopiedInputNode(reference.getRole(),reference.getSourceNode(),inputNode,reference.getTargetNode());
        PostponedReference postponedReference=new PostponedReference(refInfo,generator);
        reference.getSourceNode().setReference(reference.getRole(),postponedReference);
      }
      return true;
    }
  }
);
  for (  SNode child : node.getChildren()) {
    validateReferences(child,inputNode);
  }
}
