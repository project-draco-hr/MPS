{
  final SNode inputNode=context.getInput();
  TemplateReductionRule reductionRule=null;
  TemplateReductionRule[] conceptRules=ruleFinder.findReductionRules(inputNode);
  if (conceptRules == null) {
    return null;
  }
  try {
    for (    TemplateReductionRule rule : conceptRules) {
      reductionRule=rule;
      if (!myReductionTrack.isReductionBlocked(inputNode,rule)) {
        if (rule instanceof TemplateRuleWithCondition) {
          if (!getQueryExecutor().isApplicable((TemplateRuleWithCondition)rule,context)) {
            continue;
          }
        }
        try {
          myReductionTrack.enter(inputNode,rule);
          Collection<SNode> outputNodes=getQueryExecutor().tryToApply(rule,this,context);
          if (outputNodes != null) {
            SNodeId in=context.getInput() == null ? null : context.getInput().getNodeId();
            getTrace().trace(in,GenerationTracerUtil.translateOutput(outputNodes),rule.getRuleNode());
            return outputNodes;
          }
        }
  finally {
          myReductionTrack.leave();
        }
      }
    }
  }
 catch (  AbandonRuleInputException ex) {
    return Collections.emptyList();
  }
catch (  DismissTopMappingRuleException ex) {
    if (ex.isLoggingNeeded() && reductionRule != null) {
      SNodeReference ruleNode=reductionRule.getRuleNode();
      String messageText=String.format("-- dismissed reduction rule: %s",ruleNode);
      if (ex.isInfo()) {
        getLogger().info(ruleNode,messageText);
      }
 else       if (ex.isWarning()) {
        getLogger().warning(ruleNode,messageText);
      }
 else {
        getLogger().error(ruleNode,messageText);
      }
    }
  }
catch (  TemplateProcessingFailureException ex) {
    SNodeReference ruleNode=reductionRule.getRuleNode();
    if (myFailedRules.add(ruleNode)) {
      getLogger().error(ruleNode,String.format("Reduction rule failed: %s",ex.getMessage()),ex.asProblemDescription());
    }
  }
catch (  GenerationFailureException ex) {
    throw ex;
  }
catch (  GenerationCanceledException ex) {
    if (getTracer().isTracing() && getLogger().needsInfo()) {
      getLogger().info("generation canceled when processing branch:");
      GeneratorUtil.logCurrentGenerationBranch(getLogger(),getTracer(),false);
    }
    throw ex;
  }
catch (  GenerationException ex) {
  }
  return null;
}
