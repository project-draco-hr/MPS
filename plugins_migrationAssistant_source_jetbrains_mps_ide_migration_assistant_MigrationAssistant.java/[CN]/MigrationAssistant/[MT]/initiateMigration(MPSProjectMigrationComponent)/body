{
  StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
    public void run(){
      if (migrationState.getCurrentStep() == 0) {
        LaterInvocator.invokeLater(new Runnable(){
          @Override public void run(){
            refresh();
            migrationState.setCurrentStep(1);
            ProjectManagerEx.getInstance().reloadProject(myProject);
          }
        }
);
        return;
      }
      LaterInvocator.invokeLater(new Runnable(){
        @Override public void run(){
          MigrationAssistantWizard wizard=new MigrationAssistantWizard(myProject);
          AsyncResult<Boolean> result=wizard.showAndGetOk();
          result.doWhenDone(new Handler<Boolean>(){
            @Override public void run(            Boolean ok){
              if (ok) {
                migrationState.migrationFinished();
              }
 else {
                forceCloseProject();
              }
            }
          }
);
        }
      }
,ModalityState.NON_MODAL);
    }
  }
);
}
