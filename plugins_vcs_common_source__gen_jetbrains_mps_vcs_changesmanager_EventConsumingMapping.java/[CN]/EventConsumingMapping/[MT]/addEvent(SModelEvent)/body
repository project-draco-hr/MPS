{
  SNode affectedNode=null;
  SNode addedNode=null;
  if (event instanceof SModelRootEvent) {
    SModelRootEvent re=(SModelRootEvent)event;
    affectedNode=re.getRoot();
    if (re.isAdded()) {
      addedNode=affectedNode;
    }
  }
 else   if (event instanceof SModelChildEvent) {
    SModelChildEvent ce=(SModelChildEvent)event;
    affectedNode=ce.getParent();
    if (ce.isAdded()) {
      addedNode=ce.getChild();
    }
  }
 else   if (event instanceof SModelPropertyEvent) {
    affectedNode=((SModelPropertyEvent)event).getNode();
  }
 else   if (event instanceof SModelReferenceEvent) {
    affectedNode=((SModelReferenceEvent)event).getReference().getSourceNode();
  }
  if (affectedNode == null) {
    myNodesToUnconsumedEvents.put(null,event);
    return;
  }
  if (!(myAddedNodesToEvents.containsKey(affectedNode.getNodeId()))) {
    if (event instanceof SModelRootEvent) {
      SModelRootEvent rootEvent=(SModelRootEvent)event;
      if (rootEvent.isRemoved()) {
        consumeAllForNode(affectedNode);
      }
    }
 else     if (event instanceof SModelChildEvent) {
      SModelChildEvent childEvent=(SModelChildEvent)event;
      SNode child=childEvent.getChild();
      if (childEvent.isRemoved()) {
        consumeAllForNode(child);
      }
    }
    myNodesToUnconsumedEvents.put(affectedNode.getNodeId(),event);
  }
  if (addedNode != null) {
    myAddedNodesToEvents.put(addedNode.getNodeId(),event);
  }
}
