{
  if (ApplicationManager.getApplication().isReadAccessAllowed() && !ApplicationManager.getApplication().isWriteAccessAllowed()) {
    throw new IllegalStateException("Write actions inside of write action");
  }
  runWriteAction(new Computable<Object>(){
    public Object compute(){
      r.run();
      return null;
    }
  }
);
}
