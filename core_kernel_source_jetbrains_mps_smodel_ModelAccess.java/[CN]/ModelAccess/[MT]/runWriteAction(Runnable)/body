{
  ApplicationEx application=(ApplicationEx)ApplicationManager.getApplication();
  if (application.holdsReadLock() && !application.isWriteAccessAllowed()) {
    throw new IllegalStateException("Write actions inside of read action");
  }
  runWriteAction(new Computable<Object>(){
    public Object compute(){
      r.run();
      return null;
    }
  }
);
}
