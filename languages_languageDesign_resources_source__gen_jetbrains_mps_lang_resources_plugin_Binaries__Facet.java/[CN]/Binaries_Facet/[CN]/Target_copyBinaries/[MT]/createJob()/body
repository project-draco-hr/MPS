{
  return new IJob.Stub(){
    @Override public IResult execute(    final Iterable<IResource> rawInput,    final IJobMonitor monitor,    final IPropertiesAccessor pa,    @NotNull final ProgressMonitor progressMonitor){
      Iterable<IResource> _output_8acy7z_a0a=null;
      final Iterable<MResource> input=(Iterable<MResource>)(Iterable)rawInput;
switch (0) {
case 0:
        progressMonitor.start("Copying resources",2);
      progressMonitor.step("Collecting");
    try {
      final List<IDelta> deltaList=ListSequence.fromList(new ArrayList<IDelta>());
      final Iterable<Tuples._2<IFile,IFile>> filesToCopy=Sequence.fromIterable(input).translate(new ITranslator2<MResource,Tuples._2<IFile,IFile>>(){
        public Iterable<Tuples._2<IFile,IFile>> translate(        MResource res){
          final SModule module=res.module();
          Iterable<Tuples._2<IFile,IFile>> seq=Sequence.fromIterable(res.models()).translate(new ITranslator2<SModel,Tuples._2<IFile,IFile>>(){
            public Iterable<Tuples._2<IFile,IFile>> translate(            SModel smd){
              SModel model=smd;
              String output=SModuleOperations.getOutputPathFor(smd);
              if (output == null) {
                monitor.reportFeedback(new IFeedback.ERROR(String.valueOf("no output location for " + SNodeOperations.getModelLongName(smd))));
                return Sequence.fromIterable(Collections.<Tuples._2<IFile,IFile>>emptyList());
              }
              IFile outputRoot=Target_make.vars(pa.global()).pathToFile().invoke(output);
              final IFile outputDir=FileGenerationUtil.getDefaultOutputDir(model,outputRoot);
              final FilesDelta fd=new FilesDelta(outputDir);
              ListSequence.fromList(deltaList).addElement(fd);
              new StaleFilesCollector(outputDir).updateDelta(fd);
              return ListSequence.fromList(SModelOperations.getNodes(model,"jetbrains.mps.lang.resources.structure.Resource")).where(new IWhereFilter<SNode>(){
                public boolean accept(                SNode it){
                  return isNotEmptyString(SPropertyOperations.getString(it,MetaAdapterFactory.getProperty(new UUID(-7480838662350550057l,-7394046985400605979l),8974276187400029898l,8974276187400029899l,"path")));
                }
              }
).select(new ISelector<SNode,String>(){
                public String select(                SNode bin){
                  return MacrosFactory.forModule((AbstractModule)module).expandPath(SPropertyOperations.getString(bin,MetaAdapterFactory.getProperty(new UUID(-7480838662350550057l,-7394046985400605979l),8974276187400029898l,8974276187400029899l,"path")));
                }
              }
).where(new IWhereFilter<String>(){
                public boolean accept(                String p){
                  return p != null;
                }
              }
).select(new ISelector<String,Tuples._2<IFile,IFile>>(){
                public Tuples._2<IFile,IFile> select(                String p){
                  IFile fromFile=FileSystem.getInstance().getFileByPath(p);
                  IFile toFile=outputDir.getDescendant(fromFile.getName());
                  if (!(fromFile.exists())) {
                    monitor.reportFeedback(new IFeedback.ERROR(String.valueOf("file not found " + fromFile.getPath())));
                    return null;
                  }
                  if (!(toFile.exists()) && !(toFile.createNewFile())) {
                    monitor.reportFeedback(new IFeedback.ERROR(String.valueOf("cannot write to file " + toFile)));
                    return null;
                  }
                  fd.written(toFile);
                  return MultiTuple.<IFile,IFile>from(fromFile,toFile);
                }
              }
).where(new IWhereFilter<Tuples._2<IFile,IFile>>(){
                public boolean accept(                Tuples._2<IFile,IFile> it){
                  return it != null;
                }
              }
);
            }
          }
);
          return seq;
        }
      }
);
      _output_8acy7z_a0a=Sequence.fromIterable(_output_8acy7z_a0a).concat(Sequence.fromIterable(Sequence.<IResource>singleton(new DResource(deltaList))));
      progressMonitor.advance(1);
      progressMonitor.step("Copying content");
      ThreadUtils.runInUIThreadAndWait(new Runnable(){
        public void run(){
          ModelAccess.instance().requireWrite(new Runnable(){
            @Override public void run(){
              Sequence.fromIterable(filesToCopy).toListSequence().visitAll(new IVisitor<Tuples._2<IFile,IFile>>(){
                public void visit(                Tuples._2<IFile,IFile> ftc){
                  IFileUtils.copyFileContent(ftc._0(),ftc._1());
                }
              }
);
            }
          }
);
        }
      }
);
    }
  finally {
      progressMonitor.done();
    }
default :
  return new IResult.SUCCESS(_output_8acy7z_a0a);
}
}
}
;
}
