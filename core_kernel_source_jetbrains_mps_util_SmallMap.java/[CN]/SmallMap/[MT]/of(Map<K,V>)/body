{
  if (map.size() == 0) {
    return Collections.emptyMap();
  }
 else   if (map.size() == 1) {
    K key=map.keySet().iterator().next();
    return Collections.singletonMap(key,map.get(key));
  }
 else   if (map.size() < 10) {
    return new ArrayListBasedImmutableMap<K,V>(map);
  }
 else {
    return new HashMap<K,V>(map);
  }
}
