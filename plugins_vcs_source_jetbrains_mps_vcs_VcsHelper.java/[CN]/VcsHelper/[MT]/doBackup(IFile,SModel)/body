{
  File tmp=jetbrains.mps.util.FileUtil.createTmpDir();
  VcsHelperUtil.writeContentsToFile(ModelUtils.modelToBytes(inMemory),modelFile.getName(),tmp,FsMemoryMergeVersion.MEMORY.getSuffix());
  if (modelFile.exists()) {
    FileUtil.copy(new File(modelFile.getAbsolutePath()),new File(tmp.getAbsolutePath(),modelFile.getName() + "." + FsMemoryMergeVersion.FILE_SYSTEM.getSuffix()));
  }
  File zipfile=VcsHelperUtil.chooseZipFileNameForModelFile(modelFile.getAbsolutePath());
  jetbrains.mps.util.FileUtil.zip(tmp,zipfile);
  jetbrains.mps.util.FileUtil.delete(tmp);
  return zipfile;
}
