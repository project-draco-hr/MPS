{
  String oldConceptFQName="";
  String oldFeatureName="";
  StructureModificationData.ConceptFeatureKind kind=StructureModificationData.ConceptFeatureKind.NONE;
  StructureModification.RenameNode.RenameType renameType=null;
  if (SNodeOperations.isInstanceOf(feature,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,"jetbrains.mps.lang.structure.structure.LinkDeclaration"))) {
    SNode linkDeclaration=SNodeOperations.cast(feature,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,"jetbrains.mps.lang.structure.structure.LinkDeclaration"));
    oldConceptFQName=NameUtil.nodeFQName(SNodeOperations.getParent(linkDeclaration));
    oldFeatureName=SPropertyOperations.getString(linkDeclaration,MetaAdapterFactory.getProperty(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,0xf98052f333L,"role"));
    if (SPropertyOperations.hasValue(linkDeclaration,MetaAdapterFactory.getProperty(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,0xf980556927L,"metaClass"),"aggregation","reference")) {
      kind=StructureModificationData.ConceptFeatureKind.CHILD;
      renameType=StructureModification.RenameNode.RenameType.CHILD;
    }
 else {
      kind=StructureModificationData.ConceptFeatureKind.REFERENCE;
      renameType=StructureModification.RenameNode.RenameType.REFERENCE;
    }
    if (delete) {
      SNodeOperations.deleteNode(linkDeclaration);
    }
 else {
      if (newFeatureName != null && !(newFeatureName.equals(oldFeatureName))) {
        SPropertyOperations.set(linkDeclaration,MetaAdapterFactory.getProperty(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,0xf98052f333L,"role"),newFeatureName);
      }
    }
  }
  if (SNodeOperations.isInstanceOf(feature,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086bL,"jetbrains.mps.lang.structure.structure.PropertyDeclaration"))) {
    oldConceptFQName=NameUtil.nodeFQName(SNodeOperations.getParent(feature));
    oldFeatureName=feature.getName();
    kind=StructureModificationData.ConceptFeatureKind.PROPERTY;
    renameType=StructureModification.RenameNode.RenameType.PROPERTY;
    if (delete) {
      SNodeOperations.deleteNode(feature);
    }
 else {
      if (newFeatureName != null && !(newFeatureName.equals(oldFeatureName))) {
        SPropertyOperations.set(SNodeOperations.cast(feature,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086bL,"jetbrains.mps.lang.structure.structure.PropertyDeclaration")),MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name"),newFeatureName);
      }
    }
  }
  if (SNodeOperations.isInstanceOf(feature,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"))) {
    oldConceptFQName=NameUtil.nodeFQName(feature);
    oldFeatureName=feature.getName();
    kind=StructureModificationData.ConceptFeatureKind.CONCEPT;
    renameType=StructureModification.RenameNode.RenameType.CONCEPT;
    if (delete) {
      SNodeOperations.deleteNode(feature);
    }
 else {
      if (newFeatureName != null && !(newFeatureName.equals(oldFeatureName))) {
        SPropertyOperations.set(SNodeOperations.cast(feature,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration")),MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name"),newFeatureName);
      }
    }
  }
  if (kind != StructureModificationData.ConceptFeatureKind.NONE) {
    myConceptFeatureMap.put(new StructureModificationData.ConceptFeature(oldConceptFQName,kind,oldFeatureName),(delete ? null : new StructureModificationData.ConceptFeature(newConceptFQName,kind,newFeatureName)));
    myCachesAreUpToDate=false;
    if (newFeatureName == null) {
      return;
    }
    if (!(newFeatureName.equals(oldFeatureName))) {
      ListSequence.fromList(myLoggedData.getData()).addElement(new StructureModification.RenameNode(new SNodePointer(feature),renameType,newFeatureName,oldFeatureName));
    }
 else     if (kind == StructureModificationData.ConceptFeatureKind.CONCEPT && !(oldConceptFQName.equals(newConceptFQName))) {
    }
  }
}
