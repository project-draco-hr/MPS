{
  Graph graph=embeddedGraph.getGraph();
  List<Edge> oldEdges=ListSequence.fromList(new ArrayList<Edge>());
  ListSequence.fromList(oldEdges).addSequence(ListSequence.fromList(graph.getEdges()));
  List<Node> oldNodes=ListSequence.fromList(new ArrayList<Node>());
  ListSequence.fromList(oldNodes).addSequence(SetSequence.fromSet(MapSequence.fromMap(nodeSizes).keySet()));
  Map<Edge,Node> labelNodes=MapSequence.fromMap(new HashMap<Edge,Node>());
  Map<Edge,List<Edge>> labelEdges=MapSequence.fromMap(new HashMap<Edge,List<Edge>>());
  for (  Edge edge : SetSequence.fromSet(MapSequence.fromMap(labelSizes).keySet())) {
    List<Edge> newEdges=ListSequence.fromList(new ArrayList<Edge>());
    MapSequence.fromMap(labelNodes).put(edge,embeddedGraph.splitEdge(edge,newEdges));
    MapSequence.fromMap(labelEdges).put(edge,newEdges);
  }
  Map<Node,Dimension> labelAndNodeSizes=MapSequence.fromMap(new HashMap<Node,Dimension>());
  for (  Edge edge : SetSequence.fromSet(MapSequence.fromMap(labelSizes).keySet())) {
    MapSequence.fromMap(labelAndNodeSizes).put(MapSequence.fromMap(labelNodes).get(edge),MapSequence.fromMap(labelSizes).get(edge));
  }
  Map<Node,Map<Direction2D,Integer>> labelAndNodeDirectionSizes=getNodeDirectionSizes(labelAndNodeSizes);
  Map<Node,Map<Direction2D,Integer>> nodeDirectionSizes=getNodeDirectionSizes(nodeSizes);
  for (  Node node : SetSequence.fromSet(MapSequence.fromMap(nodeSizes).keySet())) {
    MapSequence.fromMap(labelAndNodeSizes).put(node,MapSequence.fromMap(nodeSizes).get(node));
    MapSequence.fromMap(labelAndNodeDirectionSizes).put(node,MapSequence.fromMap(nodeDirectionSizes).get(node));
  }
  GraphLayout layout=getLayoutFromEmbeddedGraph(embeddedGraph,labelAndNodeSizes,labelAndNodeDirectionSizes);
  GraphLayout initialLayout=new GraphLayout(embeddedGraph.getGraph());
  for (  Node node : ListSequence.fromList(oldNodes)) {
    initialLayout.setLayoutFor(node,layout.getNodeLayout(node));
  }
  for (  Edge edge : ListSequence.fromList(oldEdges)) {
    initialLayout.setLabelLayout(edge,layout.getNodeLayout(MapSequence.fromMap(labelNodes).get(edge)));
  }
  for (  Edge edge : ListSequence.fromList(oldEdges)) {
    if (MapSequence.fromMap(labelEdges).containsKey(edge)) {
      List<Edge> newEdges=MapSequence.fromMap(labelEdges).get(edge);
      List<Point> edgeLayout=layout.getEdgeLayout(ListSequence.fromList(newEdges).getElement(0));
      ListSequence.fromList(edgeLayout).addSequence(ListSequence.fromList(layout.getEdgeLayout(ListSequence.fromList(newEdges).getElement(1))));
      initialLayout.setLayoutFor(edge,edgeLayout);
    }
 else {
      initialLayout.setLayoutFor(edge,layout.getEdgeLayout(edge));
    }
  }
  return initialLayout;
}
