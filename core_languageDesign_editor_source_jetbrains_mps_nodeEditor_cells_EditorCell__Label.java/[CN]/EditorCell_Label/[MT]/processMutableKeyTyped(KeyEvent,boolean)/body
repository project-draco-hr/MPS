{
  final boolean[] result=new boolean[1];
  getEditorContext().executeCommand(new Runnable(){
    public void run(){
      String oldText=myTextLine.getText();
      EditorComponent editor=getEditorContext().getNodeEditorComponent();
      int startSelection=myTextLine.getStartTextSelectionPosition();
      int endSelection=myTextLine.getEndTextSelectionPosition();
      char keyChar=keyEvent.getKeyChar();
      if (UIUtil.isReallyTypedEvent(keyEvent)) {
        String newText=oldText.substring(0,startSelection) + keyChar + oldText.substring(endSelection);
        if (!allowErrors && !isValidText(newText)) {
          result[0]=false;
          return;
        }
        changeText(newText);
        setCaretPositionIfPossible(startSelection + 1);
        myTextLine.resetSelection();
        editor.resetLastCaretX();
        ensureCaretVisible();
        result[0]=true;
        return;
      }
      result[0]=false;
      return;
    }
  }
);
  return result[0];
}
