{
  for (  TemplateModule generator : myGenerators) {
    Collection<TemplateMappingPriorityRule> priorities=generator.getPriorities();
    if (priorities == null) {
      continue;
    }
    for (    TemplateMappingPriorityRule rule : priorities) {
      processRule((MappingPriorityRule)rule,generator);
    }
  }
  MultiMap<SLanguage,TemplateModule> lang2gen=new MultiMap<SLanguage,TemplateModule>();
  for (  TemplateModule generator : myGenerators) {
    SLanguage lang=SConceptRepository.getInstance().getLanguage(generator.getSourceLanguage().getNamespace());
    lang2gen.putValue(lang,generator);
  }
  for (  TemplateModule generator : myGenerators) {
    final RuleHelper lhsHelper=new RuleHelper(generator,new MappingConfig_RefAllLocal());
    if (lhsHelper.getAllMappings().isEmpty()) {
      continue;
    }
    HashSet<TemplateModule> targetGenerators=new HashSet<TemplateModule>();
    for (    SLanguage targetLang : generator.getTargetLanguages()) {
      targetGenerators.addAll(lang2gen.get(targetLang));
    }
    targetGenerators.remove(generator);
    if (targetGenerators.isEmpty()) {
      continue;
    }
    for (    TemplateModule tg : targetGenerators) {
      RuleHelper rhsHelper=new RuleHelper(tg,new MappingConfig_RefAllLocal());
      if (rhsHelper.getAllMappings().isEmpty()) {
        continue;
      }
      if (rhsHelper.getTopPriMappings().isEmpty()) {
        addImplicitTargetLanguageRule(lhsHelper.getAllMappings(),generator,rhsHelper.getAllMappings(),tg);
      }
 else {
        if (!lhsHelper.getTopPriMappings().isEmpty()) {
          addImplicitTargetLanguageRule(lhsHelper.getTopPriMappings(),generator,rhsHelper.getTopPriMappings(),tg);
        }
        if (!lhsHelper.getRegularMappings().isEmpty() && !rhsHelper.getRegularMappings().isEmpty()) {
          addImplicitTargetLanguageRule(lhsHelper.getRegularMappings(),generator,rhsHelper.getRegularMappings(),tg);
        }
      }
    }
  }
}
