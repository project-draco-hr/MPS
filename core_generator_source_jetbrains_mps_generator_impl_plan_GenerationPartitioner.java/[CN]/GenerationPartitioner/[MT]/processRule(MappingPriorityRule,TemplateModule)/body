{
  MappingConfig_AbstractRef left=rule.getLeft();
  MappingConfig_AbstractRef right=rule.getRight();
  if (left == null || right == null)   return;
  Collection<TemplateMappingConfiguration> rightPriMappings=getMappingsFromRef(left,generator);
  Collection<TemplateMappingConfiguration> leftPriMappings=getMappingsFromRef(right,generator);
  if (rule.getType() == RuleType.STRICTLY_TOGETHER) {
    Set<TemplateMappingConfiguration> coherentMappings=new HashSet<TemplateMappingConfiguration>(leftPriMappings);
    coherentMappings.addAll(rightPriMappings);
    myCoherentMappings.add(new CoherentSetData(coherentMappings,rule));
  }
 else {
    if (rule.getType() == RuleType.STRICTLY_AFTER || rule.getType() == RuleType.AFTER_OR_TOGETHER) {
      Collection<TemplateMappingConfiguration> temp=rightPriMappings;
      rightPriMappings=leftPriMappings;
      leftPriMappings=temp;
    }
    leftPriMappings=CollectionUtil.subtract(leftPriMappings,rightPriMappings);
    boolean isStrict=rule.getType() == RuleType.STRICTLY_BEFORE || rule.getType() == RuleType.STRICTLY_AFTER;
    for (    TemplateMappingConfiguration lesserPriMapping : leftPriMappings) {
      Map<TemplateMappingConfiguration,PriorityData> grtPriMappingsFromMap=myPriorityMap.get(lesserPriMapping);
      for (      TemplateMappingConfiguration grtPriMapping : rightPriMappings) {
        if (!grtPriMappingsFromMap.containsKey(grtPriMapping)) {
          grtPriMappingsFromMap.put(grtPriMapping,new PriorityData(isStrict,rule));
        }
 else {
          PriorityData priorityData=grtPriMappingsFromMap.get(grtPriMapping);
          if (isStrict)           priorityData.myStrict=true;
          priorityData.myCauseRules.add(rule);
        }
      }
    }
  }
}
