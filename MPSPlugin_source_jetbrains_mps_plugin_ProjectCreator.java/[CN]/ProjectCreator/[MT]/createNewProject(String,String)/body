{
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          LocalFileSystem lfs=LocalFileSystem.getInstance();
          Project project=myProjectManager.newProject(path + File.separator + name+ ".ipr",true,false);
          myProjectManager.openProject(project);
          ProjectRootManagerEx projectRootManager=(ProjectRootManagerEx)ProjectRootManagerEx.getInstance(project);
          projectRootManager.setLanguageLevel(LanguageLevel.JDK_1_5);
          ModuleManager moduleManager=project.getComponent(ModuleManager.class);
          Module module=moduleManager.newModule(path + File.separator + name+ ".iml",ModuleType.JAVA);
          ModuleRootManager rootManager=module.getComponent(ModuleRootManager.class);
          ModifiableRootModel rootModel=rootManager.getModifiableModel();
          rootModel.setJdk(findSuitableJDK());
          VirtualFile contentRootFile=lfs.refreshAndFindFileByIoFile(new File(path));
          rootModel.addContentEntry(contentRootFile);
          try {
            if (contentRootFile.findChild("classes") == null) {
              contentRootFile.createChildDirectory(this,"classes");
            }
            rootModel.setCompilerOutputPath(contentRootFile.findChild("classes"));
            rootModel.setExcludeOutput(true);
          }
 catch (          IOException e) {
            e.printStackTrace();
          }
          rootModel.commit();
          String path=project.getProjectFilePath();
          myProjectManager.closeProject(project);
          try {
            myProjectManager.openProject(myProjectManager.loadProject(path));
          }
 catch (          Exception e) {
            e.printStackTrace();
          }
        }
      }
);
    }
  }
,ModalityState.NON_MMODAL);
  return "OK";
}
