{
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          try {
            Project project=myProjectManager.newProject(path + File.separator + name+ ".ipr",true,false);
            myProjectManager.openProject(project);
            ModuleManager moduleManager=project.getComponent(ModuleManager.class);
            Module module=moduleManager.newModule(path + File.separator + name+ ".iml",ModuleType.JAVA);
            ModuleRootManager rootManager=module.getComponent(ModuleRootManager.class);
            ModifiableRootModel rootModel=rootManager.getModifiableModel();
            VirtualFile contentRootFile=module.getModuleFile().getParent();
            ContentEntry contentEntry=rootModel.addContentEntry(contentRootFile);
            VirtualFile sourceDir=contentRootFile.createChildDirectory(this,"source");
            contentEntry.addSourceFolder(sourceDir,false);
            rootModel.commit();
          }
 catch (          IOException e) {
            e.printStackTrace();
          }
        }
      }
);
    }
  }
,ModalityState.NON_MMODAL);
  return "OK";
}
