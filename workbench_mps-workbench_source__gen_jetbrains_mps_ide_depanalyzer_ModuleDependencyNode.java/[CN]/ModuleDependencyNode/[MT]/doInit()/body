{
  Set<IModule> reqModules=SetSequence.fromSet(new HashSet<IModule>());
  Set<IModule> rtModules=SetSequence.fromSet(new HashSet<IModule>());
  Set<IModule> usedLanguages=SetSequence.fromSet(new HashSet<IModule>());
  DependencyTree tree=(DependencyTree)getTree();
  for (  IModule module : ListSequence.fromList(myModules)) {
    GlobalModuleDependenciesManager depManager=new GlobalModuleDependenciesManager(module);
    SetSequence.fromSet(reqModules).addSequence(CollectionSequence.fromCollection(depManager.getModules(GlobalModuleDependenciesManager.Deptype.VISIBLE)));
    SetSequence.fromSet(rtModules).addSequence(CollectionSequence.fromCollection(depManager.getModules(GlobalModuleDependenciesManager.Deptype.EXECUTE)));
    SetSequence.fromSet(usedLanguages).addSequence(CollectionSequence.fromCollection(depManager.getUsedLanguages()));
  }
  Set<IModule> allModules=(tree.isShowRuntime() ? rtModules : reqModules);
  Set<IModule> depLoops=tree.getLoops();
  SetSequence.fromSet(allModules).addSequence(SetSequence.fromSet(depLoops).intersect(ListSequence.fromList(myModules)));
  if (tree.isHideSourceModules()) {
    SetSequence.fromSet(allModules).removeSequence(ListSequence.fromList(tree.getModules()));
    SetSequence.fromSet(usedLanguages).removeSequence(ListSequence.fromList(tree.getModules()));
  }
  for (  IModule m : SetSequence.fromSet(allModules).sort(new ISelector<IModule,Comparable<?>>(){
    public Comparable<?> select(    IModule it){
      return it.getModuleFqName();
    }
  }
,true)) {
    add(new ModuleDependencyNode.DepDependencyNode(m,!(SetSequence.fromSet(reqModules).contains(m)),SetSequence.fromSet(depLoops).contains(m),getOperationContext()));
  }
  if (tree.isShowUsedLanguage()) {
    MPSTreeNode usedlanguages=new TextMPSTreeNode("Used Languages",getOperationContext());
    boolean hasBootstrapDep=false;
    for (    IModule l : SetSequence.fromSet(usedLanguages).sort(new ISelector<IModule,Comparable<?>>(){
      public Comparable<?> select(      IModule it){
        return it.getModuleFqName();
      }
    }
,true)) {
      Iterable<IModule> langModules=new GlobalModuleDependenciesManager(l).getModules(GlobalModuleDependenciesManager.Deptype.EXECUTE);
      boolean isBootstrapDep=Sequence.fromIterable(langModules).intersect(ListSequence.fromList(myModules)).isNotEmpty();
      hasBootstrapDep|=isBootstrapDep;
      usedlanguages.add(new ModuleDependencyNode.ULangDependencyNode(l,isBootstrapDep,getOperationContext()));
    }
    if (hasBootstrapDep) {
      usedlanguages.addTreeMessage(BOOTSTRAP_DEPENDENCY);
    }
    add(usedlanguages);
  }
  myInitialized=true;
}
