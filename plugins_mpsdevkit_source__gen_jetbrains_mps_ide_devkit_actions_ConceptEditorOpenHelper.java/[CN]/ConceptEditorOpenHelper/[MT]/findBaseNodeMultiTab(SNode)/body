{
  SNode baseNode=null;
  if (jetbrains.mps.util.SNodeOperations.isRoot(node) && SNodeOperations.isInstanceOf(node,"jetbrains.mps.lang.core.structure.BaseConcept")) {
    SNode bc=SNodeOperations.cast(node,"jetbrains.mps.lang.core.structure.BaseConcept");
    SNode annotation=AttributeOperations.getAttribute(bc,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.generator.structure.RootTemplateAnnotation")));
    if ((annotation != null) && (SLinkOperations.getTarget(annotation,"applicableConcept",false) != null)) {
      baseNode=SLinkOperations.getTarget(annotation,"applicableConcept",false);
    }
  }
  if ((baseNode == null)) {
    return null;
  }
  IModule baseNodeModule=SNodeOperations.getModel(baseNode).getModelDescriptor().getModule();
  IModule nodeModule=SNodeOperations.getModel(node).getModelDescriptor().getModule();
  if (nodeModule instanceof Generator) {
    nodeModule=((Generator)nodeModule).getSourceLanguage();
  }
  if (baseNodeModule != nodeModule) {
    return null;
  }
  return baseNode;
}
