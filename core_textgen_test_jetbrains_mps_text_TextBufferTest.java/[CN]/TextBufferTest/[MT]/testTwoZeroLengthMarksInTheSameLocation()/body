{
  TextBuffer tb=createTextBuffer();
  tb.area().append("ABC").newLine();
  final TextMark m1=tb.pushMark().popMark();
  final TextMark m2=tb.pushMark().popMark();
  tb.area().append("GHI").newLine();
  tb.pushTextArea(new BasicToken(2));
  tb.area().append("EF").newLine();
  tb.popTextArea();
  tb.area().append("JKL");
  tb.pushTextArea(new BasicToken(1));
  tb.area().append("D");
  tb.popTextArea();
  final BufferLayout l=tb.newLayout();
  l.replace(m1,new BasicToken(1));
  l.replace(m2,new BasicToken(2));
  BufferSnapshot t=tb.snapshot(l);
  Assert.assertEquals("ABC" + myLineSep + "DEF"+ myLineSep+ "GHI"+ myLineSep+ "JKL",t.getText().toString());
  check(t,m1,"D",1,0,1,1);
  check(t,m2,"EF" + myLineSep,1,1,2,0);
}
