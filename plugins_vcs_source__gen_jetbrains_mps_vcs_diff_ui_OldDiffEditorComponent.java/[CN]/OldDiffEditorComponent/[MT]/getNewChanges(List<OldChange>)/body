{
  Set<SNodeId> newNodes=new HashSet<SNodeId>();
  for (  OldChange change : changes) {
    if (change instanceof NewNodeChange) {
      newNodes.add(change.getAffectedNodeId());
    }
  }
  Set<OldChange> newChanges=new HashSet<OldChange>();
  for (  OldChange change : changes) {
    if (change instanceof NewNodeChange) {
      SNodeId id=((NewNodeChange)change).getNodeParent();
      if (id != null && newNodes.contains(id)) {
        newChanges.add(change);
      }
    }
 else {
      SNodeId id=change.getAffectedNodeId();
      if (id != null && newNodes.contains(id)) {
        newChanges.add(change);
      }
    }
  }
  return newChanges;
}
