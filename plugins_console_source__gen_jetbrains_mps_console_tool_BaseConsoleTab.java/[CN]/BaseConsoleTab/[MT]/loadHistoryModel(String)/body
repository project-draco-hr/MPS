{
  if (state != null) {
    try {
      final Wrappers._T<SModel> loadedModel=new Wrappers._T<SModel>(PersistenceUtil.loadBinaryModel(Base64Converter.decode(state.getBytes())));
      ListSequence.fromList(SModelOperations.getNodes(loadedModel.value,null)).where(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return ConceptRegistry.getInstance().getConceptDescriptor(it.getConcept().getQualifiedName()) instanceof IllegalConceptDescriptor;
        }
      }
).visitAll(new IVisitor<SNode>(){
        public void visit(        SNode it){
          if ((SNodeOperations.getAncestor(it,"jetbrains.mps.console.base.structure.HistoryItem",false,false) != null)) {
            SNodeOperations.deleteNode(SNodeOperations.getAncestor(it,"jetbrains.mps.console.base.structure.HistoryItem",false,false));
            if (LOG.isEnabledFor(Level.ERROR)) {
              LOG.error("Unknown concept on loading console history: removing enclosing history item");
            }
          }
 else {
            loadedModel.value=null;
            if (LOG.isEnabledFor(Level.ERROR)) {
              LOG.error("Unknown concept on loading console history: not loading history");
            }
          }
        }
      }
);
      return loadedModel.value;
    }
 catch (    Throwable e) {
      if (LOG.isEnabledFor(Level.ERROR)) {
        LOG.error("Error on loading console history",e);
      }
      return null;
    }
  }
 else {
    return null;
  }
}
