{
  if (mySearchEntries.size() == 0)   return;
  addToHistory();
  jetbrains.mps.openapi.editor.cells.EditorCell selectedCell=myEditor.getDeepestSelectedCell();
  int selectionStart=0;
  boolean isEmpty=false;
  if (selectedCell instanceof EditorCell_Label) {
    EditorCell_Label labelCell=(EditorCell_Label)selectedCell;
    selectionStart=labelCell.getSelectionStart();
    isEmpty=labelCell.getText().isEmpty();
  }
  SearchEntry entryToSelect=null;
  for (ListIterator<SearchEntry> it=mySearchEntries.listIterator(mySearchEntries.size()); it.hasPrevious() && entryToSelect == null; ) {
    SearchEntry currentEntry=it.previous();
    if (CellTraversalUtil.compare(selectedCell,currentEntry.getStartLabel()) >= 0) {
      while (entryToSelect == null) {
        if (!currentEntry.getStartLabel().equals(selectedCell) || (selectionStart >= currentEntry.getFirstRange().getEndPosition() && !isEmpty)) {
          entryToSelect=currentEntry;
        }
        if (it.hasPrevious()) {
          currentEntry=it.previous();
        }
 else {
          break;
        }
      }
    }
  }
  if (entryToSelect == null) {
    entryToSelect=mySearchEntries.get(mySearchEntries.size() - 1);
  }
  entryToSelect.select();
}
