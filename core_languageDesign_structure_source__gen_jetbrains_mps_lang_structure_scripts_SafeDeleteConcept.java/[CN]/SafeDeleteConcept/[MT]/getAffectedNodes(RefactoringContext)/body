{
{
    SNode node=refactoringContext.getSelectedNode();
    SearchResults searchResults=FindUtils.getSearchResults(new EmptyProgressIndicator(),refactoringContext.getSelectedNode(),GlobalScope.getInstance(),"jetbrains.mps.lang.structure.findUsages.ConceptInstances_Finder","jetbrains.mps.lang.structure.findUsages.NodeAndDescendantsUsages_Finder");
    refactoringContext.setParameter("sourceLanguage",Language.getLanguageFor(SNodeOperations.getModel(node).getModelDescriptor()));
    if (((Language)refactoringContext.getParameter("sourceLanguage")) == null) {
      return searchResults;
    }
    SModelDescriptor editorModelDescriptor=((Language)refactoringContext.getParameter("sourceLanguage")).getEditorModelDescriptor();
    List<SearchResult<SNode>> searchResultsList=searchResults.getSearchResults();
    if (editorModelDescriptor != null) {
      refactoringContext.setParameter("editorNode",RefUtil.findEditorDeclaration(editorModelDescriptor.getSModel(),SNodeOperations.cast(node,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration")));
      if (((SNode)refactoringContext.getParameter("editorNode")) != null) {
        for (        SearchResult<SNode> searchResult : ListSequence.fromListWithValues(new ArrayList<SearchResult<SNode>>(),searchResultsList)) {
          if (searchResult.getObject().getContainingRoot() == ((SNode)refactoringContext.getParameter("editorNode"))) {
            searchResults.remove(searchResult);
          }
        }
      }
    }
    SModelDescriptor behaviorModelDescriptor=((Language)refactoringContext.getParameter("sourceLanguage")).getBehaviorModelDescriptor();
    if (behaviorModelDescriptor != null) {
      refactoringContext.setParameter("behaviorNode",RefUtil.findBehaviorDeclaration(behaviorModelDescriptor.getSModel(),SNodeOperations.cast(node,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration")));
      if (((SNode)refactoringContext.getParameter("behaviorNode")) != null) {
        for (        SearchResult<SNode> searchResult : ListSequence.fromListWithValues(new ArrayList<SearchResult<SNode>>(),searchResultsList)) {
          if (searchResult.getObject().getContainingRoot() == ((SNode)refactoringContext.getParameter("behaviorNode"))) {
            searchResults.remove(searchResult);
          }
        }
      }
    }
    return searchResults;
  }
}
