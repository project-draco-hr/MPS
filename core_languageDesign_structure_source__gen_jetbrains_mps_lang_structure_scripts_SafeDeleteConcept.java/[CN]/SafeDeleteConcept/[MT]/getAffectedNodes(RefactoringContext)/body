{
{
    SNode node=refactoringContext.getSelectedNode();
    SearchResults searchResults=FindUtils.getSearchResults(ActionEventData.createProgressIndicator(),refactoringContext.getSelectedNode(),GlobalScope.getInstance(),"jetbrains.mps.lang.structure.findUsages.ConceptInstances_Finder","jetbrains.mps.lang.structure.findUsages.NodeAndDescendantsUsages_Finder");
    refactoringContext.setParameter("sourceLanguage",Language.getLanguageFor(SNodeOperations.getModel(node).getModelDescriptor()));
    if (((Language)refactoringContext.getParameter("sourceLanguage")) != null) {
      SModelDescriptor editorModelDescriptor=((Language)refactoringContext.getParameter("sourceLanguage")).getEditorModelDescriptor();
      List<SNode> searchResultsList=searchResults.getSearchResults();
      if (editorModelDescriptor != null) {
        refactoringContext.setParameter("editorNode",SModelUtil.findEditorDeclaration(editorModelDescriptor.getSModel(),node));
        if (((SNode)refactoringContext.getParameter("editorNode")) != null) {
          for (          SearchResult<SNode> searchResult : new ArrayList<SearchResult<SNode>>((Collection)searchResultsList)) {
            if (searchResult.getObject().getContainingRoot() == ((SNode)refactoringContext.getParameter("editorNode"))) {
              searchResults.remove(searchResult);
            }
          }
        }
      }
      SModelDescriptor behaviorModelDescriptor=((Language)refactoringContext.getParameter("sourceLanguage")).getBehaviorModelDescriptor();
      if (behaviorModelDescriptor != null) {
        refactoringContext.setParameter("behaviorNode",SModelUtil.findBehaviorDeclaration(behaviorModelDescriptor.getSModel(),node));
        if (((SNode)refactoringContext.getParameter("behaviorNode")) != null) {
          for (          SearchResult<SNode> searchResult : new ArrayList<SearchResult<SNode>>((Collection)searchResultsList)) {
            if (searchResult.getObject().getContainingRoot() == ((SNode)refactoringContext.getParameter("behaviorNode"))) {
              searchResults.remove(searchResult);
            }
          }
        }
      }
    }
    return searchResults;
  }
}
