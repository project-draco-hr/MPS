{
  Key<ContextT> key=new Key<>(menuLookup,context);
  if (myKeyStack.contains(key)) {
    LOG.error("Menu for key '" + key + "' requested more than once, returning empty menu to prevent endless recursion");
    LOG.error("Current menu key stack: " + myKeyStack);
    return Collections.emptyList();
  }
  myKeyStack.addLast(key);
  try {
    Collection<? extends MenuT> menus=menuLookup.lookup(myUsedLanguages);
    if (menus.isEmpty()) {
      return Collections.emptyList();
    }
    List<ItemT> result=new ArrayList<>();
    for (    MenuT menu : menus) {
      result.addAll(menu.createMenuItems(context));
    }
    return result;
  }
  finally {
    myKeyStack.removeLast();
  }
}
