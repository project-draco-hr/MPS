{
  Node source=edge.getSource();
  Node target=edge.getTarget();
  List<Edge> history=manager.getHistory(edge);
  List<Point> edgeLayout=ListSequence.fromList(new LinkedList<Point>());
  Node cur=source;
  ListSequence.fromList(edgeLayout).addElement(new Point(MapSequence.fromMap(coordinates).get(cur)));
  for (  Edge historyEdge : ListSequence.fromList(history)) {
    Node next=historyEdge.getOpposite(cur);
    ListSequence.fromList(edgeLayout).addElement(new Point(MapSequence.fromMap(coordinates).get(next)));
    cur=next;
  }
  if (ListSequence.fromList(initialNodes).contains(source)) {
    Direction2D dir=MapSequence.fromMap(directions).get(embeddedGraph.getSourceDart(ListSequence.fromList(history).first(),source));
    int size=MapSequence.fromMap(MapSequence.fromMap(nodeDirectionSizes).get(source)).get(dir);
    Point first=ListSequence.fromList(edgeLayout).removeElementAt(0);
    first.translate(size * dir.dx(),size * dir.dy());
    ListSequence.fromList(edgeLayout).removeElementAt(0);
    ListSequence.fromList(edgeLayout).insertElement(0,first);
  }
  if (ListSequence.fromList(initialNodes).contains(edge.getTarget())) {
    Direction2D dir=MapSequence.fromMap(directions).get(embeddedGraph.getSourceDart(ListSequence.fromList(history).last(),target));
    int size=MapSequence.fromMap(MapSequence.fromMap(nodeDirectionSizes).get(target)).get(dir);
    Point last=ListSequence.fromList(edgeLayout).removeLastElement();
    last.translate(size * dir.dx(),size * dir.dy());
    ListSequence.fromList(edgeLayout).removeLastElement();
    ListSequence.fromList(edgeLayout).addElement(last);
  }
  return edgeLayout;
}
