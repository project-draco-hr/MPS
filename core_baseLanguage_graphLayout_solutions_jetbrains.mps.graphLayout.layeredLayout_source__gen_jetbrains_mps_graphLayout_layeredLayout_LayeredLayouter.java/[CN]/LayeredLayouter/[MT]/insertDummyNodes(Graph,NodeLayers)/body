{
  Map<Edge,List<Edge>> substituteMap=MapSequence.fromMap(new HashMap<Edge,List<Edge>>());
  int numOfRealNodes=graph.getNumNodes();
  Set<Edge> toDelete=SetSequence.fromSet(new HashSet<Edge>());
  for (int index=0; index < numOfRealNodes; index++) {
    Node node=graph.getNode(index);
    for (    Edge edge : ListSequence.fromList(node.getOutEdges())) {
      int sourceLayer=layers.get(edge.getSource());
      int targetLayer=layers.get(edge.getTarget());
      if (targetLayer > sourceLayer + 1) {
        MapSequence.fromMap(substituteMap).put(edge,ListSequence.fromList(new ArrayList<Edge>()));
        Node cur=edge.getSource();
        for (int i=sourceLayer + 1; i <= targetLayer; i++) {
          Node newTarget;
          if (i < targetLayer) {
            newTarget=graph.addNode();
            layers.set(newTarget,i);
          }
 else {
            newTarget=edge.getTarget();
          }
          ListSequence.fromList(MapSequence.fromMap(substituteMap).get(edge)).addElement(new Edge(cur,newTarget));
          cur=newTarget;
        }
      }
    }
  }
  for (  Edge deletedEdge : SetSequence.fromSet(MapSequence.fromMap(substituteMap).keySet())) {
    deletedEdge.removeFromGraph();
    for (    Edge newEdge : ListSequence.fromList(MapSequence.fromMap(substituteMap).get(deletedEdge))) {
      graph.addEdge(newEdge);
    }
  }
  return substituteMap;
}
