{
  StructuralNodeSet<?> frontier=new StructuralNodeSet();
  StructuralNodeSet<?> newFrontier=new StructuralNodeSet();
  StructuralNodeSet<?> yetPassed=new StructuralNodeSet();
  frontier.add(subRepresentator);
  while (!frontier.isEmpty()) {
    for (    SNode node : frontier) {
      StructuralNodeSet<?> ancestors=collectImmediateSupertypes(node,isWeak);
      if (ancestors == null)       continue;
      for (      SNode passedNode : yetPassed) {
        ancestors.removeStructurally(passedNode);
      }
      ancestors.removeStructurally(node);
      boolean matches=false;
      for (      SNode ancestor : ancestors) {
        if (m.matches(ancestor)) {
          if (m.onlyFirst()) {
            return true;
          }
 else {
            matches=true;
          }
        }
      }
      if (matches) {
        return true;
      }
      newFrontier.addAllStructurally(ancestors);
      yetPassed.addAllStructurally(ancestors);
    }
    frontier=newFrontier;
    newFrontier=new StructuralNodeSet();
  }
  return false;
}
