{
  SNode expr=node;
  boolean checkMore=true;
  while (checkMore) {
    checkMore=false;
    while (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(expr,"left",true),"jetbrains.mps.query.structure.MqlBinaryExpr") && needsRotate(expr,SNodeOperations.cast(SLinkOperations.getTarget(expr,"left",true),"jetbrains.mps.query.structure.MqlBinaryExpr"))) {
      SNode left=SNodeOperations.cast(SLinkOperations.getTarget(expr,"left",true),"jetbrains.mps.query.structure.MqlBinaryExpr");
      rotate(expr,left);
      rotateChildrenIfNecessary(expr);
      expr=left;
    }
    while (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(expr,"right",true),"jetbrains.mps.query.structure.MqlBinaryExpr") && needsRotate(expr,SNodeOperations.cast(SLinkOperations.getTarget(expr,"right",true),"jetbrains.mps.query.structure.MqlBinaryExpr"))) {
      SNode right=SNodeOperations.cast(SLinkOperations.getTarget(expr,"right",true),"jetbrains.mps.query.structure.MqlBinaryExpr");
      rotate(expr,right);
      rotateChildrenIfNecessary(expr);
      expr=right;
      checkMore=true;
    }
  }
  return expr;
}
