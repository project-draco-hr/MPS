{
  SNode currentChild=context.getCurrentChild();
  List<SubstituteMenuItem> result=new ArrayList<>();
  int index=0;
  if (currentChild != null) {
    index=((jetbrains.mps.smodel.SNode)context.getParentNode()).getChildren().indexOf(currentChild);
  }
  ReferenceDescriptor refDescriptor=ModelConstraints.getSmartReferenceDescriptor(context.getParentNode(),context.getLink(),index,myConcept,context.getEditorContext().getRepository());
  Iterable<SNode> referentNodes=refDescriptor.getScope().getAvailableElements(null);
  for (  SNode referentNode : referentNodes) {
    if (referentNode == null || !referentNode.getConcept().isSubConceptOf(smartReference.getTargetConcept())) {
      continue;
    }
    result.add(new SmartReferenceSubstituteMenuItem(referentNode,context.getParentNode(),currentChild,myConcept,smartReference,refDescriptor));
  }
  return result;
}
