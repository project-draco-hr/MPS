{
  if (!(module instanceof Language)) {
    return Collections.emptyMap();
  }
  SModel migModel=LanguageAspect.MIGRATION.get((Language)module);
  if (migModel == null) {
    return Collections.emptyMap();
  }
  if (!(migModel.isLoaded())) {
    return Collections.emptyMap();
  }
  List<SNode> allScripts=SModelOperations.roots(migModel,MetaAdapterFactory.getInterfaceConcept(0x9882f4ad195546feL,0x826994189e5dbbf2L,0x47bb811da2acc4d6L,"jetbrains.mps.lang.migration.util.structure.IMigrationUnit"));
  final Map<SNode,Collection<String>> result=MapSequence.fromMap(new HashMap<SNode,Collection<String>>());
  Iterable<SNode> noVersionScripts=ListSequence.fromList(allScripts).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return !((boolean)IMigrationUnit__BehaviorDescriptor.isVersionSet_id4uVwhQyFpOe.invoke(it));
    }
  }
);
  Sequence.fromIterable(noVersionScripts).visitAll(new IVisitor<SNode>(){
    public void visit(    SNode it){
      MigrationsCheckUtil.ensureInitialized(result,it);
      CollectionSequence.fromCollection(MapSequence.fromMap(result).get(it)).addElement("Script does not have version");
    }
  }
);
  if (Sequence.fromIterable(noVersionScripts).count() == ListSequence.fromList(allScripts).count()) {
    return result;
  }
  Iterable<SNode> scriptsWithVersions=ListSequence.fromList(allScripts).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return (boolean)IMigrationUnit__BehaviorDescriptor.isVersionSet_id4uVwhQyFpOe.invoke(it);
    }
  }
);
  final Map<Integer,Integer> versions=MapSequence.fromMap(new HashMap<Integer,Integer>());
  Sequence.fromIterable(scriptsWithVersions).visitAll(new IVisitor<SNode>(){
    public void visit(    SNode it){
      if (MapSequence.fromMap(versions).get((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it)) == null) {
        MapSequence.fromMap(versions).put((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it),0);
      }
      MapSequence.fromMap(versions).put((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it),MapSequence.fromMap(versions).get((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it)) + 1);
    }
  }
);
  final int minVersion=SetSequence.fromSet(MapSequence.fromMap(versions).keySet()).sort(new ISelector<Integer,Integer>(){
    public Integer select(    Integer it){
      return it;
    }
  }
,true).first();
  final int maxVersion=SetSequence.fromSet(MapSequence.fromMap(versions).keySet()).sort(new ISelector<Integer,Integer>(){
    public Integer select(    Integer it){
      return it;
    }
  }
,false).first();
  final int langVersion=((Language)module).getLanguageVersion();
  if (maxVersion != langVersion - 1) {
    Sequence.fromIterable(scriptsWithVersions).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return (int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it) == maxVersion;
      }
    }
).visitAll(new IVisitor<SNode>(){
      public void visit(      SNode it){
        ensureInitialized(result,it);
        CollectionSequence.fromCollection(MapSequence.fromMap(result).get(it)).addElement("Language version (" + langVersion + ") is greater than the target version of last migration script ("+ maxVersion+ ")");
      }
    }
);
  }
  Sequence.fromIterable(scriptsWithVersions).visitAll(new IVisitor<SNode>(){
    public void visit(    SNode it){
      if (MapSequence.fromMap(versions).get((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it)) > 1) {
        ensureInitialized(result,it);
        CollectionSequence.fromCollection(MapSequence.fromMap(result).get(it)).addElement("Multiple scripts for version " + (int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it) + " found");
      }
      if ((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it) != minVersion && MapSequence.fromMap(versions).get((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it) - 1) == null) {
        ensureInitialized(result,it);
        CollectionSequence.fromCollection(MapSequence.fromMap(result).get(it)).addElement("Missing script for version " + ((int)IMigrationUnit__BehaviorDescriptor.fromVersion_id4uVwhQyFcnl.invoke(it) - 1));
      }
    }
  }
);
  return result;
}
