{
  if (FileTypeManager.getInstance().isFileIgnored(dir.getName()))   return;
  if (!dir.isDirectory())   return;
  List<IFile> files=dir.list();
  for (  IFile file : files) {
    String fileName=file.getName();
    boolean isMPSModel=fileName.endsWith(MPSExtentions.DOT_MODEL);
    if (!(isMPSModel))     continue;
    DescriptorLoadResult dr=ModelPersistence.loadDescriptor(file);
    SModelReference modelReference=null;
    if (dr.getUID() != null) {
      modelReference=SModelReference.fromString(dr.getUID());
    }
 else {
      modelReference=ModelRefCreator.createModelReference(file,FileSystem.getInstance().getFileByPath(modelRoot.getPath()),modelRoot.getPrefix());
    }
    if (modelReference.getSModelId() == null) {
      modelReference=new SModelReference(modelReference.getSModelFqName(),SModelId.generate());
    }
    SModelDescriptor modelDescriptor;
    if (ModelPersistence.needsRecreating(file)) {
      modelDescriptor=recreateFileAndGetInstance(this,file.getAbsolutePath(),modelReference,owner,modelRoot,dr);
      LOG.debug("Recreated file and read model descriptor" + modelDescriptor.getSModelReference() + "\n"+ "Model root is "+ modelRoot.getPath()+ " "+ modelRoot.getPrefix());
    }
 else {
      modelDescriptor=getInstance(this,file.getAbsolutePath(),modelReference,dr,owner,false);
      LOG.debug("Read model descriptor " + modelDescriptor.getSModelReference() + "\n"+ "Model root is "+ modelRoot.getPath()+ " "+ modelRoot.getPrefix());
    }
  }
  for (  IFile childDir : files) {
    if (childDir.isDirectory()) {
      readModelDescriptors(childDir,modelRoot,owner);
    }
  }
}
