{
  LOG.debug("Getting model " + modelReference + " from "+ fileName+ " with owner "+ owner);
  SModelRepository modelRepository=SModelRepository.getInstance();
  SModelDescriptor modelDescriptor=modelRepository.getModelDescriptor(modelReference);
  if (modelDescriptor != null) {
    modelRepository.addOwnerForDescriptor(modelDescriptor,owner);
    return modelDescriptor;
  }
 else {
    IFile modelFile=FileSystem.getFile(fileName);
    if (createStub) {
      StubModelDescriptor stubModelDescriptor=new StubModelDescriptor(manager,modelFile,modelReference);
      stubModelDescriptor.readStub(modelFile);
      modelDescriptor=stubModelDescriptor;
    }
 else {
      modelDescriptor=new DefaultSModelDescriptor(manager,modelFile,modelReference);
    }
    if (fireModelCreated) {
      modelRepository.createNewModel(modelDescriptor,owner);
    }
 else {
      modelRepository.registerModelDescriptor(modelDescriptor,owner);
    }
    return modelDescriptor;
  }
}
