{
  SModelRepository modelRepository=SModelRepository.getInstance();
  if (createStub) {
    return getInstance(manager,createStub,fileName,modelUID,owner,false);
  }
  SModelDescriptor modelDescriptor=modelRepository.getModelDescriptor(modelUID);
  if (modelDescriptor != null) {
    LOG.error("can't recreate file for already loaded descriptor " + modelUID);
    return getInstance(manager,createStub,fileName,modelUID,owner,false);
  }
  IFile modelFile=FileSystem.getFile(fileName);
  SModelUID newModelUID=ModelPersistence.upgradeModelUID(modelUID);
  IFile newFile=createFileForModelUID(root,newModelUID);
  newFile.createNewFile();
  FileUtil.copyFile(modelFile.toFile(),newFile.toFile());
  modelFile.delete();
  SModelDescriptor result=getInstance(manager,createStub,newFile.getAbsolutePath(),newModelUID,owner,true);
  Project[] projects=ProjectManagerEx.getInstance().getOpenProjects();
  if (projects.length == 0) {
    MPSVCSManager.addFileLater(newFile.toFile());
    MPSVCSManager.removeFileLater(modelFile.toFile());
  }
 else {
    for (    Project project : projects) {
      MPSVCSManager mpsvcsManager=MPSVCSManager.getInstance(project);
      if (mpsvcsManager != null) {
        mpsvcsManager.removeMissingFilesFromVCS(Collections.singletonList(modelFile.toFile()));
        mpsvcsManager.addFilesToVCS(Collections.singletonList(newFile.toFile()));
      }
    }
  }
  return result;
}
