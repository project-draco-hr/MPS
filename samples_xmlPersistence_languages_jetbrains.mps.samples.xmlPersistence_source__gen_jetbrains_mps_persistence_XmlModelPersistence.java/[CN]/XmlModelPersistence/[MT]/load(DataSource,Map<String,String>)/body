{
  if (!((dataSource instanceof StreamDataSource))) {
    throw new UnsupportedDataSourceException(dataSource);
  }
  String moduleRef=options.get(ModelFactory.OPTION_MODULEREF);
  String relPath=options.get(ModelFactory.OPTION_RELPATH);
  String modelName=options.get(ModelFactory.OPTION_MODELNAME);
  boolean contentOnly="true".equals(options.get(ModelFactory.OPTION_CONTENT_ONLY));
  SModelReference ref;
  if (relPath == null || moduleRef == null || modelName == null) {
    if (!(contentOnly)) {
      if (dataSource instanceof FileDataSource) {
        LOG.error("cannot load " + dataSource.getLocation() + ": relPath = "+ relPath,new Throwable());
      }
      throw new IOException("cannot load xml model from " + dataSource.getLocation());
    }
    ref=PersistenceFacade.getInstance().createModelReference(null,SModelId.generate(),"temp");
  }
 else {
    org.jetbrains.mps.openapi.model.SModelId id=PersistenceFacade.getInstance().createModelId("path:" + relPath);
    SModuleReference mref=PersistenceFacade.getInstance().createModuleReference(moduleRef);
    if (mref == null) {
      return null;
    }
    ref=PersistenceFacade.getInstance().createModelReference(mref,id,modelName);
  }
  return new CustomPersistenceSModel(ref,(StreamDataSource)dataSource,this);
}
