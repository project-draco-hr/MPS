{
  myLock.writeLock().lock();
  try {
    if (myPaths.containsKey(path)) {
      return;
    }
    if (modelRoot instanceof FileSystemListener) {
      myListenerDependencies.add((FileSystemListener)modelRoot);
    }
 else     if (modelRoot != null && modelRoot.getModule() instanceof FileSystemListener) {
      myListenerDependencies.add((FileSystemListener)modelRoot.getModule());
    }
    PathListener listener=new PathListener(path,this);
    myPaths.put(path.getPath(),listener);
    if (!(myListeners.isEmpty())) {
      ((jetbrains.mps.vfs.FileSystem)path.getFileSystem()).addListener(listener);
    }
  }
  finally {
    myLock.writeLock().unlock();
  }
}
