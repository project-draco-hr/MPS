{
  if (getSettings().OPTIMIZE_IMPORTS_BEFORE_PROJECT_COMMIT) {
    Collection<File> affectedFiles=myPanel.getFiles();
    final List<SModelDescriptor> affectedModels=new ArrayList<SModelDescriptor>();
    SModelRepository modelRepository=SModelRepository.getInstance();
    for (    File file : affectedFiles) {
      SModelDescriptor model=SModelFileTracker.getInstance().findModel(FileSystem.getInstance().getFileByPath(file.getAbsolutePath()));
      if (model == null) {
        continue;
      }
      affectedModels.add(model);
    }
    final IOperationContext operationContext=new ProjectOperationContext(ProjectHelper.toMPSProject(myProject));
    ThreadUtils.assertEDT();
    try {
      jetbrains.mps.project.Project project=operationContext.getProject();
      if (project != null) {
        ModelAccess.instance().runCommandInEDT(new Runnable(){
          public void run(){
            new OptimizeImportsHelper(operationContext).optimizeModelsImports(affectedModels);
            for (            SModelDescriptor affectedModel : affectedModels) {
              ((EditableSModelDescriptor)affectedModel).save();
            }
          }
        }
,project);
      }
    }
 catch (    Throwable e) {
      LOG.error("Couldn't optimize imports before commit",e);
    }
  }
  return CheckinHandler.ReturnResult.COMMIT;
}
