{
  OldPQTreeNode newQNode=new OldQNode();
  newQNode.setState(OldPQTreeNode.State.PARTIAL);
  List<OldPQTreeNode> children=getChildren();
  OldPQTreeNode.State firstChildState=ListSequence.fromList(children).first().getState();
  if (firstChildState == OldPQTreeNode.State.FULL || (firstChildState == OldPQTreeNode.State.PARTIAL && ListSequence.fromList(children).last().getState() == OldPQTreeNode.State.EMPTY)) {
    children=ListSequence.fromList(children).reversedList();
  }
  for (  OldPQTreeNode child : ListSequence.fromList(children)) {
    if (child.getState() == OldPQTreeNode.State.PARTIAL) {
      List<OldPQTreeNode> partialChildren=child.getChildren();
      if (ListSequence.fromList(partialChildren).first().getState() == OldPQTreeNode.State.FULL) {
        partialChildren=ListSequence.fromList(partialChildren).reversedList();
      }
      for (      OldPQTreeNode partialChild : ListSequence.fromList(partialChildren)) {
        newQNode.addLastChild(partialChild);
      }
    }
 else {
      newQNode.addLastChild(child);
    }
  }
  return newQNode;
}
