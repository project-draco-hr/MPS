{
  clearForTypesModel(typesModel);
  for (  ContextDeclaration contextDeclaration : typesModel.getRoots(ContextDeclaration.class)) {
    ContextsManager.getInstance().registerNewContext(contextDeclaration.getName());
  }
  for (  EquationSetDeclaration equationSet : typesModel.getRoots(EquationSetDeclaration.class)) {
    EquationManager.getInstance().registerNewEquationSet(equationSet.getName());
  }
  List<Rule> rules=new ArrayList<Rule>();
  for (  Rule rule : typesModel.getRoots(Rule.class)) {
    rules.add(rule);
  }
  List<SNode> frontier=new ArrayList<SNode>();
  List<SNode> newFrontier=new ArrayList<SNode>();
  frontier.add(root);
  while (!(frontier.isEmpty())) {
    for (    SNode node : frontier) {
      newFrontier.addAll(node.getChildren());
      for (      Rule rule : rules) {
        Interpretator.interpretate(node,rule);
      }
    }
    frontier=newFrontier;
    newFrontier=new ArrayList<SNode>();
  }
  EquationManager.getInstance().solveAllEquations();
  Set<Set<Pair<SNode,SNode>>> allContexts=ContextsManager.getInstance().getAllContexts();
  if (allContexts.isEmpty())   return;
  Set<Pair<SNode,SNode>> mainContext=allContexts.iterator().next();
  for (  Pair<SNode,SNode> contextEntry : mainContext) {
    SNode term=contextEntry.o1;
    term.putUserObject(TYPE_OF_TERM,contextEntry.o2);
  }
}
