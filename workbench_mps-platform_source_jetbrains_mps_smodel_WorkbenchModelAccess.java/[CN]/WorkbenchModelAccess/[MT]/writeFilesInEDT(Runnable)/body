{
  runReadInWriteAction(new Computable<Object>(){
    @Override public Object compute(){
      if (ApplicationManager.getApplication().isDispatchThread()) {
        runReadInWriteWorker(action);
      }
 else {
        LOG.error("EDT should have IDEA write lock",new Exception());
        throw new IllegalStateException();
      }
      return null;
    }
  }
);
}
