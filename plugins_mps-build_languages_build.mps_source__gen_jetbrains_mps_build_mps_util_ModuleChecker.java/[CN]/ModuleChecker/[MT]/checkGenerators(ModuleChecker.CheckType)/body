{
  SNode language=SNodeOperations.cast(myModule,"jetbrains.mps.build.mps.structure.BuildMps_Language");
  LanguageDescriptor languageDescriptor=(LanguageDescriptor)myModuleDescriptor;
  String langName=languageDescriptor.getModuleReference().getModuleName();
  if (languageDescriptor.getGenerators().size() > 1) {
    report("more than one generator for language `" + langName + "'",myOriginalModule);
    return;
  }
  if (languageDescriptor.getGenerators().isEmpty()) {
    if (type.doCheck && (SLinkOperations.getTarget(language,"generator",true) != null)) {
      report("no generators in module descriptor for `" + langName + "'",myOriginalModule);
    }
    if (type.doPartialImport) {
      SLinkOperations.setTarget(language,"generator",null,true);
    }
    return;
  }
  GeneratorDescriptor generatorDescriptor=languageDescriptor.getGenerators().get(0);
  String generatorName=generatorDescriptor.getGeneratorUID();
  if (generatorName != null && !(generatorName.startsWith(langName + "#"))) {
    report("wrong generator name `" + generatorName + "', should start with `"+ langName+ "#'",myOriginalModule);
    return;
  }
  if (type.doCheck && (SLinkOperations.getTarget(language,"generator",true) == null)) {
    report("language generator should be extracted for `" + langName + "'",myOriginalModule);
    return;
  }
  if (type.doPartialImport & (SLinkOperations.getTarget(language,"generator",true) == null)) {
    SLinkOperations.setTarget(language,"generator",SModelOperations.createNewNode(SNodeOperations.getModel(language),null,"jetbrains.mps.build.mps.structure.BuildMps_Generator"),true);
  }
  ModuleChecker moduleCheckerForGenerator=new ModuleChecker(SLinkOperations.getTarget(language,"generator",true),SLinkOperations.getTarget(language,"generator",true),myVisibleModules,myPathConverter,myGenContext,myModuleSourceDir,generatorDescriptor,myReporter);
  moduleCheckerForGenerator.check(type);
  if (type.doFullImport) {
    Set<SNode> alreadyInDeps=unwrapExtractedDeps(language);
    SetSequence.fromSet(alreadyInDeps).addElement(language);
    Set<SNode> generatorDeps=unwrapExtractedDeps(SLinkOperations.getTarget(language,"generator",true));
    for (    SNode dep : generatorDeps) {
      SNode extraDep=dep;
      if (SNodeOperations.isInstanceOf(dep,"jetbrains.mps.build.mps.structure.BuildMps_Generator")) {
        extraDep=SLinkOperations.getTarget(SNodeOperations.cast(dep,"jetbrains.mps.build.mps.structure.BuildMps_Generator"),"sourceLanguage",false);
      }
      if (SetSequence.fromSet(alreadyInDeps).contains(extraDep)) {
        continue;
      }
      SNode newDep=SModelOperations.createNewNode(SNodeOperations.getModel(language),null,"jetbrains.mps.build.mps.structure.BuildMps_ModuleDependencyOnModule");
      SLinkOperations.setTarget(newDep,"module",extraDep,false);
      ListSequence.fromList(SLinkOperations.getTargets(language,"dependencies",true)).addElement(newDep);
      SetSequence.fromSet(alreadyInDeps).addElement(extraDep);
    }
  }
}
