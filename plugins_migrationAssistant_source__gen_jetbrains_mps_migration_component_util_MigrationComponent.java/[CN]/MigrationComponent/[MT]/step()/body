{
  Iterable<Pair<MigrationScript,AbstractModule>> allStepScripts=fetchScripts();
  Iterable<Pair<MigrationScript,AbstractModule>> availableScripts=Sequence.fromIterable(allStepScripts).where(new IWhereFilter<Pair<MigrationScript,AbstractModule>>(){
    public boolean accept(    Pair<MigrationScript,AbstractModule> it){
      return isAvailable(it);
    }
  }
);
  if (Sequence.fromIterable(allStepScripts).isNotEmpty()) {
    MigrationsUtil.executeScript(Sequence.fromIterable(availableScripts).first().first,Sequence.fromIterable(availableScripts).first().second);
    return MigrationManager.MigrationState.STEP;
  }
 else {
    if (Sequence.fromIterable(allStepScripts).isEmpty()) {
      return MigrationManager.MigrationState.FINISHED;
    }
 else {
      lastState=MigrationManager.MigrationState.CONFLICT;
      return MigrationManager.MigrationState.CONFLICT;
    }
  }
}
