{
  Graph graph=embeddedGraph.getGraph();
  List<Edge> oldEdges=ListSequence.<Edge>fromList(new ArrayList<Edge>());
  ListSequence.<Edge>fromList(oldEdges).addSequence(ListSequence.<Edge>fromList(graph.getEdges()));
  List<Node> oldNodes=ListSequence.<Node>fromList(new ArrayList<Node>());
  ListSequence.<Node>fromList(oldNodes).addSequence(ListSequence.<Node>fromList(graph.getNodes()));
  Map<Dart,Integer> bends=MapSequence.<Dart,Integer>fromMap(new HashMap<Dart,Integer>());
  Map<Dart,Integer> angles=MapSequence.<Dart,Integer>fromMap(new HashMap<Dart,Integer>());
  QuasiOrthogonalRepresentation.getRepresentation(embeddedGraph,bends,angles);
  if (OrthogonalPointFlowLayouter.SHOW_lOG > 0) {
    System.out.println("bends:");
    System.out.println(bends);
  }
  if (OrthogonalPointFlowLayouter.SHOW_TIME > 0) {
    long newTime=System.currentTimeMillis();
    System.out.println("finding the representation: " + ((newTime - curTime) / OrthogonalPointFlowLayouter.MILLIS));
    curTime=newTime;
  }
  new QuasiRepresentationModifier(embeddedGraph,bends,angles).reduceToOrthogonalRepresentation();
  OrthogonalRepresentation.replaceBendsByNodes(embeddedGraph,bends,angles);
  Map<Dart,Direction2D> directions=OrthogonalRepresentation.getDirections(embeddedGraph,angles);
  EmbeddedGraphModifier modifier=new EmbeddedGraphModifier(embeddedGraph);
  modifier.setDartDirections(directions);
  modifier.makeRectangularFaces();
  if (OrthogonalPointFlowLayouter.SHOW_lOG > 0) {
    System.out.println("after making faces rectangular: ");
    printEmbeddedGraphWithDirections(embeddedGraph,directions);
  }
  if (OrthogonalPointFlowLayouter.SHOW_TIME > 0) {
    long newTime=System.currentTimeMillis();
    System.out.println("making faces rectangular: " + ((newTime - curTime) / OrthogonalPointFlowLayouter.MILLIS));
    System.out.println("graph now has " + ListSequence.<Node>fromList(graph.getNodes()).count() + " nodes and "+ ListSequence.<Edge>fromList(graph.getEdges()).count()+ " edges");
    curTime=newTime;
  }
  Map<Edge,Integer> lengths=new EdgeLengthComputer().compute(embeddedGraph,directions);
  Map<Node,Point> coordinates;
  ConstraintsGraphProcessor processor=new ConstraintsGraphProcessor(embeddedGraph,directions);
  processor.constructGraph();
  coordinates=processor.getCoordinates();
  GraphPointLayout graphLayout=new GraphPointLayout(graph);
  for (  Node node : ListSequence.<Node>fromList(oldNodes)) {
    graphLayout.setLayoutFor(node,MapSequence.<Node,Point>fromMap(coordinates).get(node));
  }
  for (  Edge edge : ListSequence.<Edge>fromList(oldEdges)) {
    List<Edge> history=historyManager.getHistory(edge);
    List<Point> edgeLayout=ListSequence.<Point>fromList(new ArrayList<Point>());
    Node cur=edge.getSource();
    ListSequence.<Point>fromList(edgeLayout).addElement(MapSequence.<Node,Point>fromMap(coordinates).get(cur));
    for (    Edge historyEdge : ListSequence.<Edge>fromList(history)) {
      Node next=historyEdge.getOpposite(cur);
      ListSequence.<Point>fromList(edgeLayout).addElement(MapSequence.<Node,Point>fromMap(coordinates).get(next));
      cur=next;
    }
    graphLayout.setLayoutFor(edge,edgeLayout);
  }
  if (OrthogonalPointFlowLayouter.SHOW_TIME > 0) {
    long newTime=System.currentTimeMillis();
    System.out.println("finding layout: " + ((newTime - curTime) / OrthogonalPointFlowLayouter.MILLIS));
    curTime=newTime;
  }
  return graphLayout;
}
