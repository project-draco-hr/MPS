{
  EditorComponent editorComponent=context.getNodeEditorComponent();
  TextBuilder textBuilder=TextRenderUtil.getTextBuilderForSelectedCellsOfEditor(editorComponent);
  SelectionManager selectionManager=editorComponent.getSelectionManager();
  List<EditorCell> selectedCells=selectionManager.getSelection().getSelectedCells();
  if (selectedCells.size() == 0) {
    return null;
  }
  if (selectedCells.size() > 1) {
    LOG.debug("Copy " + selectedCells.size() + " nodes : ");
    for (    EditorCell aCell : selectedCells) {
      LOG.debug("    " + aCell.getSNode().getDebugText());
    }
  }
 else {
    LOG.debug("Copy node : " + selectedCells.get(0).getSNode().getDebugText());
  }
  List<SNode> copyNodeList=new ArrayList<SNode>();
  Map<SNode,Set<SNode>> nodesAndAttributes=new HashMap<SNode,Set<SNode>>();
  for (  EditorCell selectedCell : selectedCells) {
    SNode node=selectedCell.getSNode();
    final SNode parent=node.getParent();
    if (parent != null && AttributeOperations.isAttribute(node)) {
      Condition<EditorCell> condition=new Condition<EditorCell>(){
        public boolean met(        EditorCell object){
          SNode selectedNode=object.getSNode();
          return selectedNode != null && selectedNode.getParent() == parent && AttributeOperations.isAttribute(selectedNode);
        }
      }
;
      Set<SNode> selectedAttributes=new HashSet<SNode>();
      if (selectedCell instanceof EditorCell_Collection) {
        EditorCell_Collection selectedCollection=(EditorCell_Collection)selectedCell;
        for (        EditorCell cell : selectedCollection.dfsCells()) {
          if (condition.met(cell)) {
            selectedAttributes.add(cell.getSNode());
          }
        }
      }
 else {
        if (condition.met(selectedCell)) {
          selectedAttributes.add(selectedCell.getSNode());
        }
      }
      copyNodeList.add(parent);
      nodesAndAttributes.put(parent,selectedAttributes);
    }
 else {
      copyNodeList.add(node);
    }
  }
  return new MultiTuple._3<List<SNode>,Map<SNode,Set<SNode>>,String>(copyNodeList,nodesAndAttributes,textBuilder.getText());
}
