{
  EditorComponent editorComponent=context.getNodeEditorComponent();
  TextBuilder textBuilder=TextRenderUtil.getTextBuilderForSelectedCellsOfEditor(editorComponent);
  SelectionManager selectionManager=editorComponent.getSelectionManager();
  List<SNode> selectedNodes=selectionManager.getSelection().getSelectedNodes();
  if (selectedNodes.size() == 0) {
    return null;
  }
  if (selectedNodes.size() > 1) {
    LOG.debug("Copy " + selectedNodes.size() + " nodes : ");
    for (    SNode aNodeList : selectedNodes) {
      LOG.debug("    " + aNodeList.getDebugText());
    }
  }
 else {
    LOG.debug("Copy node : " + selectedNodes.get(0).getDebugText());
  }
  List<SNode> copyNodeList=new ArrayList<SNode>();
  Map<SNode,Set<SNode>> nodesAndAttributes=new HashMap<SNode,Set<SNode>>();
  for (  SNode node : selectedNodes) {
    final SNode parent=node.getParent();
    if (parent != null && AttributeOperations.isAttribute(node)) {
      EditorCell selectedCell=editorComponent.getSelectedCell();
      Condition<EditorCell> condition=new Condition<EditorCell>(){
        public boolean met(        EditorCell object){
          SNode selectedNode=object.getSNode();
          return selectedNode != null && selectedNode.getParent() == parent && AttributeOperations.isAttribute(selectedNode);
        }
      }
;
      Set<SNode> selectedAttributes=new HashSet<SNode>();
      if (selectedCell instanceof EditorCell_Collection) {
        EditorCell_Collection selectedCollection=(EditorCell_Collection)selectedCell;
        for (        EditorCell cell : selectedCollection.dfsCells()) {
          if (condition.met(cell)) {
            selectedAttributes.add(cell.getSNode());
          }
        }
      }
 else {
        if (condition.met(selectedCell)) {
          selectedAttributes.add(selectedCell.getSNode());
        }
      }
      copyNodeList.add(parent);
      nodesAndAttributes.put(parent,selectedAttributes);
    }
 else {
      copyNodeList.add(node);
    }
  }
  return new MultiTuple._3<List<SNode>,Map<SNode,Set<SNode>>,String>(copyNodeList,nodesAndAttributes,textBuilder.getText());
}
