{
  final boolean needToRegenerate=myRegenerateLanguage.getModel().isSelected();
  final String fqName=getCurrentValue();
  if (ModuleRepositoryFacade.getInstance().getModule(fqName,Language.class) != null) {
    setErrorText("Duplicate language name");
    return;
  }
  if (!((SourceVersion.isName(fqName)))) {
    setErrorText("Language namespace should be valid Java package");
    return;
  }
  final LanguageRenamer renamer=new LanguageRenamer(myProject,myLanguage,fqName);
  ModelAccess modelAccess=myProject.getRepository().getModelAccess();
  modelAccess.executeCommand(new Runnable(){
    public void run(){
      renamer.rename(needToRegenerate);
      renamer.update();
    }
  }
);
  if (needToRegenerate) {
    final Set<Language> langs=new LinkedHashSet<Language>();
    modelAccess.runReadAction(new Runnable(){
      public void run(){
        langs.add(myLanguage);
        langs.addAll(ModuleRepositoryFacade.getInstance().getAllExtendingLanguages(myLanguage));
      }
    }
);
    for (    final Language l : langs) {
      final Wrappers._T<GenParameters> params=new Wrappers._T<GenParameters>(null);
      modelAccess.runReadAction(new Runnable(){
        public void run(){
          ModuleTestConfiguration languageConfig=new ModuleTestConfiguration();
          languageConfig.setModuleRef(l.getModuleReference());
          languageConfig.setName("tmp");
          try {
            params.value=languageConfig.getGenParams(myProject,true);
          }
 catch (          IllegalGeneratorConfigurationException ignored) {
          }
        }
      }
);
      if (params.value == null) {
        setErrorText("Rebuild configuration is invalid");
        return;
      }
      ModuleContext context=new ModuleContext(myLanguage,myProject);
      MakeSession sess=new MakeSession(context);
      if (IMakeService.INSTANCE.get().openNewSession(sess)) {
        IMakeService.INSTANCE.get().make(sess,new ModelsToResources(context,ListSequence.fromListWithValues(new ArrayList<SModel>(),(Iterable<SModel>)params.value.getModelDescriptors())).resources(false));
      }
    }
  }
  super.doRefactoringAction();
}
