{
  if (containsKey(key)) {
    if (!ObjectUtils.equals(get(key),value)) {
      throw new IllegalArgumentException();
    }
 else {
      return value;
    }
  }
 else {
synchronized (lock) {
      if (containsKey(key)) {
        if (!ObjectUtils.equals(get(key),value)) {
          throw new IllegalArgumentException();
        }
 else {
          return value;
        }
      }
 else {
        if (list.size() < MAX_LIST_ELEMENTS_COUNT) {
          list=ImmutableList.of(new Pair<K,V>(key,value),list);
        }
 else {
          if (map == null) {
            map=new THashMap<K,V>(5);
          }
          map.put(key,value);
        }
        return null;
      }
    }
  }
}
