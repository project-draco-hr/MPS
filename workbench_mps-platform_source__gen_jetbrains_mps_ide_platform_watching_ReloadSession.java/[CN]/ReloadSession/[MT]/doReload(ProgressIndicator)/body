{
  LOG.debug("Starting reload for:\n" + ((SetSequence.fromSet(myChangedModules).isEmpty() ? "" : "Changed modules : " + myChangedModules + "\n")) + ((SetSequence.fromSet(myChangedProjects).isEmpty() ? "" : "Changed projects : " + myChangedProjects + "\n"))+ ((SetSequence.fromSet(myNewModelVFiles).isEmpty() ? "" : "New models : " + myNewModelVFiles + "\n"))+ ((SetSequence.fromSet(myNewModuleVFiles).isEmpty() ? "" : "New modules : " + myNewModuleVFiles + "\n"))+ ((SetSequence.fromSet(myDeletedModules).isEmpty() ? "" : "Deleted modules : " + myDeletedModules + "\n")));
  fireReloadStarted();
  try {
    if (!(SetSequence.fromSet(myNewModuleVFiles).isEmpty())) {
      if (log.isInfoEnabled()) {
        log.info("Reloading libraries.");
      }
      indicator.setText("Reloading libraries... Please wait.");
      ModelAccess.instance().runWriteAction(new Runnable(){
        public void run(){
          LibraryInitializer.getInstance().update();
        }
      }
);
    }
    preprocess();
    boolean areModulesUpdated=updateModules(indicator);
    updateModels(indicator);
    if (areModulesUpdated || !(SetSequence.fromSet(myNewModuleVFiles).isEmpty())) {
      indicator.setText("Reloading classes... Please wait.");
      if (log.isInfoEnabled()) {
        log.info("Reloading classes.");
      }
      ModelAccess.instance().runWriteAction(new Runnable(){
        public void run(){
          ClassLoaderManager.getInstance().reloadAll(new EmptyProgressMonitor());
        }
      }
);
    }
  }
  finally {
    if (log.isInfoEnabled()) {
      log.info("Reload finished.");
    }
    fireReloadFinished();
  }
}
