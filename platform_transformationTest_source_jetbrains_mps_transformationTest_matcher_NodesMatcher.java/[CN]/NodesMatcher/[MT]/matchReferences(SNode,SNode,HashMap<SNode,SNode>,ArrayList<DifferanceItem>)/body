{
  HashSet<String> roles=new HashSet<String>();
  roles.addAll(a.getReferenceRoles());
  roles.addAll(b.getReferenceRoles());
  for (  String role : roles) {
    SNode reference1=null;
    if (a.getReference(role) != null) {
      reference1=a.getReference(role).getTargetNode();
    }
    SNode reference2=null;
    if (b.getReference(role) != null) {
      reference2=b.getReference(role).getTargetNode();
    }
    if (map.containsKey(reference1)) {
      if (map.get(reference1) != reference2) {
        difference.add(new ReferenceDifferense(role,true));
      }
    }
 else {
      if (reference1 != reference2) {
        difference.add(new ReferenceDifferense(role,false));
      }
    }
  }
}
