{
  if (IdeMain.isTestMode()) {
    return;
  }
  myMessagesInProgress.incrementAndGet();
  ThreadUtils.runInUIThreadNoWait(new Runnable(){
    public void run(){
      int messages=myMessagesInProgress.decrementAndGet();
      if (myMessages.size() >= MAX_MESSAGES_SIZE) {
        PostedMessage toRemove=myMessages.remove();
        if (isVisible(toRemove.getFirst())) {
          myModel.removeElement(toRemove);
        }
      }
      if (isVisible(message)) {
        myModel.addElement(message);
        int index=myModel.size() - 1;
        myList.getSelectionModel().setSelectionInterval(index,index);
        if (messages == 0) {
          myList.ensureIndexIsVisible(index);
        }
      }
      myMessages.add(new PostedMessage(message,poster));
      int width=getMessageWidth(message);
      if (width > myList.getFixedCellWidth()) {
        myList.setFixedCellWidth(width);
      }
      updateActions();
    }
  }
);
}
