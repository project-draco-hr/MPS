{
  Collection<SReference> refs=node.getReferencesIterable();
  os.writeInt(refs.size());
  for (  SReference reference : refs) {
    SModelReference targetModelReference=reference.getTargetSModelReference();
    if (reference instanceof StaticReference) {
      os.writeInt(1);
      os.writeNodeId(reference.getTargetNodeId());
    }
 else     if (reference instanceof DynamicReference) {
      os.writeInt(2);
    }
 else {
      throw new IOException("cannot store reference: " + reference.toString());
    }
    os.writeString(reference.getRole());
    os.writeModelReference(targetModelReference != null && targetModelReference.equals(myModelReference) ? TransientModelPersistence.LOCAL : targetModelReference);
    os.writeString(reference.getResolveInfo());
  }
}
