{
  if (FileSystem.getInstance().isFileIgnored(dir.getName()))   return;
  if (!dir.isDirectory())   return;
  List<IFile> files=dir.getChildren();
  for (  IFile file : files) {
    String fileName=file.getName();
    String extension=FileUtil.getExtension(fileName);
    if (extension == null)     continue;
    ModelFactory modelFactory=PersistenceFacade.getInstance().getModelFactory(extension);
    if (modelFactory == null)     continue;
    FileDataSource source=new FileDataSource(file,this);
    SModel model=modelFactory.load(source);
    if (model != null) {
      model.setModelRoot(this);
      models.add(model);
    }
  }
  for (  IFile childDir : files) {
    if (childDir.isDirectory()) {
      collectModels(childDir,models);
    }
  }
}
