{
  SModel ourModel=new jetbrains.mps.smodel.SModel(myModelRef);
  for (  PsiJavaFile jf : Sequence.fromIterable(myDataSource.getJavaFiles())) {
    BiMap<SNodeId,PsiElement> mapping=HashBiMap.create();
    MapSequence.fromMap(myMps2PsiMappings).put(jf,mapping);
    ASTConverter converter=new ASTConverter(mapping);
    Set<SNode> roots=SetSequence.fromSet(new HashSet<SNode>());
    for (    PsiClass cls : jf.getClasses()) {
      SNode node=converter.convertClass(cls);
      SModelOperations.addRootNode(ourModel,node);
      SetSequence.fromSet(roots).addElement(node);
      MapSequence.fromMap(myRootsById).put(node.getNodeId(),node);
    }
    if (SetSequence.fromSet(roots).isNotEmpty()) {
      MapSequence.fromMap(myRootsPerFile).put(jf,roots);
    }
  }
  return ourModel;
}
