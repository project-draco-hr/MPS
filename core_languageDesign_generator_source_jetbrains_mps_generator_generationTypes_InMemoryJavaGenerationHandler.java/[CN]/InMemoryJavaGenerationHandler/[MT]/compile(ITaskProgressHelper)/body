{
  myCompiler=createJavaCompiler(myContextModules);
  for (  String key : myJavaSources) {
    myCompiler.addSource(getJavaNameFromKey(key),mySources.get(key));
  }
  progress.setText2("Compiling...");
  myCompiler.compile();
  progress.setText2("Compilation finished.");
  List<CompilationResult> result=myCompiler.getCompilationResults();
  boolean hasErrors=false;
  for (  CompilationResult cr : result) {
    if (cr.hasErrors()) {
      hasErrors=true;
      CategorizedProblem[] categorizedProblems=cr.getErrors();
      for (int i=0; i < 3 && i < categorizedProblems.length; i++) {
        error("" + categorizedProblems[i]);
      }
      info("Compilation finished with errors.");
      break;
    }
  }
  if (!myKeepSources) {
    mySources.clear();
    myJavaSources.clear();
  }
  myContextModules.clear();
  progress.setText2("reloading MPS classes...");
  if (myReloadClasses && !hasErrors) {
    ClassLoaderManager.getInstance().reloadAll(new EmptyProgressIndicator());
  }
  return hasErrors ? null : result;
}
