{
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      SModel loadedModel=null;
      if (state != null) {
        try {
          loadedModel=PersistenceUtil.loadModel(state,MPSExtentions.MODEL);
        }
 catch (        Exception e) {
          if (LOG.isEnabledFor(Priority.ERROR)) {
            LOG.error("Error on loading console history",e);
          }
        }
      }
      if (loadedModel == null || ListSequence.fromList(SModelOperations.getRoots(loadedModel,"jetbrains.mps.console.base.structure.History")).isEmpty()) {
        myHistory=SConceptOperations.createNewNode("jetbrains.mps.console.base.structure.History",null);
      }
 else {
        myHistory=ListSequence.fromList(SModelOperations.getRoots(loadedModel,"jetbrains.mps.console.base.structure.History")).first();
      }
      SModelOperations.addRootNode(myModel,myHistory);
      TemporaryModels.getInstance().addMissingImports(myModel);
    }
  }
);
}
