{
  final int length=HashUtil.adjustTableLength((int)(capacity / loadFactor));
  this.capacity=capacity;
  if (length != table.length) {
    final Iterator<Map.Entry<K,V>> entries=entrySet().iterator();
    allocateTable(length);
    final Entry<K,V>[] table=this.table;
    final int shift=this.shift;
    final int mask=this.mask;
    while (entries.hasNext()) {
      final Entry<K,V> e=(Entry<K,V>)entries.next();
      final int index=HashUtil.indexFor(e.keyHash,length,shift,mask);
      e.hashNext=table[index];
      table[index]=e;
    }
  }
}
