{
  HashSet<String> roles=new HashSet<String>();
  roles.addAll(SNodeOperations.getChildRoles(a));
  roles.addAll(SNodeOperations.getChildRoles(b));
  for (  String role : roles) {
    List<? extends SNode> children1=IterableUtil.asList(a.getChildren(role));
    List<? extends SNode> children2=IterableUtil.asList(b.getChildren(role));
    if (children1.size() != children2.size()) {
      difference.add(new ChildrenCountDifference(role,children1.size(),children2.size()));
      continue;
    }
    for (int i=0; i < children1.size(); i++) {
      NodeDifference d=NodesMatcher.matchNodes(children1.get(i),children2.get(i),map);
      if (d != null) {
        difference.add(d);
      }
    }
  }
}
