{
  Map<String,SReference> references1=getReferencesMap(a);
  Map<String,SReference> references2=getReferencesMap(b);
  HashSet<String> roles=new HashSet<String>();
  roles.addAll(references1.keySet());
  roles.addAll(references2.keySet());
  for (  String role : roles) {
    SReference reference1=references1.get(role);
    SNode referenceTarget1=null;
    if (reference1 != null) {
      referenceTarget1=reference1.getTargetNode();
    }
    SReference reference2=references2.get(role);
    SNode referenceTarget2=null;
    if (reference2 != null) {
      referenceTarget2=reference2.getTargetNode();
    }
    if (map.containsKey(referenceTarget1)) {
      if (map.get(referenceTarget1) != referenceTarget2) {
        difference.add(new ReferenceDifferense(role,true));
      }
    }
 else {
      if (referenceTarget1 != referenceTarget2) {
        difference.add(new ReferenceDifferense(role,false));
      }
    }
  }
}
