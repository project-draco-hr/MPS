{
  XmlFastScanner scanner=new XmlFastScanner(content.toCharArray());
  int depth=0;
  int token;
  int rootStart=-1;
  String rootId=null;
  boolean isEmpty=true;
  while ((token=scanner.next()) != XmlFastScanner.EOI) {
switch (token) {
case XmlFastScanner.OPEN_TAG:
      depth++;
    if (depth == 2 && ModelPersistence8.ROOT_NODE.equals(scanner.getName())) {
      rootStart=scanner.getTokenOffset();
      rootId=IHashProvider.extractId(scanner.token());
      if (rootId != null && isEmpty) {
        rootHashes.put(GeneratableSModel.HEADER,ModelDigestUtil.hashText(scanner.getText(0,rootStart)));
        isEmpty=false;
      }
    }
  break;
case XmlFastScanner.SIMPLE_TAG:
if (depth == 1 && ModelPersistence8.ROOT_NODE.equals(scanner.getName())) {
  rootId=IHashProvider.extractId(scanner.token());
  if (rootId != null) {
    String s=scanner.getText(scanner.getTokenOffset(),scanner.getOffset());
    rootHashes.put(rootId,ModelDigestUtil.hashText(s));
  }
}
break;
case XmlFastScanner.CLOSE_TAG:
if (depth == 2) {
if (rootId != null && ModelPersistence8.ROOT_NODE.equals(scanner.getName())) {
String s=scanner.getText(rootStart,scanner.getOffset());
rootHashes.put(rootId,ModelDigestUtil.hashText(s));
}
rootStart=-1;
rootId=null;
}
depth--;
break;
default :
}
}
if (depth != 0) {
LOG.error("xml: bad data");
}
if (isEmpty) {
rootHashes.put(GeneratableSModel.HEADER,ModelDigestUtil.hashText(content));
}
}
