{
  SNode typeCopy=SNodeOperations.copyNode(type);
  for (  SNode typeVariableRef : ListSequence.fromList(SNodeOperations.getDescendants(typeCopy,"jetbrains.mps.baseLanguage.structure.TypeVariableReference",false,new String[]{}))) {
    if (!(SetSequence.fromSet(typeParams).contains(SLinkOperations.getTarget(typeVariableRef,"typeVariableDeclaration",false)))) {
      continue;
    }
    if (SNodeOperations.isInstanceOf(SNodeOperations.getParent(typeVariableRef),"jetbrains.mps.baseLanguage.structure.UpperBoundType") && SNodeOperations.hasRole(typeVariableRef,"jetbrains.mps.baseLanguage.structure.UpperBoundType","bound") || SNodeOperations.isInstanceOf(SNodeOperations.getParent(typeVariableRef),"jetbrains.mps.baseLanguage.structure.LowerBoundType") && SNodeOperations.hasRole(typeVariableRef,"jetbrains.mps.baseLanguage.structure.LowerBoundType","bound")) {
      SNodeOperations.replaceWithNewChild(SNodeOperations.getParent(typeVariableRef),"jetbrains.mps.baseLanguage.structure.WildCardType");
    }
 else {
      SNodeOperations.replaceWithNewChild(typeVariableRef,"jetbrains.mps.baseLanguage.structure.WildCardType");
    }
  }
  return typeCopy;
}
