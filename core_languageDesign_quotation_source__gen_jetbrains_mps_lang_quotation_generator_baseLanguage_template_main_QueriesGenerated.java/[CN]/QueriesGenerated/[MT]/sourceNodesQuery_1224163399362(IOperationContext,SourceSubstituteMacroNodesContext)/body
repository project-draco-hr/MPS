{
  SNode root=SLinkOperations.getTarget(_context.getNode(),"quotedNode",true);
  List<SNode> result=ListOperations.<SNode>createList();
  List<SNode> frontier=ListOperations.<SNode>createList();
  SModel model=_context.getOutputModel();
  ListSequence.fromList(frontier).addElement(root);
  List<SNode> newFrontier=ListOperations.<SNode>createList();
  while (ListSequence.fromList(frontier).isNotEmpty()) {
    for (    SNode node : frontier) {
      for (      SNode child : SNodeOperations.getChildren(node)) {
        if (!(SNodeOperations.isInstanceOf(child,"jetbrains.mps.lang.quotation.structure.AbstractAntiquotation"))) {
          for (          SReference reference : child.getReferences()) {
            if (SLinkOperations.getTarget(child,AttributesRolesUtil.childRoleFromLinkAttributeRole("referenceAntiquotation",reference.getRole()),true) != null) {
              continue;
            }
            SNode targetNode=reference.getTargetNode();
            if (SNodeOperations.getAncestor(targetNode,"jetbrains.mps.lang.quotation.structure.Quotation",false,false) == SNodeOperations.getAncestor(child,"jetbrains.mps.lang.quotation.structure.Quotation",false,false)) {
              SNode referenceNode=BaseConcept.newInstance(model).getNode();
              referenceNode.setProperty("role",reference.getRole());
              referenceNode.setReferent("targetNode",targetNode);
              referenceNode.setReferent("sourceNode",child);
              ListSequence.fromList(result).addElement(referenceNode);
            }
          }
          ListSequence.fromList(newFrontier).addElement(child);
        }
      }
    }
    frontier=newFrontier;
    newFrontier=ListOperations.<SNode>createList();
  }
  return result;
}
