{
  try {
    final MessagesViewTool tool=((Project)MapSequence.fromMap(_params).get("project")).getComponent(MessagesViewTool.class);
    if (tool == null) {
      if (LOG.isEnabledFor(Priority.ERROR)) {
        LOG.error("cannot get message view tool");
      }
    }
    IMessageHandler mh=new IMessageHandler(){
      public void handle(      IMessage p0){
        tool.add(p0,"Migrate structure");
      }
      public void clear(){
        tool.clear("Migrate structure");
      }
    }
;
    Language language=(Language)((SModule)MapSequence.fromMap(_params).get("module"));
    mh.handle(new Message(MessageKind.INFORMATION,"converting " + language.getModuleFqName()));
    Language newStructureLanguage=(Language)MPSModuleRepository.getInstance().getModuleByFqName("jetbrains.mps.core.structure");
    language.addUsedLanguage(newStructureLanguage.getModuleReference());
    String newModelName=language.getModuleName() + ".core";
    SModel desc=SModelRepository.getInstance().getModelDescriptor(newModelName);
    SModel newStructure;
    SNode converted=new LanguageConverter(language,mh).convert();
    if (desc instanceof DefaultSModelDescriptor) {
      MergeSession session=new MergeSession(mh);
      session.replace((DefaultSModelDescriptor)desc,Sequence.<SNode>singleton(converted));
      session.restoreRefs();
      session.apply();
    }
 else {
      DefaultModelRoot root=(DefaultModelRoot)Sequence.fromIterable(((Iterable<ModelRoot>)language.getModelRoots())).where(new IWhereFilter<ModelRoot>(){
        public boolean accept(        ModelRoot it){
          return it instanceof DefaultModelRoot;
        }
      }
).first();
      newStructure=root.createModel(newModelName);
      if (newStructure == null) {
        mh.handle(new Message(MessageKind.INFORMATION,"cannot create model `" + newModelName + "': ()"));
        return;
      }
      ((jetbrains.mps.smodel.SModel)newStructure).addLanguage(newStructureLanguage.getModuleReference());
      newStructure.addRootNode(converted);
    }
  }
 catch (  Throwable t) {
    if (LOG.isEnabledFor(Priority.ERROR)) {
      LOG.error("User's action execute method failed. Action:" + "MigrateStructure",t);
    }
  }
}
