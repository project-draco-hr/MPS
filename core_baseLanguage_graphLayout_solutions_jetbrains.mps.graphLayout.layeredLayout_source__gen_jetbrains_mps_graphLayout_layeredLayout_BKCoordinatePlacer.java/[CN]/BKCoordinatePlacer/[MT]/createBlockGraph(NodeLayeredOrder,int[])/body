{
  Graph blockGraph=new Graph();
  Map<Integer,Node> rootsMap=MapSequence.fromMap(new HashMap<Integer,Node>());
  for (int layer=0; layer < order.getNumLayers(); layer++) {
    Node prevBlock=null;
    for (    int index : ListSequence.fromList(order.getIntOrder(layer))) {
      if (roots[index] == index) {
        MapSequence.fromMap(rootsMap).put(index,blockGraph.addNode());
      }
      Node currentBlock=MapSequence.fromMap(rootsMap).get(roots[index]);
      if (prevBlock != null) {
        prevBlock.addEdgeTo(currentBlock);
      }
      prevBlock=currentBlock;
    }
  }
  return blockGraph;
}
