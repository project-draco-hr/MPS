{
  myProject=project;
  setLayout(new BorderLayout());
  myModelsList=new JBList();
  myModelsList.setCellRenderer(new DefaultListCellRenderer(){
    public Component getListCellRendererComponent(    JList list,    Object value,    int index,    boolean isSelected,    boolean cellHasFocus){
      final org.jetbrains.mps.openapi.model.SModelReference model=(org.jetbrains.mps.openapi.model.SModelReference)value;
      final DefaultListCellRenderer ren=this;
      String modelName=model.getModelName();
      if (modelName == null) {
        modelName="<no name>";
      }
      Component result=super.getListCellRendererComponent(list,modelName,index,isSelected,cellHasFocus);
      if (isSelected) {
        return result;
      }
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          boolean inProject=false;
          for (          SModel projectModel : myProject.getProjectModels()) {
            if (model.equals(projectModel.getModelReference())) {
              inProject=true;
              break;
            }
          }
          if (inProject) {
            ren.setForeground(Color.BLACK);
          }
 else           if (SModelRepository.getInstance().getModelDescriptor(model) != null) {
            ren.setForeground(new Color(128,0,128));
          }
 else {
            ren.setForeground(Color.RED);
          }
        }
      }
);
      return result;
    }
  }
);
  JScrollPane scroller=ScrollPaneFactory.createScrollPane(myModelsList);
  add(scroller,BorderLayout.CENTER);
  ListAddAction addAction=new ListAddAction(myModelsList){
    @Override protected int doAdd(    AnActionEvent e){
      Iterable<SModel> models=myProject.getComponent(MPSProject.class).getProjectModels();
      List<SModelDescriptor> descrs=SModelRepository.getInstance().getModelDescriptors();
      SModelReference modelRef=CommonChoosers.showDialogModelChooser(ModelsPanel.this,Sequence.fromIterable(models).select(new ISelector<SModel,SModelReference>(){
        public SModelReference select(        SModel it){
          return (SModelReference)it.getModelReference();
        }
      }
).toListSequence(),ListSequence.fromList(descrs).select(new ISelector<SModelDescriptor,SModelReference>(){
        public SModelReference select(        SModelDescriptor it){
          return it.getSModelReference();
        }
      }
).toListSequence());
      if (modelRef == null) {
        return -1;
      }
      myModels.add(modelRef);
      if (!(myNamePanel.isConfigNameSet())) {
        String name=NameUtil.shortNameFromLongName(modelRef.getLongName());
        myNamePanel.setConfigName(name);
      }
      return myModels.indexOf(modelRef);
    }
  }
;
  ListRemoveAction removeAction=new ListRemoveAction(myModelsList){
    @Override protected void doRemove(    AnActionEvent e){
      for (      Object o : myModelsList.getSelectedValues()) {
        SModelReference model=(SModelReference)o;
        myModels.remove(model);
      }
    }
  }
;
  add(createToolbar(new AnAction[]{addAction,removeAction}),BorderLayout.EAST);
  bind();
}
