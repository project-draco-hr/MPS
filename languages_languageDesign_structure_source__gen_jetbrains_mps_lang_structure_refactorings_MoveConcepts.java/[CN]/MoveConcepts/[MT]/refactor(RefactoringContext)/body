{
  Language targetLanguage=Language.getLanguageFor(SModelRepository.getInstance().getModelDescriptor(((SModelReference)refactoringContext.getParameter("targetModel"))));
  Map<LanguageAspect,List<SNode>> aspectNodes=ConceptMoveUtil.getAspectNodes(((Language)refactoringContext.getParameter("sourceLanguage")),refactoringContext.getSelectedNodes());
  Iterable<SNode> targExtends=ListSequence.fromList(refactoringContext.getSelectedNodes()).translate(new ITranslator2<SNode,SNode>(){
    public Iterable<SNode> translate(    SNode it){
      return SConceptOperations.getDirectSuperConcepts(it,false);
    }
  }
).subtract(ListSequence.fromList(refactoringContext.getSelectedNodes()));
  List<SModuleReference> targetExtends=Sequence.fromIterable(targExtends).select(new ISelector<SNode,SModel>(){
    public SModel select(    SNode it){
      return SNodeOperations.getModel(it);
    }
  }
).distinct().select(new ISelector<SModel,SModuleReference>(){
    public SModuleReference select(    SModel it){
      return check_u6ijv2_a0a0a0a0a7a0(Language.getLanguageFor(it));
    }
  }
).where(new IWhereFilter<SModuleReference>(){
    public boolean accept(    SModuleReference it){
      return it != null;
    }
  }
).toListSequence();
  SModel srcModel=((SModel)refactoringContext.getParameter("sourceModel"));
  boolean isSourceExtends=ListSequence.fromList(SModelOperations.roots(srcModel,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"))).subtract(ListSequence.fromList(refactoringContext.getSelectedNodes())).translate(new ITranslator2<SNode,SNode>(){
    public Iterable<SNode> translate(    SNode it){
      return SConceptOperations.getDirectSuperConcepts(it,false);
    }
  }
).intersect(ListSequence.fromList(refactoringContext.getSelectedNodes())).isNotEmpty();
  for (  SNode node : refactoringContext.getSelectedNodes()) {
    refactoringContext.changeFeatureName(node,((SModelReference)refactoringContext.getParameter("targetModel")).getModelName() + "." + SPropertyOperations.getString(node,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name")),SPropertyOperations.getString(node,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name")));
  }
  refactoringContext.moveNodesToModel(refactoringContext.getSelectedNodes(),SModelRepository.getInstance().getModelDescriptor(((SModelReference)refactoringContext.getParameter("targetModel"))));
  for (  LanguageAspect aspect : SetSequence.fromSet(MapSequence.fromMap(aspectNodes).keySet())) {
    SModel fromModel=aspect.get(((Language)refactoringContext.getParameter("sourceLanguage")));
    SModel toModel=aspect.getOrCreate(targetLanguage);
    refactoringContext.updateByDefault(fromModel);
    refactoringContext.moveNodesToModel(MapSequence.fromMap(aspectNodes).get(aspect),toModel);
    refactoringContext.updateByDefault(toModel);
  }
  if (isSourceExtends) {
    ((Language)refactoringContext.getParameter("sourceLanguage")).addExtendedLanguage(targetLanguage.getModuleReference());
  }
  for (  SModuleReference ext : ListSequence.fromList(targetExtends)) {
    targetLanguage.addExtendedLanguage(ext);
  }
}
