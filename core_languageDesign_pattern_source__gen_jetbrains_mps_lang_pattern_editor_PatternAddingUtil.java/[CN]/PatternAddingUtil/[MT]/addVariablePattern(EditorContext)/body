{
  EditorCell contextCell=context.getSelectedCell();
  SNode node=contextCell.getSNode();
  SModel model=node.getModel();
  SNode linkDeclaration=(SNode)BaseAdapter.fromAdapter(contextCell.getLinkDeclaration());
  SNode genuineLinkDeclaration=SModelUtil.getGenuineLinkDeclaration(linkDeclaration);
  if (linkDeclaration != null && SPropertyOperations.hasValue(genuineLinkDeclaration,"metaClass","reference","reference")) {
    linkDeclaration=genuineLinkDeclaration;
    String role=SPropertyOperations.getString(linkDeclaration,"role");
    LinkPatternVariableDeclaration linkPatternVariable=LinkPatternVariableDeclaration.newInstance(model);
    node.setLinkAttribute(role,linkPatternVariable.getNode());
  }
 else {
    PatternVariableDeclaration patternVariable=PatternVariableDeclaration.newInstance(model);
    node.setAttribute(patternVariable.getNode());
  }
}
