{
synchronized (myModelsLock) {
    fireBeforeModelRemoved(md);
    SModule owner=md.getModule();
    if (owner == null)     throw new IllegalStateException();
    Set<SModelDescriptor> ownerModels=myModelsByOwner.get(owner);
    if (!ownerModels.remove(md))     throw new IllegalStateException();
    if (md.getSModelReference().getModelId() != null) {
      myIdToModelDescriptorMap.remove(md.getSModelReference().getModelId());
      md.setModule(null);
    }
    myFqNameToModelDescriptorMap.remove(md.getSModelReference().getSModelFqName());
    md.removeModelListener(myModelsListener);
    fireModelRemoved(md);
    md.dispose();
  }
}
