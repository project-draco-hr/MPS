{
synchronized (myModelsLock) {
    fireBeforeModelRemoved(md);
    List<ModelOwner> owners=myModelsWithOwners.get(md);
    if (owners != null) {
      for (      ModelOwner owner : owners) {
        Set<SModelDescriptor> ownerModels=myModelsByOwner.get(owner);
        if (!ownerModels.remove(md))         throw new IllegalStateException();
      }
    }
    myModelsWithOwners.remove(md);
    if (md.getSModelReference().getSModelId() != null) {
      myIdToModelDescriptorMap.remove(md.getSModelReference().getSModelId());
    }
    myFqNameToModelDescriptorMap.remove(md.getSModelReference().getSModelFqName());
    if (md instanceof EditableSModelDescriptor) {
      boolean result=removeModelFromFileCache(((EditableSModelDescriptor)md));
      LOG.assertLog(result,"model " + md + " do not have a path in file cache");
    }
    removeListeners(md);
    fireModelRemoved(md);
    md.dispose();
  }
}
