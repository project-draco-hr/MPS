{
synchronized (myModelsLock) {
    fireBeforeModelRemoved(md);
    SModule owner=myModelOwner.remove(md);
    if (owner == null)     throw new IllegalStateException();
    Set<SModel> ownerModels=myModelsByOwner.get(owner);
    if (!ownerModels.remove(md))     throw new IllegalStateException();
    if (md.getReference().getModelId() != null) {
      myIdToModelDescriptorMap.remove(md.getReference().getModelId());
      ((SModelInternal)md).setModule(null);
    }
    myFqNameToModelDescriptorMap.remove(md.getReference().getModelName());
    ((SModelInternal)md).removeModelListener(myModelsListener);
    fireModelRemoved(md);
    ((SModelBase)md).dispose();
    md.detach();
  }
}
