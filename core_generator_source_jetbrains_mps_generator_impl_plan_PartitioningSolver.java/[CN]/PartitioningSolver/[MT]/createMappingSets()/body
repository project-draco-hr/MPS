{
  boolean topPriorityGroup=false;
  List<List<TemplateMappingConfiguration>> mappingSets=new ArrayList<List<TemplateMappingConfiguration>>();
  while (!myPriorityMap.isEmpty()) {
    List<TemplateMappingConfiguration> mappingSet=createMappingSet(topPriorityGroup);
    if (mappingSet.isEmpty()) {
      if (!topPriorityGroup) {
        topPriorityGroup=true;
        continue;
      }
      break;
    }
    mappingSets.add(mappingSet);
  }
  Collections.reverse(mappingSets);
  for (  List<TemplateMappingConfiguration> mappingSet : mappingSets) {
    Collections.sort(mappingSet,new Comparator<TemplateMappingConfiguration>(){
      @Override public int compare(      TemplateMappingConfiguration o1,      TemplateMappingConfiguration o2){
        return jetbrains.mps.smodel.SNodePointer.serialize(o1.getMappingNode()).compareTo((jetbrains.mps.smodel.SNodePointer.serialize(o2.getMappingNode())));
      }
    }
);
  }
  return mappingSets;
}
