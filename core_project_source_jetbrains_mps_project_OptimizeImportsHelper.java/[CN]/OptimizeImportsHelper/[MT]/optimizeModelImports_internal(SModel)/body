{
  Result result=collectModelDependencies(modelDescriptor);
  Set<SModelReference> unusedModels=new HashSet<SModelReference>();
  for (  SModelReference model : SModelOperations.getImportedModelUIDs(modelDescriptor)) {
    if (result.myUsedModels.contains(model))     continue;
    SModel md=model.resolve(myRepository);
    if (md == null)     continue;
    if (result.myUsedModels.contains(md.getReference()))     continue;
    unusedModels.add(model);
  }
  Set<SLanguage> unusedLanguages=new HashSet<SLanguage>();
  for (  SLanguage languageRef : ((jetbrains.mps.smodel.SModelInternal)modelDescriptor).importedLanguageIds()) {
    if (isUnusedLanguageRef(result,languageRef)) {
      unusedLanguages.add(languageRef);
    }
  }
  Set<SModuleReference> unusedDevkits=new HashSet<SModuleReference>();
  for (  SModuleReference devkitRef : ((jetbrains.mps.smodel.SModelInternal)modelDescriptor).importedDevkits()) {
    DevKit dk=((DevKit)devkitRef.resolve(myRepository));
    if (dk == null) {
      LOG.warn("The devkit " + devkitRef + " could not be found in the "+ myRepository+ ".\nProceeding...");
      continue;
    }
    if (ModelsAutoImportsManager.getAutoImportedDevKits(modelDescriptor.getModule(),modelDescriptor).contains(dk)) {
      continue;
    }
    SModuleReference ref=getUnusedDevkitRef(result,devkitRef);
    if (ref != null)     unusedDevkits.add(devkitRef);
  }
  result.myReport=removeFromImports(modelDescriptor,unusedModels,unusedLanguages,unusedDevkits);
  return result;
}
