{
  List<SNode> templateFragments=new ArrayList<SNode>();
  LinkedList<SNode> queue=new LinkedList<SNode>();
  queue.addFirst(template);
  final SNode conceptTemplateFragment=SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.generator.structure.TemplateFragment");
  while (!(queue.isEmpty())) {
    SNode subnode=queue.removeFirst();
    boolean tfFound=false;
    for (    SNode attr : SLinkOperations.getTargets(subnode,"smodelAttribute",true)) {
      if (SNodeOperations.getConceptDeclaration(attr) == conceptTemplateFragment) {
        templateFragments.add((SNode)attr);
        tfFound=true;
        break;
      }
    }
    if (!(tfFound)) {
      queue.addAll(SNodeOperations.getChildren(subnode));
    }
  }
  return templateFragments;
}
