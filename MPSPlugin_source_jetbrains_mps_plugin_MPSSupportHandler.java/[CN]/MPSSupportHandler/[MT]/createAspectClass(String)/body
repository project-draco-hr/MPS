{
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
            public void run(){
              final PsiManager psiManager=PsiManager.getInstance(myProject);
              final ProjectRootManager rootManager=ProjectRootManager.getInstance(myProject);
              VirtualFile sourceDir=null;
              VirtualFile[] sourceRoots=rootManager.getContentSourceRoots();
              for (int i=0; i < sourceRoots.length; i++) {
                VirtualFile file=sourceRoots[i];
                if (file.getName().equals("source"))                 sourceDir=file;
                if (file.getName().equals("src"))                 sourceDir=file;
              }
              if (sourceDir == null) {
                System.out.println("I can't find directory with sources.");
                return;
              }
              PsiDirectory rootDir=psiManager.findDirectory(sourceDir);
              try {
                createPackagesForNamespace(rootDir,namespace).createClass("Aspects");
              }
 catch (              IncorrectOperationException e) {
                e.printStackTrace();
              }
            }
          }
,"createAspectClass","MPSPlugin");
        }
      }
);
    }
  }
,ModalityState.NON_MMODAL);
  return "OK";
}
