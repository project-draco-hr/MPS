{
  runReadInWriteAction(new Computable<Object>(){
    @Override public Object compute(){
      Runnable task=new Runnable(){
        @Override public void run(){
          runReadInWriteWorker(action);
        }
      }
;
      if (ApplicationManager.getApplication().isDispatchThread()) {
        task.run();
      }
 else {
        if (!myDistributedLocksMode) {
          LOG.error("EDT should have IDEA write lock",new Exception());
          throw new IllegalStateException();
        }
 else {
          ApplicationManager.getApplication().invokeAndWait(task,ModalityState.defaultModalityState());
        }
      }
      return null;
    }
  }
);
}
