{
  SNode node=(SNode)cellContext.get(PropertyCellContext.EDITED_NODE);
  SNode parent=node.getParent();
  if (parent == null) {
    return Collections.emptyList();
  }
  IOperationContext context=editorContext.getOperationContext();
  List<SubstituteAction> actions=ModelActions.createChildNodeSubstituteActions(parent,node,getReplacementConcept().getDeclarationNode(),this,context);
  SubstituteMenuContext substituteMenuContext=DefaultSubstituteMenuContext.createInitialContextForNode(node.getContainmentLink(),parent,node,editorContext);
  MenuLookup<SubstituteMenu> lookup=new DefaultSubstituteMenuLookup(LanguageRegistry.getInstance(editorContext.getRepository()),getReplacementConcept());
  List<SubstituteMenuItem> items=substituteMenuContext.createItems(lookup);
  List<SubstituteAction> result=new ArrayList<SubstituteAction>(actions.size());
  for (  SubstituteAction a : actions) {
    result.add(new NodeSubstituteActionWrapper(a){
      @Override public SNode substitute(      @Nullable EditorContext context,      String pattern){
        String selectedCellId=null;
        if (context != null && context.getSelectedCell() != null) {
          selectedCellId=context.getSelectedCell().getCellId();
        }
        SNode result=super.substitute(context,pattern);
        if (selectedCellId != null) {
          EditorCell toSelect=context.getEditorComponent().findCellWithId(result,selectedCellId);
          if (toSelect != null) {
            context.flushEvents();
            context.getSelectionManager().setSelection(toSelect);
            if (context.getSelectedCell() instanceof EditorCell_Label) {
              context.getSelectedCell().end();
            }
          }
        }
        return result;
      }
    }
);
  }
  return result;
}
