{
  for (  SNode linkAccess : ListSequence.fromList(SNodeOperations.getNodeDescendants(conditionQueryNode,SNodeOperations.asSConcept(concept),false,new SAbstractConcept[]{}))) {
    SNode link=linkFunction.invoke(linkAccess);
    if (!(SPropertyOperations.hasValue(link,MetaAdapterFactory.getProperty(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,0xf980556927L,"metaClass"),"aggregation","reference"))) {
      continue;
    }
    if (!(Sequence.fromIterable(affectedLinks).contains(link))) {
      continue;
    }
    SNode parent=SNodeOperations.getParent(linkAccess);
    if (!(SNodeOperations.isInstanceOf(parent,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x116b46a08c4L,"jetbrains.mps.baseLanguage.structure.DotExpression")))) {
      continue;
    }
    if (linkAccessParentCondition.invoke(parent)) {
      replaceLinkAccessWithChildAndAttributesOperation(SNodeOperations.cast(parent,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x116b46a08c4L,"jetbrains.mps.baseLanguage.structure.DotExpression")),link);
      replaceNodeWithNotEmptyExpression(nodeToReplaceFunction.invoke(parent),SNodeOperations.cast(parent,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x116b46a08c4L,"jetbrains.mps.baseLanguage.structure.DotExpression")));
    }
  }
}
