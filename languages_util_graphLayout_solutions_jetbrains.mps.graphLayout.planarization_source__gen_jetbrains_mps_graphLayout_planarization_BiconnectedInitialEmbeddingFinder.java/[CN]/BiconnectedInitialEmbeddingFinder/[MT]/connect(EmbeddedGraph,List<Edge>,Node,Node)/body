{
  Graph graph=embeddedGraph.getGraph();
  DualGraph dualGraph=new DualGraph(embeddedGraph);
  Node dualStart=dualGraph.addRealNode(start);
  Node dualEnd=dualGraph.addRealNode(end);
  List<Edge> dualPath=ShortestPath.getPath(dualGraph,dualStart,dualEnd,Edge.Direction.BOTH);
  List<Node> nodePath=ListSequence.<Node>fromList(new ArrayList<Node>());
  List<Face> facePath=ListSequence.<Face>fromList(new ArrayList<Face>());
  ListSequence.<Node>fromList(nodePath).addElement(start);
  Node cur=dualStart;
  for (  Edge edge : ListSequence.<Edge>fromList(dualPath)) {
    Edge realEdge=MapSequence.<Edge,Edge>fromMap(dualGraph.getEdgesMap()).get(edge);
    if (embeddedGraph.getAdjacentFaces(realEdge) != null) {
      ListSequence.<Node>fromList(nodePath).addElement(embeddedGraph.splitEdge(MapSequence.<Edge,Edge>fromMap(dualGraph.getEdgesMap()).get(edge)));
    }
    cur=edge.getOpposite(cur);
    Face curFace=MapSequence.<Node,Face>fromMap(dualGraph.getFacesMap()).get(cur);
    if (curFace != null) {
      ListSequence.<Face>fromList(facePath).addElement(curFace);
    }
  }
  ListSequence.<Node>fromList(nodePath).addElement(end);
  Edge deletedEdge=null;
  List<Edge> newEdges=ListSequence.<Edge>fromList(new ArrayList<Edge>());
  for (int i=0; i < ListSequence.<Node>fromList(nodePath).count() - 1; i++) {
    Node curStart=ListSequence.<Node>fromList(nodePath).getElement(i);
    Node curEnd=ListSequence.<Node>fromList(nodePath).getElement(i + 1);
    List<Edge> tempPath=ListSequence.<Edge>fromList(new ArrayList<Edge>());
    if (i == 0) {
      if (end == ListSequence.<Node>fromList(nodePath).getElement(i + 1)) {
        ListSequence.<Edge>fromList(tempPath).addSequence(ListSequence.<Edge>fromList(path));
      }
 else {
        Edge lastEdge=ListSequence.<Edge>fromList(path).removeLastElement();
        graph.removeEdge(lastEdge);
        deletedEdge=lastEdge;
        ListSequence.<Edge>fromList(tempPath).addSequence(ListSequence.<Edge>fromList(path));
        Edge newEdge;
        newEdge=graph.connect(lastEdge.getOpposite(end),curEnd);
        ListSequence.<Edge>fromList(newEdges).addElement(newEdge);
        ListSequence.<Edge>fromList(tempPath).addElement(newEdge);
      }
    }
 else {
      Edge newEdge;
      newEdge=graph.connect(curStart,curEnd);
      ListSequence.<Edge>fromList(newEdges).addElement(newEdge);
      ListSequence.<Edge>fromList(tempPath).addElement(newEdge);
    }
    embeddedGraph.splitFace(ListSequence.<Face>fromList(facePath).getElement(i),tempPath,curStart,curEnd);
    if (deletedEdge != null) {
      GraphModificationEvent splitEvent=new GraphModificationEvent(GraphModificationEvent.Type.EDGE_SPLITTED,deletedEdge,newEdges);
      graph.getModificationProcessor().fire(splitEvent);
    }
  }
}
