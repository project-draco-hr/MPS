{
  myMessagesChanged=false;
  Set<EditorMessage> messages=new LinkedHashSet<EditorMessage>();
  if (!wasCheckedOnce || !TypeChecker.getInstance().isCheckedRoot(node.getContainingRoot())) {
    try {
      myMessagesChanged=true;
      TypeChecker.getInstance().checkRoot(node.getContainingRoot());
    }
 catch (    Throwable t) {
      LOG.error(t);
      TypeChecker.getInstance().markAsChecked(node.getContainingRoot());
      return messages;
    }
  }
  NodeTypesComponent typesComponent=getNodeTypesComponent(node);
  if (typesComponent != null) {
    if (!wasCheckedOnce || !typesComponent.isCheckedNonTypesystem()) {
      try {
        myMessagesChanged=true;
        typesComponent.applyNonTypesystemRulesToRoot(operationContext);
      }
 catch (      Throwable t) {
        LOG.error(t);
      }
    }
    for (    Pair<SNode,IErrorReporter> errorNode : typesComponent.getNodesWithErrorStrings()) {
      MessageStatus status=errorNode.o2.getMessageStatus();
      String errorString=errorNode.o2.reportError();
      HighlighterMessage message=createHighlighterMessage(errorNode.o1,NameUtil.capitalize(status.getPresentation()) + ": " + errorString,errorNode.o2);
      IntentionProvider intentionProvider=errorNode.o2.getIntentionProvider();
      if (intentionProvider != null && intentionProvider.isExecutedImmediately() && !IMMEDIATE_QFIX_DISABLED) {
        final QuickFix_Runtime intention=intentionProvider.getQuickFix();
        if (intention != null) {
          if (!myOnceExecutedQuickFixes.contains(intention)) {
            myOnceExecutedQuickFixes.add(intention);
            LaterInvocator.invokeLater(new Runnable(){
              public void run(){
                ModelAccess.instance().runWriteActionInCommand(new Runnable(){
                  public void run(){
                    CommandProcessor.getInstance().runUndoTransparentAction(new Runnable(){
                      public void run(){
                        intention.execute(node);
                      }
                    }
);
                  }
                }
);
              }
            }
,ModalityState.NON_MODAL);
          }
        }
      }
 else {
        if (intentionProvider != null) {
          intentionProvider.setIsError(status == MessageStatus.ERROR);
        }
        message.setIntentionProvider(intentionProvider);
      }
      messages.add(message);
    }
  }
  return messages;
}
