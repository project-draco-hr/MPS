{
  for (  SReference sourceReference : allReferences) {
    SNode oldSourceNode=sourceReference.getSourceNode();
    SNode newSourceNode=sourceNodesToNewNodes.get(oldSourceNode);
    SNode oldTargetNode=sourceReference.getTargetNode();
    SNode newTargetNode=sourceNodesToNewNodes.get(oldTargetNode);
    if (newTargetNode != null) {
      newSourceNode.addSemanticReference(SReference.newInstance(sourceReference.getRole(),newSourceNode,newTargetNode));
    }
 else {
      SReference newReference;
      if (!sourceReference.isExternal()) {
        newReference=SReference.newInstance(sourceReference.getRole(),newSourceNode,oldTargetNode);
        SReference.setResolveInfoByOldReference(sourceReference,newReference);
      }
 else {
        newReference=SReference.newInstance(sourceReference.getRole(),newSourceNode,sourceReference);
      }
      newSourceNode.addSemanticReference(newReference);
    }
  }
}
