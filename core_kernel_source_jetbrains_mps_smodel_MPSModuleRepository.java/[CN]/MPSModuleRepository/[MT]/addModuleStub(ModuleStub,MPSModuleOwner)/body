{
  myDirtyFlag=true;
  if (myModuleStubToOwners.contains(moduleStub,owner)) {
    throw new RuntimeException("Couldn't add module stub\"" + moduleStub.getOldModuleId() + "\" : this module stub is already registered with this very owner: "+ owner);
  }
  IFile descriptorFile=moduleStub.getDescriptorFile();
  String canonicalDescriptorPath;
  if (descriptorFile == null) {
    canonicalDescriptorPath=null;
  }
 else {
    canonicalDescriptorPath=descriptorFile.getCanonicalPath();
  }
  if (canonicalDescriptorPath != null && !myFileToModuleStubMap.containsKey(canonicalDescriptorPath)) {
    myFileToModuleStubMap.put(canonicalDescriptorPath,moduleStub);
  }
  putModuleStubWithUID(moduleStub.getOldModuleId(),moduleStub);
  myModuleStubToOwners.addLink(moduleStub,owner);
}
