{
  List<IModule> result=new ArrayList<IModule>();
  String dirName=dir.getName();
  if (isExluded(dirName))   return result;
  List<IFile> files=dir.list();
  if (files == null) {
    if (hasModuleExtension(dirName)) {
      IModule module=readModuleDescriptor_internal(dir,owner,getModuleExtension(dirName));
      if (module != null) {
        result.add(module);
      }
    }
    return result;
  }
  for (  IFile file : files) {
    if (hasModuleExtension(file.getName())) {
      IModule module=readModuleDescriptor_internal(file,owner,getModuleExtension(file.getName()));
      if (module != null) {
        result.add(module);
      }
    }
 else     if (file.getName().endsWith(AbstractModule.PACKAGE_SUFFIX)) {
      IFile dirInJar=FileSystem.getFile(file.getAbsolutePath() + "!/" + AbstractModule.MODULE_DIR);
      result.addAll(readModuleDescriptors(dirInJar,owner));
    }
  }
  List<IFile> dirs=files;
  for (  IFile childDir : dirs) {
    if (childDir.getName().endsWith(".svn"))     continue;
    result.addAll(readModuleDescriptors(childDir,owner));
  }
  return result;
}
