{
  List<SModuleFacet> moduleFacets=IterableUtil.asList(myModule.getFacets());
  for (  JBCheckBox checkBox : myCheckBoxMap.keySet()) {
    if (checkBox.isSelected() && !moduleFacets.contains(myCheckBoxMap.get(checkBox))) {
      ModuleFacetBase facetBase=(ModuleFacetBase)myCheckBoxMap.get(checkBox);
      facetBase.setModule(myModule);
      Memento memento=new MementoImpl();
      facetBase.save(memento);
      myModuleDescriptor.getModuleFacetDescriptors().add(new ModuleFacetDescriptor(facetBase.getFacetType(),memento));
    }
 else     if (!checkBox.isSelected() && moduleFacets.contains(myCheckBoxMap.get(checkBox))) {
      Iterator<ModuleFacetDescriptor> it=myModuleDescriptor.getModuleFacetDescriptors().iterator();
      while (it.hasNext()) {
        ModuleFacetDescriptor facetDescriptor=it.next();
        if (facetDescriptor.getType().equals(((ModuleFacetBase)myCheckBoxMap.get(checkBox)).getFacetType())) {
          myModuleDescriptor.getModuleFacetDescriptors().remove(facetDescriptor);
          break;
        }
      }
    }
  }
}
