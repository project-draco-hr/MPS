{
  final SearchQuery[] query=new SearchQuery[1];
  final IResultProvider[] provider=new IResultProvider[1];
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      if (value instanceof SModelReference) {
        query[0]=new SearchQuery(SModelRepository.getInstance().getModelDescriptor(((jetbrains.mps.smodel.SModelReference)value).getSModelId()).getSModel(),new ModulesOnlyScope(Arrays.asList(myModule)));
        provider[0]=FindUtils.makeProvider(new ModelUsagesFinder());
      }
 else       if (value instanceof ModuleReference) {
        query[0]=new SearchQuery(MPSModuleRepository.getInstance().getModuleByFqName(((ModuleReference)value).getModuleFqName()),GlobalScope.getInstance());
        provider[0]=FindUtils.makeProvider(new ModuleUsagesFinder());
      }
    }
  }
);
  IUsagesViewTool usagesViewTool=(IUsagesViewTool)ProjectHelper.toIdeaProject(myProject).getComponent("jetbrains.mps.ide.findusages.view.UsagesViewTool");
  usagesViewTool.findUsages(provider[0],query[0],true,true,true,"No usages found");
  forceCancelCloseDialog();
}
