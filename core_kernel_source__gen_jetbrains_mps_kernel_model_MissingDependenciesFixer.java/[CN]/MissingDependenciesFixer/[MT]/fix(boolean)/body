{
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      boolean wereChanges=false;
      IModule module=myModelDescriptor.getModule();
      if (module == null) {
        LOG.error("Module is null: " + myModelDescriptor.getReference().toString());
        return;
      }
      IScope moduleScope=module.getScope();
      ModuleDescriptor md=module.getModuleDescriptor();
      for (      SModelReference modelImport : SModelOperations.getImportedModelUIDs(myModelDescriptor.getSModel())) {
        if (moduleScope.getModelDescriptor(modelImport) != null) {
          continue;
        }
        SModel sm=SModelRepository.getInstance().getModelDescriptor(modelImport);
        if (sm == null) {
          SModelFqName fqName=modelImport.getSModelFqName();
          sm=(fqName != null ? SModelRepository.getInstance().getModelDescriptor(fqName) : null);
          if (sm == null) {
            continue;
          }
        }
        IModule anotherModule=sm.getModule();
        if (anotherModule == null || anotherModule == module) {
          continue;
        }
        Dependency dep=new Dependency();
        dep.setModuleRef(anotherModule.getModuleReference());
        md.getDependencies().add(dep);
        wereChanges=true;
      }
      for (      ModuleReference namespace : CollectionUtil.union(((SModelInternal)myModelDescriptor.getSModel()).importedLanguages(),((SModelInternal)myModelDescriptor.getSModel()).engagedOnGenerationLanguages())) {
        if (ScopeOperations.resolveModule(moduleScope,namespace,Language.class) != null) {
          continue;
        }
        Language lang=ScopeOperations.resolveModule(moduleScope,namespace,Language.class);
        if (lang == null) {
          continue;
        }
        ModuleReference ref=ModuleReference.fromString(namespace.toString());
        md.getUsedLanguages().add(ref);
        wereChanges=true;
      }
      for (      ModuleReference devKitNamespace : ((SModelInternal)myModelDescriptor.getSModel()).importedDevkits()) {
        if (ScopeOperations.resolveModule(moduleScope,devKitNamespace,DevKit.class) != null) {
          continue;
        }
        DevKit devKit=ScopeOperations.resolveModule(GlobalScope.getInstance(),devKitNamespace,DevKit.class);
        if (devKit == null) {
          continue;
        }
        ModuleReference ref=ModuleReference.fromString(devKitNamespace.toString());
        md.getUsedDevkits().add(ref);
        wereChanges=true;
      }
      if (wereChanges) {
        module.setModuleDescriptor(md,reload);
        module.invalidateCaches();
        module.invalidateDependencies();
      }
    }
  }
);
}
