{
  try {
    List<ITestNodeWrapper> allTests=ListSequence.fromList(success).union(ListSequence.fromList(failure)).toListSequence();
    ProcessHandler process=new Junit_Command().createProcess(allTests);
    TestRunState runState=new TestRunState(allTests);
    CheckTestStateListener checkListener=new CheckTestStateListener(success,failure);
    runState.addListener(checkListener);
    TestEventsDispatcher eventsDispatcher=new TestEventsDispatcher(runState);
    OutputRedirector.redirect(process,new UnitTestProcessListener(eventsDispatcher));
    int exitcode=ProcessHandlerBuilder.startAndWait(process,5 * 60 * 1000);
    if (exitcode > 0) {
      Assert.fail("Exit code is not 0 but " + exitcode);
    }
 else     if (exitcode < 0) {
      Assert.fail("Process running too long.");
    }
    if (isNotEmptyString(checkListener.getMessages())) {
      Assert.fail(checkListener.getMessages());
    }
  }
 catch (  ExecutionException e) {
    Assert.fail(e.getMessage());
  }
}
