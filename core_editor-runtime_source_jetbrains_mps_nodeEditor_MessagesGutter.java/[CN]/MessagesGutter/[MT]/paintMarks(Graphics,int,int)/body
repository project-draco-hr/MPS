{
  removeBadMessages();
  Graphics2D g=(Graphics2D)graphics;
  List<EditorMessage> editorMessages=new ArrayList<EditorMessage>(myMessages);
  Collections.sort(editorMessages,new Comparator<EditorMessage>(){
    public int compare(    EditorMessage o1,    EditorMessage o2){
      if (o1 == o2)       return 0;
      if (o1 == null)       return -1;
      if (o2 == null)       return 1;
      if (o1.getStatus().ordinal() == o2.getStatus().ordinal()) {
        if (o1.isLongInGutter() == o2.isLongInGutter()) {
          return getMessageStart(o1) - getMessageStart(o2);
        }
 else {
          return o1.isLongInGutter() ? -1 : 1;
        }
      }
 else {
        return o1.getStatus().ordinal() - o2.getStatus().ordinal();
      }
    }
  }
);
  for (  EditorMessage msg : editorMessages) {
    if (msg == null || !msg.isValid(myEditorComponent)) {
      continue;
    }
    int messageY=getMessagePosition(msg);
    int messageHeight=Math.max(getMessageHeight(msg),3);
    Color color=msg.getColorInGutter();
    if (color == null)     return;
    g.setColor(color);
    g.fillRect(x + 1,messageY,width - 2,messageHeight);
    Color brighter=color.brighter();
    g.setColor(brighter);
    UIUtil.drawLine(g,x,messageY,x,messageY + messageHeight - 1);
    UIUtil.drawLine(g,x + 1,messageY,x + width - 2,messageY);
    Color darker=ColorUtil.shift(color,0.75);
    g.setColor(darker);
    UIUtil.drawLine(g,x + 1,messageY + messageHeight - 1,x + width - 2,messageY + messageHeight - 1);
    UIUtil.drawLine(g,x + width - 2,messageY,x + width - 2,messageY + messageHeight - 1);
  }
}
