{
  String varname=SPropertyOperations.getString(SLinkOperations.getTarget(thisNode,"var",true),"name");
  Collection<Object> result=(unique ? new LinkedHashSet<Object>() : new ArrayList<Object>());
  for (  Object o : input) {
    EvaluationContext innerContext=new EvaluationContext(context.getThis(),context);
    innerContext.setValue(varname,o);
    Object val=env.evaluate(SLinkOperations.getTarget(thisNode,"expr",true),innerContext,true);
    if (val instanceof Iterable) {
      for (      Object innerVal : ((Iterable)val)) {
        if (innerVal != null) {
          result.add(innerVal);
        }
      }
    }
 else     if (val != null) {
      result.add(val);
    }
  }
  return result;
}
