{
  SNode project=artifacts.getProject();
  TemplateQueryContext genContext=artifacts.getGenContext();
  ModulePlugins plugins=new ModulePlugins(project,genContext);
  plugins.collect(new MPSModulesClosure(ListSequence.fromList(SLinkOperations.getChildren(__thisNode__,MetaAdapterFactory.getContainmentLink(0x3600cb0a44dd4a5bL,0x996822924406419eL,0x3f496e80bd8ef36dL,0x3f496e80bd8ef370L,"modules"))).translate(new ITranslator2<SNode,SNode>(){
    public Iterable<SNode> translate(    SNode it){
      return (Iterable<SNode>)BuildMpsLayout_TestModules_Content__BehaviorDescriptor.getModules_id3X9rC2XzJij.invoke(it);
    }
  }
),new MPSModulesClosure.ModuleDependenciesOptions().trackDevkits()).runtimeClosure());
  for (  SNode plugin : Sequence.fromIterable(plugins.getDependency())) {
    SNode pluginArtifact;
    if (SNodeOperations.getContainingRoot(__thisNode__) != SNodeOperations.getContainingRoot(plugin)) {
      pluginArtifact=SNodeOperations.as(artifacts.findArtifact(plugin),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node"));
    }
 else {
      pluginArtifact=SNodeOperations.as(artifacts.findArtifact(artifacts.toOriginalNode(plugin)),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node"));
    }
    if (pluginArtifact != null) {
      builder.add(pluginArtifact,plugin);
    }
  }
  Iterable<SNode> originalModules=ListSequence.fromList(SLinkOperations.getChildren(__thisNode__,MetaAdapterFactory.getContainmentLink(0x3600cb0a44dd4a5bL,0x996822924406419eL,0x3f496e80bd8ef36dL,0x3f496e80bd8ef370L,"modules"))).translate(new ITranslator2<SNode,SNode>(){
    public Iterable<SNode> translate(    SNode it){
      return (Iterable<SNode>)BuildMpsLayout_TestModules_Content__BehaviorDescriptor.getModules_id3X9rC2XzJij.invoke(it);
    }
  }
);
  Iterable<SNode> modules=Sequence.fromIterable(new MPSModulesClosure(originalModules,new MPSModulesClosure.ModuleDependenciesOptions().trackDevkits()).designtimeClosure().getAllModules()).union(Sequence.fromIterable(originalModules));
  for (  SNode m : Sequence.fromIterable(modules)) {
    SNode artifact;
    SNode originalModule=DependenciesHelper.getOriginalNode(m,genContext);
    VisibleArtifacts currentArtifacts=artifacts;
    artifact=SNodeOperations.as(currentArtifacts.findArtifact(originalModule),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node"));
    if (artifact != null) {
      builder.add(SNodeOperations.as(DependenciesHelper.getOriginalNode(artifact,genContext),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node")),originalModule);
    }
 else     if (SNodeOperations.isInstanceOf(originalModule,MetaAdapterFactory.getConcept(0xcf935df46994e9cL,0xa132fa109541cba3L,0x4780308f5d2060eL,"jetbrains.mps.build.mps.structure.BuildMps_DevKit"))) {
      artifact=SNodeOperations.as(currentArtifacts.findArtifact(SLinkOperations.getTarget(SNodeOperations.cast(originalModule,MetaAdapterFactory.getConcept(0xcf935df46994e9cL,0xa132fa109541cba3L,0x4780308f5d2060eL,"jetbrains.mps.build.mps.structure.BuildMps_DevKit")),MetaAdapterFactory.getContainmentLink(0xcf935df46994e9cL,0xa132fa109541cba3L,0x4780308f5d333ebL,0x4780308f5d47f25L,"path"))),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node"));
      if (artifact != null) {
        builder.add(SNodeOperations.as(DependenciesHelper.getOriginalNode(artifact,genContext),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node")),originalModule);
      }
    }
  }
}
