{
  SemanticNode anchorNode=(anchorCell != null ? anchorCell.getSemanticNode() : null);
  if (anchorNode != null) {
    Iterator<SemanticNode> listElementsIter=null;
    if (myAggregation) {
      listElementsIter=getOwner().children(myLinkRole);
    }
 else {
      listElementsIter=getOwner().referents(myLinkRole);
    }
    List<SemanticNode> listElements=new LinkedList<SemanticNode>();
    while (listElementsIter.hasNext()) {
      listElements.add(listElementsIter.next());
    }
    while (anchorNode != null && !listElements.contains(anchorNode)) {
      anchorNode=anchorNode.getParent();
    }
  }
  myInsertedNode=createNodeToInsert();
  if (myAggregation) {
    getOwner().insertChild(anchorNode,myLinkRole,myInsertedNode,insertBefore);
  }
 else {
    getOwner().insertReferent(anchorNode,myLinkRole,myInsertedNode,insertBefore);
  }
  AbstractEditorComponent editor=editorContext.getNodeEditorComponent();
  editor.pushKeyboardHandler(this);
  editor.rebuildEditorContent();
  if (myInsertCell != null) {
    EditorCell selectableLeaf=myInsertCell.findFirstSelectableLeaf();
    if (selectableLeaf != null) {
      editor.changeSelection(selectableLeaf);
    }
  }
}
