{
  Set<AbstractModule> releasedModules=new HashSet<AbstractModule>();
  for (  AbstractModule module : modules) {
    Set<MPSModuleOwner> owners=moduleToOwnerMap.get(module);
    if (owners != null) {
      owners.remove(owner);
      if (owners.isEmpty() || (owners.size() == 1 && owners.contains(module)))       releasedModules.add(module);
    }
  }
  for (  AbstractModule module : releasedModules) {
    modules.remove(module);
  }
  Set<AbstractModule> additionalReleasedModules=new HashSet<AbstractModule>();
  for (  AbstractModule module : releasedModules) {
    if (module instanceof AbstractModule) {
      additionalReleasedModules.addAll(collectReleasedModules(modules,moduleToOwnerMap,module));
    }
  }
  releasedModules.addAll(additionalReleasedModules);
  return releasedModules;
}
