{
  Set<IModule> releasedModules=new HashSet<IModule>();
  for (  IModule module : modules) {
    Set<MPSModuleOwner> owners=moduleToOwnerMap.get(module);
    if (owners != null) {
      owners.remove(owner);
      if (owners.isEmpty())       releasedModules.add(module);
    }
  }
  for (  IModule module : releasedModules) {
    modules.remove(module);
  }
  for (  IModule module : releasedModules) {
    if (module instanceof AbstractModule) {
      releasedModules.addAll(collectReleasedModules(modules,moduleToOwnerMap,(AbstractModule)module));
    }
  }
  return releasedModules;
}
