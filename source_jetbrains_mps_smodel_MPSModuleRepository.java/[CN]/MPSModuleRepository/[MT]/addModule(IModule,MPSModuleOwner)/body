{
  myDirtyFlag=true;
  if (existsModule(module,owner)) {
    throw new RuntimeException("Couldn't add module \"" + module.getModuleUID() + "\" : this module is already registered with this very owner: "+ owner);
  }
  IFile descriptorFile=module.getDescriptorFile();
  String canonicalDescriptorPath;
  if (descriptorFile == null) {
    canonicalDescriptorPath=null;
  }
 else {
    canonicalDescriptorPath=descriptorFile.getCanonicalPath();
  }
  if (canonicalDescriptorPath != null && !myFileToModuleMap.containsKey(canonicalDescriptorPath)) {
    myFileToModuleMap.put(canonicalDescriptorPath,module);
  }
  putModuleWithUID(module.getModuleUID(),module);
  Set<MPSModuleOwner> owners=myModuleToOwnersMap.get(module);
  if (owners == null)   owners=new HashSet<MPSModuleOwner>();
  owners.add(owner);
  myModuleToOwnersMap.put(module,owners);
  fireModuleAdded(module);
}
