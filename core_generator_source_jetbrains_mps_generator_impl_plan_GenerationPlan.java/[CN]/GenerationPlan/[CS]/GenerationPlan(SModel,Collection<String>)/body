{
  myInputName=jetbrains.mps.util.SNodeOperations.getModelLongName(inputModel);
  try {
    EngagedGeneratorCollector c=new EngagedGeneratorCollector(inputModel,additionalLanguages);
    GenerationPartitioner partitioner=new GenerationPartitioner(c.getAccessibleGenerators());
    final List<List<TemplateMappingConfiguration>> mappingSets=partitioner.createMappingSets();
    myGenerators=c.getDirectlyEngagedGenerators();
    myPlan=new ArrayList<List<TemplateMappingConfiguration>>();
    for (    List<TemplateMappingConfiguration> l : mappingSets) {
      for (Iterator<TemplateMappingConfiguration> it=l.iterator(); it.hasNext(); ) {
        final TemplateMappingConfiguration tmc=it.next();
        if (!myGenerators.contains(tmc.getModel().getModule())) {
          it.remove();
        }
      }
      if (!l.isEmpty()) {
        myPlan.add(l);
      }
    }
    if (myPlan.isEmpty()) {
      myPlan.add(Collections.<TemplateMappingConfiguration>emptyList());
    }
    myConflictingPriorityRules=partitioner.getConflictingPriorityRules();
    initTemplateModels();
  }
 catch (  Throwable t) {
    LOG.error(null,t);
    throw new RuntimeException("Couldn't compute generation steps for model '" + jetbrains.mps.util.SNodeOperations.getModelLongName(inputModel) + "'",t);
  }
}
