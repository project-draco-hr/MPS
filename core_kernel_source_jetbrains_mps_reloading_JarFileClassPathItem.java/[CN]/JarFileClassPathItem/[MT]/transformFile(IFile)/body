{
  if (!OldFileSystem.isPackaged(f)) {
    return new File(f.getAbsolutePath());
  }
  File tmpFile=File.createTempFile(f.getName(),"tmp");
  tmpFile.deleteOnExit();
  OutputStream os=null;
  InputStream is=null;
  try {
    is=new BufferedInputStream(f.openInputStream());
    os=new BufferedOutputStream(new FileOutputStream(tmpFile));
    int result;
    while ((result=is.read()) != -1) {
      os.write(result);
    }
  }
  finally {
    if (is != null) {
      is.close();
    }
    if (os != null) {
      os.close();
    }
  }
  return tmpFile;
}
