{
  if (link == null) {
    writeByte(NULL);
    return;
  }
  final SReferenceLinkId id=IdHelper.getRefId(link);
  if (myAssociation2Index.containsKey(id)) {
    writeByte(ASSOCIATION_INDEX);
    writeShort(myAssociation2Index.get(id));
  }
 else {
    writeByte(ASSOCIATION);
    writeConcept(link.getContainingConcept());
    writeLong(id.getIdValue());
    writeString(link.getRoleName());
    myAssociation2Index.put(id,myAssociationIndex++);
  }
}
