{
  super(project);
  myProjectManager=projectManager;
  myIndex=index;
  final MPSUnindexedFilesUpdater updater=new MPSUnindexedFilesUpdater(myIndex);
  final StartupManagerEx startupManager=(StartupManagerEx)StartupManager.getInstance(myProject);
  if (startupManager == null)   return;
  startupManager.registerPreStartupActivity(new Runnable(){
    public void run(){
      startupManager.registerCacheUpdater(updater);
      myIndex.registerIndexableSet(MPSFileBasedIndexProjectHandler.this);
      DumbServiceImpl.getInstance(myProject).queueCacheUpdate(Collections.<CacheUpdater>singletonList(new MPSUnindexedFilesUpdater(myIndex)));
    }
  }
);
}
