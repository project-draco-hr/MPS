{
  SReference reference=createReferenceInModelDoNotAddToSourceNode(model,visibleModelElements);
  SReference newReference=null;
  if (reference instanceof SReference_old) {
    SModelUID modelUID=((SReference_old)reference).getTargetModelUID();
    if (SModelStereotype.JAVA_STUB.equals(modelUID.getStereotype())) {
      SNode javaStubNode=reference.getTargetNode();
      if (javaStubNode != null) {
        newReference=SReference.create(reference.getRole(),this.getSourceNode(),javaStubNode);
      }
 else       if (reference.getExtResolveInfo() != null) {
        String resolveInfo=ExternalResolver.getHumanFriendlyString(reference.getExtResolveInfo());
        newReference=SReference.create(this.getRole(),this.getSourceNode(),null,null,resolveInfo);
      }
    }
 else {
      newReference=SReference.create(this.getRole(),this.getSourceNode(),reference.getTargetModelUID(),SNodeId.fromString(this.getTargetId()),this.getResolveInfo());
    }
  }
  if (newReference != null)   this.getSourceNode().addReference(newReference);
}
