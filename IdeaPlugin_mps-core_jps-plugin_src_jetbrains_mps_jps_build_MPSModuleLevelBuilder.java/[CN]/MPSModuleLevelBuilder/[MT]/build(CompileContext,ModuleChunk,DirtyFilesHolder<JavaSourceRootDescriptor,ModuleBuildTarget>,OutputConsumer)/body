{
  ExitCode status=ExitCode.NOTHING_DONE;
  try {
    for (    JpsModule jpsModule : moduleChunk.getModules()) {
      final JpsMPSProject project=new JpsMPSProject(jpsModule.getProject());
      JpsGeneratorWorker worker=new JpsGeneratorWorker(project);
      dirtyFilesHolder.processDirtyFiles(worker);
      JpsMPSModuleExtension extension=JpsMPSExtensionService.getInstance().getExtension(jpsModule);
      if (extension == null) {
        compileContext.processMessage(new CompilerMessage(MPSCompilerUtil.BUILDER_ID,Kind.INFO,"Ignoring (no facet) " + jpsModule.getName()));
        continue;
      }
      JpsMPSRepositoryFacade.getInstance().init(compileContext);
      compileContext.processMessage(new CompilerMessage(MPSCompilerUtil.BUILDER_ID,Kind.INFO,"Processing " + jpsModule.getName() + ": "+ extension.getConfiguration().getUUID()));
      SolutionDescriptor descriptor=extension.getConfiguration().getSolutionDescriptor();
      final JpsSolutionIdea solution=new JpsSolutionIdea(jpsModule,descriptor);
      ModelAccess.instance().runWriteAction(new Runnable(){
        @Override public void run(){
          MPSModuleRepository.getInstance().registerModule(solution,project);
          solution.updateModelsSet();
          compileContext.processMessage(new CompilerMessage(MPSCompilerUtil.BUILDER_ID,Kind.INFO,"FQ name: " + solution.getModuleReference().getModuleFqName()));
        }
      }
);
      for (      final SModelDescriptor d : SModelRepository.getInstance().getModelDescriptors(solution)) {
        compileContext.processMessage(new CompilerMessage(MPSCompilerUtil.BUILDER_ID,Kind.INFO," ++ " + d.getLongName()));
        worker.addModel(d);
        ModelAccess.instance().runReadAction(new Runnable(){
          @Override public void run(){
            for (            SNode n : d.getRootNodes()) {
              compileContext.processMessage(new CompilerMessage(MPSCompilerUtil.BUILDER_ID,Kind.INFO," root: " + n.getName()));
            }
          }
        }
);
      }
      worker.generate();
      for (      ModelRoot root : extension.getConfiguration().getModelRoots()) {
        compileContext.processMessage(new CompilerMessage(MPSCompilerUtil.BUILDER_ID,Kind.INFO," -- " + root.getPresentation()));
      }
    }
  }
 catch (  Exception ex) {
    throw new ProjectBuildException(ex);
  }
  compileContext.processMessage(new CompilerMessage(MPSCompilerUtil.BUILDER_ID,Kind.WARNING,"<simple warning to show Messages tool>"));
  return status;
}
