{
  super(session,autoUpdate);
  myHighlighter=project.getComponent(Highlighter.class);
  myEvaluationModel=evaluationModel;
  if (myEvaluationModel.isDeveloperMode()) {
    myEvaluationModel.addGenerationListener(new _FunctionTypes._void_P1_E0<SNode>(){
      public void invoke(      SNode result){
        EvaluationPanel.this.updateGenerationResultTab(result);
      }
    }
);
  }
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      myEditor=new EmbeddableEditor(new ModuleContext(myEvaluationModel.getModule(),myEvaluationModel.getModule().getMPSProject().getProject()),myEvaluationModel.getModel(),myEvaluationModel.getRootToShow(),myEvaluationModel.getNodeToShow(),true);
      for (      Language language : myEvaluationModel.getRequiredLanguages()) {
        myEditor.addLanguage(language);
      }
    }
  }
);
  myTree.addModel(myEvaluationModel);
  if (myEvaluationModel.getDebugSession().isPaused()) {
    myTree.updateLocation(myDebugSession.getUiState().getStackFrame().getLocation().getUnitName(),myDebugSession.getUiState().getThread().getThread());
  }
  JSplitPane splitPane=new JSplitPane(JSplitPane.VERTICAL_SPLIT);
  splitPane.setResizeWeight(0.8);
  splitPane.setTopComponent(myEditor.getComponenet());
  splitPane.setBottomComponent(new JBScrollPane(myTree));
  if (myEvaluationModel.isDeveloperMode()) {
    myTabbedPane.addTab("Main",splitPane);
    add(myTabbedPane);
  }
 else {
    add(splitPane);
  }
  myEditor.getComponenet().registerKeyboardAction(new AbstractAction(){
    public void actionPerformed(    ActionEvent p0){
      evaluate();
    }
  }
,KeyStroke.getKeyStroke("ctrl ENTER"),JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);
  myHighlighter.addAdditionalEditor(myEditor.getEditor());
}
