{
  String nodeIdString=myRefactoring.getSourceId();
  String modelUID=MarshallUtil.getModelUID(nodeIdString);
  String nodeId=MarshallUtil.getNodeId(nodeIdString);
  SModelDescriptor modelDescriptor=SModelRepository.getInstance().getModelDescriptor(SModelUID.fromString(modelUID));
  if (modelDescriptor == null) {
    throw new RefactoringLoggingFailedException("refactoring source model could not be found, UID=" + modelUID);
  }
  SNode refactoringSourceNode=modelDescriptor.getSModel().getNodeById(nodeId);
  if (refactoringSourceNode == null) {
    throw new RefactoringLoggingFailedException("refactoring source node could not be found, id=" + nodeId);
  }
  if (!BaseAdapter.isInstance(refactoringSourceNode,Refactoring.class)) {
    throw new RefactoringLoggingFailedException("refactoring source node is not a refactoring source, id=" + nodeId);
  }
  Refactoring refactoring=(Refactoring)refactoringSourceNode.getAdapter();
  RuntimeLog refactoringLog=RuntimeLog.newInstance(model);
  UpdateModelClause updateModelClause=refactoring.getUpdateModelClause();
  refactoringLog.setUpdateModelClause(updateModelClause);
  for (  String name : args.keySet()) {
    RequiredAdditionalArgument argument=findArgumentByName(refactoring,name);
    if (argument == null)     continue;
    RequiredAdditionalArgumentValue value=RequiredAdditionalArgumentValue.newInstance(model);
    refactoringLog.addArgumentValue(value);
    value.setValue(args.get(name));
    RequiredAdditionalArgument argumentCopy=CopyUtil.copy(argument,model);
    value.setArgument(argumentCopy);
  }
  SNode log=model.getLog();
  RuntimeLogStack runtimeLogStack;
  if (log == null) {
    runtimeLogStack=RuntimeLogStack.newInstance(model);
    model.setLog(runtimeLogStack.getNode());
  }
 else {
    runtimeLogStack=(RuntimeLogStack)log.getAdapter();
  }
  runtimeLogStack.addLog(refactoringLog);
  model.increaseVersion();
  refactoringLog.setModelVersion(model.getVersion());
}
