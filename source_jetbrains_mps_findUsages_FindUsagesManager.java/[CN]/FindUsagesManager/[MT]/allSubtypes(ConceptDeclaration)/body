{
  if (ourCache.get(typeDeclaration) != null)   return Collections.unmodifiableList(ourCache.get(typeDeclaration));
  List<ConceptDeclaration> list=new LinkedList<ConceptDeclaration>();
  FindUsagesManager manager=IdeMain.instance().getProject().getComponent(FindUsagesManager.class);
  Set<SReference> usages=manager.findUsages(typeDeclaration,new FilterScope(manager.globalScope()){
    protected boolean accept(    SModelDescriptor descriptor){
      return descriptor.getModelUID().getName().equals("structure");
    }
  }
,null);
  for (  SReference ref : usages) {
    if (ref.getRole().equals(ConceptDeclaration.EXTENDS)) {
      ConceptDeclaration subtype=(ConceptDeclaration)ref.getSourceNode();
      list.add(subtype);
      list.addAll(allSubtypes(subtype));
    }
  }
  ourCache.put(typeDeclaration,list);
  return Collections.unmodifiableList(list);
}
