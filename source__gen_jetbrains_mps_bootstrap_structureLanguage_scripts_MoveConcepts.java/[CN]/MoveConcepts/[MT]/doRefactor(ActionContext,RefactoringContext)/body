{
{
    List<SNode> nodes=(List<SNode>)actionContext.getNodes();
    SModel model=actionContext.getNode().getModel();
    refactoringContext.setParameter("sourceModel",model);
    Language sourceLanguage=Language.getLanguageFor(((SModel)refactoringContext.getParameter("sourceModel")).getModelDescriptor());
    Language targetLanguage=Language.getLanguageFor(((SModel)refactoringContext.getParameter("targetModel")).getModelDescriptor());
    List<SNode> editors=new ArrayList<SNode>();
    List<SNode> behaviors=new ArrayList<SNode>();
    SModelDescriptor editorModelDescriptor=sourceLanguage.getEditorModelDescriptor();
    if (editorModelDescriptor != null) {
      for (      SNode node : nodes) {
        if (SNodeOperations.isInstanceOf(node,"jetbrains.mps.bootstrap.structureLanguage.structure.ConceptDeclaration")) {
          SNode editor=(SNode)SModelUtil_new.findEditorDeclaration(editorModelDescriptor.getSModel(),((ConceptDeclaration)SNodeOperations.getAdapter(node))).getNode();
          if ((editor != null)) {
            ListOperations.addElement(editors,editor);
          }
        }
      }
    }
    SModelDescriptor constraintsModelDescriptor=sourceLanguage.getConstraintsModelDescriptor();
    if (constraintsModelDescriptor != null) {
      for (      SNode node : nodes) {
        SNode behavior=(SNode)SModelUtil_new.findBehaviorDeclaration(constraintsModelDescriptor.getSModel(),((AbstractConceptDeclaration)SNodeOperations.getAdapter(node))).getNode();
        if ((behavior != null)) {
          ListOperations.addElement(behaviors,behavior);
        }
      }
    }
    refactoringContext.moveNodesToModel(nodes,((SModel)refactoringContext.getParameter("targetModel")));
    for (    SNode node : nodes) {
      refactoringContext.changeFeatureName(node,((SModel)refactoringContext.getParameter("targetModel")) + "." + SPropertyOperations.getString(node,"name"),SPropertyOperations.getString(node,"name"));
    }
    if (!(SequenceOperations.isEmpty(editors))) {
      SModelDescriptor targetEditorModelDescriptor=targetLanguage.getEditorModelDescriptor();
      if (targetEditorModelDescriptor == null) {
        targetEditorModelDescriptor=targetLanguage.createLanguageEditorModel();
      }
      SModel editorModel=targetEditorModelDescriptor.getSModel();
      refactoringContext.moveNodesToModel(editors,editorModel);
      refactoringContext.computeCaches();
      refactoringContext.updateModelWithMaps(editorModel);
    }
    if (!(SequenceOperations.isEmpty(behaviors))) {
      SModelDescriptor targetConstraintsModelDescriptor=targetLanguage.getConstraintsModelDescriptor();
      if (targetConstraintsModelDescriptor == null) {
        targetConstraintsModelDescriptor=targetLanguage.createLanguageBehaviorModel();
      }
      SModel constraintsModel=targetConstraintsModelDescriptor.getSModel();
      refactoringContext.moveNodesToModel(behaviors,constraintsModel);
      refactoringContext.computeCaches();
      refactoringContext.updateModelWithMaps(constraintsModel);
    }
  }
}
