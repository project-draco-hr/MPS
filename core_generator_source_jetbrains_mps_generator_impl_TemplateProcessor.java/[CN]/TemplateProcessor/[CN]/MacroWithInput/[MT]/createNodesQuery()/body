{
  SNode nodesQuery=RuleUtil.getSourceNodesQuery(macro);
  if (nodesQuery != null) {
    return myTemplateProcessor.getQueryProvider(getMacroNodeRef()).getSourceNodesQuery(nodesQuery);
  }
  if (RuleUtil.doesMacroRequireInput(macro)) {
    return null;
  }
  return new SourceNodesQuery(){
    @NotNull @Override public Collection<SNode> evaluate(    @NotNull SourceSubstituteMacroNodesContext context) throws GenerationFailureException {
      return wrapAsList(context.getInputNode());
    }
  }
;
}
