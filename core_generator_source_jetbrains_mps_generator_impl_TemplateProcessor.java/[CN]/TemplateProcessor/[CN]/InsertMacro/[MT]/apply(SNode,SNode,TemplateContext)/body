{
  SNode child=InputQueryUtil.getNodeToInsert(macro,templateContext,myTemplateProcessor.myEnv);
  if (child != null) {
    Language childLang=jetbrains.mps.util.SNodeOperations.getLanguage(child);
    if (!getGeneratorSessionContext().getGenerationPlan().isCountedLanguage(childLang)) {
      if (!childLang.getGenerators().isEmpty()) {
        getLogger().error(child,"language of output node is '" + childLang.getModuleName() + "' - this language did not show up when computing generation steps!",GeneratorUtil.describe(macro,"template"),GeneratorUtil.describe(templateContext.getInput(),"input"),new ProblemDescription(null,"workaround: add the language '" + childLang.getModuleName() + "' to list of 'Languages Engaged On Generation' in model '"+ getGeneratorSessionContext().getOriginalInputModel().getReference().getModelName()+ "'"));
      }
    }
    if (child.getModel() != null) {
      child=CopyUtil.copy(child);
    }
    myTemplateProcessor.validateReferences(child,templateContext.getInput());
    getGenerator().registerMappingLabel(templateContext.getInput(),templateContext.getInputName(),child);
    return Collections.singletonList(child);
  }
  return Collections.emptyList();
}
