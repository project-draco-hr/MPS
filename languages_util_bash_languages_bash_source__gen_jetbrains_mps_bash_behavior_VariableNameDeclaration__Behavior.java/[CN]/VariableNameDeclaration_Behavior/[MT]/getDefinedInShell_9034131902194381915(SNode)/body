{
  List<SNode> result=new ArrayList<SNode>();
  SNode script=SNodeOperations.getAncestor(node,"jetbrains.mps.bash.structure.ShellScript",false,false);
  ListSequence.<SNode>fromList(result).addSequence(ListSequence.<SNode>fromList(SLinkOperations.getTargets(script,"usedVars",true)));
  for (  SNode line : ListSequence.<SNode>fromList(SLinkOperations.getTargets(SLinkOperations.getTarget(script,"commands",true),"lines",true))) {
    ListSequence.<SNode>fromList(result).addSequence(ListSequence.<SNode>fromList(SNodeOperations.getDescendants(line,"jetbrains.mps.bash.structure.VariableNameDeclaration",false,new String[]{})));
  }
  return result;
}
