{
  UndoManagerImpl undoManager=(UndoManagerImpl)UndoManager.getInstance(ProjectHelper.toIdeaProject(myProject));
  CurrentEditorProvider oldEditorProvider=undoManager.getEditorProvider();
  undoManager.setEditorProvider(new CurrentEditorProvider(){
    public FileEditor getCurrentEditor(){
      return myFileNodeEditor;
    }
  }
);
  SwingUtilities.invokeAndWait(new Runnable(){
    public void run(){
      runnable.run();
    }
  }
);
  flushEDTEvents();
  flushEDTEvents();
  undoManager.setEditorProvider(oldEditorProvider);
}
