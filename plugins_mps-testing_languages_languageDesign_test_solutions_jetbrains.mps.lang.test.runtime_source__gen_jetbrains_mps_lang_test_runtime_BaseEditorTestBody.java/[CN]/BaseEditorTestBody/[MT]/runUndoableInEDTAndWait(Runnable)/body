{
  UndoManagerImpl undoManager=(UndoManagerImpl)UndoManager.getInstance(ProjectHelper.toIdeaProject(myProject));
  CurrentEditorProvider oldEditorProvider=undoManager.getEditorProvider();
  undoManager.setEditorProvider(new CurrentEditorProvider(){
    public FileEditor getCurrentEditor(){
      return myFileNodeEditor;
    }
  }
);
  final Throwable[] ts=new Throwable[1];
  SwingUtilities.invokeAndWait(new Runnable(){
    public void run(){
      try {
        runnable.run();
      }
 catch (      Throwable t) {
        ts[0]=t;
      }
    }
  }
);
  if (ts[0] != null) {
    throw new RuntimeException("Failure during editor test execution",ts[0]);
  }
  flushEDTEvents();
  flushEDTEvents();
  undoManager.setEditorProvider(oldEditorProvider);
}
