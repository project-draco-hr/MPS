{
  UndoManagerImpl instance=(UndoManagerImpl)UndoManager.getInstance(ProjectHelper.toIdeaProject(myProject));
  instance.setEditorProvider(new CurrentEditorProvider(){
    public FileEditor getCurrentEditor(){
      final Component owner=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner();
      return PlatformDataKeys.FILE_EDITOR.getData(DataManager.getInstance().getDataContext(owner));
    }
  }
);
}
