{
  UndoManagerImpl instance=(UndoManagerImpl)UndoManager.getInstance(ProjectHelper.toIdeaProject(myProject));
  instance.setEditorProvider(new CurrentEditorProvider(){
    public FileEditor getCurrentEditor(){
      DataContext context=DataManager.getInstance().getDataContext((Component)editor.getCurrentEditorComponent());
      return MPSCommonDataKeys.FILE_EDITOR.getData(context);
    }
  }
);
}
