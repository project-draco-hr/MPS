{
  ModelAccess.assertLegalWrite();
  Sdk sdk=ModuleRootManager.getInstance(module).getSdk();
  if (!(sdk instanceof SdkModificator)) {
    return;
  }
  String sdkType=sdk.getSdkType().getName();
synchronized (LOCK) {
    if (JAVA_SDK_TYPE.equals(sdkType)) {
      if (sdk.equals(myJavaSdk))       return;
      dropSdksIfUnused();
      if (myJavaSdk == null && myIdeaSdk == null) {
        setUpJdk(sdk);
        myModules.add(module);
        return;
      }
      throw new DifferentSdkException(myJavaSdk,sdk);
    }
 else     if (IDEA_SDK_TYPE.equals(sdkType)) {
      if (sdk.equals(myIdeaSdk))       return;
      dropSdksIfUnused();
      if (myIdeaSdk == null) {
        setUpIdeaSdk(sdk);
        myModules.add(module);
        return;
      }
      throw new DifferentSdkException(myIdeaSdk,sdk);
    }
 else {
      addSolution(sdk);
    }
  }
}
