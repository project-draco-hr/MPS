{
  SetSequence.fromSet(visited).addElement(plugin);
  for (  SNode dependency : ListSequence.fromList(SLinkOperations.getTargets(plugin,"dependencies",true))) {
    SNode dependencyPlugin=SLinkOperations.getTarget(dependency,"target",false);
    if (SNodeOperations.getContainingRoot(dependencyPlugin) != myRoot) {
      dependencyPlugin=SNodeOperations.as(DependenciesHelper.getOriginalNode(dependencyPlugin,myContext),"jetbrains.mps.build.mps.structure.BuildMps_IdeaPlugin");
      if (dependencyPlugin == null) {
        continue;
      }
    }
    if (!(SetSequence.fromSet(visited).contains(dependencyPlugin))) {
      collectDependencies(dependencyPlugin,visited);
    }
  }
}
