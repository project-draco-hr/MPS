{
  String models=PathUtil.getParentPath(copyFromUserDirToProject("tests/makeTests/models/code.mps","models/code.mps"));
  PathUtil.getParentPath(copyFromUserDirToProject("tests/makeTests/models/code2.mps","models/code2.mps"));
  PathUtil.getParentPath(copyFromUserDirToProject("tests/makeTests/models/data.mps","models/data.mps"));
  PathUtil.getParentPath(copyFromUserDirToProject("tests/makeTests/models/data2.mps","models/data2.mps"));
  String srcgen=PathUtil.getParentPath(createFile("src/empty.txt",""));
  JpsModule main=addModule("makeTests",srcgen,models);
  MPSConfigurationBean configuration=createConfiguration(models);
  configuration.setGeneratorOutputPath(srcgen);
  configuration.setUseModuleSourceFolder(true);
  DefaultModelRoot dmr=createModelRoot(models);
  configuration.setModelRoots(Arrays.<ModelRoot>asList(dmr));
  JpsMPSExtensionService.getInstance().setExtension(main,new JpsMPSModuleExtensionImpl(configuration));
  getBuilderParams().put(MPSMakeConstants.MPS_LANGUAGES.toString(),getLanguageLocations());
  rebuildAll();
  assertGenerated("models/Manifest.java","models/Manifest2.java","models/manifest.xml","models/trace.info","models/trace.info","mps-make/makeTests/source_gen.caches/code/dependencies","mps-make/makeTests/source_gen.caches/code/generated","mps-make/makeTests/source_gen.caches/code2/dependencies","mps-make/makeTests/source_gen.caches/code2/generated","mps-make/makeTests/source_gen.caches/data/dependencies","mps-make/makeTests/source_gen.caches/data/generated","mps-make/makeTests/source_gen.caches/data2/dependencies","mps-make/makeTests/source_gen.caches/data2/generated","src/code/Test.java","src/code/trace.info","src/code2/Test2.java","src/code2/trace.info");
  doBuild(CompileScopeTestBuilder.make().all());
  assertGenerated();
  touch(getAbsolutePath("models/data.mps"));
  touch(getAbsolutePath("models/code.mps"));
  doBuild(CompileScopeTestBuilder.make().all());
  assertGenerated("models/trace.info","mps-make/makeTests/source_gen.caches/code/dependencies","mps-make/makeTests/source_gen.caches/code/generated","mps-make/makeTests/source_gen.caches/data/dependencies","mps-make/makeTests/source_gen.caches/data/generated","src/code/trace.info");
}
