{
  Graph graph=myEmbeddedGraph.getGraph();
  Map<Edge,Edge> edgeTransform=MapSequence.<Edge,Edge>fromMap(new HashMap<Edge,Edge>());
  List<Node> initialNodes=ListSequence.<Node>fromList(new ArrayList<Node>());
  ListSequence.<Node>fromList(initialNodes).addSequence(ListSequence.<Node>fromList(myGraph.getNodes()));
  for (  final Node node : ListSequence.<Node>fromList(initialNodes)) {
    List<Dart> darts=getOrderedDarts(node);
    Iterator<Dart> dartItr=ListSequence.<Dart>fromList(darts).iterator();
    Set<Dart> removed=SetSequence.<Dart>fromSet(new HashSet<Dart>());
    while (dartItr.hasNext()) {
      Dart curDart;
      curDart=dartItr.next();
      if (MapSequence.<Dart,Integer>fromMap(myAngles).get(curDart) == 0) {
        List<Dart> sameDirectionDarts=ListSequence.<Dart>fromList(new LinkedList<Dart>());
        while (MapSequence.<Dart,Integer>fromMap(myAngles).get(curDart) == 0) {
          ListSequence.<Dart>fromList(sameDirectionDarts).addElement(curDart);
          curDart=dartItr.next();
        }
        List<Edge> modifiedEdges=ListSequence.<Edge>fromList(new LinkedList<Edge>());
        for (        Dart dart : ListSequence.<Dart>fromList(sameDirectionDarts)) {
          Edge edge=dart.getEdge();
          if (MapSequence.fromMap(edgeTransform).containsKey(edge)) {
            edge=MapSequence.<Edge,Edge>fromMap(edgeTransform).get(edge);
          }
          ListSequence.<Edge>fromList(modifiedEdges).addElement(edge);
        }
        Edge edge=curDart.getEdge();
        if (MapSequence.fromMap(edgeTransform).containsKey(edge)) {
          edge=MapSequence.<Edge,Edge>fromMap(edgeTransform).get(edge);
        }
        ListSequence.<Edge>fromList(modifiedEdges).addElement(edge);
        final Wrappers._T<Edge> curEdge=new Wrappers._T<Edge>(curDart.getEdge());
        int curNum=0;
        List<Edge> newEdges=ListSequence.<Edge>fromList(new LinkedList<Edge>());
        for (        Dart dart : ListSequence.<Dart>fromList(sameDirectionDarts).reversedList()) {
          SetSequence.fromSet(removed).addElement(curDart);
          SetSequence.fromSet(removed).addElement(myEmbeddedGraph.getOpposite(curDart));
          Dart backCurDart=myEmbeddedGraph.getOpposite(curDart);
          List<Edge> edgesFromSplit=ListSequence.<Edge>fromList(new ArrayList<Edge>());
          Node newNode=myEmbeddedGraph.splitEdge(curEdge.value,edgesFromSplit);
          Edge nextEdge=ListSequence.<Edge>fromList(edgesFromSplit).findFirst(new IWhereFilter<Edge>(){
            public boolean accept(            Edge it){
              return ListSequence.<Node>fromList(it.getAdjacentNodes()).contains(node);
            }
          }
);
          Dart tempDart;
          tempDart=myEmbeddedGraph.getSourceDart(nextEdge,node);
          MapSequence.<Dart,Integer>fromMap(myAngles).put(tempDart,MapSequence.<Dart,Integer>fromMap(myAngles).get(curDart));
          MapSequence.<Dart,Integer>fromMap(myBends).put(tempDart,0);
          tempDart=myEmbeddedGraph.getOpposite(tempDart);
          MapSequence.<Dart,Integer>fromMap(myAngles).put(tempDart,1);
          MapSequence.<Dart,Integer>fromMap(myBends).put(tempDart,0);
          Edge anotherEdge=ListSequence.<Edge>fromList(edgesFromSplit).findFirst(new IWhereFilter<Edge>(){
            public boolean accept(            Edge it){
              return ListSequence.<Node>fromList(it.getAdjacentNodes()).contains(curEdge.value.getOpposite(node));
            }
          }
);
          if (dart == ListSequence.<Dart>fromList(sameDirectionDarts).last()) {
            MapSequence.<Edge,Edge>fromMap(edgeTransform).put(anotherEdge,curEdge.value);
            ListSequence.<Edge>fromList(newEdges).addElement(anotherEdge);
          }
          tempDart=myEmbeddedGraph.getSourceDart(anotherEdge,newNode);
          MapSequence.<Dart,Integer>fromMap(myAngles).put(tempDart,2);
          MapSequence.<Dart,Integer>fromMap(myBends).put(tempDart,MapSequence.<Dart,Integer>fromMap(myBends).get(curDart));
          tempDart=myEmbeddedGraph.getOpposite(tempDart);
          MapSequence.<Dart,Integer>fromMap(myAngles).put(tempDart,MapSequence.<Dart,Integer>fromMap(myAngles).get(backCurDart));
          MapSequence.<Dart,Integer>fromMap(myBends).put(tempDart,MapSequence.<Dart,Integer>fromMap(myBends).get(backCurDart));
          Face face=myEmbeddedGraph.getFace(dart);
          Dart oppositeDart=myEmbeddedGraph.getOpposite(dart);
          Face anotherFace=myEmbeddedGraph.getFace(oppositeDart);
          Edge oldEdge=dart.getEdge();
          Dart frontOldDart=myEmbeddedGraph.getSourceDart(oldEdge,node);
          Dart backOldDart=myEmbeddedGraph.getOpposite(frontOldDart);
          SetSequence.fromSet(removed).addElement(frontOldDart);
          SetSequence.fromSet(removed).addElement(backOldDart);
          face.makeStartsWith(dart);
          graph.removeEdge(oldEdge);
          Edge newEdge=graph.connect(newNode,oldEdge.getOpposite(node));
          ListSequence.<Edge>fromList(newEdges).addElement(newEdge);
          MapSequence.<Edge,Edge>fromMap(edgeTransform).put(newEdge,oldEdge);
          Dart lastFaceDart=ListSequence.<Dart>fromList(face.getDarts()).last();
          myEmbeddedGraph.removeDart(face,lastFaceDart);
          Dart frontNewDart=new Dart(newEdge,newNode);
          myEmbeddedGraph.setDart(face,0,frontNewDart);
          MapSequence.<Dart,Integer>fromMap(myAngles).put(frontNewDart,1);
          MapSequence.<Dart,Integer>fromMap(myBends).put(frontNewDart,MapSequence.<Dart,Integer>fromMap(myBends).get(frontOldDart));
          anotherFace.makeEndsWith(oppositeDart);
          Dart backNewDart=new Dart(newEdge,oldEdge.getOpposite(node));
          myEmbeddedGraph.setDart(anotherFace,ListSequence.<Dart>fromList(anotherFace.getDarts()).count() - 1,backNewDart);
          myEmbeddedGraph.insertDart(anotherFace,ListSequence.<Dart>fromList(anotherFace.getDarts()).count(),lastFaceDart);
          MapSequence.<Dart,Integer>fromMap(myAngles).put(backNewDart,MapSequence.<Dart,Integer>fromMap(myAngles).get(backOldDart));
          MapSequence.<Dart,Integer>fromMap(myBends).put(backNewDart,MapSequence.<Dart,Integer>fromMap(myBends).get(backOldDart) - 1);
          List<Edge> historyEdgesList=ListSequence.<Edge>fromListAndArray(new ArrayList<Edge>(),nextEdge,newEdge);
          GraphModificationEvent splitEvent=new GraphModificationEvent(GraphModificationEvent.Type.EDGE_SPLITTED,oldEdge,historyEdgesList);
          myGraph.getModificationProcessor().fire(splitEvent);
          curEdge.value=nextEdge;
          curDart=myEmbeddedGraph.getSourceDart(curEdge.value,node);
          curNum++;
        }
        ListSequence.<QuasiRepresentationModifier.Modification>fromList(myModifications).addElement(new QuasiRepresentationModifier.Modification(ListSequence.<Edge>fromList(modifiedEdges).reversedList(),newEdges,node,curDart));
      }
    }
    for (    Dart dart : SetSequence.<Dart>fromSet(removed)) {
      MapSequence.fromMap(myAngles).removeKey(dart);
      MapSequence.fromMap(myBends).removeKey(dart);
    }
  }
}
