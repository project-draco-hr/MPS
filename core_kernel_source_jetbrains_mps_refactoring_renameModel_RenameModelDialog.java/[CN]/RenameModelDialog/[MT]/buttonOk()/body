{
  final SModelFqName fqName=SModelFqName.fromString(myModelNameField.getText());
  if (!myModelRoot.isCorrectModelFqName(fqName)) {
    setErrorText("Incorrect model name for the model root (should start with prefix " + myModelRoot.getPrefix() + ")");
    return;
  }
  final ModelRenamer renamer=new ModelRenamer(myModelDescriptor,fqName,!myUpdateAllReferences.getModel().isSelected());
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      renamer.rename();
    }
  }
);
  ProgressManager.getInstance().run(new Modal(myProject,"Updating model usages...",false){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      indicator.pushState();
      indicator.setIndeterminate(true);
      try {
        ModelAccess.instance().runWriteAction(new Runnable(){
          public void run(){
            renamer.updateReferencesIfNeeded();
          }
        }
);
      }
  finally {
        indicator.popState();
      }
    }
  }
);
  dispose();
}
