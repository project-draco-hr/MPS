{
  final LanguageDescriptor languageDescriptor=language.getModuleDescriptor();
  final GeneratorDescriptor generatorDescriptor=new GeneratorDescriptor();
  generatorDescriptor.setGeneratorUID(Generator.generateGeneratorUID(language));
  generatorDescriptor.setNamespace(name);
  ModelRoot templateModelsRoot=new ModelRoot();
  templateModelsRoot.setPath(templateModelsDir.getAbsolutePath());
  generatorDescriptor.getModelRoots().add(templateModelsRoot);
  generatorDescriptor.getUsedDevkits().add(GeneralPurpose_DevKit.MODULE_REFERENCE);
  languageDescriptor.getGenerators().add(generatorDescriptor);
  language.setLanguageDescriptor(languageDescriptor,true);
  ModelAccess.instance().runWriteInEDT(new Runnable(){
    @Override public void run(){
      language.save();
    }
  }
);
  return (Generator)MPSModuleRepository.getInstance().getModuleById(generatorDescriptor.getId());
}
