{
  final LanguageDescriptor languageDescriptor=language.getModuleDescriptor();
  final GeneratorDescriptor generatorDescriptor=new GeneratorDescriptor();
  generatorDescriptor.setGeneratorUID(Generator.generateGeneratorUID(language));
  generatorDescriptor.setNamespace(name);
  DefaultModelRoot templateModelsRoot=new DefaultModelRoot();
  templateModelsRoot.setContentRoot(templateModelsDir);
  templateModelsRoot.addFile(DefaultModelRoot.SOURCE_ROOTS,templateModelsDir);
  generatorDescriptor.getModelRootDescriptors().add(templateModelsRoot.toDescriptor());
  generatorDescriptor.getUsedDevkits().add(PersistenceFacade.getInstance().createModuleReference("fbc25dd2-5da4-483a-8b19-70928e1b62d7(jetbrains.mps.devkit.general-purpose)"));
  generatorDescriptor.getUsedLanguages().add(PersistenceFacade.getInstance().createModuleReference("b401a680-8325-4110-8fd3-84331ff25bef(jetbrains.mps.lang.generator)"));
  generatorDescriptor.getUsedLanguages().add(PersistenceFacade.getInstance().createModuleReference("d7706f63-9be2-479c-a3da-ae92af1e64d5(jetbrains.mps.lang.generator.generationContext)"));
  languageDescriptor.getGenerators().add(generatorDescriptor);
  language.setLanguageDescriptor(languageDescriptor);
  language.save();
  return (Generator)MPSModuleRepository.getInstance().getModule(generatorDescriptor.getId());
}
