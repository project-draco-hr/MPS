{
  for (  IModule m : MPSModuleRepository.getInstance().getAllModules()) {
    if (!containsBundle(m.getModuleUID())) {
      addModule(m.getModuleUID());
    }
  }
  Set<String> removed=new HashSet<String>();
  for (  String uid : myOSGIBundles.keySet()) {
    if (MPSModuleRepository.getInstance().getModuleByUID(uid) == null) {
      try {
        removeBundle(uid);
        removed.add(uid);
      }
 catch (      Throwable t) {
        LOG.error(t);
      }
    }
  }
  myOSGIBundles.keySet().removeAll(removed);
  if (myUseOSGI) {
    refreshBundles(myOSGIBundles.values().toArray(new Bundle[myOSGIBundles.size()]),true);
  }
 else {
    myRuntimeEnvironment.reloadAll();
  }
  for (  IModule m : myModuleRepository.getAllModules()) {
    m.updateClassPath();
  }
}
