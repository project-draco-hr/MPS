{
  if (myBundleContext != null) {
    myBundleContext.addFrameworkListener(new FrameworkListener(){
      public void frameworkEvent(      FrameworkEvent event){
synchronized (myInvokeOnRefresh) {
          if (event.getType() == FrameworkEvent.PACKAGES_REFRESHED) {
            for (            Runnable r : myInvokeOnRefresh) {
              r.run();
            }
            myInvokeOnRefresh.clear();
          }
        }
      }
    }
);
    ServiceReference ref=myBundleContext.getServiceReference(PackageAdmin.class.getName());
    myPackageAdmin=(PackageAdmin)myBundleContext.getService(ref);
  }
  updateClassPath();
  CommandProcessor.instance().addCommandListener(new CommandAdapter(){
    public void commandFinished(    @NotNull CommandEvent event){
      handleAddAndRemoves();
    }
  }
);
}
