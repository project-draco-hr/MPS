{
  if (bundles.length == 0) {
    return;
  }
  for (  Bundle b : bundles) {
    try {
      b.update();
    }
 catch (    Throwable t) {
      LOG.error(t);
    }
  }
  final Lock lock=new ReentrantLock();
  final Condition refreshCompleted=lock.newCondition();
  lock.lock();
  try {
    myPackageAdmin.refreshPackages(bundles);
    invokeOnRefresh(new Runnable(){
      public void run(){
        lock.lock();
        refreshCompleted.signal();
        lock.unlock();
      }
    }
);
    refreshCompleted.await();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
 finally {
    lock.unlock();
  }
}
