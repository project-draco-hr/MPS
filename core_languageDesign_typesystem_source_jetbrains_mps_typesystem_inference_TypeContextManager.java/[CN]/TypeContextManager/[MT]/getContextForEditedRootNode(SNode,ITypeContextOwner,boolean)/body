{
synchronized (myLock) {
    Pair<TypeCheckingContext,List<ITypeContextOwner>> contextWithOwners=myTypeCheckingContexts.get(node);
    if (contextWithOwners == null) {
      TypeCheckingContext newTypeCheckingContext=createTypeCheckingContext(node);
      List<ITypeContextOwner> owners=new ArrayList<ITypeContextOwner>(1);
      contextWithOwners=new Pair<TypeCheckingContext,List<ITypeContextOwner>>(newTypeCheckingContext,owners);
      owners.add(owner);
      myTypeCheckingContexts.put(node,contextWithOwners);
      return newTypeCheckingContext;
    }
 else {
      TypeCheckingContext context=contextWithOwners.o1;
      if (alwaysRegisterOwner && !contextWithOwners.o2.contains(owner)) {
        contextWithOwners.o2.add(owner);
      }
      return context;
    }
  }
}
