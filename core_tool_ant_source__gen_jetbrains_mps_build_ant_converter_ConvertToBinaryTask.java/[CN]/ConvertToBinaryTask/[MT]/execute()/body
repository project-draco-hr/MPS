{
  super.execute();
  if (!(toConvert.isEmpty())) {
    Iterable<File> classPaths=MPSClasspathUtil.buildClasspath(getProject(),mpsHome,false);
    List<URL> classPathUrls=new ArrayList<URL>();
    for (    File path : classPaths) {
      try {
        classPathUrls.add(new URL("file:///" + path));
      }
 catch (      MalformedURLException e) {
        throw new BuildException(e);
      }
    }
    URLClassLoader classLoader=new URLClassLoader(classPathUrls.toArray(new URL[classPathUrls.size()]),this.getClass().getClassLoader());
    try {
      Class<?> converterClass=classLoader.loadClass("jetbrains.mps.tool.builder.converter.ConvertToBinaryWorker");
      Object converter=converterClass.newInstance();
      Method method=converterClass.getMethod("convert",Map.class);
      method.invoke(converter,toConvert);
    }
 catch (    Throwable t) {
      if (t instanceof RuntimeException && t.getCause() instanceof IOException) {
        t=t.getCause();
      }
      String message=t.getMessage();
      if ((message == null || message.length() == 0)) {
        message=t.getClass().toString();
      }
      throw new BuildException("Cannot convert .mps into .mpb: " + message + "\n"+ "Used class path: "+ classPathUrls.toString(),t);
    }
  }
}
