{
  monitor.start("Loading modules...",1);
  try {
    Condition<ReloadableModule> notLoadedCondition=new NotCondition<ReloadableModule>(myLoadedCondition);
    Set<ReloadableModule> modulesToLoad=new LinkedHashSet<ReloadableModule>(filterModules(modules,myWatchableCondition,myValidCondition));
    if (modulesToLoad.isEmpty())     return Collections.emptySet();
    modulesToLoad.addAll(myModulesWatcher.getResolvedDependencies(modulesToLoad));
    modulesToLoad=filterModules(modulesToLoad,myMPSLoadableCondition,notLoadedCondition);
    if (modulesToLoad.isEmpty())     return Collections.emptySet();
    LOG.debug("Loading " + modulesToLoad.size() + " modules");
    monitor.advance(1);
    if (!filterModules(modulesToLoad,myUnloadedCondition).isEmpty()) {
      LOG.warn("Some modules are not preloaded yet : cannot load them");
    }
    myClassLoadersHolder.doLoadModules(modulesToLoad,monitor);
    return modulesToLoad;
  }
  finally {
    monitor.done();
  }
}
