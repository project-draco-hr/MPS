{
synchronized (CLASS_LOADING_LOCK) {
    Set<SModule> modulesToLoad=new LinkedHashSet<SModule>(getValidModulesWithDeps(modules));
    modulesToLoad=filterModules(modulesToLoad,negateCondition(myLoadedCondition));
    if (modulesToLoad.isEmpty())     return modulesToLoad;
    modulesToLoad=filterModules(modulesToLoad,myMPSLoadableCondition);
    LOG.debug("Loading " + modulesToLoad.size() + " modules");
    Set<SModule> modulesToNotify=myClassLoadersHolder.doLoadModules(modulesToLoad,monitor);
    myBroadCaster.onLoad(modulesToNotify);
    return modulesToLoad;
  }
}
