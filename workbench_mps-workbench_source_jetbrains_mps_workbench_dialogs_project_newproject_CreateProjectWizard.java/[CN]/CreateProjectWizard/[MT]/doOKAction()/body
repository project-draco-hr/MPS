{
  super.doOKAction();
  if (myCurrentProject != null) {
    int exitCode=Messages.showDialog(IdeBundle.message("prompt.open.project.in.new.frame"),IdeBundle.message("title.open.project"),new String[]{IdeBundle.message("button.newframe"),IdeBundle.message("button.existingframe")},1,Messages.getQuestionIcon());
    if (exitCode == 1) {
      ProjectUtil.closeAndDispose(myCurrentProject);
    }
  }
  final ProjectOptions myOptions=new ProjectOptions();
  myOptions.setProjectName(myProjectName.getText());
  myOptions.setProjectPath(myProjectPath.getPath());
  myOptions.setCreateNewLanguage(false);
  myOptions.setCreateNewSolution(false);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      try {
        ProjectFactory factory=new ProjectFactory(myCurrentProject,myOptions);
        Project project=factory.createProject();
        myCurrentTemplateItem.getTemplateFiller().fillProjectWithModules(project.getComponent(MPSProject.class));
        factory.activate();
      }
 catch (      ProjectNotCreatedException e) {
        Messages.showErrorDialog(getContentPane(),e.getMessage());
      }
    }
  }
);
}
