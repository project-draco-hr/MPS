{
  final SModelPersistence pers=new XmlModelPersistence();
  final StreamDataSource source=new XmlConverterTest.MyDataSource(resource);
  final XmlConverterTest.StringBuilderDataSource sbds=new XmlConverterTest.StringBuilderDataSource();
  ourProject.getModelAccess().runReadAction(new Runnable(){
    @Override public void run(){
      try {
        SModelData model=pers.readModel(new SModelReference(new ModuleReference("mockModule",ModuleId.regular()),SModelId.generate(),"xmlfile"),source);
        pers.writeModel(model,sbds);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
catch (      ModelSaveException e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  String after=sbds.getResult();
  String before=FileUtil.read(new InputStreamReader(source.openInputStream(),FileUtil.DEFAULT_CHARSET)).trim();
  Assert.assertEquals(before,after);
}
