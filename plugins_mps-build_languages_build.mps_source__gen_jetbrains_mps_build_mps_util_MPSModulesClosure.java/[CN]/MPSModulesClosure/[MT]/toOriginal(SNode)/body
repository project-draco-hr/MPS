{
  if (node == null) {
    return null;
  }
  if (SNodeOperations.getContainingRoot(node) == SNodeOperations.getContainingRoot(Sequence.fromIterable(initialModules).first())) {
    return node;
  }
  if (skipExternalModules) {
    return null;
  }
  return SNodeOperations.as(DependenciesHelper.getOriginalNode(node,genContext),"jetbrains.mps.build.mps.structure.BuildMps_Module");
}
