{
  final SModelPersistence pers=new XmlModelPersistence();
  final StreamDataSource source=new MyDataSource(resource);
  final StringBuilderDataSource sbds=new StringBuilderDataSource();
  ModelAccess.instance().runReadAction(new Runnable(){
    @Override public void run(){
      try {
        SModelData model=pers.readModel(new SModelReference(null,SModelId.generate(),"xmlfile"),source);
        pers.writeModel(model,sbds);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
catch (      ModelSaveException e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  String after=sbds.getResult();
  String before=FileUtil.read(new InputStreamReader(source.openInputStream(),FileUtil.DEFAULT_CHARSET)).trim();
  assertEquals(before,after);
}
