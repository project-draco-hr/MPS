{
  int maxImport=0;
  for (  ImportElement elem : ((jetbrains.mps.smodel.SModelInternal)model).importedModels()) {
    maxImport=Math.max(elem.getReferenceID(),maxImport);
  }
  for (  ImportElement elem : ((jetbrains.mps.smodel.SModelInternal)model).getAdditionalModelVersions()) {
    maxImport=Math.max(elem.getReferenceID(),maxImport);
  }
  for (  ImportElement elem : ((jetbrains.mps.smodel.SModelInternal)model).importedModels()) {
    if (elem.getReferenceID() < 0)     elem.setReferenceID(++maxImport);
  }
  for (  ImportElement elem : ((jetbrains.mps.smodel.SModelInternal)model).getAdditionalModelVersions()) {
    if (elem.getReferenceID() < 0)     elem.setReferenceID(++maxImport);
  }
}
