{
  List<ProjectMigration> pMig=ProjectMigrationsRegistry.getInstance().getMigrations();
  final MPSProject mpsPoject=ProjectHelper.fromIdeaProject(project);
  List<ProjectMigrationWithOptions.Option> options=ListSequence.fromList(new ArrayList<ProjectMigrationWithOptions.Option>());
  final List<String> modulesToMigrate=ListSequence.fromList(new ArrayList<String>());
  final List<String> languageMigrations=ListSequence.fromList(new ArrayList<String>());
  mpsPoject.getRepository().getModelAccess().runReadAction(new Runnable(){
    public void run(){
      ListSequence.fromList(modulesToMigrate).addSequence(Sequence.fromIterable(MigrationModuleUtil.getMigrateableModulesFromProject(mpsPoject)).where(new IWhereFilter<SModule>(){
        public boolean accept(        SModule module){
          return Sequence.fromIterable(MigrationsUtil.getAllSteps(module)).isNotEmpty();
        }
      }
).select(new ISelector<SModule,String>(){
        public String select(        SModule module){
          return NameUtil.compactNamespace(module.getModuleName());
        }
      }
));
      ListSequence.fromList(languageMigrations).addSequence(ListSequence.fromList(manager.getModuleMigrationsToApply(MigrationModuleUtil.getMigrateableModulesFromProject(mpsPoject))).select(new ISelector<ScriptApplied.ScriptAppliedReference,String>(){
        public String select(        ScriptApplied.ScriptAppliedReference it){
          return it.getKindDescription(it.resolve(manager.getMigrationComponent(),false));
        }
      }
).distinct());
    }
  }
);
  StringBuilder modulesSB=new StringBuilder();
  for (  String m : modulesToMigrate) {
    modulesSB.append(m).append("<br />");
  }
  StringBuilder scriptsSB=new StringBuilder();
  for (  String lm : languageMigrations) {
    scriptsSB.append(lm).append("<br />");
  }
  ListSequence.fromList(options).addElement(new MigrationAssistantWizard.InfoOption("viewModulesToMigrate","Modules to be migrated:",modulesSB.toString()));
  ListSequence.fromList(options).addElement(new MigrationAssistantWizard.InfoOption("viewScriptToRun","Language migrations to be executed:",scriptsSB.toString()));
  ListSequence.fromList(options).addSequence(ListSequence.fromList(pMig).ofType(ProjectMigrationWithOptions.class).where(new IWhereFilter<ProjectMigrationWithOptions>(){
    public boolean accept(    ProjectMigrationWithOptions it){
      return it.shouldBeExecuted(ProjectHelper.fromIdeaProject(project));
    }
  }
).translate(new ITranslator2<ProjectMigrationWithOptions,ProjectMigrationWithOptions.Option>(){
    public Iterable<ProjectMigrationWithOptions.Option> translate(    ProjectMigrationWithOptions it){
      return it.getOptions();
    }
  }
));
  InitialStep initialStep=new InitialStep(project,options);
  MigrationsProgressWizardStep migrationsProgressWizardStep=new MigrationsProgressWizardStep(project,initialStep,manager,errorContainer,true);
  MigrationErrorWizardStep migrationErrorWizardStep=new MigrationErrorWizardStep(project,errorContainer);
  MigrationsProgressWizardStep fallBackProgressStep=new MigrationsProgressWizardStep(project,initialStep,manager,errorContainer,false);
  return ListSequence.fromListAndArray(new ArrayList<MigrationWizardStep>(),initialStep,migrationsProgressWizardStep,migrationErrorWizardStep,fallBackProgressStep);
}
