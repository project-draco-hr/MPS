{
  CompilerManager compilerManager=CompilerManager.getInstance(project);
  compilerManager.addBeforeTask(new CompileTask(){
    @Override public boolean execute(    CompileContext compileContext){
      if (!CompilerWorkspaceConfiguration.getInstance(project).USE_COMPILE_SERVER)       return true;
      compileContext.addMessage(CompilerMessageCategory.ERROR,"Compiler setting \"Use exernal build\" should be switched off to generate MPS code",null,-1,-1);
      return false;
    }
  }
);
  compilerManager.addCompilableFileType(MPSFileTypeFactory.MODEL_FILE_TYPE);
  for (  MPSCompiler2 compiler : compilerManager.getCompilers(MPSCompiler2.class)) {
    compilerManager.removeCompiler(compiler);
  }
  compilerManager.addCompiler(new MPSCompiler2(project));
}
