{
  final boolean[] closeDialog=new boolean[]{true};
  getProject().getRepository().getModelAccess().executeCommand(new Runnable(){
    @Override public void run(){
      SModelRepository.getInstance().saveAll();
    }
  }
);
  ThreadUtils.runInUIThreadAndWait(new Runnable(){
    @Override public void run(){
      closeDialog[0]=doSaveChanges();
    }
  }
);
  ProgressManager.getInstance().run(new Modal(ProjectHelper.toIdeaProject(getProject()),"Applying changes",false){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      indicator.setIndeterminate(true);
      try {
        ModelAccess.instance().runWriteAction(new Runnable(){
          @Override public void run(){
            CleanupManager.getInstance().cleanup();
          }
        }
);
      }
 catch (      Throwable t) {
        LOG.error(null,t);
      }
    }
  }
);
  ApplicationManager.getApplication().saveAll();
  return closeDialog[0];
}
