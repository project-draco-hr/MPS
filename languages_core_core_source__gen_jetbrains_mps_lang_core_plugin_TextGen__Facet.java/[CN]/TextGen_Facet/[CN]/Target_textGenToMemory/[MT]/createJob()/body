{
  return new IJob.Stub(){
    public IResult execute(    final Iterable<IResource> input,    final IJobMonitor monitor,    final IPropertiesAccessor pa){
      Iterable<IResource> _output_21gswx_a0b=null;
switch (0) {
case 0:
        for (        IResource resource : Sequence.fromIterable(input)) {
          final GResource gres=(GResource)resource;
          final Map<String,Object> texts=MapSequence.fromMap(new HashMap<String,Object>());
          final Wrappers._T<SModel> sModel=new Wrappers._T<SModel>();
          final Wrappers._boolean errors=new Wrappers._boolean(false);
          ModelAccess.instance().runReadAction(new Runnable(){
            public void run(){
              sModel.value=gres.status().getOutputModel();
              for (              SNode root : sModel.value.roots()) {
                TextGenerationResult tgr=TextGenerationUtil.generateText(pa.global().properties(new ITarget.Name("jetbrains.mps.lang.core.Generate.checkParameters"),Generate_Facet.Target_checkParameters.Variables.class).operationContext(),root);
                errors.value|=tgr.hasErrors();
                if (errors.value) {
                  for (                  IMessage err : tgr.problems()) {
                    monitor.reportFeedback(new IFeedback.MESSAGE(err));
                  }
                  monitor.reportFeedback(new IFeedback.ERROR(String.valueOf("Failed to generate text")));
                  break;
                }
                String ext=TextGenManager.instance().getExtension(root);
                String fname=((ext != null ? root.getName() + "." + ext : root.getName()));
                if (fname == null) {
                  fname="<null> [" + root.getSNodeId() + "]";
                  monitor.reportFeedback(new IFeedback.WARNING(String.valueOf("No file name for the root node [" + root.getSNodeId() + "]")));
                }
                MapSequence.fromMap(texts).put(fname,tgr.getResult());
              }
            }
          }
);
          if (errors.value) {
            return new IResult.FAILURE(_output_21gswx_a0b);
          }
          _output_21gswx_a0b=Sequence.fromIterable(_output_21gswx_a0b).concat(Sequence.fromIterable(Sequence.<IResource>singleton(new FResource(JavaNameUtil.packageName(sModel.value),texts,gres.module(),gres.model()))));
        }
default :
      return new IResult.SUCCESS(_output_21gswx_a0b);
  }
}
}
;
}
