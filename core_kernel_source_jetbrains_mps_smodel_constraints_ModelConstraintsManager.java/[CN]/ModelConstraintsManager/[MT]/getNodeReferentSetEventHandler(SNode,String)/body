{
  String nodeConceptFqName=node.getConceptFqName();
  String originalKey=nodeConceptFqName + "#" + referentRole;
synchronized (myLock) {
    INodeReferentSetEventHandler result=myNodeReferentSetEventHandlersMap.get(originalKey);
    if (result != null || myNodeReferentSetEventHandlersMap.containsKey(originalKey)) {
      return result;
    }
    List<AbstractConceptDeclaration> hierarchy=SModelUtil_new.getConceptAndSuperConcepts(node.getConceptDeclarationAdapter());
    for (    AbstractConceptDeclaration concept : hierarchy) {
      Language l=SModelUtil_new.getDeclaringLanguage(concept,GlobalScope.getInstance());
      ensureLanguageAdded(l);
      String conceptFqName=NameUtil.nodeFQName(concept);
      result=myNodeReferentSetEventHandlersMap.get(conceptFqName + "#" + referentRole);
      if (result != null) {
        break;
      }
    }
    myNodeReferentSetEventHandlersMap.put(originalKey,result);
    return result;
  }
}
