{
  Map<MPSVCSManager,List<VirtualFile>> vcsManagerToFile=new HashMap<MPSVCSManager,List<VirtualFile>>();
  for (  VirtualFile file : files) {
    Project projectForFile=getProjectForFile(file);
    if (projectForFile != null) {
      MPSVCSManager mpsVcsManager=MPSVCSManager.getInstance(projectForFile);
      if (mpsVcsManager != null) {
        List<VirtualFile> filesForManager=vcsManagerToFile.get(mpsVcsManager);
        if (filesForManager == null) {
          filesForManager=new LinkedList<VirtualFile>();
          vcsManagerToFile.put(mpsVcsManager,filesForManager);
        }
        filesForManager.add(file);
      }
 else {
        LOG.debug("Can not find " + MPSVCSManager.class.getName() + " instance for file "+ file+ ".");
      }
    }
 else {
      LOG.debug("Can not find " + Project.class.getName() + " instance for file "+ file+ ".");
    }
  }
  for (  MPSVCSManager manager : vcsManagerToFile.keySet()) {
    manager.addVirtualFilesToVcs(vcsManagerToFile.get(manager),recursive,true);
  }
}
