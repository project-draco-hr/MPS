{
  Map<Project,List<VirtualFile>> toMerge=new HashMap<Project,List<VirtualFile>>();
  Map<VirtualFile,SModelDescriptor> fileToModel=new HashMap<VirtualFile,SModelDescriptor>();
  for (  SModelDescriptor modelDescriptor : models) {
    IFile ifile=modelDescriptor.getModelFile();
    if (isInConflict(ifile,true)) {
      VirtualFile vfile=VFileSystem.getFile(ifile);
      Project project=getProjectForFile(vfile);
      List<VirtualFile> files=toMerge.get(project);
      if (files == null) {
        files=new LinkedList<VirtualFile>();
        toMerge.put(project,files);
      }
      files.add(vfile);
      fileToModel.put(vfile,modelDescriptor);
    }
  }
  final List<SModelDescriptor> merged=new LinkedList<SModelDescriptor>();
  for (  Project project : toMerge.keySet()) {
    List<VirtualFile> virtualFileList=AbstractVcsHelper.getInstance(project).showMergeDialog(toMerge.get(project));
    for (    VirtualFile vfile : virtualFileList) {
      SModelDescriptor model=fileToModel.get(vfile);
      if (model != null) {
        merged.add(model);
      }
    }
  }
  return merged;
}
