{
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      final ListPopup popup;
      popup=JBPopupFactory.getInstance().createListPopup(new BaseListPopupStep<SNode>("Choose concept",getAvailableConceptArray()){
        public Icon getIconFor(        final SNode concept){
          final Icon[] result=new Icon[1];
          ModelAccess.instance().runReadAction(new Runnable(){
            public void run(){
              String name=NameUtil.longNameFromNamespaceAndShortName(concept.getModel().getSModelFqName().getLongName(),concept.getName());
              result[0]=IconManager.getIconForConceptFQName(name);
            }
          }
);
          return result[0];
        }
        @NotNull public String getTextFor(        final SNode concept){
          final String[] result=new String[]{null};
          ModelAccess.instance().runReadAction(new Runnable(){
            public void run(){
              result[0]=concept.getName();
            }
          }
);
          return result[0];
        }
        public PopupStep onChosen(        SNode selectedValue,        boolean finalChoice){
          if (myInnerTabbedPane == null) {
            ModelAccess.instance().runReadAction(new Runnable(){
              public void run(){
                tryToInitComponent();
              }
            }
);
          }
          createNewInnerTab(selectedValue);
          return FINAL_CHOICE;
        }
      }
);
      popup.show(relativePoint);
    }
  }
);
}
