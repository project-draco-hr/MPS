{
  myInvocationCount++;
  myTransientModelsCount=0;
  SModel sourceModel=sourceModelDescriptor.getSModel();
  addProgressMessage(MessageKind.INFORMATION,"generating model \"" + sourceModel.getUID() + "\"");
  GenerationSessionContext context=new GenerationSessionContext(targetLanguage,sourceModel,myInvocationContext,mappings,generationStepController,myCurrentContext);
  if (generationStepController != null) {
    if (!checkGenerationStep(generationStepController)) {
      throw new GenerationCanceledException();
    }
    if (generationStepController.getCurrentMappings().isEmpty()) {
      addProgressMessage(MessageKind.WARNING,"skip model \"" + sourceModel.getUID() + "\" : no generator avalable");
      return new GenerationStatus(sourceModel,null,null,false,false,false);
    }
    printGenerationStepData(generationStepController,sourceModel);
  }
 else {
    List<Generator> generators=context.getGeneratorModules();
    if (generators.isEmpty()) {
      addProgressMessage(MessageKind.WARNING,"skip model \"" + sourceModel.getUID() + "\" : no generator avalable");
      return new GenerationStatus(sourceModel,null,null,false,false,false);
    }
  }
  setGenerationSessionContext(context);
  ITemplateGenerator generator=myUseNewGeneratorEngine ? new TemplateModelGenerator_New(context,myProgressMonitor,myHandler) : new DefaultTemplateGenerator(context,myProgressMonitor,myHandler);
  GenerationStatus status;
  try {
    SModel outputModel=generateModel(sourceModel,generator);
    boolean wasErrors=generator.getErrorCount() > 0;
    boolean wasWarnigns=generator.getWarningCount() > 0;
    status=new GenerationStatus(sourceModel,outputModel,context.getTraceMap(),wasErrors,wasWarnigns,false);
    addMessage(status.isError() ? MessageKind.WARNING : MessageKind.INFORMATION,"model \"" + sourceModel.getUID() + "\" has been generated "+ (status.isError() ? "with errors" : "successfully"));
    generator.clearErrorsAndWarnings();
    generator.reset();
  }
 catch (  GenerationCanceledException gce) {
    throw gce;
  }
catch (  GenerationFailedException gfe) {
    LOG.error(gfe);
    myProgressMonitor.addText(gfe.toString());
    GenerationFailueInfo failueInfo=gfe.getFailueInfo();
    if (failueInfo != null) {
      for (      Message message : failueInfo.createMessages()) {
        addMessage(message);
      }
    }
    addMessage(MessageKind.ERROR,"model \"" + sourceModel.getUID() + "\" generation failed : "+ gfe);
    status=new GenerationStatus.ERROR(sourceModel);
  }
catch (  Exception e) {
    LOG.error(e);
    e.printStackTrace();
    myProgressMonitor.addText(e.toString());
    addMessage(MessageKind.ERROR,"model \"" + sourceModel.getUID() + "\" generation failed : "+ e);
    status=new GenerationStatus.ERROR(sourceModel);
  }
  return status;
}
