{
  IModule module=generationContext.getModule();
  SModelDescriptor currentInputModel=inputModel.getModelDescriptor();
  SModelDescriptor currentOutputModel=createTransientModel(inputModel,module);
  boolean somethingHasBeenGenerated=generator.doPrimaryMapping(currentInputModel.getSModel(),currentOutputModel.getSModel());
  if (!somethingHasBeenGenerated) {
    SModel model=currentOutputModel.getSModel();
    model.validateLanguagesAndImports();
    return model;
  }
  int secondaryMappingRepeatCount=1;
  while (true) {
    currentOutputModel.getSModel().validateLanguagesAndImports();
    addMessage(MessageKind.INFORMATION,"generating model \"" + currentOutputModel.getModelUID() + "\"");
    generationContext.replaceInputModel(currentOutputModel);
    SModelDescriptor transientModel=createTransientModel(currentInputModel.getSModel(),module);
    if (myDiscardTransients && currentInputModel.isTransient() && !myCurrentContext.isTransientModelToKeep(currentInputModel.getSModel())) {
      addMessage(MessageKind.INFORMATION,"remove model (1) \"" + currentInputModel.getModelUID() + "\"");
      SModelRepository.getInstance().removeModelDescriptor(currentInputModel);
    }
    currentInputModel=currentOutputModel;
    if (!generator.doSecondaryMapping(currentInputModel.getSModel(),transientModel.getSModel())) {
      addMessage(MessageKind.INFORMATION,"remove model (2) \"" + transientModel.getModelUID() + "\"");
      SModelRepository.getInstance().removeModelDescriptor(transientModel);
      myTransientModelsCount--;
      break;
    }
    if (++secondaryMappingRepeatCount > 10) {
      generator.showErrorMessage(null,"Failed to generate output after 10 repeated mappings");
      throw new GenerationFailedException("Failed to generate output after 10 repeated mappings");
    }
    currentOutputModel=transientModel;
  }
  return currentOutputModel.getSModel();
}
