{
  GenerationSessionContext generationContext=generator.getGeneratorSessionContext();
  if (generationContext.getGenerationStepData() == null) {
    return generateModel(inputModel,targetLanguage,generator,generationContext);
  }
  SModel outputModel=null;
  while (true) {
    outputModel=generateModel(inputModel,targetLanguage,generator,generationContext);
    inputModel=outputModel;
    GenerationStepData generationStepData=generationContext.getGenerationStepData();
    if (!generationStepData.update(inputModel)) {
      break;
    }
    if (!checkGenerationStepData(generationStepData)) {
      throw new GenerationCanceledException();
    }
    if (generationStepData.getMappings().isEmpty()) {
      break;
    }
    printGenerationStepData(generationStepData,inputModel);
    generationContext.replaceInputModel(inputModel.getModelDescriptor());
    generationContext.replaceGenerationStepData(generationStepData);
  }
  return outputModel;
}
