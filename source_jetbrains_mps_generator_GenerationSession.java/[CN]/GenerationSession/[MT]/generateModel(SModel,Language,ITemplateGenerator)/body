{
  GenerationSessionContext generationContext=generator.getGeneratorSessionContext();
  if (generationContext.getGenerationStepController() == null) {
    return generateModel(inputModel,targetLanguage,generator,generationContext);
  }
  GenerationStepController generationStepController=generationContext.getGenerationStepController();
  if (!checkGenerationStep(generationStepController)) {
    throw new GenerationCanceledException();
  }
  SModel outputModel=null;
  while (true) {
    outputModel=generateModel(inputModel,targetLanguage,generator,generationContext);
    inputModel=outputModel;
    if (!generationStepController.advanceStep()) {
      break;
    }
    if (generationStepController.getCurrentMappings().isEmpty()) {
      break;
    }
    printGenerationStepData(generationStepController,inputModel);
    generationContext.replaceInputModel(inputModel.getModelDescriptor());
    generationContext.updateGenerationStepData(generationStepController);
  }
  return outputModel;
}
