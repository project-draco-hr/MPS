{
  GenerationSessionContext generationContext=generator.getGeneratorSessionContext();
  if (generationContext.getGenerationStepController() == null) {
    return generateModel(inputModel,targetLanguage,generator,generationContext);
  }
  SModel outputModel=null;
  while (true) {
    outputModel=generateModel(inputModel,targetLanguage,generator,generationContext);
    inputModel=outputModel;
    GenerationStepController generationStepController=generationContext.getGenerationStepController();
    if (!generationStepController.update(inputModel)) {
      break;
    }
    if (!checkGenerationStep(generationStepController)) {
      throw new GenerationCanceledException();
    }
    if (generationStepController.getMappings().isEmpty()) {
      break;
    }
    printGenerationStepData(generationStepController,inputModel);
    generationContext.replaceInputModel(inputModel.getModelDescriptor());
    generationContext.updateGenerationStepData(generationStepController);
  }
  return outputModel;
}
