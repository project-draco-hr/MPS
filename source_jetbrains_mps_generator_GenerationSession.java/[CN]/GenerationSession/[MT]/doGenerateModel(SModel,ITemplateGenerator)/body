{
  GeneratorSessionContext generatorContext=generator.getGeneratorSessionContext();
  SModelDescriptor currentOutputModel=createTransientModel(0,inputModel,generatorContext.getModule());
  if (!generator.doPrimaryMapping(inputModel,currentOutputModel.getSModel())) {
    SModel model=currentOutputModel.getSModel();
    model.validateLanguagesAndImports();
    return model;
  }
  SModelDescriptor transientModel;
  int repeatCount=1;
  while (true) {
    SModelDescriptor currentInputModel=currentOutputModel;
    transientModel=createTransientModel(repeatCount,inputModel,generatorContext.getModule());
    currentInputModel.getSModel().validateLanguagesAndImports();
    List<String> languageNamespaces=currentInputModel.getSModel().getLanguageNamespaces();
    if (languageNamespaces.size() == 1 && languageNamespaces.get(0).equals(myTargetLanguage.getNamespace())) {
      break;
    }
    myGeneratorSessionContext.replaceInputModel(currentInputModel);
    if (!generator.doSecondaryMapping(currentInputModel.getSModel(),transientModel.getSModel(),repeatCount)) {
      break;
    }
    currentOutputModel=transientModel;
    if (++repeatCount > 10) {
      generator.showErrorMessage(null,"Failed to generate output after 10 repeated mappings");
      throw new GenerationFailedException("Failed to generate output after 10 repeated mappings");
    }
  }
  SModelRepository.getInstance().unRegisterModelDescriptor(transientModel,generatorContext.getModule());
  return currentOutputModel.getSModel();
}
