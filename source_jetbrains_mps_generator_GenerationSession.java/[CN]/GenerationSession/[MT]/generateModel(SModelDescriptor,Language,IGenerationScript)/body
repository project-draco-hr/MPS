{
  GenerationStatus status;
  Statistics.clear();
  status=script.doGenerate(new IGenerationScriptContext(){
    public GenerationStatus doGenerate(    @NotNull SModelDescriptor inputModel,    Language targetLanguage,    Set<MappingConfiguration> confs) throws Exception {
      if (targetLanguage != null) {
        return generateModel_internal(inputModel,targetLanguage,confs,null);
      }
      GenerationStepController generationStepController=new GenerationStepController(inputModel.getSModel());
      GenerationStatus status;
      boolean hasWarnings=false;
      int stepCount=1;
      while (true) {
        addMessage(new Message(MessageKind.INFORMATION,"execute step " + (stepCount++)));
        status=generateModel_internal(inputModel,targetLanguage,confs,generationStepController);
        hasWarnings|=status.hasWarnings();
        if (status.isCanceled() || status.isError()) {
          break;
        }
        if (!generationStepController.advanceStep()) {
          break;
        }
        if (generationStepController.getCurrentMappings().isEmpty()) {
          break;
        }
        inputModel=status.getOutputModel().getModelDescriptor();
      }
      return new GenerationStatus(status.getSourceModel(),status.getOutputModel(),status.getTraceMap(),status.isError(),hasWarnings,status.isCanceled());
    }
    public SModelDescriptor getSourceModelDescriptor(){
      return inputModel;
    }
    public Language getTargetLanguage(){
      return targetLanguage;
    }
    public IOperationContext getOperationContext(){
      return myInvocationContext;
    }
    public IMessageHandler getHandler(){
      return myHandler;
    }
  }
);
  if (status.isError() || status.hasWarnings()) {
    myDiscardTransients=false;
  }
  return status;
}
