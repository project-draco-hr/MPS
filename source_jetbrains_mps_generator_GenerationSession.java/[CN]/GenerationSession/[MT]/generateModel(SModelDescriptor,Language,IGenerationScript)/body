{
  Statistics.clearAll();
  GenerationStatus status=script.doGenerate(new IGenerationScriptContext(){
    public GenerationStatus doGenerate(    @NotNull SModelDescriptor inputModel,    Language targetLanguage,    Set<MappingConfiguration> confs) throws Exception {
      if (targetLanguage != null) {
        return generateModel_internal(inputModel,targetLanguage,confs,null);
      }
      GenerationStepController generationStepController=new GenerationStepController(inputModel.getSModel());
      GenerationStatus status;
      boolean wasErrors=false;
      boolean wasWarnings=false;
      int stepCount=1;
      while (true) {
        addMessage(new Message(MessageKind.INFORMATION,"execute step " + (stepCount++)));
        status=generateModel_internal(inputModel,targetLanguage,confs,generationStepController);
        wasErrors|=status.isError();
        wasWarnings|=status.hasWarnings();
        if (status.isCanceled()) {
          break;
        }
        if (!generationStepController.advanceStep()) {
          break;
        }
        if (generationStepController.getCurrentMappings().isEmpty()) {
          break;
        }
        if (status.getOutputModel() == null) {
          System.err.println("Oy vey");
          break;
        }
        inputModel=status.getOutputModel().getModelDescriptor();
      }
      return new GenerationStatus(status.getSourceModel(),status.getOutputModel(),status.getTraceMap(),wasErrors,wasWarnings,status.isCanceled());
    }
    public SModelDescriptor getSourceModelDescriptor(){
      return inputModel;
    }
    public Language getTargetLanguage(){
      return targetLanguage;
    }
    public IOperationContext getOperationContext(){
      return myInvocationContext;
    }
    public IMessageHandler getHandler(){
      return myMessagesHandler;
    }
  }
);
  return status;
}
