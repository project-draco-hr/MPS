{
  SelectionManager selectionManager=context.getNodeEditorComponent().getSelectionManager();
  Selection selection=selectionManager.getSelection();
  if (selection instanceof SingularSelection) {
    SNode selectedNode=((SingularSelection)selection).getEditorCell().getSNode();
    SNode topMostNodeInSingularContainment=findTopMostNodeWithSingularContainment(selectedNode);
    if (topMostNodeInSingularContainment != selectedNode) {
      EditorCell nodeCell=context.getNodeEditorComponent().findNodeCell(topMostNodeInSingularContainment);
      if (nodeCell != null) {
        context.getNodeEditorComponent().pushSelection(nodeCell);
      }
    }
 else {
      selectionManager.pushSelection(selectionManager.createRangeSelection(selectedNode,selectedNode));
    }
  }
 else   if (selection instanceof jetbrains.mps.nodeEditor.selection.NodeRangeSelection) {
    Selection newSelection=((jetbrains.mps.nodeEditor.selection.NodeRangeSelection)selection).enlargeSelection(myUp);
    if (newSelection != null) {
      selectionManager.pushSelection(newSelection);
    }
  }
}
