{
  SelectionManager selectionManager=context.getNodeEditorComponent().getSelectionManager();
  Selection selection=selectionManager.getSelection();
  if (selection instanceof SingularSelection) {
    EditorCell selectedCell=((SingularSelection)selection).getEditorCell();
    SNode selectedNode=selectedCell.getSNode();
    SNode topMostNodeInSingularContainment=findTopMostNodeWithSingularContainment(selectedNode);
    if (topMostNodeInSingularContainment != selectedNode) {
      EditorCell nodeCell=context.getNodeEditorComponent().findNodeCell(topMostNodeInSingularContainment);
      if (nodeCell != null) {
        context.getNodeEditorComponent().pushSelection(nodeCell);
      }
    }
 else {
      Selection newSelection=selectionManager.createRangeSelection(selectedNode,selectedNode);
      if (newSelection instanceof NodeRangeSelection && selectedCell.isBigCell()) {
        newSelection=((jetbrains.mps.nodeEditor.selection.NodeRangeSelection)newSelection).enlargeSelection(myUp);
      }
      if (newSelection != null) {
        selectionManager.pushSelection(newSelection);
      }
    }
  }
 else   if (selection instanceof jetbrains.mps.nodeEditor.selection.NodeRangeSelection) {
    Selection newSelection=((jetbrains.mps.nodeEditor.selection.NodeRangeSelection)selection).enlargeSelection(myUp);
    if (newSelection != null) {
      selectionManager.pushSelection(newSelection);
    }
  }
}
