{
  IFile result=null;
  Set<String> macroNames=PathMacros.getInstance().getAllMacroNames();
  for (  String macro : macroNames) {
    String prefix="${" + macro + "}";
    if (path.startsWith(prefix)) {
      String relativePath=removePrefix(path,prefix);
      result=FileSystem.getFile(PathMacros.getInstance().getValue(macro)).child(relativePath);
      break;
    }
  }
  if (result != null)   return result.getCanonicalPath();
  result=tryToExpandWith(path,MPS_HOME,PathManager.getHomePath());
  if (result != null)   return result.getCanonicalPath();
  String samplesPath=WorkbenchPathManager.getSamplesPath();
  if (samplesPath != null) {
    result=tryToExpandWith(path,SAMPLES_HOME,samplesPath);
    if (result != null)     return result.getCanonicalPath();
  }
  if (!path.startsWith("${")) {
    result=FileSystem.getFile(path);
    return result.getCanonicalPath();
  }
  int end=path.indexOf("}");
  if (end != -1) {
    LOG.error("Wasn't able to expand path " + path);
    LOG.error("Please define path variable " + path.substring(2,end) + " in path variables section of settings");
  }
  return path;
}
