{
  IFile result=null;
  Set<String> macroNames=PathMacros.getInstance().getAllMacroNames();
  for (  String macro : macroNames) {
    String prefix="${" + macro + "}";
    if (path.startsWith(prefix)) {
      String relativePath=removePrefix(path,prefix);
      result=FileSystem.getInstance().getFileByPath(PathMacros.getInstance().getValue(macro)).getDescendant(relativePath);
      break;
    }
  }
  if (result != null)   return IFileUtils.getCanonicalPath(result);
  if (path.startsWith(MPS_HOME)) {
    String relativePath=removePrefix(path,MPS_HOME);
    result=FileSystem.getInstance().getFileByPath(PathManager.getHomePath()).getDescendant(relativePath);
  }
  if (result != null)   return IFileUtils.getCanonicalPath(result);
  if (!path.startsWith("${")) {
    result=FileSystem.getInstance().getFileByPath(path);
    return IFileUtils.getCanonicalPath(result);
  }
  int end=path.indexOf("}");
  if (end != -1) {
    LOG.error("Wasn't able to expand path " + path);
    LOG.error("Please define path variable " + path.substring(2,end) + " in path variables section of settings");
  }
  return path;
}
