{
  Version version=myProject.getComponent(MPSProjectVersion.class).getVersion();
  if (myProject instanceof ProjectEx && !((version.isMajorUpdate(MPSProjectVersion.CURRENT))) && ProjectKt.isDirectoryBased(myProject)&& myState.offerStorageMigration) {
    StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
      @Override public void run(){
        SaveAsDirectoryBasedFormatAction action=new SaveAsDirectoryBasedFormatAction();
        final AnActionEvent actionEvent=AnActionEvent.createFromDataContext("",null,new DataContext(){
          @Nullable @Override public Object getData(          String dataId){
            return (CommonDataKeys.PROJECT.getName().equals(dataId) ? myProject : null);
          }
        }
);
        action.update(actionEvent);
        action.actionPerformed(actionEvent);
      }
    }
);
  }
}
