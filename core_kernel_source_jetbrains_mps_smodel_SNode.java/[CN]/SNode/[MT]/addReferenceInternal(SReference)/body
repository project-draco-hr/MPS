{
  ModelChange.assertLegalNodeChange(getModel(),this);
  int oldLen=myReferences.length;
  jetbrains.mps.smodel.SReference[] newArray=new jetbrains.mps.smodel.SReference[oldLen + 1];
  System.arraycopy(myReferences,0,newArray,0,oldLen);
  newArray[oldLen]=reference;
  myReferences=newArray;
  if (myModel == null)   return;
  myModel.performUndoableAction(new Computable<SNodeUndoableAction>(){
    @Override public SNodeUndoableAction compute(){
      return new InsertReferenceAtUndoableAction(SNode.this,reference);
    }
  }
);
  if (ModelChange.needFireEvents(getModel(),this)) {
    myModel.fireReferenceAddedEvent(reference);
  }
}
