{
  ModelChange.assertLegalNodeChange(myModel,this);
  int oldLen=myReferences.length;
  jetbrains.mps.smodel.SReference[] newArray=new jetbrains.mps.smodel.SReference[oldLen + 1];
  System.arraycopy(myReferences,0,newArray,0,oldLen);
  newArray[oldLen]=((jetbrains.mps.smodel.SReference)reference);
  myReferences=newArray;
  SModel model=getModel();
  if (model == null)   return;
  model.performUndoableAction(new Computable<SNodeUndoableAction>(){
    public SNodeUndoableAction compute(){
      return new InsertReferenceAtUndoableAction(SNode.this,reference);
    }
  }
);
  if (ModelChange.needFireEvents(model,this)) {
    model.fireReferenceAddedEvent(reference);
  }
}
