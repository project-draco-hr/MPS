{
  ModelChange.assertLegalNodeChange(myModel,this);
  int index=-1;
  for (int i=0; i < myReferences.length; i++) {
    if (myReferences[i].equals(ref)) {
      index=i;
      break;
    }
  }
  if (index == -1) {
    LOG.error("ref not found " + ref,new Throwable());
    return;
  }
  jetbrains.mps.smodel.SReference[] newArray=new jetbrains.mps.smodel.SReference[myReferences.length - 1];
  System.arraycopy(myReferences,0,newArray,0,index);
  System.arraycopy(myReferences,index + 1,newArray,index,myReferences.length - index - 1);
  myReferences=newArray;
  SModel model=getModel();
  if (model == null)   return;
  model.performUndoableAction(new RemoveReferenceAtUndoableAction(this,ref));
  if (ModelChange.needFireEvents(model,this)) {
    model.fireReferenceRemovedEvent(ref);
  }
}
