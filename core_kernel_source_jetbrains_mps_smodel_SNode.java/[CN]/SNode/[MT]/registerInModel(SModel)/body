{
  if (model != myModel) {
    if (myModel != null) {
      LOG.errorWithTrace("couldn't register node which is already registered in '" + myModel.getSModelReference() + "'");
      return;
    }
  }
  model.registerNode(this);
  myModel=model;
  for (  SReference ref : myReferences) {
    ((jetbrains.mps.smodel.SReference)ref).makeIndirect();
  }
  for (SNode child=first; child != null; child=child.next) {
    child.registerInModel(model);
  }
}
