{
  Statistics.clearAll();
  if (!checkGenerationStep(stepController)) {
    throw new GenerationCanceledException();
  }
  myCurrentSourceModel=inputModel;
  try {
    GenerationStatus status;
    boolean wasErrors=false;
    boolean wasWarnings=false;
    int stepCount=1;
    SModelDescriptor currInputModel=inputModel;
    while (true) {
      addMessage(new Message(MessageKind.INFORMATION,"execute step " + (stepCount++)));
      status=generateModel_step(currInputModel.getSModel(),stepController);
      wasErrors|=status.isError();
      wasWarnings|=status.hasWarnings();
      if (status.isCanceled()) {
        break;
      }
      if (!stepController.advanceStep()) {
        break;
      }
      if (stepController.getCurrentMappings().isEmpty()) {
        break;
      }
      if (status.getOutputModel() == null) {
        break;
      }
      currInputModel=status.getOutputModel().getModelDescriptor();
    }
    return new GenerationStatus(status.getInputModel(),status.getOutputModel(),status.getTraceMap(),wasErrors,wasWarnings,status.isCanceled());
  }
  finally {
    myCurrentSourceModel=null;
  }
}
