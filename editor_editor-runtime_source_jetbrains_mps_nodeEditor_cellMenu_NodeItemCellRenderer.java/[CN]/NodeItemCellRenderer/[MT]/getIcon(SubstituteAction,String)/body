{
  Icon icon=null;
  SNode iconNode=action.getIconNode(pattern);
  if (iconNode != null) {
    boolean isConcept=SNodeUtil.isInstanceOfConceptDeclaration(iconNode) && !(action.isReferentPresentation());
    boolean isCached=false;
    if (isConcept && myConceptIconMap.containsKey(iconNode)) {
      isCached=true;
      icon=myConceptIconMap.get(iconNode);
    }
 else     if (!isConcept && myNodeIconMap.containsKey(iconNode)) {
      isCached=true;
      icon=myNodeIconMap.get(iconNode);
    }
    if (!isCached) {
      icon=isConcept ? IconManager.getIconForConceptFQName(NameUtil.nodeFQName(iconNode)) : IconManager.getIconFor(iconNode);
      if (isConcept) {
        myConceptIconMap.put(iconNode,icon);
      }
 else {
        myNodeIconMap.put(iconNode,icon);
      }
    }
  }
 else {
    icon=IdeIcons.DEFAULT_ICON;
  }
  return icon;
}
