{
  final TestModelFactory m1f=new TestModelFactory();
  m1f.createModel(3,3);
  final int initialNodeCount=m1f.countModelNodes();
  myModelAccess.enableWrite();
  m1f.attachTo(myRepo);
  SNode r1c1=m1f.getRoot(1).getFirstChild();
  SNode r2c2=m1f.getRoot(2).getFirstChild().getNextSibling();
  SNode r3c3=m1f.getRoot(3).getLastChild();
  r1c1.delete();
  myUndo.flushCommand(null);
  r2c2.delete();
  myUndo.flushCommand(null);
  r3c3.delete();
  myUndo.flushCommand(null);
  Assert.assertEquals(3,myUndo.actualStackSize());
  Assert.assertEquals(initialNodeCount - 3,m1f.countModelNodes());
  myUndo.myUndoStack.pop().undo();
  myUndo.myUndoStack.pop().undo();
  myUndo.myUndoStack.pop().undo();
  myErrors.checkThat(m1f.getRoot(1).getFirstChild(),equalTo(r1c1));
  myErrors.checkThat(m1f.getRoot(2).getFirstChild().getNextSibling(),equalTo(r2c2));
  myErrors.checkThat(m1f.getRoot(3).getLastChild(),equalTo(r3c3));
  Assert.assertEquals(initialNodeCount,m1f.countModelNodes());
}
