{
  SModel m1=new TestModelFactory().createModel(1,1,1);
  myModelAccess.enableWrite();
  ((SModelBase)m1).attach(myRepo);
  SNode r1=m1.getRootNodes().iterator().next();
  SNode r1c1=r1.getFirstChild();
  r1.removeChild(r1c1);
  final SNode c=r1c1.getFirstChild();
  r1c1.removeChild(c);
  myUndo.flushCommand(null);
  Assert.assertEquals(1,countTreeNodes(m1.getRootNodes()));
  final UndoUnit undoElement=myUndo.myUndoStack.peek();
  undoElement.undo();
  Assert.assertEquals(3,countTreeNodes(m1.getRootNodes()));
  undoElement.redo();
  Assert.assertEquals(1,countTreeNodes(m1.getRootNodes()));
}
