{
  final TestModelFactory m1f=new TestModelFactory();
  m1f.createModel(1,1,1);
  myModelAccess.enableWrite();
  m1f.attachTo(myRepo);
  SNode r1=m1f.getRoot(1);
  SNode r1c1=r1.getFirstChild();
  r1.removeChild(r1c1);
  final SNode c=r1c1.getFirstChild();
  r1c1.removeChild(c);
  myUndo.flushCommand(null);
  Assert.assertEquals(1,m1f.countModelNodes());
  final UndoUnit undoElement=myUndo.myUndoStack.peek();
  undoElement.undo();
  Assert.assertEquals(3,m1f.countModelNodes());
  undoElement.redo();
  Assert.assertEquals(1,m1f.countModelNodes());
}
