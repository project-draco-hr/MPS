{
  Set<SModelDescriptor> result=new HashSet<SModelDescriptor>();
  for (  SNode concept : nodes) {
    Set<VirtualFile> candidates=new HashSet<VirtualFile>();
    final Set<VirtualFile> scopeFiles=getScopeFiles(models);
    if (concept != null)     candidates.addAll(getCandidates(scopeFiles,concept.getName()));
    if (!isExact) {
      Set<String> fqNames=LanguageHierarchyCache.getInstance().getAllDescendantsOfConcept(NameUtil.nodeFQName(concept));
      for (      String fqName : fqNames) {
        candidates.addAll(getCandidates(scopeFiles,fqName.substring(fqName.lastIndexOf('.') + 1)));
      }
    }
    for (    VirtualFile file : candidates) {
      SModelDescriptor sm=SModelRepository.getInstance().findModel(VirtualFileUtils.toIFile(file));
      if (sm == null)       continue;
      result.add(sm);
    }
  }
  return result;
}
