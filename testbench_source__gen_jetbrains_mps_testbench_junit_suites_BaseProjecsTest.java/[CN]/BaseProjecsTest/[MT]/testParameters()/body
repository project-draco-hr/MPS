{
  EnvironmentConfig defaultConfig=EnvironmentConfig.defaultConfig();
  defaultConfig.addPlugin("migrationAssistant","jetbrains.mps.ide.migration.assistant");
  ourEnv=IdeaEnvironment.getOrCreate(defaultConfig);
  ArrayList<Object[]> res=new ArrayList<Object[]>();
  String projectsDir=System.getProperty("projects_dir");
  VirtualFile projectsRoot=LocalFileSystem.getInstance().findFileByPath(projectsDir);
  final List<Object[]> projects=new ArrayList<Object[]>();
  VfsUtil.processFilesRecursively(projectsRoot,new Processor<VirtualFile>(){
    public boolean process(    VirtualFile file){
      if (!(file.isValid()) || !(file.isDirectory())) {
        return true;
      }
      if (!(file.getName().toLowerCase().endsWith(MPSExtentions.DOT_MPS_PROJECT))) {
        return true;
      }
      projects.add(new String[]{file.getPath()});
      return true;
    }
  }
);
  return projects;
}
