{
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      ModelAccess.instance().runWriteAction(new Runnable(){
        public void run(){
          for (          SModelEvent e : events) {
            if (e.getAffectedRoot() != null) {
              updateModificationStamp(e.getAffectedRoot());
            }
            e.accept(new SModelEventVisitorAdapter(){
              public void visitRootEvent(              SModelRootEvent event){
                if (event.isRemoved()) {
                  VirtualFile vf=myVirtualFiles.get(event.getRoot());
                  if (vf != null) {
                    fireBeforeFileDeletion(this,vf);
                    fireFileDeleted(this,vf,vf.getName(),null);
                    myVirtualFiles.remove(event.getRoot());
                  }
                }
              }
              public void visitPropertyEvent(              SModelPropertyEvent event){
                VirtualFile vf=myVirtualFiles.get(event.getNode());
                if (event.getNode().isRoot() && vf != null) {
                  fireBeforePropertyChange(this,vf,VirtualFile.PROP_NAME,event.getOldPropertyValue(),event.getNewPropertyValue());
                  ((MPSNodeVirtualFile)vf).updateFields();
                  firePropertyChanged(this,vf,VirtualFile.PROP_NAME,event.getOldPropertyValue(),event.getNewPropertyValue());
                }
              }
            }
);
          }
        }
      }
);
    }
  }
);
}
