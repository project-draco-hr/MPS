{
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      ModelAccess.instance().runWriteActionInCommand(new Runnable(){
        public void run(){
          for (          SModelEvent e : events) {
            e.accept(new SModelEventVisitorAdapter(){
              public void visitRootEvent(              SModelRootEvent event){
                if (event.isRemoved()) {
                  VirtualFile vf=myVirtualFiles.get(new SNodePointer(event.getRoot()));
                  if (vf != null) {
                    fireBeforeFileDeletion(this,vf);
                    fireFileDeleted(this,vf,vf.getName(),null);
                    myVirtualFiles.remove(new SNodePointer(event.getRoot()));
                  }
                }
              }
              public void visitPropertyEvent(              SModelPropertyEvent event){
                if (event.getNode().isDisposed()) {
                  return;
                }
                VirtualFile vf=myVirtualFiles.get(new SNodePointer(event.getNode()));
                if (event.getNode().isRoot() && vf != null) {
                  fireBeforePropertyChange(this,vf,VirtualFile.PROP_NAME,event.getOldPropertyValue(),event.getNewPropertyValue());
                  ((MPSNodeVirtualFile)vf).updateFields();
                  firePropertyChanged(this,vf,VirtualFile.PROP_NAME,event.getOldPropertyValue(),event.getNewPropertyValue());
                }
              }
            }
);
          }
        }
      }
);
    }
  }
);
}
