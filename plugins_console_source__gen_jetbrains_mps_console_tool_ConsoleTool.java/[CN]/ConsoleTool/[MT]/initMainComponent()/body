{
  jetbrains.mps.project.Project project=ProjectHelper.toMPSProject(getProject());
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      if (myModel == null) {
        if (LOG.isEnabledFor(Priority.ERROR)) {
          LOG.error("Error on loading history: model does not exist");
        }
        return;
      }
      loadHistory();
      ConsoleTool.this.myEditor=new UIEditorComponent(ProjectHelper.toMPSProject(getProject()).getRepository(),null){
        @Nullable @Override public Object getData(        @NonNls String key){
          if (PlatformDataKeys.FILE_EDITOR.is(key)) {
            return myFileEditor;
          }
          if (PlatformDataKeys.PASTE_PROVIDER.is(key)) {
            return new ConsoleTool.MyPasteProvider((PasteProvider)super.getData(key));
          }
          return super.getData(key);
        }
        @Override public boolean isReadOnly(){
          final SNode selectedNode=getSelectedNode();
          final Wrappers._boolean editable=new Wrappers._boolean(false);
          ModelAccess.instance().runReadAction(new Runnable(){
            public void run(){
              if (selectedNode != null) {
                editable.value=SNodeOperations.getAncestor(selectedNode,"jetbrains.mps.console.base.structure.CommandHolder",true,false) == SLinkOperations.getTarget(myRoot,"commandHolder",true);
              }
 else {
                List<SNode> selectedNodes=getSelectedNodes();
                if (selectedNodes != null) {
                  editable.value=ListSequence.fromList(selectedNodes).all(new IWhereFilter<SNode>(){
                    public boolean accept(                    SNode it){
                      return SNodeOperations.getAncestor(it,"jetbrains.mps.console.base.structure.CommandHolder",false,false) == SLinkOperations.getTarget(myRoot,"commandHolder",true);
                    }
                  }
);
                }
              }
            }
          }
);
          return !(editable.value);
        }
      }
;
      myFileEditor=new ConsoleFileEditor(myEditor);
      addBuiltInImports();
      myEditor.editNode(myRoot);
    }
  }
);
  myMainComponent=new JPanel();
  myMainComponent.setLayout(new BorderLayout());
  myMainComponent.add(initToolbarComponent(project),BorderLayout.WEST);
  JPanel editorPanel=new JPanel(new BorderLayout());
  editorPanel.add(myEditor);
  JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(editorPanel);
  scrollPane.getVerticalScrollBar().setBlockIncrement(10);
  myMainComponent.add(scrollPane,BorderLayout.CENTER);
  myMainComponent.add(myEditor.getUpperPanel(),BorderLayout.NORTH);
  myHighlighter=check_xg3v07_a0n0y(getProject(),this);
  myHighlighter.addAdditionalEditorComponent(myEditor);
}
