{
  if (myTree.getSelectionPath() == null) {
    if (myChooseItemComponent.getSelectedItem() != null && myMayBeModel) {
      return myChooseItemComponent.getSelectedItem();
    }
    throw new InvalidInputValueException(myCaption + ": nothing is selected");
  }
  MPSTreeNode node=(MPSTreeNode)myTree.getSelectionPath().getLastPathComponent();
  if (node instanceof SNodeTreeNode) {
    if (!myMayBeNode) {
      throw new InvalidInputValueException(myCaption + ": selected value should not not be a node");
    }
    SNode sNode=((SNodeTreeNode)node).getSNode();
    if (myConceptFQName != null && !sNode.isInstanceOfConcept(myConceptFQName)) {
      throw new InvalidInputValueException(myCaption + ": selected node should be an istance of " + myConceptFQName);
    }
    return sNode;
  }
  if (node instanceof SModelTreeNode) {
    if (!myMayBeModel) {
      throw new InvalidInputValueException(myCaption + ": selected value should not not be a model");
    }
    SModelDescriptor modelDescriptor=((SModelTreeNode)node).getSModelDescriptor();
    if (myReturnLoadedModels) {
      return modelDescriptor.getSModel();
    }
 else {
      return modelDescriptor;
    }
  }
  throw new InvalidInputValueException(myCaption + ": nothing is selected");
}
