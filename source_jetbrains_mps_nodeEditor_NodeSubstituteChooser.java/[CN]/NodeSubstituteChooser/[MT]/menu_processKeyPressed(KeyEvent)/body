{
  String[] strings=getStrings();
  if (strings.length > 0) {
    if (keyEvent.getKeyCode() == KeyEvent.VK_UP) {
      getPopupWindow().setSelectionIndex(getPopupWindow().getSelectionIndex() - 1);
      repaintPopupMenu();
      if (!myMenuEmpty) {
        myPatternEditor.setText(getPopupWindow().getSelectedText());
        myPatternEditor.setCaretPosition(getPopupWindow().getSelectedText().length());
      }
      return true;
    }
    if (keyEvent.getKeyCode() == KeyEvent.VK_DOWN) {
      getPopupWindow().setSelectionIndex(getPopupWindow().getSelectionIndex() + 1);
      repaintPopupMenu();
      if (!myMenuEmpty) {
        myPatternEditor.setText(getPopupWindow().getSelectedText());
        myPatternEditor.setCaretPosition(getPopupWindow().getSelectedText().length());
      }
      return true;
    }
    if (keyEvent.getKeyCode() == KeyEvent.VK_PAGE_UP) {
      getPopupWindow().setSelectionIndex(getPopupWindow().getSelectionIndex() - MAX_MENU_LEN);
      repaintPopupMenu();
      if (!myMenuEmpty) {
        myPatternEditor.setText(getPopupWindow().getSelectedText());
        myPatternEditor.setCaretPosition(getPopupWindow().getSelectedText().length());
      }
      return true;
    }
    if (keyEvent.getKeyCode() == KeyEvent.VK_PAGE_DOWN) {
      getPopupWindow().setSelectionIndex(getPopupWindow().getSelectionIndex() + MAX_MENU_LEN);
      repaintPopupMenu();
      if (!myMenuEmpty) {
        myPatternEditor.setText(getPopupWindow().getSelectedText());
        myPatternEditor.setCaretPosition(getPopupWindow().getSelectedText().length());
      }
      return true;
    }
    if (keyEvent.getKeyCode() == KeyEvent.VK_HOME) {
      getPopupWindow().setSelectionIndex(0);
      repaintPopupMenu();
      if (!myMenuEmpty) {
        myPatternEditor.setText(getPopupWindow().getSelectedText());
        myPatternEditor.setCaretPosition(getPopupWindow().getSelectedText().length());
      }
      return true;
    }
    if (keyEvent.getKeyCode() == KeyEvent.VK_END) {
      getPopupWindow().setSelectionIndex(strings.length - 1);
      repaintPopupMenu();
      if (!myMenuEmpty) {
        myPatternEditor.setText(getPopupWindow().getSelectedText());
        myPatternEditor.setCaretPosition(getPopupWindow().getSelectedText().length());
      }
      return true;
    }
  }
  if (keyEvent.getKeyCode() == KeyEvent.VK_ENTER || (keyEvent.getKeyCode() == KeyEvent.VK_SPACE && keyEvent.isControlDown())) {
    if (!myMenuEmpty) {
      String pattern=getPatternEditor().getPattern();
      INodeSubstituteAction entry=myMenuSubstituteEntries.get(myPopupWindow.getSelectionIndex());
      setVisible(false);
      CommandUtil.substituteNode(entry,pattern,myNodeSubstituteInfo,myEditorComponent.getContext());
    }
    return true;
  }
  return false;
}
