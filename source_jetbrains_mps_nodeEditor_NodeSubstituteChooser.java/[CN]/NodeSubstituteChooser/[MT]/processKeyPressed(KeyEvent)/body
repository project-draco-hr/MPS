{
  if (getPatternEditor().processKeyPressed(keyEvent)) {
    if (isPopupActivated) {
      rebuildMenuEntries();
      getPopupWindow().relayout();
      repaintPopupMenu();
    }
    return true;
  }
  if (keyEvent.getKeyCode() == KeyEvent.VK_ESCAPE) {
    setVisible(false);
    return true;
  }
  if (isPopupActivated) {
    return menu_processKeyPressed(keyEvent);
  }
  if (keyEvent.getKeyCode() == KeyEvent.VK_ENTER || (keyEvent.getKeyCode() == KeyEvent.VK_SPACE && keyEvent.isControlDown())) {
    String pattern=getPatternEditor().getPattern();
    List<INodeSubstituteAction> matchingActions=myNodeSubstituteInfo.getMatchingActions(pattern);
    if (matchingActions.size() == 1) {
      setVisible(false);
      SemanticNode changedNode=matchingActions.get(0).doSubstitute(pattern);
      if (changedNode != null) {
        changedNode.getSemanticModel().fireNodeAddedEvent(changedNode);
      }
    }
    return true;
  }
  return false;
}
