{
  if (isChooserActivated != b) {
    if (b) {
      myEditorComponent.pushKeyboardHandler(this);
      getPatternEditor().activate(getEditorWindow(),myPatternEditorLocation,myPatternEditorSize);
      myNodeSubstituteInfo.invalidateActions();
      rebuildMenuEntries();
      getPopupWindow().setSelectionIndex(0);
      getPopupWindow().relayout();
      getPopupWindow().setVisible(true);
      isPopupActivated=true;
    }
 else {
      getPopupWindow().setVisible(false);
      getPatternEditor().done();
      isPopupActivated=false;
      myEditorComponent.popKeyboardHandler();
    }
  }
  isChooserActivated=b;
}
