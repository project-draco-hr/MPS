{
  IFile result=null;
  Set<String> macroNames=PathMacros.getInstance().getNames();
  for (  String macro : macroNames) {
    String prefix="${" + macro + "}";
    if (path.startsWith(prefix)) {
      String relativePath=removePrefix(path,prefix);
      String macroValue=PathMacros.getInstance().getValue(macro);
      result=macroValue == null ? null : FileSystem.getInstance().getFileByPath(macroValue).getDescendant(relativePath);
      break;
    }
  }
  if (result != null)   return IFileUtils.getCanonicalPath(result);
  if (path.startsWith(MPS_HOME)) {
    String relativePath=removePrefix(path,MPS_HOME);
    result=FileSystem.getInstance().getFileByPath(PathManager.getHomePath()).getDescendant(relativePath);
  }
  if (result != null)   return IFileUtils.getCanonicalPath(result);
  if (!path.startsWith("${")) {
    result=FileSystem.getInstance().getFileByPath(path);
    return IFileUtils.getCanonicalPath(result);
  }
  int end=path.indexOf("}");
  if (end != -1) {
    LOG.error("Wasn't able to expand path " + path);
    LOG.error("Please define path variable " + path.substring(2,end) + " in path variables section of settings");
  }
  return path;
}
