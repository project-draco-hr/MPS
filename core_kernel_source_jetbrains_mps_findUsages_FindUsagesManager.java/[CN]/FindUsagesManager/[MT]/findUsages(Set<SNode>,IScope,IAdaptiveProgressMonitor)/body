{
  LOG.assertInCommand();
  Set<SReference> result=new HashSet<SReference>();
  try {
    if (progress == null)     progress=IAdaptiveProgressMonitor.NULL_PROGRESS_MONITOR;
    List<SModelDescriptor> models=scope.getModelDescriptors();
    long estimatedTime=ModelsProgressUtil.estimateFindNodeUsagesTimeMillis(models);
    progress.startTaskAnyway(ModelsProgressUtil.TASK_KIND_FIND_NODE_USAGES,null,estimatedTime);
    progress.addText("Finding usages...");
    for (    SModelDescriptor model : new ArrayList<SModelDescriptor>(models)) {
      String taskName=ModelsProgressUtil.findNodeUsagesModelTaskName(model);
      progress.startLeafTask(taskName,ModelsProgressUtil.TASK_KIND_FIND_NODE_USAGES);
      result.addAll(model.findUsages(nodes));
      if (progress.isCanceled()) {
        progress.finishAnyway();
        return result;
      }
      progress.finishTask(taskName);
    }
    progress.finishTask(ModelsProgressUtil.TASK_KIND_FIND_NODE_USAGES);
    return result;
  }
  finally {
  }
}
