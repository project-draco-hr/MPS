{
  for (  SReference ref : current.getReferences()) {
    if (ref instanceof StaticReference) {
      SModelReference mr=ref.getTargetSModelReference();
      if (mr == null) {
        LOG.warning("StaticReference with null target smodel reference; model: " + current.getModel().getModelName() + "; root node: "+ current.getContainingRoot()+ "; node: "+ current);
        continue;
      }
      if (srefs.contains(new StaticReferenceInfo(SModelRepository.getInstance().getModelDescriptor(mr),ref.getTargetNodeId()))) {
        consumer.consume(ref);
      }
    }
 else {
      if (nodes.contains(ref.getTargetNode())) {
        consumer.consume(ref);
      }
    }
  }
  for (  SNode child : current.getChildren()) {
    collectUsages(child,nodes,srefs,consumer);
  }
}
