{
  if (!getPatternEditor().isActivated()) {
    return;
  }
  Point location=getPatternEditor().getLeftBottomPosition();
  Rectangle deviceBounds=WindowsUtil.findDeviceBoundsAt(location);
  Dimension preferredSize=getPreferredSize();
  if (getPosition() == PopupWindowPosition.BOTTOM && location.getY() + preferredSize.getHeight() > deviceBounds.height + deviceBounds.y - 150 && location.getY() - getPatternEditor().getHeight() / 2 > deviceBounds.y + deviceBounds.height / 2) {
    setPosition(PopupWindowPosition.TOP);
  }
  if (getPosition() == PopupWindowPosition.TOP && myList.getFixedCellHeight() != 0) {
    double maxHeight=location.getY() - getPatternEditor().getHeight() - deviceBounds.y;
    double visibleRowCount=maxHeight / myList.getFixedCellHeight();
    if (visibleRowCount < myList.getVisibleRowCount()) {
      if (visibleRowCount <= 1) {
        myList.setVisibleRowCount(1);
      }
 else {
        myList.setVisibleRowCount((int)visibleRowCount);
      }
      preferredSize=getPreferredSize();
    }
  }
  if (preferredSize.getWidth() >= deviceBounds.width) {
    setSize(deviceBounds.width,preferredSize.height);
  }
 else {
    setSize(preferredSize);
  }
  Point newLocation=getLocationWithRespectToScreenBounds(location,deviceBounds);
  setLocation(newLocation);
  myScroller.setSize(getSize());
  myScroller.validate();
}
