{
  if (getPosition() == PopupWindowPosition.TOP) {
    location=new Point(location.x,location.y - getHeight() - getPatternEditor().getHeight());
  }
  if (location.x < deviceBounds.x) {
    location.x=deviceBounds.x;
  }
  if (getWidth() + location.x > deviceBounds.width + deviceBounds.x) {
    location=new Point(deviceBounds.width + deviceBounds.x - getWidth(),location.y);
  }
  return location;
}
