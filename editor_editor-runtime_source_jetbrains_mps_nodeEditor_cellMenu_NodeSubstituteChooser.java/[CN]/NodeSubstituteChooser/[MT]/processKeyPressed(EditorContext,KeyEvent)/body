{
  String oldPattern=getPatternEditor().getPattern();
  if (getPatternEditor().processKeyPressed(keyEvent)) {
    if (oldPattern.length() > getPatternEditor().getPattern().length()) {
      setUserChoseItem(false);
    }
    processKeyEventInternal();
    return true;
  }
  if (keyEvent.getKeyCode() == KeyEvent.VK_ESCAPE) {
    setVisible(false);
    return true;
  }
  if (myPopupActivated) {
    return menu_processKeyPressed(keyEvent);
  }
  if (keyEvent.getKeyCode() == KeyEvent.VK_ENTER || (keyEvent.getKeyCode() == KeyEvent.VK_SPACE && keyEvent.isControlDown())) {
    return doSubstitute();
  }
  return false;
}
