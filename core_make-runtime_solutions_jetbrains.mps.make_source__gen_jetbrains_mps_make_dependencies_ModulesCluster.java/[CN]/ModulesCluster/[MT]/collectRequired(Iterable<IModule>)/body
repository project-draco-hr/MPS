{
  Set<ModuleReference> allRequired=SetSequence.fromSetWithValues(new HashSet<ModuleReference>(),Sequence.fromIterable(MapSequence.fromMap(allDeps).values()).translate(new ITranslator2<ModulesCluster.ModuleDeps,ModuleReference>(){
    public Iterable<ModuleReference> translate(    ModulesCluster.ModuleDeps dep){
      return dep.required;
    }
  }
));
  List<IModule> available=Sequence.fromIterable(pool).toListSequence();
  int atSize;
  do {
    atSize=MapSequence.fromMap(allDeps).count();
    for (Iterator<IModule> it=ListSequence.fromList(available).iterator(); it.hasNext(); ) {
      IModule mod=it.next();
      ModuleReference mr=mod.getModuleReference();
      if (SetSequence.fromSet(allRequired).contains(mr)) {
        primAdd(mod);
        SetSequence.fromSet(allRequired).addSequence(ListSequence.fromList(MapSequence.fromMap(allDeps).get(mr).required));
        it.remove();
      }
    }
  }
 while (atSize < MapSequence.fromMap(allDeps).count());
}
