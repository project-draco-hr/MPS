{
  ModuleReference mr=mod.getModuleReference();
  ModulesCluster.ModuleDeps deps=MapSequence.<ModuleReference,ModulesCluster.ModuleDeps>fromMap(allDeps).get(mr);
  if (deps == null) {
    deps=new ModulesCluster.ModuleDeps();
    MapSequence.<ModuleReference,ModulesCluster.ModuleDeps>fromMap(allDeps).put(mr,deps);
  }
  ListSequence.<ModuleReference>fromList(deps.required).addSequence(Sequence.<ModuleReference>fromIterable(required(mod)));
  for (  ModuleReference req : deps.required) {
    if (MapSequence.fromMap(allDeps).containsKey(req)) {
      ListSequence.<ModuleReference>fromList(MapSequence.<ModuleReference,ModulesCluster.ModuleDeps>fromMap(allDeps).get(req).dependent).addElement(mr);
    }
  }
  for (  IMapping<ModuleReference,ModulesCluster.ModuleDeps> m : MapSequence.fromMap(allDeps).mappingsSet()) {
    if (ListSequence.<ModuleReference>fromList(m.value().required).contains(mr) && !(ListSequence.<ModuleReference>fromList(deps.dependent).contains(m.key()))) {
      ListSequence.<ModuleReference>fromList(deps.dependent).addElement(m.key());
    }
  }
}
