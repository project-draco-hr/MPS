{
  ModuleReference mr=mod.getModuleReference();
  ModulesCluster.ModuleDeps deps=MapSequence.fromMap(allDeps).get(mr);
  if (deps == null) {
    deps=new ModulesCluster.ModuleDeps(mr);
    MapSequence.fromMap(allDeps).put(mr,deps);
  }
  ListSequence.fromList(deps.required).addSequence(Sequence.fromIterable(required(mod)));
  for (  ModuleReference req : deps.required) {
    if (MapSequence.fromMap(allDeps).containsKey(req)) {
      ListSequence.fromList(MapSequence.fromMap(allDeps).get(req).dependent).addElement(mr);
    }
  }
  for (  IMapping<ModuleReference,ModulesCluster.ModuleDeps> m : MapSequence.fromMap(allDeps).mappingsSet()) {
    if (ListSequence.fromList(m.value().required).contains(mr) && !(ListSequence.fromList(deps.dependent).contains(m.key()))) {
      ListSequence.fromList(deps.dependent).addElement(m.key());
    }
  }
}
