{
  myLock.lock();
  try {
    while (true) {
      if (myClosed) {
        throw new ICommandQueue.QueueClosedException();
      }
      for (      List<ICommand> commandList : myQueue) {
        if (!(ListSequence.fromList(commandList).isEmpty())) {
          ICommand command=ListSequence.fromList(commandList).removeElementAt(0);
          myLastCommand=command;
          return command;
        }
      }
      myCondition.awaitUninterruptibly();
    }
  }
  finally {
    myLock.unlock();
  }
}
