{
  SNode smartType=myTypesToSmartTypes.get(type);
  if (smartType != null)   return smartType;
  ConceptDeclaration concept=SModelUtil.getConceptDeclaration(type,GlobalScope.getInstance());
  if (concept == null) {
    smartType=type;
  }
 else {
    LinkDeclaration smartLink=myConceptsToSmartLinks.get(concept);
    if (smartLink == null) {
      smartLink=SModelUtil.getSmartReferenceLinkDeclaration(concept);
      myConceptsToSmartLinks.put(concept,smartLink);
    }
    if (smartLink == null) {
      smartType=type;
    }
 else {
      smartType=type.getReferent(smartLink.getRole());
    }
  }
  myTypesToSmartTypes.put(type,smartType);
  return smartType;
}
