{
  boolean compiledSuccessfully=generationOK;
  writeFiles();
  if (generationOK) {
    long compilationStart=System.currentTimeMillis();
    boolean needToReload=false;
    for (    Pair<IModule,List<SModelDescriptor>> moduleListPair : input) {
      IModule module=moduleListPair.o1;
      if (module != null && module.reloadClassesAfterGeneration()) {
        needToReload=true;
      }
      boolean compilationResult=compileModuleInMPS(module,progressHelper);
      compiledSuccessfully=compiledSuccessfully && compilationResult;
    }
    if (compiledSuccessfully && needToReload) {
      reloadClasses(progressHelper);
    }
    info("Compilation finished in " + (System.currentTimeMillis() - compilationStart) + " ms");
  }
  return compiledSuccessfully;
}
