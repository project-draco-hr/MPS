{
  int charCode=0;
  if (charRef.startsWith("x")) {
    if (charRef.length() > 8 || charRef.length() < 2) {
      return false;
    }
    for (int i=1; i < charRef.length(); i++) {
      int c=charRef.codePointAt(i);
      if (c >= '0' && c <= '9') {
        c=c - '0';
      }
 else       if (c >= 'A' && c <= 'F') {
        c=c - 'A' + 10;
      }
 else       if (c >= 'a' && c <= 'f') {
        c=c - 'a' + 10;
      }
 else {
        return false;
      }
      charCode=(charCode << 4) + c;
    }
  }
 else {
    if (charRef.length() > 9 || charRef.length() < 1) {
      return false;
    }
    for (int i=0; i < charRef.length(); i++) {
      int c=charRef.codePointAt(i);
      if (c >= '0' && c <= '9') {
        c=c - '0';
      }
 else {
        return false;
      }
      charCode=charCode * 10 + c;
    }
  }
  return isXmlChar(charCode);
}
