{
  monitor.start("generating files",1);
  try {
    info("handling output...");
    IFile targetDir=FileSystem.getInstance().getFileByPath(SModuleOperations.getOutputPathFor(inputModel));
    long startJobTime=System.currentTimeMillis();
    if (status.isOk()) {
      JavaStreamHandler javaSourcesLocation=new JavaStreamHandler(inputModel,targetDir,myProcessor);
      JavaStreamHandler cachesLocation=new JavaStreamHandler(inputModel,FileGenerationUtil.getCachesDir(targetDir),myProcessor);
      TextFacility tf=new TextFacility(status);
      tf.failNoTextGen(false).generateDebug(true).generateBaseLangDeps(true);
      tf.produceTextModel();
      tf.serializeOutcome(javaSourcesLocation);
      CacheGenLayout cgl=new CacheGenLayout();
      cgl.register(cachesLocation,BLDependenciesCache.getInstance().getGenerator());
      cgl.register(cachesLocation,GenerationDependenciesCache.getInstance().getGenerator());
      cgl.register(javaSourcesLocation,TraceInfoCache.getInstance().getGenerator());
      tf.serializeCaches(cgl);
      if (!tf.getErrors().isEmpty()) {
        info("there were errors:");
        for (        IMessage m : tf.getErrors()) {
          myLogger.info(m.getText());
        }
        return false;
      }
      myProcessor.filesToDelete(javaSourcesLocation.getFilesToDelete());
      myProcessor.filesToDelete(cachesLocation.getFilesToDelete());
      myProcessor.invalidateModel(inputModel);
    }
    if (myLogger.needsInfo()) {
      myLogger.info("output generated in " + (System.currentTimeMillis() - startJobTime) + " ms");
    }
    return true;
  }
  finally {
    monitor.done();
  }
}
