{
  try {
    ModelAccess.instance().runWriteAction(new Runnable(){
      @Override public void run(){
        for (        Language l : MPSModuleRepository.getInstance().getAllLanguages()) {
          Set<SModelReference> toRemove=new HashSet<SModelReference>();
          Set<SModelReference> toAdd=new HashSet<SModelReference>();
          List<SModelReference> acc=l.getModuleDescriptor().getAccessoryModels();
          for (          SModelReference ref : acc) {
            if (!(ref.getSModelId() instanceof ForeignSModelId))             continue;
            toRemove.add(ref);
            for (            SModelDescriptor md : l.getScope().getModelDescriptors()) {
              if (md.getLongName().equals(ref.getLongName())) {
                toAdd.add(md.getSModelReference());
              }
            }
          }
          acc.removeAll(toRemove);
          acc.addAll(toAdd);
          l.save();
        }
      }
    }
);
  }
 catch (  Throwable t) {
    LOG.error("User's action execute method failed. Action:" + "UpdateModuleStubDeps",t);
  }
}
