{
  mySolution=null;
  myModelRoot=null;
  myModelPrefix=null;
  Module module=e.getData(LangDataKeys.MODULE);
  VirtualFile[] vFiles=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  if (module == null || vFiles == null || vFiles.length != 1 || !vFiles[0].isDirectory()) {
    return;
  }
  MPSFacet mpsFacet=FacetManager.getInstance(module).getFacetByType(MPSFacetType.ID);
  if (mpsFacet == null || !mpsFacet.wasInitialized()) {
    return;
  }
  String url=vFiles[0].getUrl();
  if (!LocalFileSystem.PROTOCOL.equals(VirtualFileManager.extractProtocol(url))) {
    return;
  }
  String path=VirtualFileManager.extractPath(url);
  for (  ModelRoot root : mpsFacet.getSolution().getModelRoots()) {
    if (!(root instanceof FolderModelRootBase))     continue;
    FolderModelRootBase modelRoot=(FolderModelRootBase)root;
    if (path.startsWith(modelRoot.getPath())) {
      mySolution=mpsFacet.getSolution();
      myModelRoot=modelRoot;
      myModelPrefix=path.substring(modelRoot.getPath().length());
      while (myModelPrefix.startsWith("/") || myModelPrefix.startsWith("\\")) {
        myModelPrefix=myModelPrefix.substring(1);
      }
      while (myModelPrefix.endsWith("/") || myModelPrefix.endsWith("\\")) {
        myModelPrefix=myModelPrefix.substring(0,myModelPrefix.length());
      }
      myModelPrefix=myModelPrefix.replaceAll("/",".");
      myModelPrefix=myModelPrefix.replaceAll("\\\\",".");
      if (!myModelPrefix.isEmpty()) {
        myModelPrefix+=".";
      }
      return;
    }
  }
}
