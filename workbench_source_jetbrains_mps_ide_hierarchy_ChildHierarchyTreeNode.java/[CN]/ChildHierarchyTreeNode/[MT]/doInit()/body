{
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      try {
        T node=(T)getUserObject();
        List<T> descendants=new ArrayList<T>(myHierarchyTree.getAbstractChildren(node,myVisited));
        Collections.sort(descendants,new Comparator<T>(){
          public int compare(          T o1,          T o2){
            return ("" + o1.toString()).compareTo(o2.toString());
          }
        }
);
        Set<T> visited=new HashSet<T>(myVisited);
        visited.add(node);
        for (        T descendant : descendants) {
          ChildHierarchyTreeNode<T> childHierarchyTreeNode=new ChildHierarchyTreeNode<T>(descendant,getOperationContext(),myHierarchyTree,visited);
          add(childHierarchyTreeNode);
        }
      }
 catch (      CircularHierarchyException ex) {
        T errorNode=(T)ex.getRepeatedObject();
        final String message=ex.getMessage();
        HierarchyTreeNode<T> errorTreeNode=new HierarchyTreeNode<T>(errorNode,getOperationContext(),myHierarchyTree){
          @Override protected void doUpdatePresentation(){
            super.doUpdatePresentation();
            setIcon(Icons.ERROR_ICON);
            setColor(Color.RED);
          }
          @Override protected String calculateAdditionalText(){
            return message;
          }
        }
;
        add(errorTreeNode);
      }
      myInitialized=true;
    }
  }
);
}
