{
  IFile tmpDir=IFileUtils.createTmpDir();
  assertTrue("Temp dir does not exist",tmpDir.exists());
  assertTrue("Created temp directory is not directory",tmpDir.isDirectory());
  assertFalse("Could create file with the same name as the directory",tmpDir.createNewFile());
  assertTrue("Created temp directory is not empty",tmpDir.getChildren().isEmpty());
  IFile subSubDir=tmpDir.getDescendant(SUBSUBDIR);
  assertTrue(subSubDir.mkdirs());
  assertTrue(subSubDir.isDirectory());
  assertTrue(subSubDir.exists());
  IFile file1=tmpDir.getDescendant(SUBSUBDIR + File.separator + "file1");
  assertFalse(file1.exists());
  assertTrue(file1.getParent().equals(subSubDir));
  try {
    OutputStream os=file1.openOutputStream();
    for (int i=0; i < FILE_SIZE; i++) {
      os.write(i % 256);
    }
    os.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
    fail();
  }
  assertTrue(file1.exists());
  assertEquals(file1.length(),FILE_SIZE);
  assertEquals(Collections.singletonList(file1),subSubDir.getChildren());
  try {
    InputStream os=file1.openInputStream();
    for (int i=0; i < FILE_SIZE; i++) {
      assertEquals(os.read(),i % 256);
    }
    os.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
    fail();
  }
  assertTrue(file1.rename("file111"));
  assertTrue(file1.getName().equals("file111"));
  assertTrue(file1.getParent().getDescendant("file111").equals(file1));
  assertFalse(file1.getParent().getDescendant("file1").exists());
  assertTrue(file1.rename("file1"));
  String path1Original=file1.getPath();
  assertTrue(file1.move(tmpDir));
  assertFalse(file1.getPath().equals(path1Original));
  assertTrue(file1.getParent().equals(tmpDir));
  assertFalse(FileSystem.getInstance().getFileByPath(path1Original).exists());
  assertTrue(tmpDir.delete());
  assertFalse(tmpDir.exists());
}
