{
  boolean enabled=true;
  List<SNode> nodes=getNodes(e);
  if (myRefactoring.getRefactoringTarget() == RefactoringTarget.NODE) {
    enabled=RefactoringUtil.isApplicableInContext(myRefactoring,nodes);
  }
 else   if (myRefactoring.getRefactoringTarget() == RefactoringTarget.MODEL) {
    SModelDescriptor modelDescriptor=MPSDataKeys.MODEL.getData(e.getDataContext());
    if (modelDescriptor != null) {
      enabled=myRefactoring.isApplicableToModel(modelDescriptor);
    }
  }
  setEnabledState(e.getPresentation(),enabled);
}
