{
  Set<SNode> declarations=SetSequence.fromSet(new HashSet<SNode>());
  Set<SNode> reference=SetSequence.fromSet(new HashSet<SNode>());
  SetSequence.fromSet(reference).addSequence(ListSequence.fromList(SNodeOperations.getDescendants(thisNode,"jetbrains.mps.baseLanguage.structure.LocalVariableReference",false)));
  SetSequence.fromSet(reference).addSequence(ListSequence.fromList(SNodeOperations.getDescendants(thisNode,"jetbrains.mps.baseLanguage.structure.ParameterReference",false)));
  for (  SNode ref : reference) {
    boolean statementsContainsVar=false;
    for (    SNode parent : SNodeOperations.getAncestors(SLinkOperations.getTarget(ref,"variableDeclaration",false),null,false)) {
      if (parent == SNodeOperations.getParent(thisNode)) {
        statementsContainsVar=true;
      }
    }
    if (!(statementsContainsVar)) {
      SetSequence.fromSet(declarations).addElement(SLinkOperations.getTarget(ref,"variableDeclaration",false));
    }
  }
  return declarations;
}
