{
  HashSet<SNode> declarations=new HashSet<SNode>();
  HashSet<SNode> reference=new HashSet<SNode>();
  reference.addAll(SNodeOperations.getDescendants(thisNode,"jetbrains.mps.baseLanguage.structure.LocalVariableReference",false));
  reference.addAll(SNodeOperations.getDescendants(thisNode,"jetbrains.mps.baseLanguage.structure.ParameterReference",false));
  for (  SNode ref : reference) {
    boolean statementsContainsVar=false;
    for (    SNode parent : SNodeOperations.getAncestors(SLinkOperations.getTarget(ref,"variableDeclaration",false),null,false)) {
      if (parent == thisNode) {
        statementsContainsVar=true;
      }
    }
    if (!(statementsContainsVar)) {
      declarations.add(SLinkOperations.getTarget(ref,"variableDeclaration",false));
    }
  }
  return declarations;
}
