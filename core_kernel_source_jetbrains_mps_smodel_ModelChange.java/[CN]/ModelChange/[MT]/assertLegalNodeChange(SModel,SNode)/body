{
  if (model.canFireEvent() && jetbrains.mps.util.SNodeOperations.isRegistered(node) && !UndoHelper.getInstance().isInsideUndoableCommand()) {
    throw new IllegalModelChangeError("registered node can only be modified inside undoable command or in 'loading' model " + node.getDebugText());
  }
}
