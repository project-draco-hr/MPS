{
  setupEnvironment();
  Map<File,List<String>> mpsProjects=myWhatToDo.getMPSProjectFiles();
  for (  File file : mpsProjects.keySet()) {
    Project p=myEnvironment.openProject(file);
    info("Loaded project " + p);
    MigrationManager m=p.getComponent(MigrationManager.class);
    if (!(m.isMigrationRequired())) {
      MigrationWorker.this.info("Nothing to migrate");
    }
 else {
      myEnvironment.flushAllEvents();
      migrate(p,m);
      myEnvironment.flushAllEvents();
    }
    myEnvironment.closeProject(p);
  }
  dispose();
}
