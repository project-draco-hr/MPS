{
  setupEnvironment();
  Map<File,List<String>> mpsProjects=myWhatToDo.getMPSProjectFiles();
  for (  File file : mpsProjects.keySet()) {
    FileMPSProject p=new FileMPSProject(file);
    p.init(new FileMPSProject.ProjectDescriptor(file));
    p.projectOpened();
    info("Loaded project " + p);
    if (!(p.getComponent(MigrationComponent.class).isMigrationRequired())) {
      MigrationWorker.this.info("Nothing to migrate");
    }
 else {
      myEnvironment.flushAllEvents();
      migrate(p);
      myEnvironment.flushAllEvents();
    }
    p.projectClosed();
  }
  dispose();
}
