{
  String solutionName=makePluginSolutionName(l,SOLUTION_NAME);
  Solution s=ModuleRepositoryFacade.getInstance().getModule(solutionName,Solution.class);
  if (s == null) {
    s=NewModuleUtil.createSolution(solutionName,l.getBundleHome().getDescendant("solutions").getDescendant(SOLUTION_NAME).getPath(),myProject);
    StandaloneMPSProject project=(StandaloneMPSProject)myProject;
    project.setFolderFor(s,project.getFolderFor(l));
  }
  s.getModuleDescriptor().setKind(SolutionKind.PLUGIN_OTHER);
  final String modelName=s.getModuleFqName() + ".plugin";
  List<SModel> solModels=s.getOwnModelDescriptors();
  final Wrappers._T<SModel> pluginModel=new Wrappers._T<SModel>(ListSequence.fromList(solModels).where(new IWhereFilter<SModel>(){
    public boolean accept(    SModel it){
      return jetbrains.mps.util.SNodeOperations.getModelLongName(it).equals(modelName);
    }
  }
).first());
  if (pluginModel.value == null) {
    pluginModel.value=SModuleOperations.createModelWithAdjustments(modelName,s.getModelRoots().iterator().next());
  }
  List<SNode> nodes=IterableUtil.asList(LanguageAspect.PLUGIN.get(l).getRootNodes());
  Iterable<SNode> nodes2Refactor=ListSequence.fromList(nodes).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return !(isFromFacetLang(it));
    }
  }
);
  final RefactoringContext context=RefactoringContext.createRefactoringContextByName("jetbrains.mps.lang.core.refactorings.MoveNodes",Arrays.asList("target"),Arrays.asList(pluginModel.value),Sequence.fromIterable(nodes2Refactor).toListSequence(),myProject);
  RefactoringContext rc=(RefactoringContext)context;
  rc.setLocal(true);
  ModelAccess.instance().runWriteInEDT(new Runnable(){
    @Override public void run(){
      RefactoringAccess.getInstance().getRefactoringFacade().executeSimple(context);
    }
  }
);
  jetbrains.mps.smodel.SModelOperations.validateLanguagesAndImports(pluginModel.value,false,true);
  s.save();
  SModelRepository.getInstance().saveAll();
}
