{
  ProjectMigration current=next(lastProjectMigration,cleanup);
  while (current != null && !(current.shouldBeExecuted(myMpsMproject))) {
    current=next(current,cleanup);
  }
  if (current == null) {
    return null;
  }
  lastProjectMigration=current;
  if (current instanceof ProjectMigrationWithOptions) {
    ((ProjectMigrationWithOptions)current).setOptionValues(options);
  }
  final ProjectMigration cc=current;
  return new MigrationManager.MigrationStep(){
    public String getDescription(){
      return cc.getDescription();
    }
    public boolean execute(){
      try {
        myMpsMproject.getRepository().getModelAccess().executeCommand(new Runnable(){
          public void run(){
            cc.execute(myMpsMproject);
          }
        }
);
      }
 catch (      Throwable e) {
        if (LOG.isEnabledFor(Level.ERROR)) {
          LOG.error("Could not execute script",e);
        }
        return false;
      }
      return true;
    }
    public void forceExecutionNextTime(){
      if (!((cc instanceof CleanupProjectMigration))) {
        throw new UnsupportedOperationException("only supported for cleanup project migrations");
      }
      ((CleanupProjectMigration)cc).forceExecutionNextTime(myMpsMproject);
    }
  }
;
}
