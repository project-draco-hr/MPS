{
  progress.start("Converting...",31);
  final ProgressMonitor parseProgress=progress.subTask(1);
  parseProgress.start("Parsing...",ListSequence.fromList(files).count());
  myModelAccess.runReadAction(new Runnable(){
    public void run(){
      for (      IFile file : ListSequence.fromList(files)) {
        try {
          parseFile(file);
          parseProgress.advance(1);
        }
 catch (        JavaParseException e) {
        }
catch (        IOException e) {
        }
      }
    }
  }
);
  parseProgress.done();
  int rootCount=0;
  runCommand("roots creation pass",new Runnable(){
    public void run(){
      SModule module;
      if (myModel == null) {
        ((AbstractModule)myModule).addDependency(PersistenceFacade.getInstance().createModuleReference("6354ebe7-c22a-4a0f-ac54-50b52ab9b065(JDK)"),false);
        for (        String pakage : MapSequence.fromMap(classesPerPackage).keySet()) {
          final SModel model=getModel(pakage,MapSequence.fromMap(packageDirs).get(pakage));
          if (model == null) {
            continue;
          }
          ((SModelBase)model).addLanguage(MetaAdapterFactory.getLanguage(MetaIdFactory.langId(0xf3061a5392264cc5L,0xa443f952ceaf5816L),"jetbrains.mps.baseLanguage",-1));
          ((SModelBase)model).addLanguage(MetaAdapterFactory.getLanguage(MetaIdFactory.langId(0xf280165065d5424eL,0xbb1b463a8781b786L),"jetbrains.mps.baseLanguage.javadoc",-1));
          Set<SNode> roots=MapSequence.fromMap(classesPerPackage).get(pakage);
          SetSequence.fromSet(roots).visitAll(new IVisitor<SNode>(){
            public void visit(            SNode it){
              model.addRootNode(it);
            }
          }
);
          ListSequence.fromList(mySuccessfulFiles).addSequence(ListSequence.fromList(MapSequence.fromMap(filesPerPackage).get(pakage)));
          ListSequence.fromList(myAttachedRoots).addSequence(SetSequence.fromSet(roots));
          ((EditableSModelBase)model).save();
          ListSequence.fromList(myModels).addElement(model);
        }
        module=myModule;
      }
 else {
        for (        SNode root : ListSequence.fromList(myRoots)) {
          myModel.addRootNode(root);
        }
        myAttachedRoots=myRoots;
        ((SModelBase)myModel).addLanguage(PersistenceFacade.getInstance().createModuleReference("f3061a53-9226-4cc5-a443-f952ceaf5816(jetbrains.mps.baseLanguage)"));
        ((SModelBase)myModel).addLanguage(PersistenceFacade.getInstance().createModuleReference("f2801650-65d5-424e-bb1b-463a8781b786(jetbrains.mps.baseLanguage.javadoc)"));
        module=myModel.getModule();
      }
      JavaParser.tryResolveUnknowns(myAttachedRoots);
    }
  }
);
  myRootCount=myAttachedRoots.size();
  ProgressMonitor resolveProgress=progress.subTask(30);
  tryResolveRefs(myAttachedRoots,FeatureKind.CLASS,resolveProgress);
  progress.done();
}
