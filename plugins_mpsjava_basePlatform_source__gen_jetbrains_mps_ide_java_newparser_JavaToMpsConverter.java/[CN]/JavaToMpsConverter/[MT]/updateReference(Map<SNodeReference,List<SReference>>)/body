{
  for (  SNodeReference nodeRef : SetSequence.fromSet(MapSequence.fromMap(refMap).keySet())) {
    final SNode node=nodeRef.resolve(myRepository);
    if (node == null) {
      continue;
    }
    final SModel sourceModel=node.getModel();
    ListSequence.fromList(MapSequence.fromMap(refMap).get(nodeRef)).visitAll(new IVisitor<SReference>(){
      public void visit(      SReference it){
        SModelReference targetModelRef=it.getTargetSModelReference();
        if (!(sourceModel.getReference().equals(targetModelRef))) {
          ((SModelInternal)sourceModel).addModelImport(targetModelRef,true);
        }
        node.setReference(it.getRole(),it);
      }
    }
);
  }
}
