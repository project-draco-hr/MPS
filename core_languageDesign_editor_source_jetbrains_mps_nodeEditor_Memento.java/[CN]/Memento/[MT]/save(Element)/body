{
  if (mySelectedCellInfo instanceof DefaultCellInfo) {
    Element cellElem=new Element(SELECTED_CELL);
    ((DefaultCellInfo)mySelectedCellInfo).saveTo(cellElem);
    e.addContent(cellElem);
  }
  Element selectedStack=new Element(SELECTED_STACK);
  boolean success=true;
  for (  CellInfo cellInfo : mySelectedStack) {
    if (cellInfo instanceof DefaultCellInfo) {
      Element stackElement=new Element(STACK_ELEMENT);
      ((DefaultCellInfo)cellInfo).saveTo(stackElement);
      selectedStack.addContent(stackElement);
    }
 else {
      success=false;
      break;
    }
  }
  if (success) {
    e.addContent(selectedStack);
  }
  success=true;
  Element folded=new Element(FOLDED);
  for (  CellInfo cellInfo : myFolded) {
    if (cellInfo instanceof DefaultCellInfo) {
      Element foldedElement=new Element(FOLDED_ELEMENT);
      ((DefaultCellInfo)cellInfo).saveTo(foldedElement);
      folded.addContent(foldedElement);
    }
 else {
      success=false;
      break;
    }
  }
  if (success) {
    e.addContent(folded);
  }
  Element textLine=new Element(TEXT_LINE);
  textLine.setAttribute(CARET_POSITION,myCaretX + "");
  textLine.setAttribute(SEL_START,mySelectionStart + "");
  textLine.setAttribute(SEL_END,mySelectionEnd + "");
  e.addContent(textLine);
}
