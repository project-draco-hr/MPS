{
  this.config=config;
  ActiveEnvironment.activateEnvironment(this);
  BasicConfigurator.configure();
  Logger.getRootLogger().setLevel(Level.ERROR);
  IdeMain.setTestMode(IdeMain.TestMode.CORE_TEST);
  EnvironmentUtils.setSystemProperties(true);
  TestMain.configureMPS(SetSequence.fromSet(config.plugins()).toGenericArray(String.class));
  try {
    SwingUtilities.invokeAndWait(new Runnable(){
      @Override public void run(){
        ModelAccess.instance().runWriteAction(new Runnable(){
          public void run(){
            LibraryInitializer.getInstance().update();
          }
        }
);
      }
    }
);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  for (  String macro : SetSequence.fromSet(MapSequence.fromMap(config.macros()).keySet())) {
    setMacro(macro,MapSequence.fromMap(config.macros()).get(macro));
  }
}
