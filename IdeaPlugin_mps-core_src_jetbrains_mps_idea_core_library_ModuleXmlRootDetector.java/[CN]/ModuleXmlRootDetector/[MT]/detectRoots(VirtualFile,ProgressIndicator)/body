{
  LinkedHashSet<VirtualFile> result=new LinkedHashSet<VirtualFile>();
  List<ModuleHandle> moduleHandles=ModulesMiner.getInstance().collectModules(VirtualFileUtils.toIFile(rootCandidate),false);
  for (  ModuleHandle handle : moduleHandles) {
    if (handle.getDescriptor() instanceof SolutionDescriptor) {
      if (ModuleRepositoryFacade.getInstance().getModule(handle.getDescriptor().getModuleReference()) != null) {
        VirtualFile ideaFile=VirtualFileUtils.getVirtualFile(handle.getFile());
        if (ideaFile != null && ideaFile.getFileSystem() == rootCandidate.getFileSystem()) {
          result.add(ideaFile);
        }
      }
    }
  }
  return result;
}
