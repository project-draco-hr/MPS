{
  Set<SNode> result=SetSequence.<SNode>fromSet(new LinkedHashSet<SNode>());
  Queue<SNode> queue=QueueSequence.<SNode>fromQueueAndArray(new LinkedList<SNode>(),thisNode);
  while (QueueSequence.<SNode>fromQueue(queue).isNotEmpty()) {
    SNode fd=QueueSequence.fromQueue(queue).removeFirstElement();
    if (!(SetSequence.<SNode>fromSet(result).contains(fd))) {
      SetSequence.fromSet(result).addElement(fd);
      QueueSequence.fromQueue(queue).addSequence(ListSequence.<SNode>fromList(SLinkOperations.getTargets(fd,"extended",true)).<SNode>select(new ISelector<SNode,SNode>(){
        public SNode select(        SNode it){
          return SLinkOperations.getTarget(it,"facet",false);
        }
      }
));
    }
  }
  return result;
}
