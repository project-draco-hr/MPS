{
  List<Edge> fullHistory=ListSequence.<Edge>fromList(new LinkedList<Edge>());
  List<Edge> history=MapSequence.<Edge,List<Edge>>fromMap(myHistory).get(edge);
  if (history == null) {
    ListSequence.<Edge>fromList(fullHistory).addElement(edge);
  }
 else {
    Node cur=edge.getSource();
    for (    Edge newEdge : history) {
      if (!(checkConnection(cur,newEdge))) {
        throw new RuntimeException("history is broken: edge " + edge + " history: "+ history);
      }
      List<Edge> newHistory=getHistory(newEdge);
      if (!(checkConnection(cur,ListSequence.<Edge>fromList(newHistory).first()))) {
        newHistory=ListSequence.<Edge>fromList(newHistory).reversedList();
      }
      ListSequence.<Edge>fromList(fullHistory).addSequence(ListSequence.<Edge>fromList(newHistory));
      cur=newEdge.getOpposite(cur);
    }
  }
  return fullHistory;
}
