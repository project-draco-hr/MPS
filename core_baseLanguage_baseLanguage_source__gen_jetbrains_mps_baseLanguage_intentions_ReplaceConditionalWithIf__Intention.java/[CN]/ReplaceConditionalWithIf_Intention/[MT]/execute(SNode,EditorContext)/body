{
  SNode stmtNode=(SNode)SNodeOperations.getAncestor(node,"jetbrains.mps.baseLanguage.structure.Statement",false,false);
  if (SNodeOperations.isInstanceOf(stmtNode,"jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement")) {
    SNode variableDeclaration=SLinkOperations.getTarget(((SNode)stmtNode),"localVariableDeclaration",true);
    SNode eStatement=SModelOperations.createNewNode(SNodeOperations.getModel(variableDeclaration),"jetbrains.mps.baseLanguage.structure.ExpressionStatement",null);
    SNode assignment=SLinkOperations.setNewChild(eStatement,"expression","jetbrains.mps.baseLanguage.structure.AssignmentExpression");
    SLinkOperations.setTarget(assignment,"rValue",SLinkOperations.getTarget(variableDeclaration,"initializer",true),true);
    SNode local=SLinkOperations.setNewChild(assignment,"lValue","jetbrains.mps.baseLanguage.structure.LocalVariableReference");
    SLinkOperations.setTarget(local,"variableDeclaration",variableDeclaration,false);
    SNodeOperations.insertNextSiblingChild(stmtNode,eStatement);
    stmtNode=(SNode)SNodeOperations.getNextSibling(stmtNode);
  }
  SNode nodeParent=SNodeOperations.getParent(node,null,false,false);
  int nodeIndex=ListSequence.fromList(SNodeOperations.getChildren(nodeParent)).indexOf(node);
  SNode nodeCopy=SNodeOperations.copyNode(node);
  SNodeOperations.replaceWithAnother(ListSequence.fromList(SNodeOperations.getChildren(nodeParent)).getElement(nodeIndex),SLinkOperations.getTarget(nodeCopy,"ifTrue",true));
  SNode trueStmt=SNodeOperations.copyNode(stmtNode);
  SNodeOperations.replaceWithAnother(ListSequence.fromList(SNodeOperations.getChildren(nodeParent)).getElement(nodeIndex),SLinkOperations.getTarget(nodeCopy,"ifFalse",true));
  SNode falseStmt=SNodeOperations.copyNode(stmtNode);
  SNode falseBlockStmt=SConceptOperations.createNewNode("jetbrains.mps.baseLanguage.structure.BlockStatement",null);
  SLinkOperations.setNewChild(falseBlockStmt,"statements","jetbrains.mps.baseLanguage.structure.StatementList");
  SLinkOperations.insertChildFirst(SLinkOperations.getTarget(falseBlockStmt,"statements",true),"statement",SNodeOperations.copyNode(stmtNode));
  SNode ifNode=SConceptOperations.createNewNode("jetbrains.mps.baseLanguage.structure.IfStatement",null);
  SLinkOperations.setTarget(ifNode,"condition",SLinkOperations.getTarget(node,"condition",true),true);
  SLinkOperations.setNewChild(ifNode,"ifTrue","jetbrains.mps.baseLanguage.structure.StatementList");
  SLinkOperations.insertChildFirst(SLinkOperations.getTarget(ifNode,"ifTrue",true),"statement",trueStmt);
  SLinkOperations.setTarget(ifNode,"ifFalseStatement",falseBlockStmt,true);
  SNodeOperations.replaceWithAnother(stmtNode,ifNode);
}
