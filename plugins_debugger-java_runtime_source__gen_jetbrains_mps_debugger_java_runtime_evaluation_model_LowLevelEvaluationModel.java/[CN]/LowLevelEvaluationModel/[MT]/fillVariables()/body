{
  SNode evaluatorConcept=getNodeToShow();
  try {
    _FunctionTypes._return_P1_E0<? extends SNode,? super String> createClassifierType=new _FunctionTypes._return_P1_E0<SNode,String>(){
      public SNode invoke(      String name){
        return createClassifierType(name);
      }
    }
;
    Map<String,VariableDescription> contextVariables=myEvaluationContext.getVariables(createClassifierType);
    Map<String,SNode> declaredVariables=MapSequence.fromMap(new LinkedHashMap<String,SNode>(16,(float)0.75,false));
    for (    SNode var : ListSequence.fromList(SLinkOperations.getTargets(evaluatorConcept,"variables",true))) {
      MapSequence.fromMap(declaredVariables).put(SPropertyOperations.getString(var,"lowLevelName"),var);
    }
    final Set<SNode> foundVars=SetSequence.fromSet(new HashSet<SNode>());
    for (    String variable : SetSequence.fromSet(MapSequence.fromMap(contextVariables).keySet())) {
      String name=variable;
      SNode lowLevelVarNode=MapSequence.fromMap(declaredVariables).get(name);
      if (needUpdateVariables()) {
        if (lowLevelVarNode == null) {
          lowLevelVarNode=SConceptOperations.createNewNode("jetbrains.mps.debugger.java.evaluation.structure.LowLevelVariable",null);
          ListSequence.fromList(SLinkOperations.getTargets(evaluatorConcept,"variables",true)).addElement(lowLevelVarNode);
          MapSequence.fromMap(declaredVariables).put(name,lowLevelVarNode);
        }
        MapSequence.fromMap(contextVariables).get(variable).updateLowLevelVariable(lowLevelVarNode);
      }
      SetSequence.fromSet(foundVars).addElement(lowLevelVarNode);
    }
    Sequence.fromIterable(MapSequence.fromMap(declaredVariables).values()).visitAll(new IVisitor<SNode>(){
      public void visit(      SNode it){
        SPropertyOperations.set(it,"isOutOfScope","" + (!(SetSequence.fromSet(foundVars).contains(it))));
      }
    }
);
    if (needUpdateVariables()) {
      SLinkOperations.setTarget(evaluatorConcept,"contextNode",myEvaluationContext.getStaticContextType(createClassifierType),true);
      SLinkOperations.setTarget(evaluatorConcept,"thisNode",myEvaluationContext.getThisClassifierType(createClassifierType),true);
    }
  }
 catch (  InvalidStackFrameException e) {
    if (log.isWarnEnabled()) {
      log.warn("InvalidStackFrameException",e);
    }
  }
  myVariablesInitialized=true;
}
