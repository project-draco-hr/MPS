{
  if (owner == null)   owner=JOptionPane.getRootFrame();
  setAdditionalModeFilter(myMode);
  List<IFile> res=new ArrayList<IFile>();
  FileChooserDescriptor descriptor=new FileChooserDescriptor(myMode != MODE_DIRECTORIES,myMode != MODE_FILES,true,true,false,multipleSelection){
    @Override public boolean isFileVisible(    VirtualFile file,    boolean showHiddenFiles){
      if (!super.isFileVisible(file,showHiddenFiles))       return false;
      if (file.isDirectory() && myDirectoriesAlwaysVisible) {
        return true;
      }
      return myFileFilter.accept(FileSystem.getInstance().getFileByPath(file.getPath()));
    }
  }
;
  descriptor.setTitle(myTitle == null ? "Select File" : myTitle);
  descriptor.setShowFileSystemRoots(true);
  FileChooserDialog dialog=FileChooserFactory.getInstance().createFileChooser(descriptor,owner);
  VirtualFile selection=VirtualFileUtils.getVirtualFile(ourInitialSelectedFile);
  for (  VirtualFile file : dialog.choose(selection,null)) {
    res.add(FileSystem.getInstance().getFileByPath(file.getPath()));
  }
  if (!res.isEmpty())   ourInitialSelectedFile=res.get(0);
  return res;
}
