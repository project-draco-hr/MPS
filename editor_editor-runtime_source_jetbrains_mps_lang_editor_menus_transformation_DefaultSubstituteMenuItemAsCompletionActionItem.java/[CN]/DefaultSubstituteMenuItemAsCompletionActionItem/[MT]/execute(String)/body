{
  SNode newChild=getSubstituteItem().createNode(pattern);
  if (newChild != null) {
    SContainmentLink containmentLink=myContext.getLink();
    SNode parentNode=myContext.getParentNode();
    SNode currentChild=myContext.getCurrentTargetNode();
    if (containmentLink == null) {
      LOG.error("Containment link should not be null. " + "Parent node" + parentNode.getPresentation() + " Parent id: "+ parentNode.getNodeId());
      return;
    }
    if (!newChild.getConcept().isSubConceptOf(containmentLink.getTargetConcept())) {
      LOG.error("couldn't set instance of " + newChild.getConcept().getName() + " as child '"+ containmentLink.getName()+ "' to parent"+ parentNode.getPresentation()+ " Parent id: "+ parentNode.getNodeId());
    }
    if (currentChild == null) {
      parentNode.addChild(containmentLink,newChild);
    }
 else {
      SNodeUtil.replaceWithAnother(currentChild,newChild);
      currentChild.delete();
    }
    myContext.getEditorContext().flushEvents();
    getSubstituteItem().select(newChild,pattern);
  }
}
