{
  if (node == null)   return null;
  if (ancestorConceptFqNames.length == 0) {
    return null;
  }
  if (root) {
    SNode rootParent=node.getContainingRoot();
    if (_isInstanceOf(rootParent,ancestorConceptFqNames)) {
      return rootParent;
    }
    return null;
  }
  SNode outputNode;
  if (inclusion) {
    outputNode=node;
  }
 else {
    outputNode=node.getParent();
  }
  if (outputNode == null)   return null;
  if (_isInstanceOf(outputNode,ancestorConceptFqNames))   return outputNode;
  while ((outputNode=outputNode.getParent()) != null) {
    if (_isInstanceOf(outputNode,ancestorConceptFqNames))     return outputNode;
  }
  return outputNode;
}
