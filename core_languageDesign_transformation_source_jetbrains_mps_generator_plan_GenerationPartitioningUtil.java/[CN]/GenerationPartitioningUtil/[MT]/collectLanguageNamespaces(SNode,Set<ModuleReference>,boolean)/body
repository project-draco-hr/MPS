{
  ModuleReference namespace=node.getConceptLanguage();
  if (!namespace.getModuleFqName().equals("jetbrains.mps.transformation.TLBase")) {
    namespaces.add(namespace);
    for (    SNode child : node.getChildren()) {
      collectLanguageNamespaces(child,namespaces,excludeTLBase);
    }
  }
 else {
    if (excludeTLBase) {
      if (node.getAdapter() instanceof TemplateDeclaration) {
        BaseConcept content=((TemplateDeclaration)node.getAdapter()).getContentNode();
        if (content != null) {
          collectLanguageNamespaces(content.getNode(),namespaces,excludeTLBase);
        }
      }
    }
 else {
      namespaces.add(namespace);
      for (      SNode child : node.getChildren()) {
        collectLanguageNamespaces(child,namespaces,excludeTLBase);
      }
    }
  }
}
