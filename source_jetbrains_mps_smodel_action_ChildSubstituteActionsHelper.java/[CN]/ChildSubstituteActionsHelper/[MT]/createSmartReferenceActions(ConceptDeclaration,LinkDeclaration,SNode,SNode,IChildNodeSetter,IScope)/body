{
  IStatus status=ModelConstraintsUtil.getReferentSearchScope(parentNode,null,referenceNodeConcept,smartReference,scope);
  if (status.isError())   return null;
  List<INodeSubstituteAction> actions=new LinkedList<INodeSubstituteAction>();
  final LinkDeclaration referenceLink_final=smartReference;
  ISearchScope searchScope=(ISearchScope)status.getUserObject();
  final ConceptDeclaration targetConcept=smartReference.getTarget();
  Class targetConceptClass;
  try {
    targetConceptClass=Class.forName(JavaNameUtil.className(targetConcept),true,ClassLoaderManager.getInstance().getClassLoader());
  }
 catch (  ClassNotFoundException ex) {
    throw new RuntimeException(ex);
  }
  List<SNode> referentNodes=searchScope.getNodes();
  for (  final SNode referentNode : referentNodes) {
    if (targetConceptClass.isInstance(referentNode)) {
      actions.add(new DefaultChildNodeSubstituteAction(referentNode,parentNode,currentChild,childSetter,scope){
        String myMatchingText=null;
        public String getMatchingText(        String pattern){
          if (myMatchingText == null) {
            myMatchingText=getSmartMatchingText(referenceNodeConcept,getParameterNode(),getScope());
          }
          return myMatchingText;
        }
        public String getDescriptionText(        String pattern){
          BaseConcept pn=(BaseConcept)getParameterNode();
          if (pn.getShortDescription() == null) {
            return "(smart ref:" + referenceNodeConcept.getName() + ") "+ NodePresentationUtil.descriptionText(getParameterNode(),true);
          }
          return "(smart ref:" + NodePresentationUtil.descriptionText(getParameterNode(),true) + ")";
        }
        public SNode createChildNode(        SNode parameterNode,        SModel model,        String pattern){
          SNode childNode=SModelUtil.instantiateConceptDeclaration(referenceNodeConcept,model);
          String referentRole=SModelUtil.getGenuineLinkRole(referenceLink_final);
          childNode.setReferent(referentRole,parameterNode);
          NodeFactoryManager.setupNode(referenceNodeConcept,childNode,currentChild,parentNode,model);
          return childNode;
        }
      }
);
    }
  }
  return actions;
}
