{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      for (      Module module : ModuleManager.getInstance(myProject).getModules()) {
        FacetManager mgr=FacetManager.getInstance(module);
        if (mgr.getFacetByType(MPSFacetType.ID) == null) {
          ModifiableFacetModel modModel=mgr.createModifiableModel();
          MPSFacetType type=MPSFacetType.findInstance(MPSFacetType.class);
          MPSFacet facet=type.createFacet(module,MPSFacetConstants.MPS_FACET_NAME,type.createDefaultConfiguration(),null);
          modModel.addFacet(facet);
          modModel.commit();
        }
      }
    }
  }
);
}
