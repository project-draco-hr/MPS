{
  List<Set<M>> result=new LinkedList<Set<M>>();
  Graph<SModuleDecorator<M>> graph=new Graph<SModuleDecorator<M>>();
  Map<SModule,SModuleDecorator<M>> moduleToDecorator=new LinkedHashMap<SModule,SModuleDecorator<M>>();
  for (  M module : modules) {
    SModuleDecorator<M> decorator=decoratorBuilder.decorate(module);
    moduleToDecorator.put(module,decorator);
    graph.add(decorator);
  }
  for (  SModuleDecorator<M> decorator : graph.getData()) {
    decorator.fill(moduleToDecorator);
  }
  List<List<SModuleDecorator<M>>> cycles=Graphs.findStronglyConnectedComponents(graph);
  for (  List<SModuleDecorator<M>> cycle : cycles) {
    Set<M> mset=new LinkedHashSet<M>();
    result.add(mset);
    for (    SModuleDecorator<M> decorator : cycle) {
      mset.add(decorator.getModule());
    }
  }
  Collections.reverse(result);
  return result;
}
