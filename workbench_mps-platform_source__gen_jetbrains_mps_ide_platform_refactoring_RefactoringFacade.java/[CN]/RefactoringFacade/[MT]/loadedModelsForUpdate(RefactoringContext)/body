{
  final SModelRepository modelRepository=SModelRepository.getInstance();
  Map<SModelReference,Integer> dependencies=context.getStructureModification().getDependencies();
  Set<SModel> result=SetSequence.fromSet(new HashSet<SModel>());
  SetSequence.fromSet(result).addSequence(SetSequence.fromSet(MapSequence.fromMap(dependencies).keySet()).select(new ISelector<SModelReference,SModel>(){
    public SModel select(    SModelReference it){
      return modelRepository.getModelDescriptor(it);
    }
  }
));
  for (  SModel descr : modelRepository.getModelDescriptors()) {
    if (!(SModelStereotype.isUserModel(descr)) || !(descr.isLoaded())) {
      continue;
    }
    if (!(descr instanceof SModelBase)) {
      continue;
    }
    for (    jetbrains.mps.smodel.SModel.ImportElement elem : ListSequence.fromList(SModelOperations.getAllImportElements(((SModelBase)descr).getSModel()))) {
      if (MapSequence.fromMap(dependencies).containsKey(elem.getModelReference())) {
        SetSequence.fromSet(result).addElement(descr);
        break;
      }
    }
  }
  return result;
}
