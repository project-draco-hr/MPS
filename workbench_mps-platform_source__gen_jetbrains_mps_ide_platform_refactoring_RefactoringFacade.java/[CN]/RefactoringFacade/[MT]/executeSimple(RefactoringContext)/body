{
  ThreadUtils.assertEDT();
  final IRefactoring refactoring=context.getRefactoring();
  List<SModel> modelsToGenerate;
  modelsToGenerate=getModelsToGenerate(refactoring,context);
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      try {
        refactoring.refactor(context);
        if (refactoring instanceof ILoggableRefactoring) {
          if (!(context.isLocal())) {
            writeIntoLog(context);
          }
          updateModels(context);
        }
      }
 catch (      Throwable t) {
        myLog.error("An exception occured while trying to execute refactoring " + refactoring.getUserFriendlyName() + ". Models could have been corrupted.",t);
      }
    }
  }
);
  if (context.getDoesGenerateModels()) {
    generateModels(modelsToGenerate,context);
  }
 else {
  }
  try {
    refactoring.doWhenDone(context);
  }
 catch (  Throwable t) {
    myLog.error("An error occurred in doWhenDone(), refactoring: " + refactoring.getUserFriendlyName(),t);
  }
}
