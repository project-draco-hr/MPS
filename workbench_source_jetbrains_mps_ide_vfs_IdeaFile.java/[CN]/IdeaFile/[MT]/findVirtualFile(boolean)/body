{
  if (myVirtualFile != null && !myVirtualFile.isValid()) {
    myPath=myVirtualFile.getPath();
    myVirtualFile=null;
  }
  if (myVirtualFile == null) {
    LocalFileSystem localFileSystem=LocalFileSystem.getInstance();
    if (myPath.contains("!")) {
      int index=myPath.indexOf("!");
      String jarPath=myPath.substring(0,index);
      String entryPath=myPath.substring(index + 1);
      entryPath=entryPath.replaceAll("\\\\","/");
      if (entryPath.startsWith("/")) {
        entryPath=entryPath.substring(1);
      }
      JarFileSystem jarFileSystem=JarFileSystem.getInstance();
      VirtualFile jarFile;
      if (withRefresh) {
        jarFile=localFileSystem.refreshAndFindFileByPath(jarPath);
      }
 else {
        jarFile=localFileSystem.findFileByPath(jarPath);
      }
      if (jarFile != null) {
        VirtualFile jarRootFile=jarFileSystem.getJarRootForLocalFile(jarFile);
        if (jarRootFile != null) {
          myVirtualFile=jarRootFile.findFileByRelativePath(entryPath);
        }
      }
    }
 else {
      if (withRefresh) {
        myVirtualFile=localFileSystem.refreshAndFindFileByPath(myPath);
      }
 else {
        myVirtualFile=localFileSystem.findFileByPath(myPath);
      }
    }
  }
  if (myVirtualFile != null) {
    myPath=null;
  }
  return myVirtualFile != null;
}
