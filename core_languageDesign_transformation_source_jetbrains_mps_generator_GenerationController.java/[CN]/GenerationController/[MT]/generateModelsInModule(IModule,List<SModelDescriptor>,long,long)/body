{
  boolean currentGenerationOK=true;
  IOperationContext invocationContext=myModulesToContexts.get(module);
  setText2("generating in module " + module,totalJob,startJobTime);
  String outputFolder=module != null ? module.getGeneratorOutputPath() : null;
  if (outputFolder != null && !new File(outputFolder).exists()) {
    new File(outputFolder).mkdirs();
    try {
      getProjectHandler().addSourceRoot(outputFolder);
    }
 catch (    Exception e) {
      myMesssages.handle(new Message(MessageKind.WARNING,"Can't add output folder to IDEA as sources"));
    }
  }
  myMesssages.handle(new Message(MessageKind.INFORMATION,"    target root folder: \"" + outputFolder + "\""));
  Statistics.setEnabled(Statistics.TPL,myManager.isDumpStatistics());
  String wasLoggingThreshold=null;
  IGenerationSession generationSession=new GenerationSession(invocationContext,mySaveTransientModels,myProgress,myMesssages);
  try {
    if (myManager.isShowErrorsOnly()) {
      wasLoggingThreshold=Logger.setThreshold("ERROR");
    }
    Logger.addLoggingHandler(generationSession.getLoggingHandler());
    TypeChecker.getInstance().setTypeCheckingMode(TypeCheckingMode.GENERATION);
    for (    SModelDescriptor inputModel : descriptors) {
      if (!myGenerationType.isApplicable(inputModel)) {
        LOG.error("Can't apply generation type " + myGenerationType + " to "+ inputModel.getModelUID());
        continue;
      }
      info("");
      String taskName=ModelsProgressUtil.generationModelTaskName(inputModel);
      setText2(inputModel.getModelUID().toString(),totalJob,startJobTime);
      TaskProgressHelper progress=new TaskProgressHelper(this);
      progress.startLeafTask(taskName,myProgress,totalJob,startJobTime);
      GenerationStatus status=generationSession.generateModel(inputModel);
      currentGenerationOK=currentGenerationOK && status.isOk();
      if (myManager.isDumpStatistics()) {
        Statistics.dumpAll();
      }
      info("handling output...");
      checkMonitorCanceled();
      if (status.getOutputModel() != null) {
        boolean result=myGenerationType.handleOutput(status,outputFolder,invocationContext,myProgress,myMesssages);
        if (!result) {
          info("there were errors.");
          currentGenerationOK=false;
        }
      }
 else       if (!(status.isCanceled() || status.isError())) {
        myGenerationType.handleEmptyOutput(status,outputFolder,invocationContext,myProgress,myMesssages);
      }
      generationSession.discardTransients();
      progress.finishTask();
      setText2("",totalJob,startJobTime);
    }
  }
  finally {
    if (wasLoggingThreshold != null) {
      Logger.setThreshold(wasLoggingThreshold);
    }
    generationSession.discardTransients();
    Logger.removeLoggingHandler(generationSession.getLoggingHandler());
    TypeChecker.getInstance().resetTypeCheckingMode();
    tryToReloadModelsFromDisk();
  }
  checkMonitorCanceled();
  info("");
  setText2("",totalJob,startJobTime);
  return currentGenerationOK;
}
