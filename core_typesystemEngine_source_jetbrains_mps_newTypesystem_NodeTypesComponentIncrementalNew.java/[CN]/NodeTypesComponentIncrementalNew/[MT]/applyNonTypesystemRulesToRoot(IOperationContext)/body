{
  SNode root=myRootNode;
  if (root == null)   return;
  doInvalidateNonTypesystem();
  myIsNonTypesystemCheckingInProgress=true;
  getTypeCheckingContext().setOperationContext(context);
  try {
    Set<SNode> frontier=new LinkedHashSet<SNode>();
    Set<SNode> newFrontier=new LinkedHashSet<SNode>();
    frontier.add(root);
    while (!(frontier.isEmpty())) {
      for (      SNode sNode : frontier) {
        newFrontier.addAll(sNode.getChildren());
        applyNonTypesystemRulesToNode(sNode);
      }
      frontier=newFrontier;
      newFrontier=new LinkedHashSet<SNode>();
    }
  }
  finally {
    getTypeCheckingContext().setOperationContext(null);
    myIsNonTypesystemCheckingInProgress=false;
    myInvalidationWasPerformedNT=false;
  }
}
