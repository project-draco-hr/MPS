{
  SModelReference modelRef=model.getSModelReference();
  List<MPSTreeNode> obsoleteTreeNodes=ListSequence.fromList(new ArrayList<MPSTreeNode>());
synchronized (myFeatureToNodes) {
    for (    Feature f : SetSequence.fromSet(myFeatureToNodes.keySet())) {
      if (!(f instanceof ModelFeature) && modelRef.equals(f.getModelReference())) {
        ListSequence.fromList(obsoleteTreeNodes).addSequence(Sequence.fromIterable(myFeatureToNodes.get(f)));
        myFeatureToNodes.remove(f);
      }
    }
  }
  ListSequence.fromList(obsoleteTreeNodes).visitAll(new IVisitor<MPSTreeNode>(){
    public void visit(    MPSTreeNode tn){
      unhighlightNode(tn);
    }
  }
);
}
