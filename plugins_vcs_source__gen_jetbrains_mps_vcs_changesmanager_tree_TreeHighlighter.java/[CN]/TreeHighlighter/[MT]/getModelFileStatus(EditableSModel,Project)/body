{
  DataSource ds=ed.getSource();
  IFile file=null;
  if (ds instanceof FileDataSource) {
    file=((FileDataSource)ds).getFile();
  }
 else   if (ds instanceof FilePerRootDataSource) {
    file=((FilePerRootDataSource)ds).getFile(FilePerRootDataSource.HEADER_FILE);
  }
  if (!(file instanceof IdeaFile)) {
    if (LOG.isEnabledFor(Level.WARN)) {
      LOG.warn("File " + file + " must be a project file and managed by IDEA FS");
    }
    return null;
  }
  VirtualFile vf=((IdeaFile)file).getVirtualFile();
  return (vf == null ? null : FileStatusManager.getInstance(project).getStatus(vf));
}
