{
  InputStream in=null;
  try {
    in=file.openInputStream();
    InputSource source=new InputSource(new InputStreamReader(in,"UTF-8"));
    return readModel(header,source,state);
  }
 catch (  Throwable t) {
    SModelReference ref=header.getModelReference();
    if (ref == null) {
      ref=SModelReference.fromPath(file.getPath());
    }
    LOG.error("Error while loading model from file: " + file.getPath(),t);
    StubModel model=new StubModel(ref);
    return new ModelLoadResult(model,ModelLoadingState.NOT_LOADED);
  }
 finally {
    if (in != null) {
      try {
        in.close();
      }
 catch (      IOException e) {
        LOG.error(e);
      }
    }
  }
}
