{
  String modelName=extractModelName(file.getName());
  String modelStereotype=extractModelStereotype(file.getName());
  Document document=loadModelDocument(file);
  int modelPersistenceVersion=getModelPersistenceVersion(document);
  IModelReader reader=modelReaders.get(modelPersistenceVersion);
  if (reader == null) {
    return handleNullReaderForPersistence(" file " + file.getPath());
  }
  SModel model=reader.readModel(document,modelName,modelStereotype);
  if (needsUpgradeCondition.met(modelPersistenceVersion)) {
    model=upgradeModelPersistence(model,modelPersistenceVersion,toVersion);
    document=saveModel(model,false);
    try {
      JDOMUtil.writeDocument(document,file);
    }
 catch (    IOException e) {
      LOG.error("error while saving model after persistence upgrade " + model.getSModelReference(),e);
    }
  }
 else {
    model.setPersistenceVersion(modelPersistenceVersion);
  }
  return model;
}
