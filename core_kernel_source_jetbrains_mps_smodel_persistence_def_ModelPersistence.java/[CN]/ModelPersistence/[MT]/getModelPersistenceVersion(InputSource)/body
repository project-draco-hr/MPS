{
  final int[] version=new int[]{-1};
  try {
    SAXParser parser=JDOMUtil.createSAXParser();
    parser.parse(source,new DefaultHandler(){
      public void startElement(      String uri,      String localName,      String qName,      Attributes attributes) throws SAXException {
        if (version[0] == -1 && MODEL.equals(qName)) {
          version[0]=0;
        }
 else         if (version[0] == 0 && PERSISTENCE.equals(qName)) {
          String s=attributes.getValue(PERSISTENCE_VERSION);
          if (s != null) {
            try {
              version[0]=Integer.parseInt(s);
            }
 catch (            NumberFormatException ex) {
            }
          }
        }
 else {
          throw new BreakParseSAXException();
        }
      }
      public void endElement(      String uri,      String localName,      String qName) throws SAXException {
        throw new BreakParseSAXException();
      }
    }
);
  }
 catch (  SAXException ex) {
  }
catch (  ParserConfigurationException e) {
  }
catch (  IOException e) {
  }
  return version[0] == -1 ? getCurrentPersistenceVersion() : version[0];
}
