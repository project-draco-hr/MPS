{
  LOG.debug("ModelPersistence readModel from :" + file.getAbsolutePath());
  String fileName=file.getName();
  int index=fileName.indexOf('.');
  String rawModelName=(index >= 0) ? fileName.substring(0,index) : fileName;
  String modelName=rawModelName;
  int index1=rawModelName.indexOf("@");
  String modelStereotype="";
  if (index1 >= 0) {
    modelName=rawModelName.substring(0,index1);
    modelStereotype=rawModelName.substring(index1 + 1);
  }
  Document document=loadModelDocument(file);
  int modelPersistenceVersion=getModelPersistenceVersion(document);
  SModel model=modelReaders.get(modelPersistenceVersion).readModel(document,modelName,modelStereotype);
  if (modelPersistenceVersion < currentPersistenceVersion) {
    model=upgradeModelPersistence(model,modelPersistenceVersion);
    document=saveModel(model,false);
    try {
      JDOMUtil.writeDocument(document,file);
    }
 catch (    IOException e) {
      LOG.error("error while saving model after persistence upgrade " + model.getSModelReference(),e);
    }
  }
  return model;
}
