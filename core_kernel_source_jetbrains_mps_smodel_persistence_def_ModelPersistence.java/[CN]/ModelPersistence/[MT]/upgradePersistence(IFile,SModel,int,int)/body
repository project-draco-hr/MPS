{
  if (fromVersion < 5 && toVersion >= 5) {
    StructureModificationHistory refactorings=model.getRefactoringHistory();
    if (refactorings != null && !refactorings.getDataList().isEmpty()) {
      RefactoringsPersistence.save(file,refactorings);
    }
    model.setRefactoringHistory(null);
  }
  model.setPersistenceVersion(toVersion);
  Document document=saveModel(model,toVersion);
  try {
    JDOMUtil.writeDocument(document,file);
  }
 catch (  IOException e) {
    LOG.error("error while saving model after persistence upgrade " + model.getSModelReference(),e);
  }
  LOG.info("persistence upgraded: " + fromVersion + "->"+ toVersion+ " "+ model.getSModelReference());
}
