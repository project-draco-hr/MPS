{
  SModelUID uid=model.getUID();
  int version=fromVersion;
  IFile file=fileArray[0];
  while (version < currentPersistenceVersion) {
    IModelWriter writer=modelWriters.get(++version);
    Document document=writer.saveModel(model,false);
    file=writer.upgradeFile(file);
    model.dispose();
    model=modelReaders.get(version).readModel(document,uid.getShortName(),uid.getStereotype());
  }
  LOG.info("persistence upgraded: " + fromVersion + "->"+ currentPersistenceVersion+ " "+ uid);
  fileArray[0]=file;
  return model;
}
