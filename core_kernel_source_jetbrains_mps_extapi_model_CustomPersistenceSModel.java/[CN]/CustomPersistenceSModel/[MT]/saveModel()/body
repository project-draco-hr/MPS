{
  SModel smodel=getSModelInternal();
  if (smodel instanceof InvalidSModel) {
    return false;
  }
  try {
    myPersistence.writeModel(smodel,getSource());
    IFile brokenFile=getBackupFile(true);
    if (brokenFile != null) {
      brokenFile.delete();
    }
    myProblems=Collections.emptySet();
  }
 catch (  ModelSaveException e) {
    IFile brokenFile=getBackupFile(false);
    try {
      PersistenceFacade.getInstance().getDefaultModelFactory().save(this,new FileDataSource(brokenFile,null));
    }
 catch (    ModelSaveException ignore) {
    }
catch (    IOException ignore) {
    }
    myProblems=e.getProblems();
    throw e;
  }
  return false;
}
