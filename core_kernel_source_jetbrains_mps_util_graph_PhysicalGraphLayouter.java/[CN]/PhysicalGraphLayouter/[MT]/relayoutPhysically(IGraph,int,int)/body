{
  Map<IVertex,Pair<Double,Double>> forces=new HashMap<IVertex,Pair<Double,Double>>();
  Set<IVertex> vertices=graph.getVertices();
  final double ELECTRICITY_CONST=getCulonConst();
  final double IDLE_CONST=getIdleLength();
  final double TENSION=getTensionConst();
  final double FORCE=getCurrentForceFactor();
  for (  IVertex vertex : vertices) {
    forces.put(vertex,new Pair<Double,Double>(0.0,0.0));
  }
  for (  IEdge edge : graph.getEdges()) {
    IVertex vertex1=edge.getFirst();
    IVertex vertex2=edge.getSecond();
    double dist=distance(vertex1,vertex2);
    double rawTension=(dist - IDLE_CONST) * TENSION;
    double tension=rawTension;
    double forcex=((vertex2.getX() - vertex1.getX()) / dist) * tension;
    double forcey=((vertex2.getY() - vertex1.getY()) / dist) * tension;
    Pair<Double,Double> force1=forces.get(vertex1);
    Pair<Double,Double> force2=forces.get(vertex2);
    force1.o1=force1.o1 + forcex;
    force1.o2=force1.o2 + forcey;
    force2.o1=force2.o1 - forcex;
    force2.o2=force2.o2 - forcey;
  }
  List<IVertex> verticesList=new ArrayList<IVertex>(vertices);
  for (int i=0; i < verticesList.size() - 1; i++) {
    for (int j=i + 1; j < verticesList.size(); j++) {
      IVertex vertex1=verticesList.get(i);
      IVertex vertex2=verticesList.get(j);
      double dist=distance(vertex1,vertex2);
      double culon=ELECTRICITY_CONST / (dist * dist * dist* Math.signum(dist));
      double forcex=((vertex2.getX() - vertex1.getX()) / dist) * culon;
      double forcey=((vertex2.getY() - vertex1.getY()) / dist) * culon;
      Pair<Double,Double> force1=forces.get(vertex1);
      Pair<Double,Double> force2=forces.get(vertex2);
      force1.o1=force1.o1 - forcex;
      force1.o2=force1.o2 - forcey;
      force2.o1=force2.o1 + forcex;
      force2.o2=force2.o2 + forcey;
    }
  }
  for (  IVertex vertex : vertices) {
    double x=vertex.getX();
    double y=vertex.getY();
    Pair<Double,Double> force=forces.get(vertex);
    double deltax=force.o1 * FORCE;
    double deltay=force.o2 * FORCE;
    vertex.trySetCoords(x + deltax,y + deltay);
  }
  setBaricenter(graph,baricenterx,baricentery);
}
