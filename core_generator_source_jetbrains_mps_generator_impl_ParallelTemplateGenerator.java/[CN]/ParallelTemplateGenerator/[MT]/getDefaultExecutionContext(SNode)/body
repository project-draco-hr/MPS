{
  if (ROOT_PER_THREAD) {
    if (inputNode == null || !inputNode.isRegistered()) {
      return super.getDefaultExecutionContext(null);
    }
    inputNode=inputNode.getTopmostAncestor();
    if (inputNode.getModel() == getInputModel()) {
      RootBasedQueryExectionContext context;
      if (myRootContext == null) {
        myRootContext=new HashMap<SNode,RootBasedQueryExectionContext>();
        context=null;
      }
 else {
        context=myRootContext.get(inputNode);
      }
      if (context == null) {
        context=new RootBasedQueryExectionContext(inputNode,this);
        myRootContext.put(inputNode,context);
      }
      return context;
    }
  }
  return super.getDefaultExecutionContext(inputNode);
}
