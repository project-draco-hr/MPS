{
  MacroHelper macroHelper=MacrosFactory.forModuleFile(sourcesDescriptorFile);
  String canonicalPath=FileUtil.getCanonicalPath(originalPath).toLowerCase();
  String suffix=descriptor.getCompileInMPS() ? CLASSES_GEN : CLASSES;
  if (canonicalPath.endsWith(suffix)) {
    String classes=macroHelper.expandPath("${module}/" + suffix);
    if (FileUtil.getCanonicalPath(classes).equalsIgnoreCase(canonicalPath)) {
      return bundleHome.getPath();
    }
  }
 else   if (FileUtil.getCanonicalPath(bundleHome.getPath()).equalsIgnoreCase(canonicalPath)) {
    return bundleHome.getPath();
  }
  String mpsHomeLibPath=FileUtil.getCanonicalPath(PathManager.getHomePath() + File.separator + "lib").toLowerCase();
  if (canonicalPath.startsWith(mpsHomeLibPath)) {
    return canonicalPath;
  }
  if (MacrosFactory.containsNonMPSMacros(macroHelper.shrinkPath(originalPath))) {
    return originalPath;
  }
 else {
    return null;
  }
}
