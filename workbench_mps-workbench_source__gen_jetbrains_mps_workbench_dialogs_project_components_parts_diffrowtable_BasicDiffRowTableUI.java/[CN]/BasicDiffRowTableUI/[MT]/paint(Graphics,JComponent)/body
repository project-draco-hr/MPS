{
  Rectangle oldClipBounds=g.getClipBounds();
  Rectangle clipBounds=new Rectangle(oldClipBounds);
  int tableWidth=table.getColumnModel().getTotalColumnWidth();
  clipBounds.width=Math.min(clipBounds.width,tableWidth);
  g.setClip(clipBounds);
  paintGrid(g);
  int firstIndex=table.rowAtPoint(new Point(0,clipBounds.y));
  int lastIndex=lastVisibleRow(clipBounds);
  int rowMargin=table.getRowMargin();
  Rectangle rowRect=new Rectangle(0,0,tableWidth,((DiffRowTable)table).getRowHeight(firstIndex) + rowMargin);
  rowRect.y=0;
  for (int i=0; i < firstIndex; i++) {
    rowRect.y+=((DiffRowTable)table).getRowHeight(i) + rowMargin;
  }
  for (int index=firstIndex; index <= lastIndex; index++) {
    if (rowRect.intersects(clipBounds)) {
      paintRow(g,index);
    }
    rowRect.y+=((DiffRowTable)table).getRowHeight(index) + rowMargin;
  }
  g.setClip(oldClipBounds);
}
