{
  boolean canSubstitute=action.canSubstitute(pattern);
  if (canSubstitute) {
    return CAN_SUBSTITUTE_VIA_PATTERN;
  }
 else {
    if (pattern == null || pattern.isEmpty()) {
      return CANT_SUBSTITUTE;
    }
    String matchingText=action.getMatchingText(pattern);
    if (matchingText == null || matchingText.isEmpty()) {
      return CANT_SUBSTITUTE;
    }
    if (action.canSubstitute(matchingText) && matchingText.toLowerCase().contains(pattern.toLowerCase())) {
      return CAN_SUBSTITUTE_VIA_SEARCH;
    }
    return CANT_SUBSTITUTE;
  }
}
