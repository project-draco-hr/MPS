{
  boolean canSubstitute=action.canSubstitute(pattern);
  if (canSubstitute) {
    return CAN_SUBSTITUTE_VIA_PATTERN;
  }
 else {
    if (pattern.isEmpty() || pattern == null) {
      return CANT_SUBSTITUTE;
    }
    String visibleMatchingText=action.getVisibleMatchingText(pattern);
    if (visibleMatchingText == null || visibleMatchingText.isEmpty()) {
      return CANT_SUBSTITUTE;
    }
    String matchingText=action.getMatchingText(pattern);
    if (action.canSubstitute(matchingText) && visibleMatchingText.toLowerCase().contains(pattern.toLowerCase())) {
      return CAN_SUBSTITUTE_VIA_SEARCH;
    }
    return CANT_SUBSTITUTE;
  }
}
