{
  String visibleMatchingText=action.getVisibleMatchingText(pattern);
  if (pattern == null || visibleMatchingText == null) {
    return visibleMatchingText;
  }
  List<Integer> indexes=getIndexes(action,pattern,visibleMatchingText);
  if (indexes.isEmpty()) {
    return visibleMatchingText;
  }
  StringBuilder builder=new StringBuilder("<html>");
  int next=0;
  int curIndex=indexes.get(next);
  boolean isColored=false;
  for (int i=0; i < visibleMatchingText.length(); i++) {
    if (i == curIndex && !isColored) {
      builder.append("<font color='");
      builder.append(color);
      builder.append("'>");
      isColored=true;
    }
    if (isColored) {
      next++;
    }
    char c=visibleMatchingText.charAt(i);
    if (c == '<') {
      builder.append("&lt;");
    }
 else     if (c == '>') {
      builder.append("&gt;");
    }
 else     if (c == ' ') {
      builder.append("&nbsp;");
    }
 else {
      builder.append(c);
    }
    if (next < indexes.size()) {
      curIndex=indexes.get(next);
    }
    if (next >= indexes.size() || curIndex > i + 1) {
      builder.append("</font>");
      isColored=false;
    }
  }
  return builder.toString();
}
