{
  if (model != null && !(model instanceof jetbrains.mps.smodel.SModel.FakeModelDescriptor)) {
    return;
  }
  IModule module=null;
  if (mergeResultModel) {
    SModel mdInRepo=SModelRepository.getInstance().getModelDescriptor(model.getReference());
    if (mdInRepo != null) {
      module=mdInRepo.getModule();
    }
  }
  if (module == null) {
    module=new DiffTemporaryModule(model,version,project);
  }
  ((SModelInternal)model).setModelDescriptor(new DiffTemporaryModule.DiffSModelDescriptor(module,(jetbrains.mps.smodel.SModel)model,mergeResultModel));
}
