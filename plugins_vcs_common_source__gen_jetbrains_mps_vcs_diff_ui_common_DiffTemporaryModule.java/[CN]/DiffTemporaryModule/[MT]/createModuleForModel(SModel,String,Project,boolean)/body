{
  if (model.getModelDescriptor() != null) {
    return;
  }
  IModule module=null;
  if (mergeResultModel) {
    SModel mdInRepo=SModelRepository.getInstance().getModelDescriptor(model.getReference());
    if (mdInRepo != null) {
      module=mdInRepo.getModule();
    }
  }
  if (module == null) {
    module=new DiffTemporaryModule(model,version,project);
  }
  jetbrains.mps.smodel.SModel m=(jetbrains.mps.smodel.SModel)model;
  m.setModelDescriptor(new DiffTemporaryModule.DiffSModelDescriptor(module,m,mergeResultModel));
}
