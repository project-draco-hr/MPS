{
  return new IJob.Stub(){
    @Override public IResult execute(    final Iterable<IResource> rawInput,    final IJobMonitor monitor,    final IPropertiesAccessor pa,    @NotNull final ProgressMonitor progressMonitor){
      final Wrappers._T<Iterable<IResource>> _output_kp7j54_a0a=new Wrappers._T<Iterable<IResource>>(null);
      final Iterable<IMResource> input=(Iterable<IMResource>)(Iterable)rawInput;
switch (0) {
case 0:
        final Wrappers._T<List<SModel>> models=new Wrappers._T<List<SModel>>();
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          models.value=Sequence.fromIterable(input).where(new IWhereFilter<IMResource>(){
            public boolean accept(            IMResource it){
              return ((MResource)it).module() instanceof Language;
            }
          }
).translate(new ITranslator2<IMResource,SModel>(){
            public Iterable<SModel> translate(            IMResource it){
              return ((MResource)it).models();
            }
          }
).where(new IWhereFilter<SModel>(){
            public boolean accept(            SModel it){
              return ListSequence.fromList(SModelOperations.getRoots(((SModel)it),"jetbrains.mps.core.structure.structure.SStructureContainer")).isNotEmpty();
            }
          }
).toListSequence();
        }
      }
);
    if (ListSequence.fromList(models.value).isEmpty()) {
      return new IResult.SUCCESS(_output_kp7j54_a0a.value);
    }
  final IMessageHandler mh=new IMessageHandler(){
    public void handle(    IMessage msg){
      monitor.reportFeedback(new IFeedback.MESSAGE(msg));
    }
    public void clear(){
    }
  }
;
final List<LanguageModelsMerger> generated=ListSequence.fromList(new ArrayList<LanguageModelsMerger>());
IGenerationHandler gh=new MakeGenerationHandler(new _FunctionTypes._return_P1_E0<Boolean,GResource>(){
public Boolean invoke(GResource data){
  monitor.currentProgress().advanceWork("Transforming",100);
  monitor.reportFeedback(new IFeedback.MESSAGE(new Message(MessageKind.INFORMATION,"Generated " + SNodeOperations.getModelLongName(data.model()))));
  ListSequence.fromList(generated).addElement(new LanguageModelsMerger((Language)data.module(),data.status().getOutputModel(),mh));
  return true;
}
}
);
monitor.reportFeedback(new IFeedback.MESSAGE(new Message(MessageKind.INFORMATION,"Transforming core language descriptors..")));
monitor.currentProgress().beginWork("Transforming",ListSequence.fromList(models.value).count() * 100,monitor.currentProgress().workLeft());
Object tmc=null;
try {
Class<?> tmcCls=Class.forName("jetbrains.mps.ide.generator.TransientModelsComponent");
tmc=Target_checkParameters.vars(pa.global()).project().getComponent(tmcCls);
}
 catch (ClassNotFoundException ignore) {
}
final TransientModelsProvider transModels=(tmc != null ? (TransientModelsProvider)tmc : new TransientModelsProvider(Target_checkParameters.vars(pa.global()).project(),null));
GenerationOptions options=Target_configure.vars(pa.global()).generationOptions().create();
final GenerationOptions.OptionsBuilder builder=GenerationOptions.getDefaults().keepOutputModel(true).strictMode(options.isStrictMode()).reporting(options.isShowInfo(),options.isShowWarnings(),options.isKeepModelsWithWarnings(),options.getNumberOfModelsToKeep()).saveTransientModels(options.isSaveTransientModels());
ModelAccess.instance().runReadAction(new Runnable(){
public void run(){
for (SModel m : ListSequence.fromList(models.value)) {
builder.customPlan(m,TransformGenerationPlan.forLanguages("jetbrains.mps.core.gen.transform"));
}
}
}
);
options=builder.create();
boolean generationOk=GenerationFacade.generateModels(Target_checkParameters.vars(pa.global()).project(),models.value,Target_checkParameters.vars(pa.global()).operationContext(),gh,new EmptyProgressMonitor(),mh,options,transModels);
if (ListSequence.fromList(generated).isNotEmpty()) {
ModelAccess.instance().runReadAction(new Runnable(){
public void run(){
ListSequence.fromList(generated).visitAll(new IVisitor<LanguageModelsMerger>(){
public void visit(LanguageModelsMerger it){
it.convert();
}
}
);
}
}
);
ModelAccess.instance().runWriteAction(new Runnable(){
public void run(){
ListSequence.fromList(generated).visitAll(new IVisitor<LanguageModelsMerger>(){
public void visit(LanguageModelsMerger it){
it.apply();
}
}
);
}
}
);
ListSequence.fromList(generated).visitAll(new IVisitor<LanguageModelsMerger>(){
public void visit(LanguageModelsMerger it){
_output_kp7j54_a0a.value=Sequence.fromIterable(_output_kp7j54_a0a.value).concat(Sequence.fromIterable(Sequence.<IResource>singleton(new MResource(it.getLanguage(),it.getGenerated()))));
}
}
);
}
monitor.currentProgress().finishWork("Transforming");
if (!(generationOk)) {
return new IResult.FAILURE(_output_kp7j54_a0a.value);
}
default :
return new IResult.SUCCESS(_output_kp7j54_a0a.value);
}
}
}
;
}
