{
  final MacroHelper macroHelper=MacrosFactory.forProjectFile(file);
  Element project=new Element("project");
  Element projectModules=new Element("projectModules");
  for (  Path path : Sequence.fromIterable(((Iterable<Path>)descriptor.getModules())).sort(new ISelector<Path,String>(){
    public String select(    Path p){
      return macroHelper.shrinkPath(p.getPath());
    }
  }
,true)) {
    XmlUtil.tagWithAttributes(projectModules,"modulePath","path",macroHelper.shrinkPath(path.getPath()).replace("${project}","$PROJECT_DIR$"),"folder",(path.getMPSFolder() != null ? path.getMPSFolder() : ""));
  }
  project.addContent(projectModules);
  return project;
}
