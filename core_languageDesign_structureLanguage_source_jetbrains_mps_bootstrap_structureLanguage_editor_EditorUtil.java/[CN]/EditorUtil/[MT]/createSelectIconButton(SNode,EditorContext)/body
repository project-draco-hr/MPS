{
  final ConceptDeclaration conceptDeclaration=(ConceptDeclaration)BaseAdapter.fromNode(sourceNode);
  final String path=conceptDeclaration.getIconPath();
  final Language language=SModelUtil_new.getDeclaringLanguage(conceptDeclaration,context.getScope());
  String filename=language == null ? null : Macros.languageDescriptor().expandPath(path,language.getDescriptorFile());
  final File baseFile=filename == null ? null : new File(filename);
  final JButton button=new JButton();
  button.setAction(new AbstractAction("..."){
    public void actionPerformed(    ActionEvent e){
      if (UseTreeFileChooser.get()) {
        IFile initialFile=null;
        if (baseFile != null && baseFile.exists()) {
          initialFile=new FileSystemFile(baseFile);
        }
        TreeFileChooser chooser=new TreeFileChooser(TreeFileChooser.MODE_FILES,TreeFileChooser.ALL_FILES_FILTER,initialFile,context.getOperationContext());
        Component root=SwingUtilities.getRoot(button);
        if (chooser.getResult() == null)         return;
        String selectedPath=FileUtil.getCanonicalPath(chooser.getResult().toFile());
        final String pathToShow=Macros.languageDescriptor().shrinkPath(selectedPath,language.getDescriptorFile());
        new CommandRunnable(){
          protected Object onRun(){
            conceptDeclaration.setIconPath(pathToShow);
            return null;
          }
        }
.run();
      }
 else {
        final JFileChooser chooser=new SmartFileChooser();
        if (baseFile != null && baseFile.exists()) {
          chooser.setSelectedFile(baseFile);
        }
        Component root=SwingUtilities.getRoot(button);
        JFrame frame=root instanceof JFrame ? (JFrame)root : null;
        if (chooser.showDialog(frame,"Select") != JFileChooser.APPROVE_OPTION)         return;
        String selectedPath=FileUtil.getCanonicalPath(chooser.getSelectedFile());
        final String pathToShow=Macros.languageDescriptor().shrinkPath(selectedPath,language.getDescriptorFile());
        new CommandRunnable(){
          protected Object onRun(){
            conceptDeclaration.setIconPath(pathToShow);
            return null;
          }
        }
.run();
      }
    }
  }
);
  return button;
}
