{
  if (SNodeOperations.isAttribute(n)) {
    if (SNodeOperations.isInstanceOf(n,MetaAdapterFactory.getConcept(new UUID(-3554657779850784990l,-7236703803128771572l),3364660638048049748l,"jetbrains.mps.lang.core.structure.NodeAttribute"))) {
      SNode next=SNodeOperations.getPrevSibling(n);
      while (next != null) {
        if (SNodeOperations.isInstanceOf(next,MetaAdapterFactory.getConcept(new UUID(-3554657779850784990l,-7236703803128771572l),3364660638048049748l,"jetbrains.mps.lang.core.structure.NodeAttribute"))) {
          return next;
        }
        next=SNodeOperations.getPrevSibling(next);
      }
      n=SNodeOperations.getParent(n);
      return (n == null ? null : SNodeOperations.getParent(n));
    }
    return SNodeOperations.getParent(n);
  }
  SNode lastAttr=ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(n,MetaAdapterFactory.getConcept(new UUID(-3554657779850784990l,-7236703803128771572l),1133920641626l,"jetbrains.mps.lang.core.structure.BaseConcept")),MetaAdapterFactory.getContainmentLink(new UUID(-3554657779850784990l,-7236703803128771572l),1133920641626l,5169995583184591170l,"smodelAttribute"))).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return SNodeOperations.isInstanceOf(it,MetaAdapterFactory.getConcept(new UUID(-3554657779850784990l,-7236703803128771572l),3364660638048049748l,"jetbrains.mps.lang.core.structure.NodeAttribute"));
    }
  }
).last();
  if ((lastAttr != null)) {
    return lastAttr;
  }
  return SNodeOperations.getParent(n);
}
