{
  final int length=HashUtil.adjustTableLength((int)(capacity / loadFactor));
  this.capacity=capacity;
  if (length != table.length) {
    final Iterator<Entry<E>> entries=new HashSetIterator<Entry<E>>(){
      public Entry<E> next(){
        return nextEntry();
      }
    }
;
    allocateTable(length);
    final Entry<E>[] table=this.table;
    final int shift=this.shift;
    final int mask=this.mask;
    while (entries.hasNext()) {
      final Entry<E> e=entries.next();
      final int index=HashUtil.indexFor(e.keyHash,length,shift,mask);
      e.hashNext=table[index];
      table[index]=e;
    }
  }
}
