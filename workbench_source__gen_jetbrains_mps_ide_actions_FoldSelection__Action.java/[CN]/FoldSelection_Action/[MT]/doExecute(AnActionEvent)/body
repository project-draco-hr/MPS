{
  try {
    EditorCell_Collection collectionCell=(FoldSelection_Action.this.editorCell instanceof EditorCell_Collection ? (EditorCell_Collection)FoldSelection_Action.this.editorCell : FoldSelection_Action.this.editorCell.getParent());
    while (collectionCell != null) {
      if (collectionCell.isFolded()) {
        collectionCell.unfold();
        FoldSelection_Action.this.editorContext.getNodeEditorComponent().clearSelectionStack();
        EditorCell editorCellToSelect=collectionCell.getFirstDescendant(CellConditions.SELECTABLE);
        if (editorCellToSelect != null) {
          FoldSelection_Action.this.editorContext.getNodeEditorComponent().changeSelection(editorCellToSelect);
          editorCellToSelect.home();
        }
        return;
      }
      if (collectionCell.canBePossiblyFolded()) {
        collectionCell.fold();
        FoldSelection_Action.this.editorContext.getNodeEditorComponent().clearSelectionStack();
        EditorCell editorCellToSelect=collectionCell.getFirstDescendant(CellConditions.SELECTABLE);
        if (editorCellToSelect != null) {
          FoldSelection_Action.this.editorContext.getNodeEditorComponent().changeSelection(editorCellToSelect);
          editorCellToSelect.home();
        }
        return;
      }
      collectionCell=collectionCell.getParent();
    }
  }
 catch (  Throwable t) {
    if (log.isErrorEnabled()) {
      log.error("User's action execute method failed. Action:" + "FoldSelection",t);
    }
  }
}
