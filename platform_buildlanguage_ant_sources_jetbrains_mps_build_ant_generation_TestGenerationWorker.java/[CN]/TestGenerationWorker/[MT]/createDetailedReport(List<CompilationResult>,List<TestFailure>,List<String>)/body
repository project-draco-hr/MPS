{
  StringBuffer sb=new StringBuffer();
  if (myMessageHandler.getGenerationErrors().size() > 0) {
    sb.append("Generation errors:");
    sb.append(myBuildServerMessageFormat.getLinesSeparator());
    for (    String e : myMessageHandler.getGenerationErrors()) {
      sb.append("  ");
      sb.append(myBuildServerMessageFormat.escapeBuildMessage(e));
      sb.append(myBuildServerMessageFormat.getLinesSeparator());
    }
    sb.append(myBuildServerMessageFormat.getLinesSeparator());
  }
  boolean headerPrinted=false;
  for (  CompilationResult r : compilationResult) {
    if (r.getErrors() != null && r.getErrors().length > 0) {
      if (!headerPrinted) {
        sb.append("Compilation problems:");
        sb.append(myBuildServerMessageFormat.getLinesSeparator());
        headerPrinted=true;
      }
      for (      CategorizedProblem p : r.getErrors()) {
        sb.append("  ");
        sb.append(myBuildServerMessageFormat.escapeBuildMessage(new String(r.getCompilationUnit().getFileName())));
        sb.append(" (");
        sb.append(p.getSourceLineNumber());
        sb.append("): ");
        sb.append(myBuildServerMessageFormat.escapeBuildMessage(p.getMessage()));
        sb.append(myBuildServerMessageFormat.getLinesSeparator());
      }
    }
  }
  if (headerPrinted) {
    sb.append(myBuildServerMessageFormat.getLinesSeparator());
  }
  if (testFailures.size() > 0) {
    sb.append("Test Failures:");
    sb.append(myBuildServerMessageFormat.getLinesSeparator());
    for (    TestFailure failure : testFailures) {
      sb.append("  ");
      StringWriter writer=new StringWriter();
      failure.thrownException().printStackTrace(new PrintWriter(writer));
      StringBuffer buffer=writer.getBuffer();
      sb.append(myBuildServerMessageFormat.escapeBuildMessage(writer.getBuffer()));
      sb.append(myBuildServerMessageFormat.getLinesSeparator());
    }
    sb.append(myBuildServerMessageFormat.getLinesSeparator());
  }
  if (Boolean.parseBoolean(myWhatToDo.getProperty(TestGenerationOnTeamcity.SHOW_DIFF))) {
    if (diffReports.size() > 0) {
      sb.append("Difference:");
      sb.append(myBuildServerMessageFormat.getLinesSeparator());
      for (      String diffReport : diffReports) {
        sb.append("  ");
        sb.append(myBuildServerMessageFormat.escapeBuildMessage(diffReport));
        sb.append(myBuildServerMessageFormat.getLinesSeparator());
      }
      sb.append(myBuildServerMessageFormat.getLinesSeparator());
    }
  }
  return sb;
}
