{
  TableColumnModel columnModel=table.getColumnModel();
  for (int i=0; i < columnModel.getColumnCount(); i++) {
    columnModel.getColumn(i).setHeaderRenderer(new TableCellRenderer(){
      public Component getTableCellRendererComponent(      JTable table,      Object value,      boolean isSelected,      boolean hasFocus,      int row,      int column){
        Component c=table.getTableHeader().getDefaultRenderer().getTableCellRendererComponent(table,value,isSelected,hasFocus,row,column);
        column=table.convertColumnIndexToModel(column);
        if (mySortedColumn == column) {
          if (mySortingOrder == ASC)           ((JLabel)c).setIcon(new MyDownIcon(7));
 else           if (mySortingOrder == DESC)           ((JLabel)c).setIcon(new MyUpIcon(8));
 else           ((JLabel)c).setIcon(null);
        }
 else {
          ((JLabel)c).setIcon(null);
        }
        return c;
      }
    }
);
  }
  final JTableHeader header=table.getTableHeader();
  header.addMouseListener(new MouseAdapter(){
    public void mouseClicked(    MouseEvent e){
      int col=header.columnAtPoint(e.getPoint());
      col=header.getTable().convertColumnIndexToModel(col);
      if (col == 0)       return;
      int sortingOrder=ASC;
      if (mySortedColumn == col) {
        if (mySortingOrder == NONE)         sortingOrder=ASC;
        if (mySortingOrder == ASC)         sortingOrder=DESC;
        if (mySortingOrder == DESC)         sortingOrder=NONE;
      }
 else {
        if (mySortingOrder == NONE)         sortingOrder=ASC;
 else         sortingOrder=mySortingOrder;
      }
      int[] selectedRows=table.getSelectedRows();
      for (int i=0; i < selectedRows.length; i++) {
        selectedRows[i]=convertRowIndexToModel(selectedRows[i]);
      }
      MySortingTableModel.this.sort(col,sortingOrder);
      for (      int selectedRow : selectedRows) {
        selectedRow=convertRowIndexToView(selectedRow);
        table.addRowSelectionInterval(selectedRow,selectedRow);
      }
    }
  }
);
}
