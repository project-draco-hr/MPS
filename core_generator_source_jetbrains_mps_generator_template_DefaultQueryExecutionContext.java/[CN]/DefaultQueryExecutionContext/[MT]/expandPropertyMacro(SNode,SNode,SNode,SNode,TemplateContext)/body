{
  try {
    final SNodeReference qr=propertyMacro.getReference();
    PropertyValueQuery q=myGenerator.getGeneratorSessionContext().getQueryProvider(qr).getPropertyValueQuery(propertyMacro);
    final Object tv=q.getTemplateValue();
    Object macroValue=q.evaluate(new PropertyMacroContext(context,tv == null ? null : String.valueOf(tv),qr,myGenerator));
    String propertyValue=macroValue == null ? null : String.valueOf(macroValue);
    SNodeAccessUtil.setProperty(outputNode,q.getPropertyName(),propertyValue);
  }
 catch (  GenerationFailureException ex) {
    throw ex;
  }
catch (  Throwable t) {
    getLog().handleException(t);
    getLog().error(propertyMacro.getReference(),"cannot evaluate property macro, exception was thrown",GeneratorUtil.describeInput(context));
    throw new GenerationFailureException(t);
  }
}
