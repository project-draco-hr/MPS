{
  try {
    final SNodeReference qr=propertyMacro.getReference();
    PropertyValueQuery pvq=myPropertyQueries.get(qr);
    if (pvq == null) {
      pvq=myGenerator.getGeneratorSessionContext().getQueryProvider(qr).getPropertyValueQuery(propertyMacro);
      myPropertyQueries.put(qr,pvq);
    }
    final Object templateValue=pvq.getTemplateValue();
    Object macroValue=pvq.evaluate(new PropertyMacroContext(context,templateValue == null ? null : String.valueOf(templateValue),qr,myGenerator));
    String propertyValue=macroValue == null ? null : String.valueOf(macroValue);
    SNodeAccessUtil.setProperty(outputNode,pvq.getPropertyName(),propertyValue);
  }
 catch (  GenerationFailureException ex) {
    throw ex;
  }
catch (  Throwable t) {
    getLog().handleException(t);
    getLog().error(propertyMacro.getReference(),"cannot evaluate property macro, exception was thrown",GeneratorUtil.describeInput(context));
    throw new GenerationFailureException(t);
  }
}
