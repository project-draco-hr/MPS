{
  SNode fragment=RuleUtil.getTemplateFragmentByAnnotatedNode(templateFragmentNode);
  SNode query=RuleUtil.getTemplateFragment_ContextNodeQuery(fragment);
  if (query != null) {
    String methodName=TemplateFunctionMethodName.templateFragment_ContextNodeQuery(query);
    try {
      return (SNode)QueryMethodGenerated.invoke(methodName,generator.getGeneratorSessionContext(),new TemplateFragmentContext(mainContextNode,templateFragmentNode,context,generator),query.getModel());
    }
 catch (    NoSuchMethodException e) {
      generator.getLogger().warning(templateFragmentNode,"cannot find context node method for template fragment '" + methodName + "' : evaluate to null");
      return null;
    }
catch (    Exception e) {
      generator.getLogger().handleException(e);
      generator.showErrorMessage(context.getInput(),null,templateFragmentNode,"cannot evaluate template fragment context query (see exception)");
      return null;
    }
  }
  return mainContextNode;
}
