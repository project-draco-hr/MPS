{
  SNode fragment=RuleUtil.getTemplateFragmentByAnnotatedNode(templateFragmentNode);
  SNode query=RuleUtil.getTemplateFragment_ContextNodeQuery(fragment);
  if (query != null) {
    String methodName=TemplateFunctionMethodName.templateFragment_ContextNodeQuery(query);
    try {
      return (SNode)QueryMethodGenerated.invoke(methodName,myGenerator.getGeneratorSessionContext(),new TemplateFragmentContext(mainContextNode,templateFragmentNode,context,myGenerator),query.getModel());
    }
 catch (    NoSuchMethodException e) {
      myGenerator.getLogger().warning(templateFragmentNode,"cannot find context node method for template fragment '" + methodName + "' : evaluate to null");
      return null;
    }
catch (    Exception e) {
      myGenerator.getLogger().handleException(e);
      myGenerator.showErrorMessage(context.getInput(),null,templateFragmentNode,"cannot evaluate template fragment context query, exception was thrown");
      return null;
    }
  }
  return mainContextNode;
}
