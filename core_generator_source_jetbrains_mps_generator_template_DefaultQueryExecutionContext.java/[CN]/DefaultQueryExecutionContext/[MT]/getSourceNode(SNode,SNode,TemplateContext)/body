{
  try {
    final SNodeReference qr=query.getReference();
    SourceNodeQuery q=myNodeQueries.get(qr);
    if (q == null) {
      q=myGenerator.getGeneratorSessionContext().getQueryProvider(qr).getSourceNodeQuery(query);
      myNodeQueries.put(qr,q);
    }
    return q.evaluate(new SourceSubstituteMacroNodeContext(context,templateNode.getReference(),myGenerator));
  }
 catch (  GenerationFailureException ex) {
    throw ex;
  }
catch (  Exception e) {
    getLog().handleException(e);
    getLog().error(query.getReference(),"cannot evaluate query, exception was thrown",GeneratorUtil.describeInput(context));
    return null;
  }
}
