{
  TreePath leadSelectionPath=tree.getLeadSelectionPath();
  int row=tree.getRowCount() - 1;
  while (row >= 0) {
    tree.collapseRow(row);
    row--;
  }
  DefaultMutableTreeNode root=(DefaultMutableTreeNode)tree.getModel().getRoot();
  tree.expandPath(new TreePath(root));
  if (leadSelectionPath != null) {
    Object[] path=leadSelectionPath.getPath();
    Object[] pathToSelect=new Object[path.length > keepSelectionLevel ? keepSelectionLevel : path.length];
    System.arraycopy(path,0,pathToSelect,0,pathToSelect.length);
    TreeScrollingUtil.selectPath(tree,new TreePath(pathToSelect));
  }
}
