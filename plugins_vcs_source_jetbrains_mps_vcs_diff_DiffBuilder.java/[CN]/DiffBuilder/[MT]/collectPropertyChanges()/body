{
  for (  SNode newNode : myNewModel.nodes()) {
    SNodeId id=newNode.getSNodeId();
    SNode oldNode=myOldModel.getNodeById(id);
    if (oldNode == null) {
      for (      String prop : newNode.getProperties().keySet()) {
        myChanges.add(new SetPropertyChange(id,prop,newNode.getProperties().get(prop)));
      }
    }
 else {
      Set<String> newNodeProps=newNode.getPropertyNames();
      Set<String> oldNodeProps=oldNode.getPropertyNames();
      Set<String> deletedProps=new HashSet<String>(oldNodeProps);
      deletedProps.removeAll(newNodeProps);
      for (      String deletedProp : deletedProps) {
        myChanges.add(new SetPropertyChange(id,deletedProp,null));
      }
      for (      String nnp : newNodeProps) {
        if (!eq(newNode.getProperties().get(nnp),oldNode.getProperties().get(nnp))) {
          myChanges.add(new SetPropertyChange(id,nnp,newNode.getProperties().get(nnp)));
        }
      }
    }
  }
}
