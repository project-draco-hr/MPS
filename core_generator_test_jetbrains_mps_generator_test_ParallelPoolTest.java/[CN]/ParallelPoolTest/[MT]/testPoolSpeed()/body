{
  int cores=Runtime.getRuntime().availableProcessors();
  if (cores < 3) {
    return;
  }
  long amountFor2secs=get2SecsOperation();
  LOG.info("Work amount: " + amountFor2secs + " ticks");
  long start=System.currentTimeMillis();
  GenerationTaskPool pool=new GenerationTaskPool(new EmptyProgressIndicator(),4);
  final CustomTask[] generationTasks=createTasks(amountFor2secs,4,pool);
  for (  GenerationTask t : generationTasks) {
    pool.addTask(t);
  }
  try {
    pool.waitForCompletion();
  }
 catch (  GenerationCanceledException e) {
    Assert.fail();
  }
catch (  GenerationFailureException e) {
    Assert.fail();
  }
  long end=System.currentTimeMillis();
  for (  CustomTask t : generationTasks) {
    Assert.assertTrue(t.isFinished());
  }
  LOG.info("Total " + (end - start) / 1000. + " seconds to complete 4 x 2secs tasks");
  Assert.assertTrue("too slow: " + (end - start),(end - start) < 4500);
  pool.dispose();
}
