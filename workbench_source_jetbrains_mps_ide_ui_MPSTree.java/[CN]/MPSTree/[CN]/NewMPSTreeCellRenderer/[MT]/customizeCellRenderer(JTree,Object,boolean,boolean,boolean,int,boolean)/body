{
  SimpleTextAttributes foregroundAttributes=SimpleTextAttributes.REGULAR_ATTRIBUTES;
  Icon icon;
  String text;
  String additionalText=null;
  if (value instanceof MPSTreeNode) {
    MPSTreeNode treeNode=(MPSTreeNode)value;
    icon=treeNode.getIcon(expanded);
    text=treeNode.getText();
    additionalText=treeNode.getAdditionalText();
    int style=SimpleTextAttributes.STYLE_PLAIN;
    Color foregroundColor=null;
    if (!selected) {
      foregroundColor=treeNode.getColor();
    }
    Color waveColor=null;
    if (treeNode.getAggregatedErrorState() != ErrorState.NONE) {
      waveColor=treeNode.getAggregatedErrorState() == ErrorState.ERROR ? Color.RED : Color.YELLOW;
      style=style | SimpleTextAttributes.STYLE_WAVED;
    }
    if (foregroundColor != null || waveColor != null) {
      foregroundAttributes=new SimpleTextAttributes(style,foregroundColor,waveColor);
    }
  }
 else {
    text=value.toString();
    if (leaf) {
      icon=UIManager.getIcon("Tree.leafIcon");
    }
 else     if (expanded) {
      icon=UIManager.getIcon("Tree.openIcon");
    }
 else {
      icon=UIManager.getIcon("Tree.closedIcon");
    }
  }
  append(text,foregroundAttributes);
  if (additionalText != null) {
    append(" (" + additionalText + ") ",SimpleTextAttributes.GRAY_ATTRIBUTES);
  }
 else {
    append(" ",SimpleTextAttributes.GRAY_ATTRIBUTES);
  }
  setIcon(icon);
}
