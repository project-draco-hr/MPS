{
  if (!ThreadUtils.isEventDispatchThread()) {
    throw new RuntimeException("Rebuild now can be only called from UI thread");
  }
  CommandProcessor.instance().executeLightweightCommand(new Runnable(){
    public void run(){
      List<String> expansion=getExpandedPaths();
      List<String> selection=getSelectedPaths();
      rebuildAction.run();
      if (saveExpansion) {
        expandPaths(expansion);
        selectPaths(selection);
      }
    }
  }
);
}
