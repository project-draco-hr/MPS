{
  Set<SModule> theirModules=SetSequence.fromSetWithValues(new HashSet<SModule>(),event.getData(MPSCommonDataKeys.MPS_PROJECT).getRepository().getModules());
  SetSequence.fromSet(theirModules).removeSequence(Sequence.fromIterable(event.getData(MPSCommonDataKeys.MPS_PROJECT).getModulesWithGenerators()));
  Iterable<SNode> depConcepts;
  Iterable<SNode> depProps;
  Iterable<SNode> depLinks;
{
    final SearchScope scope=CommandUtil.createScope(theirModules);
    QueryExecutionContext context=new QueryExecutionContext(){
      public SearchScope getDefaultSearchScope(){
        return scope;
      }
    }
;
    depConcepts=CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"))).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return (AttributeOperations.getAttribute(it,new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x11d0a70ae54L,"jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation"))) != null);
      }
    }
);
    depProps=CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086bL,"jetbrains.mps.lang.structure.structure.PropertyDeclaration"))).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return !((AttributeOperations.getAttribute(SNodeOperations.getNodeAncestor(it,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"),false,false),new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x11d0a70ae54L,"jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation"))) == null)) && (AttributeOperations.getAttribute(it,new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x11d0a70ae54L,"jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation"))) != null);
      }
    }
);
    depLinks=CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,"jetbrains.mps.lang.structure.structure.LinkDeclaration"))).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return !((AttributeOperations.getAttribute(SNodeOperations.getNodeAncestor(it,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"),false,false),new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x11d0a70ae54L,"jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation"))) == null)) && (AttributeOperations.getAttribute(it,new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x11d0a70ae54L,"jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation"))) != null);
      }
    }
);
  }
{
    final SearchScope scope=CommandUtil.createScope(event.getData(MPSCommonDataKeys.MPS_PROJECT));
    final QueryExecutionContext context=new QueryExecutionContext(){
      public SearchScope getDefaultSearchScope(){
        return scope;
      }
    }
;
    Sequence.fromIterable(depConcepts).translate(new ITranslator2<SNode,SNode>(){
      public Iterable<SNode> translate(      SNode it){
        return CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),SNodeOperations.asSConcept(SNodeOperations.asSConcept(it)));
      }
    }
);
    Sequence.fromIterable(depProps).translate(new ITranslator2<SNode,SNode>(){
      public Iterable<SNode> translate(      final SNode prop){
        return CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),SNodeOperations.asSConcept(SNodeOperations.asSConcept(SNodeOperations.getNodeAncestor(prop,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"),false,false))))).where(new IWhereFilter<SNode>(){
          public boolean accept(          SNode ins){
            return ins.getProperty(MetaAdapterByDeclaration.getProperty(prop)) != null;
          }
        }
);
      }
    }
);
    Sequence.fromIterable(depLinks).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return SPropertyOperations.hasValue(it,MetaAdapterFactory.getProperty(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,0xf980556927L,"metaClass"),"aggregation","reference");
      }
    }
).translate(new ITranslator2<SNode,SNode>(){
      public Iterable<SNode> translate(      final SNode link){
        return CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),SNodeOperations.asSConcept(SNodeOperations.asSConcept(SNodeOperations.getNodeAncestor(link,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"),false,false))))).where(new IWhereFilter<SNode>(){
          public boolean accept(          SNode ins){
            return ins.getChildren(MetaAdapterByDeclaration.getContainmentLink(link)).iterator().hasNext();
          }
        }
);
      }
    }
);
    Sequence.fromIterable(depLinks).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return SPropertyOperations.hasValue(it,MetaAdapterFactory.getProperty(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,0xf980556927L,"metaClass"),"reference","reference");
      }
    }
).translate(new ITranslator2<SNode,SNode>(){
      public Iterable<SNode> translate(      final SNode link){
        return CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),SNodeOperations.asSConcept(SNodeOperations.asSConcept(SNodeOperations.getNodeAncestor(link,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103553c5ffL,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration"),false,false))))).where(new IWhereFilter<SNode>(){
          public boolean accept(          SNode ins){
            return ins.getReference(MetaAdapterByDeclaration.getReferenceLink(link)) != null;
          }
        }
);
      }
    }
);
  }
  Iterable<SNode> deprecatedMembers;
{
    final SearchScope scope=CommandUtil.createScope(theirModules);
    QueryExecutionContext context=new QueryExecutionContext(){
      public SearchScope getDefaultSearchScope(){
        return scope;
      }
    }
;
    deprecatedMembers=CollectionSequence.fromCollection(CommandUtil.usages(CommandUtil.createConsoleScope(null,false,context),SNodeOperations.getNode("6354ebe7-c22a-4a0f-ac54-50b52ab9b065/java:java.lang(JDK/)","~Deprecated"))).where(new IWhereFilter<SReference>(){
      public boolean accept(      SReference it){
        return it.getLink() == MetaAdapterFactory.getReferenceLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x114a6b4ccabL,0x114a6b85d40L,"annotation");
      }
    }
).select(new ISelector<SReference,SNode>(){
      public SNode select(      SReference it){
        return it.getSourceNode();
      }
    }
);
  }
  final Wrappers._T<Iterable<SReference>> usagesOfDeprecated=new Wrappers._T<Iterable<SReference>>();
{
    final SearchScope scope=CommandUtil.createScope(event.getData(MPSCommonDataKeys.MPS_PROJECT));
    final QueryExecutionContext context=new QueryExecutionContext(){
      public SearchScope getDefaultSearchScope(){
        return scope;
      }
    }
;
    usagesOfDeprecated.value=Sequence.fromIterable(deprecatedMembers).translate(new ITranslator2<SNode,SReference>(){
      public Iterable<SReference> translate(      SNode it){
        return CommandUtil.usages(CommandUtil.createConsoleScope(null,false,context),it);
      }
    }
);
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          MigrationProblemsOutputUtil.showNodes(event.getData(CommonDataKeys.PROJECT),"Usages of deprecated stuff",Sequence.fromIterable(usagesOfDeprecated.value).select(new ISelector<SReference,SNode>(){
            public SNode select(            SReference it){
              return it.getSourceNode();
            }
          }
));
        }
      }
);
    }
  }
,ModalityState.NON_MODAL);
}
