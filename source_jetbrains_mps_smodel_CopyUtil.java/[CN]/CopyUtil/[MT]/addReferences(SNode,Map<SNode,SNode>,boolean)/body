{
  SNode clonedNode=mapping.get(sourceNode);
  for (  SReference ref : sourceNode.getReferences()) {
    if (mapping.containsKey(ref.getTargetNode())) {
      clonedNode.addReferent(ref.getRole(),mapping.get(ref.getTargetNode()));
    }
 else {
      clonedNode.addReferent(ref.getRole(),ref.getTargetNode());
    }
  }
  for (  String role : sourceNode.getChildRoles(copyAttributes)) {
    for (    SNode child : sourceNode.getChildren(role)) {
      addReferences(child,mapping,copyAttributes);
    }
  }
}
