{
  for (  SNode node : sourceNodes) {
    SNode target=mapping.get(node);
    for (    SReference ref : node.getReferences()) {
      if (mapping.containsKey(ref.getTargetNode())) {
        target.addReferent(ref.getRole(),mapping.get(ref.getTargetNode()));
      }
 else {
        target.addReferent(ref.getRole(),ref.getTargetNode());
      }
    }
    List<SNode> childList=new ArrayList<SNode>();
    for (    String role : node.getChildRoles(copyAttributes)) {
      for (      SNode child : node.getChildren(role)) {
        childList.add(child);
      }
    }
    addReferences(childList,mapping,copyAttributes);
  }
}
