{
  for (  SNode node : sourceNodes) {
    SNode target=mapping.get(node);
    for (    SReference ref : node.getReferences()) {
      SNode targetNode=ref.getTargetNode();
      if (targetNode == null) {
      }
 else       if (mapping.containsKey(targetNode)) {
        target.setReferent(ref.getRole(),mapping.get(targetNode));
      }
 else {
        target.setReferent(ref.getRole(),targetNode);
      }
    }
    List<SNode> childList=new ArrayList<SNode>();
    for (    String role : node.getChildRoles(copyAttributes)) {
      for (      SNode child : node.getChildren(role)) {
        childList.add(child);
      }
    }
    addReferences(childList,mapping,copyAttributes);
  }
}
