{
  if (!projectFile.exists()) {
    throw new RuntimeException("Can't find project file " + projectFile.getAbsolutePath());
  }
  final ProjectManagerEx projectManager=ProjectManagerEx.getInstanceEx();
  final String filePath=projectFile.getAbsolutePath();
  final Project[] project=new Project[1];
  ThreadUtils.runInUIThreadAndWait(new Runnable(){
    public void run(){
      try {
        project[0]=projectManager.loadAndOpenProject(filePath,false);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
catch (      JDOMException e) {
        throw new RuntimeException(e);
      }
catch (      InvalidDataException e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  if (project[0] == null) {
    throw new RuntimeException("ProjectManager could not load project from " + projectFile.getAbsolutePath());
  }
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      new ModuleMaker().make(new LinkedHashSet<IModule>(MPSModuleRepository.getInstance().getAllModules()),new EmptyProgressIndicator());
    }
  }
);
  projectManager.openProject(project[0]);
  return project[0].getComponent(MPSProject.class);
}
