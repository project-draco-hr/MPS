{
  Element top=new Element(ELEMENT_DEBUG_INFO);
  DebugInfoRoot[] roots=sortedRoots(debugInfo);
  TreeSet<String> allConcepts=new TreeSet<String>();
  collectAllConcepts(roots,allConcepts);
  int i=0;
  HashMap<String,Integer> conceptsOrder=new HashMap<String,Integer>();
  for (  String concept : allConcepts) {
    conceptsOrder.put(concept,i++);
    top.addContent(new Element(CONCEPT).setAttribute(ATTR_FQN,concept));
  }
  for (  DebugInfoRoot dr : roots) {
    Element r=new Element(ELEMENT_ROOT);
    top.addContent(r);
    SNodeReference nr=dr.getNodeRef();
    if (nr != null) {
      r.setAttribute(ATTR_NODE_REF,nr.toString());
    }
    r.addContent(serialize(dr,conceptsOrder));
  }
  return top;
}
