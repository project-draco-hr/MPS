{
  String oldText=myTextLine.getText();
  int startSelection=myTextLine.getStartTextSelectionPosition();
  int endSelection=myTextLine.getEndTextSelectionPosition();
  char keyChar=keyEvent.getKeyChar();
  if (UIUtil.isReallyTypedEvent(keyEvent)) {
    String newText=oldText.substring(0,startSelection) + keyChar + oldText.substring(endSelection);
    if (!allowErrors && !isValidText(newText)) {
      return false;
    }
    changeText(newText);
    setCaretPositionIfPossible(startSelection + 1);
    myTextLine.resetSelection();
    fireSelectionChanged();
    ensureCaretVisible();
    return true;
  }
  return false;
}
