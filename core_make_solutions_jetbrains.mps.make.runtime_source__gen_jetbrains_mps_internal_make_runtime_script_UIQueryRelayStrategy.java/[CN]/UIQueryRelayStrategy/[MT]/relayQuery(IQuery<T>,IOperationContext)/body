{
  ProgressIndicator ind=ProgressManager.getInstance().getProgressIndicator();
  System.out.println("We're in " + Thread.currentThread().getName());
  ind.stop();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    public void run(){
    }
  }
);
  String[] options=Sequence.fromIterable(query.options()).select(new ISelector<T,String>(){
    public String select(    T o){
      return o.getText();
    }
  }
).toGenericArray(String.class);
  int res=JOptionPane.showOptionDialog(context.getMainFrame(),query.getText(),query.getName().toString(),JOptionPane.DEFAULT_OPTION,JOptionPane.QUESTION_MESSAGE,null,options,null);
  if (res == JOptionPane.CLOSED_OPTION) {
    return query.voidOption();
  }
  T resOption=ListSequence.fromList(Sequence.fromIterable(query.options()).toListSequence()).getElement(res);
  ind.start();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    public void run(){
    }
  }
);
  return resOption;
}
