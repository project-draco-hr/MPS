{
  if (!(state instanceof MPSEditorStateWrapper))   return;
  if (myNodeEditor == null)   return;
  final MPSEditorStateWrapper wrapper=(MPSEditorStateWrapper)state;
  if (wrapper.getLevel() == FileEditorStateLevel.UNDO) {
    ModelAccess.instance().runWriteAction(new Runnable(){
      @Override public void run(){
        myNodeEditor.loadState(wrapper.getEditorState());
      }
    }
);
    ModelAccess.instance().runWriteInEDT(new Runnable(){
      @Override public void run(){
        myNodeEditor.getCurrentEditorComponent().rebuildEditorContent();
      }
    }
);
  }
 else {
    myNodeEditor.loadState(wrapper.getEditorState());
  }
}
