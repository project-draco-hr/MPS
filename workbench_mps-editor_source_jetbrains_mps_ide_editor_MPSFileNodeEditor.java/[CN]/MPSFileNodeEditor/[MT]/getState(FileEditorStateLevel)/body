{
  final MPSEditorStateWrapper state=new MPSEditorStateWrapper();
  if (!isDisposed()) {
    ModelAccess.instance().runReadAction(new Runnable(){
      @Override public void run(){
        state.setEditorState(myNodeEditor.saveState(level == FileEditorStateLevel.UNDO || level == FileEditorStateLevel.FULL));
      }
    }
);
  }
  state.setLevel(level);
  return state;
}
