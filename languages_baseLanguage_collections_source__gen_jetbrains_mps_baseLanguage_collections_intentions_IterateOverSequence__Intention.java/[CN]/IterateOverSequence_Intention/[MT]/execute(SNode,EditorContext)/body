{
  SNode forStatement=SNodeFactoryOperations.createNewNode("jetbrains.mps.baseLanguage.collections.structure.ForEachStatement",null);
  SNode outerStatement=SNodeOperations.getAncestor(node,"jetbrains.mps.baseLanguage.structure.Statement",false,false);
  boolean deleteStatement=SNodeOperations.isInstanceOf(SNodeOperations.getParent(node),"jetbrains.mps.baseLanguage.structure.ExpressionStatement");
  SNodeOperations.insertNextSiblingChild(outerStatement,forStatement);
  SLinkOperations.setTarget(forStatement,"inputSequence",node,true);
  if (deleteStatement) {
    SNodeOperations.deleteNode(outerStatement);
  }
  editorContext.select(SLinkOperations.getTarget(forStatement,"variable",true));
}
