{
  List<SNode> TFs=SNodeOperations.getDescendants(SLinkOperations.getTarget(SLinkOperations.getTarget(node,"template",false),"contentNode",true),"jetbrains.mps.lang.generator.structure.TemplateFragment",true,new String[]{});
  if ((int)ListSequence.fromList(TFs).count() == 0) {
    JOptionPane.showMessageDialog(null,"No fragments found");
    return;
  }
  if (ListSequence.fromList(TFs).count() > 1) {
    JOptionPane.showMessageDialog(null,"Too many fragments");
    return;
  }
  SNode oldTemplate=SLinkOperations.getTarget(node,"template",false);
  SNode fragmentToSet=SNodeOperations.copyNode(SNodeOperations.getParent(ListSequence.fromList(TFs).first()));
  SNode TFtoDelete=AttributeOperations.getAttribute(fragmentToSet,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.generator.structure.TemplateFragment")));
  SNodeOperations.deleteNode(TFtoDelete);
  SNode inlineTemplate=SNodeFactoryOperations.replaceWithNewChild(node,"jetbrains.mps.lang.generator.structure.InlineTemplate_RuleConsequence");
  SLinkOperations.setTarget(inlineTemplate,"templateNode",fragmentToSet,true);
  int option=JOptionPane.showConfirmDialog(null,"Delete old template?","",JOptionPane.YES_NO_OPTION);
  if (option == JOptionPane.YES_OPTION) {
    SNodeOperations.deleteNode(oldTemplate);
  }
}
