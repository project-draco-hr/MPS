{
  List<SModelDescriptor> models=getModels();
  List<SNode> result=new ArrayList<SNode>();
  if (myRootsOnly) {
    for (    SModelDescriptor model : models) {
      Iterable<SNode> roots=new ConditionalIterable(model.getSModel().roots(),condition);
      for (      SNode root : roots) {
        result.add(root);
      }
    }
  }
 else {
    for (    SModelDescriptor model : models) {
      try {
        if (model == null) {
          continue;
        }
        if (condition instanceof IsInstanceCondition) {
          IsInstanceCondition isInstance=(IsInstanceCondition)condition;
          result.addAll(model.getSModel().getFastNodeFinder().getNodes(isInstance.getConceptFqName(),true));
        }
 else {
          Iterable<SNode> iter=new ConditionalIterable(model.getSModel().nodes(),condition);
          for (          SNode node : iter) {
            result.add(node);
          }
        }
      }
 catch (      Throwable t) {
        LOG.error("error collecting nodes form model " + model,t);
      }
    }
  }
  return result;
}
