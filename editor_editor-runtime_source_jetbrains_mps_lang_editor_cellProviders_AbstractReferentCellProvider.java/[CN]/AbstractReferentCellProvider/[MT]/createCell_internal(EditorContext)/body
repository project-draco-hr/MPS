{
  SNode node=getSNode();
  if (myErrorText != null) {
    return createErrorCell(myErrorText,node,context);
  }
  SNode referentNode=null;
  if (myIsAggregation) {
    List<? extends SNode> ch=IterableUtil.asList(node.getChildren(myGenuineRole));
    referentNode=ch.iterator().hasNext() ? ch.iterator().next() : null;
  }
 else {
    SReference reference=node.getReference(myGenuineRole);
    if (reference != null) {
      referentNode=reference.getTargetNode();
      if (referentNode == null || referentNode.getModel() == null || !VisibilityUtil.isVisible(context.getModel(),referentNode.getModel())) {
        String rinfo=((jetbrains.mps.smodel.SReference)reference).getResolveInfo();
        myErrorText=rinfo != null ? rinfo : "?" + myRole + "?";
        return createErrorCell(myErrorText,node,context);
      }
    }
  }
  if (referentNode == null) {
    EditorCell_Label noRefCell=myIsCardinality1 ? new EditorCell_Error(context,node,myNoTargetText) : new EditorCell_Constant(context,node,"");
    noRefCell.setText("");
    noRefCell.setEditable(true);
    noRefCell.setDefaultText(myNoTargetText);
    noRefCell.setAction(CellActionType.DELETE,new CellAction_DeleteEasily(getSNode(),false));
    noRefCell.setAction(CellActionType.BACKSPACE,new CellAction_DeleteEasily(getSNode(),true));
    if (myIsAggregation) {
      noRefCell.setAction(CellActionType.INSERT,new CellAction_Insert(getSNode(),myGenuineRole));
      noRefCell.setAction(CellActionType.INSERT_BEFORE,new CellAction_Insert(getSNode(),myGenuineRole));
    }
    noRefCell.setCellId("empty_" + myRole);
    setRoleForCellWithNoTarget(noRefCell);
    return noRefCell;
  }
  return createRefCell(context,referentNode,node);
}
