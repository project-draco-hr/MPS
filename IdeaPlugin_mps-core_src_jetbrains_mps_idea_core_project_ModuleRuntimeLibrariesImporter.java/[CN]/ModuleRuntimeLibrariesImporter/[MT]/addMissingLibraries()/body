{
  Set<SModuleReference> alreadyImported=ModuleLibrariesUtil.getModules(myModifiableRootModel.getOrderEntries());
  Collection<Library> projectLibs2Add=new HashSet<Library>();
  for (  IModule usedModule : collectRuntimeModules(myAddedModules)) {
    if (BootstrapLanguages.JDK.equals(usedModule.getModuleReference())) {
      continue;
    }
    if (alreadyImported.contains(usedModule.getModuleReference())) {
      continue;
    }
    Library library=null;
    if (usedModule instanceof StubSolutionIdea) {
      library=StubSolutionIdea.findLibrary((StubSolutionIdea)usedModule);
    }
 else {
      library=ModuleLibrariesUtil.getOrCreateAutoLibrary(usedModule,getProject(),myLibrariesContainer);
    }
    if (library != null) {
      projectLibs2Add.add(library);
    }
  }
  for (  Library projectLibrary : projectLibs2Add) {
    myModifiableRootModel.addLibraryEntry(projectLibrary);
  }
}
