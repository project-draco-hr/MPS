{
  for (  TextGenerationResult result : results) {
    SNode outputRootNode=result.getRoot();
    String name=getFileName(outputRootNode);
    if (name == null) {
      Message m=new Message(MessageKind.ERROR,"Can't create file with no name. Root node [" + outputRootNode.getNodeId() + "] in model "+ outputRootNode.getModel().getReference().getModelName());
      m.setHintObject(new jetbrains.mps.smodel.SNodePointer(outputRootNode));
      errors.add(m);
      continue;
    }
    Object contents=result.getResult();
    if (contents != TextGen.NO_TEXTGEN) {
      if (contents instanceof String) {
        streamHandler.saveStream(name,(String)contents,false);
      }
 else {
        streamHandler.saveStream(name,(byte[])contents,false);
      }
    }
  }
}
