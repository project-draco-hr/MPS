{
  markDependentNodesForInvalidation(event.getChild(),getTypecheckingComponent());
  markDependentNodesForInvalidation(event.getParent(),getTypecheckingComponent());
  markDependentNodesForInvalidation(event.getChild(),myNonTypeSystemComponent);
  markDependentNodesForInvalidation(event.getParent(),myNonTypeSystemComponent);
  List<SReference> references=new ArrayList<SReference>();
  SNode child=event.getChild();
  references.addAll(IterableUtil.asCollection(child.getReferences()));
  for (  SNode descendant : jetbrains.mps.util.SNodeOperations.getDescendants(child,null)) {
    references.addAll(IterableUtil.asCollection(descendant.getReferences()));
    if (event.isRemoved()) {
      markDependentNodesForInvalidation(descendant,myNonTypeSystemComponent);
      markDependentNodesForInvalidation(descendant,getTypecheckingComponent());
    }
  }
  for (  SReference reference : references) {
    if (reference instanceof DynamicReference) {
      continue;
    }
    SNode targetNode=reference.getTargetNodeSilently();
    if (targetNode != null) {
      markDependentNodesForInvalidation(targetNode,myNonTypeSystemComponent);
    }
  }
}
