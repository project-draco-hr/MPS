{
  if (!org.jetbrains.mps.openapi.model.SNodeUtil.isAccessible(node,MPSModuleRepository.getInstance()))   return;
  SModel sm=node.getModel();
  if (!myNodesCount.containsKey(sm)) {
    ((SModelInternal)sm).addModelListener(myModelListener);
    sm.addModelListener(mySModelListener);
    myNodesCount.put(sm,1);
    mySModelNodes.put(sm,new WeakSet<SNode>());
  }
 else {
    Integer oldValue=myNodesCount.get(sm);
    myNodesCount.put(sm,oldValue + 1);
  }
  WeakReference<SNode> ref=new WeakReference<SNode>(node,myReferenceQueue);
  myDescriptors.put(ref,sm);
  mySModelNodes.get(sm).add(node);
}
