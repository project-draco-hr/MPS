{
  if (query != null) {
    List<SNode> list=GeneratorUtil.evaluateSourceNodesQuery(currentInputNode,query,generator);
    if (list != null) {
      return list;
    }
    return new LinkedList<SNode>();
  }
  String sourceQueryAspectMethodName=macro.getSourceQueryAspectMethodName();
  if (sourceQueryAspectMethodName != null) {
    String methodName="templateSourceQuery_" + sourceQueryAspectMethodName;
    Object[] args=new Object[]{currentInputNode,generator};
    long startTime=System.currentTimeMillis();
    try {
      List<SNode> sourceNodes=(List<SNode>)QueryMethod.invoke(methodName,args,macro.getModel());
      if (sourceNodes != null) {
        return sourceNodes;
      }
      return new LinkedList<SNode>();
    }
  finally {
      Statistics.getStatistic(Statistics.TPL).add(macro.getModel(),methodName,startTime);
    }
  }
  throw new GenerationFailedException("couldn't evaluate macro query",currentInputNode,BaseAdapter.fromAdapter(macro),null);
}
