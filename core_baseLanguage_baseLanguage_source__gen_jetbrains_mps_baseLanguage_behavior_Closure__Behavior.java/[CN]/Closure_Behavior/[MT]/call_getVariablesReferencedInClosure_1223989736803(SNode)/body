{
  List<SNode> referencedInClosures=new ArrayList<SNode>();
  for (  SNode varRef : SNodeOperations.getDescendants(thisNode,"jetbrains.mps.baseLanguage.structure.VariableReference",false,new String[]{})) {
    SNode closure=SNodeOperations.getAncestor(SLinkOperations.getTarget(varRef,"variableDeclaration",false),"jetbrains.mps.baseLanguage.structure.Closure",false,false);
    if ((closure == null) || closure != SNodeOperations.getParent(thisNode)) {
      ListSequence.fromList(referencedInClosures).addElement(SLinkOperations.getTarget(varRef,"variableDeclaration",false));
    }
  }
  return referencedInClosures;
}
