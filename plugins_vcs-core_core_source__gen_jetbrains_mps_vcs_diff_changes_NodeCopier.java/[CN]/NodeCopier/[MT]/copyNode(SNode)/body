{
  SNode copy=CopyUtil.copyAndPreserveId(sourceNode);
  for (  SNode node : ListSequence.fromList(SNodeOperations.getNodeDescendants(copy,null,true,new SAbstractConcept[]{}))) {
    SNodeId nodeId=node.getNodeId();
    if (myModel.getNode(nodeId) == null) {
      continue;
    }
    SNodeId replacedId;
    do {
      replacedId=jetbrains.mps.smodel.SModel.generateUniqueId();
    }
 while (myModel.getNode(replacedId) != null);
    ((jetbrains.mps.smodel.SNode)node).setId(replacedId);
    if (!(MapSequence.fromMap(myIdReplacementCache).containsKey(nodeId))) {
      MapSequence.fromMap(myIdReplacementCache).put(nodeId,replacedId);
    }
  }
  return copy;
}
