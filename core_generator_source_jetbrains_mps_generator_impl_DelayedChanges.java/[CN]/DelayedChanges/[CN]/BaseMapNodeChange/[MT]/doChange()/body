{
  try {
    SNode child=mapNode();
    if (child == null) {
      return;
    }
    child=new TemplateExecutionEnvironmentImpl(myGenerator,myExecContext).insertNode(child,getMapSrcMacro(),myContext);
    SNode parent=myChildToReplace.getParent();
    if (parent == null) {
      if (myChildToReplace.getModel() != null && myChildToReplace.getParent() == null) {
        myChildToReplace.getModel().addRootNode(child);
        myChildToReplace.getModel().removeRootNode(myChildToReplace);
        myGenerator.rootReplaced(myChildToReplace,child);
      }
    }
 else {
      String childRole=myChildToReplace.getRoleInParent();
      final Status status=myGenerator.getChildRoleValidator(parent,childRole).validate(child);
      if (status != null) {
        status.reportProblem(false,parent,"",GeneratorUtil.describe(myContext.getInput(),"input"),GeneratorUtil.describe(getMapSrcMacro(),"template"));
      }
      org.jetbrains.mps.openapi.model.SNodeUtil.replaceWithAnother(myChildToReplace,child);
    }
    myGenerator.getGenerationTracer().replaceOutputNode(myChildToReplace,child);
    postProcess(child);
  }
 catch (  Throwable t) {
    myLogger.error(getMapSrcMacro(),String.format("mapping failed: '%s'",t.getMessage()),GeneratorUtil.describe(myContext.getInput(),"input"));
    myLogger.handleException(t);
  }
}
