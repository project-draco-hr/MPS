{
synchronized (myBreakpoints) {
    if (breakpoint instanceof ILocationBreakpoint) {
      SNode node=((ILocationBreakpoint)breakpoint).getNodePointer().getNode();
      if (node != null) {
        SNode root=node.getContainingRoot();
        if (root != null) {
          SNodePointer rootPointer=new SNodePointer(root);
          Set<IBreakpoint> breakpointsForRoot=myRootsToBreakpointsMap.get(rootPointer);
          if (breakpointsForRoot == null) {
            breakpointsForRoot=new HashSet<IBreakpoint>();
            myRootsToBreakpointsMap.put(rootPointer,breakpointsForRoot);
          }
          breakpointsForRoot.add(breakpoint);
          for (          IEditor editor : myEditorsProvider.getSelectedEditors()) {
            EditorComponent editorComponent=editor.getCurrentEditorComponent();
            if (editorComponent != null) {
              SNode editedNode=editorComponent.getEditedNode();
              if (root == editedNode) {
                editorComponent.addAdditionalPainter(new MPSBreakpointPainter(breakpoint));
                editorComponent.getLeftEditorHighlighter().addIconRenderer(new BreakpointIconRenderer((ILocationBreakpoint)breakpoint,editorComponent));
                editorComponent.repaint();
              }
            }
          }
        }
      }
    }
    breakpoint.setCreationTime(System.currentTimeMillis());
    myBreakpoints.add(breakpoint);
    breakpoint.addBreakpointListener(myBreakpointListener);
    breakpoint.addToRunningSessions();
  }
  fireBreakpointsChanged();
}
