{
  SNode type=null;
  SNode prevNode=null;
  SNode node=initialNode;
  try {
    myIsSpecial=true;
    while (node != null) {
      List<SNode> additionalNodes=new ArrayList<SNode>(givenAdditionalNodes);
      if (prevNode != null) {
        additionalNodes.add(prevNode);
      }
      computeTypes(node,true,false,additionalNodes,inferenceMode);
      type=getType(initialNode);
      if (type == null || TypesUtil.hasVariablesInside(type)) {
        if (node.isRoot()) {
          computeTypes(node,true,true,new ArrayList<SNode>(0),inferenceMode);
          checkNode(node,true);
          type=getRawTypeFromContext(initialNode);
          return type;
        }
        prevNode=node;
        node=node.getParent();
      }
 else {
        return type;
      }
    }
  }
  finally {
    myIsSpecial=false;
  }
  return type;
}
