{
  if (node == null) {
    LOG.error("node to bookmark is null");
    return;
  }
  SNodeReference newBookmark=new jetbrains.mps.smodel.SNodePointer(node);
  boolean bookmarkRemoved=false;
  for (int i=0; i < 10; i++) {
    if (myBookmarks[i] != null && myBookmarks[i].resolve(MPSModuleRepository.getInstance()) == node) {
      myBookmarks[i]=null;
      bookmarkRemoved=true;
      fireBookmarkRemoved(i,node);
    }
  }
  if (myUnnumberedBookmarks.contains(newBookmark)) {
    myUnnumberedBookmarks.remove(newBookmark);
    bookmarkRemoved=true;
    fireBookmarkRemoved(-1,newBookmark.resolve(MPSModuleRepository.getInstance()));
  }
  if (!bookmarkRemoved) {
    myUnnumberedBookmarks.add(newBookmark);
    fireBookmarkAdded(-1,newBookmark.resolve(MPSModuleRepository.getInstance()));
  }
}
