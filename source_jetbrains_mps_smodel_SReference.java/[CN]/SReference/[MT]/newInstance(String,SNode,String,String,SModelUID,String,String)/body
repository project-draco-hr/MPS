{
  SModel sourceModel=sourceNode.getModel();
  if (sourceModel.getUID().equals(targetModelUID)) {
    if (targetNodeId == null) {
      if (resolveInfo != null) {
        return new InternalReference(role,sourceNode,resolveInfo,targetClassResolveInfo);
      }
 else {
        LOG.error("resolve info is null, source node is " + sourceNode + ", role is "+ role);
        return null;
      }
    }
    SReference internalReference=new InternalReference(role,sourceNode,targetNodeId);
    internalReference.setResolveInfo(resolveInfo);
    internalReference.setTargetClassResolveInfo(targetClassResolveInfo);
    return internalReference;
  }
  if (targetNodeId != null || extResolveInfo != null) {
    return new ExternalReference(role,sourceNode,targetNodeId,extResolveInfo,targetModelUID);
  }
  return null;
}
