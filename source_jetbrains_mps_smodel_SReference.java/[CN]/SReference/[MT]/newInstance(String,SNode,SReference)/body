{
  if (templateRef instanceof InternalReference) {
    if (templateRef.isResolved()) {
      return new InternalReference(role,sourceNode,templateRef.getTargetNode().getId());
    }
 else {
      return new InternalReference(role,sourceNode,templateRef.getResolveInfo(),templateRef.getTargetClassResolveInfo());
    }
  }
  SReference extTemplateRef=templateRef;
  return new ExternalReference(role,sourceNode,extTemplateRef.getTargetNodeId(),extTemplateRef.getExtResolveInfo(),extTemplateRef.getTargetModelUID());
}
