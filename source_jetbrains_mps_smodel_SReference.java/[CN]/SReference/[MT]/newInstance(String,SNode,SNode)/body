{
  SModel sourceModel=sourceNode.getModel();
  SModel targetModel=targetNode == null ? null : targetNode.getModel();
  if (sourceModel == targetModel || targetModel == null) {
    String id=targetNode == null ? null : targetNode.getId();
    return new InternalReference(role,sourceNode,id);
  }
 else {
    sourceModel.addImportElement(targetModel.getUID());
    String extResolveInfo=null;
    if (targetModel.isExternallyResolvable()) {
      extResolveInfo=ExternalResolver.getExternalResolveInfoFromTarget(targetNode);
    }
    return new ExternalReference(role,sourceNode,targetNode.getId(),extResolveInfo,targetModel.getUID());
  }
}
