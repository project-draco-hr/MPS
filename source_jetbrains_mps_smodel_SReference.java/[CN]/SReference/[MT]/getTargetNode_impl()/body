{
  SModel targetModel=getTargetModel();
  SModel sourceModel=mySourceNode.getModel();
  if (targetModel == null) {
    logGetTargetNodeErrors(GetTargetNodeErrorState.NO_MODEL);
    return null;
  }
  if (ExternalResolver.isEmptyExtResolveInfo(myExtResolveInfo)) {
    if (myTargetNodeId == null) {
      logGetTargetNodeErrors(GetTargetNodeErrorState.CANT_RESOLVE_BY_ID);
      return null;
    }
    SNode nodeById=targetModel.getNodeById(myTargetNodeId);
    if (nodeById == null) {
      nodeById=UnregisteredNodes.instance().get(targetModel.getUID(),myTargetNodeId);
      if (nodeById == null) {
        logGetTargetNodeErrors(GetTargetNodeErrorState.CANT_RESOLVE_BY_ID);
      }
    }
 else {
      if (targetModel.isExternallyResolvable() && targetModel != sourceModel) {
        String extResolveInfo=ExternalResolver.getExternalResolveInfoFromTarget(nodeById);
        if (extResolveInfo != null) {
          LOG.warning("reference is resolved by ID, while should be resolved by ERI");
          LOG.info("re-resolving reference");
          targetModel.setNodeExtResolveInfo(nodeById,extResolveInfo);
          myExtResolveInfo=extResolveInfo;
          myTargetNodeId=null;
          markChanged();
        }
      }
    }
    return nodeById;
  }
 else {
    SNode nodeByExtResolveInfo=targetModel.getNodeByExtResolveInfo(myExtResolveInfo);
    if (nodeByExtResolveInfo == null) {
      logGetTargetNodeErrors(GetTargetNodeErrorState.CANT_RESOLVE_BY_ERI);
    }
    return nodeByExtResolveInfo;
  }
}
