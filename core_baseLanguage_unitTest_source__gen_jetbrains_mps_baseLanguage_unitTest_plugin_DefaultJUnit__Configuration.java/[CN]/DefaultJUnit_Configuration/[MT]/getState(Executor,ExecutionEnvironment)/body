{
  return new JavaRunProfileState(){
    @Nullable public ExecutionResult execute(    Executor executor,    @NotNull ProgramRunner runner) throws ExecutionException {
      final ConsoleViewImpl consoleView_22042010=StacktraceUtil.createConsoleView(MPSDataKeys.PROJECT.getData(environment.getDataContext()));
      JComponent consoleComponent_22042010=null;
      Runnable consoleDispose_22042010=null;
      final List<AnAction> actions_22042010=ListSequence.fromList(new ArrayList<AnAction>());
      ProcessHandler handler_22042010=null;
      final Project project=MPSDataKeys.PROJECT.getData(environment.getDataContext());
      final MPSProject mpsProject=MPSDataKeys.MPS_PROJECT.getData(environment.getDataContext());
      final IOperationContext operationContext=MPSDataKeys.OPERATION_CONTEXT.getData(environment.getDataContext());
      try {
        final ConfigRunParameters javaRunParameters=DefaultJUnit_Configuration.this.getStateObject().myJavaRunParameters.copy();
        if (executor.getId().equals(DefaultDebugExecutor.EXECUTOR_ID)) {
          String args=this.getUserData(DebuggerKeys.CONNECTION_SETTINGS);
          String oldVmParams=javaRunParameters.getVMParameters();
          if (StringUtils.isNotEmpty(oldVmParams)) {
            oldVmParams+=" ";
          }
 else {
            oldVmParams="";
          }
          javaRunParameters.setVMParameters(oldVmParams + args);
        }
{
          final UnitTestExecutionController parameter=new _FunctionTypes._return_P0_E0<UnitTestExecutionController>(){
            public UnitTestExecutionController invoke(){
              List<SNode> stuffToTest=DefaultJUnit_Configuration.this.collectWhatToTest(mpsProject);
              if (javaRunParameters.getMake()) {
                RunUtil.makeBeforeRun(project,stuffToTest);
              }
              return new UnitTestExecutionController(stuffToTest,javaRunParameters);
            }
          }
.invoke();
          ListSequence.fromList(actions_22042010).addSequence(ListSequence.fromList(new _FunctionTypes._return_P0_E0<List<AnAction>>(){
            public List<AnAction> invoke(){
{
                final List<AnAction> actionsList=ListSequence.fromListAndArray(new ArrayList<AnAction>(),consoleView_22042010.createConsoleActions());
                ListSequence.fromList(actionsList).clear();
                return actionsList;
              }
            }
          }
.invoke()));
          final Tuples._2<JComponent,_FunctionTypes._void_P0_E0> component=(Tuples._2<JComponent,_FunctionTypes._void_P0_E0>)(new _FunctionTypes._return_P0_E0<Tuples._2<JComponent,_FunctionTypes._void_P0_E0>>(){
            public Tuples._2<JComponent,_FunctionTypes._void_P0_E0> invoke(){
              final UnitTestViewComponent runComponent=new UnitTestViewComponent(project,operationContext,consoleView_22042010,parameter);
              return MultiTuple.<JComponent,_FunctionTypes._void_P0_E0>from((JComponent)runComponent,new _FunctionTypes._void_P0_E0(){
                public void invoke(){
                  runComponent.dispose();
                }
              }
);
            }
          }
.invoke());
          consoleComponent_22042010=component._0();
          consoleDispose_22042010=new Runnable(){
            public void run(){
              component._1().invoke();
            }
          }
;
          final Wrappers._T<ExecutionException> ex=new Wrappers._T<ExecutionException>(null);
          handler_22042010=(ProcessHandler)new _FunctionTypes._return_P0_E0<ProcessHandler>(){
            public ProcessHandler invoke(){
              try {
                return parameter.execute();
              }
 catch (              ExecutionException e) {
                ex.value=e;
                return null;
              }
            }
          }
.invoke();
          if (ex.value != null) {
            throw ex.value;
          }
        }
      }
 catch (      Throwable t) {
        if (t instanceof ExecutionException) {
          throw (ExecutionException)t;
        }
 else {
          Logger.getLogger(DefaultJUnit_Configuration.class).error(t);
          throw new ExecutionException("Execution code threw an exception: " + t.getMessage(),t);
        }
      }
      final JComponent finalConsoleComponent=consoleComponent_22042010;
      final Runnable finalConsoleDispose=consoleDispose_22042010;
      final ProcessHandler finalHandler=handler_22042010;
      if (finalHandler == null) {
        return null;
      }
      return new ExecutionResult(){
        public ExecutionConsole getExecutionConsole(){
          return new ExecutionConsole(){
            public void dispose(){
              if (finalConsoleDispose == null) {
                return;
              }
              finalConsoleDispose.run();
            }
            public JComponent getComponent(){
              return finalConsoleComponent;
            }
            public JComponent getPreferredFocusableComponent(){
              return finalConsoleComponent;
            }
          }
;
        }
        public AnAction[] getActions(){
          return ListSequence.fromList(actions_22042010).toGenericArray(AnAction.class);
        }
        public ProcessHandler getProcessHandler(){
          return finalHandler;
        }
      }
;
    }
    public RunnerSettings getRunnerSettings(){
      return null;
    }
    public ConfigurationPerRunnerSettings getConfigurationSettings(){
      return null;
    }
  }
;
}
