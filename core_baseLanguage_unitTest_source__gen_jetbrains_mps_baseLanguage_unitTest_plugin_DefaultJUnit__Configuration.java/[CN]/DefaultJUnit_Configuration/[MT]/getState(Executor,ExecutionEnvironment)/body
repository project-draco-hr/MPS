{
  return new RunProfileState(){
    @Nullable public ExecutionResult execute(    Executor executor,    @NotNull ProgramRunner runner) throws ExecutionException {
      JComponent consoleComponent;
      Runnable consoleDispose=null;
      final List<AnAction> actions=ListSequence.fromList(new ArrayList<AnAction>());
      ProcessHandler handler=null;
{
        MPSProject project=MPSDataKeys.MPS_PROJECT.getData(environment.getDataContext());
        final JUnitTestViewComponent runComponent=new JUnitTestViewComponent(project,null);
        final Wrappers._T<UnitTestRunner> testRunner=new Wrappers._T<UnitTestRunner>(null);
        try {
          testRunner.value=new UnitTestRunner(project.getComponent(MPSProjectHolder.class).getMPSProject().getPluginManager().getPrefsComponent(UnitTest_PreferencesComponent.class),runComponent);
        }
 catch (        NullPointerException npe) {
          npe.printStackTrace();
        }
        ListSequence.fromList(actions).addSequence(ListSequence.fromList(ListSequence.fromListAndArray(new ArrayList<AnAction>(),runComponent.getConsole().createConsoleActions())));
        consoleComponent=runComponent;
        consoleDispose=new Runnable(){
          public void run(){
            runComponent.dispose();
          }
        }
;
        Process process=null;
        final List<SNode> all=new ArrayList<SNode>();
        ModelAccess.instance().runReadAction(new Runnable(){
          public void run(){
            if (DefaultJUnit_Configuration.this.getStateObject().type != null) {
              IOperationContext context=MPSDataKeys.OPERATION_CONTEXT.getData(environment.getDataContext());
              List<SNode> tests=new ArrayList<SNode>();
              List<SNode> methods=new ArrayList<SNode>();
              if (DefaultJUnit_Configuration.this.getStateObject().type == JUnitRunTypes.METHOD) {
                SNode test=(SNode)SModelUtil.findNodeByFQName(DefaultJUnit_Configuration.this.getStateObject().node,SConceptOperations.findConceptDeclaration("jetbrains.mps.baseLanguage.unitTest.structure.BTestCase"),GlobalScope.getInstance());
                for (                SNode method : SLinkOperations.getTargets(SLinkOperations.getTarget(test,"testMethodList",true),"testMethod",true)) {
                  if (ITestMethod_Behavior.call_getTestName_1216136419751(method).equals(DefaultJUnit_Configuration.this.getStateObject().method)) {
                    ListSequence.fromList(methods).addElement(method);
                    break;
                  }
                }
              }
 else               if (DefaultJUnit_Configuration.this.getStateObject().type == JUnitRunTypes.NODE) {
                SNode test=(SNode)SModelUtil.findNodeByFQName(DefaultJUnit_Configuration.this.getStateObject().node,SConceptOperations.findConceptDeclaration("jetbrains.mps.baseLanguage.unitTest.structure.BTestCase"),GlobalScope.getInstance());
                ListSequence.fromList(tests).addElement(test);
              }
 else               if (DefaultJUnit_Configuration.this.getStateObject().type == JUnitRunTypes.MODEL) {
                SModel model=GlobalScope.getInstance().getModelDescriptor(SModelReference.fromString(DefaultJUnit_Configuration.this.getStateObject().model)).getSModel();
                ListSequence.fromList(tests).addSequence(ListSequence.fromList(SModelOperations.getRoots(model,"jetbrains.mps.baseLanguage.unitTest.structure.BTestCase")));
              }
 else               if (DefaultJUnit_Configuration.this.getStateObject().type == JUnitRunTypes.MODULE) {
                for (                IModule module : GlobalScope.getInstance().getVisibleModules()) {
                  if (module.getModuleFqName().equals(DefaultJUnit_Configuration.this.getStateObject().module)) {
                    for (                    SModelDescriptor modelDescriptor : module.getOwnModelDescriptors()) {
                      SModel model=modelDescriptor.getSModel();
                      ListSequence.fromList(tests).addSequence(ListSequence.fromList(SModelOperations.getRoots(model,"jetbrains.mps.baseLanguage.unitTest.structure.BTestCase")));
                    }
                    break;
                  }
                }
              }
              runComponent.setTestCaseAndMethod(context,tests,methods);
              ListSequence.fromList(all).addSequence(ListSequence.fromList(tests));
              ListSequence.fromList(all).addSequence(ListSequence.fromList(methods));
            }
          }
        }
);
        if (DefaultJUnit_Configuration.this.getStateObject().myParams == null) {
          DefaultJUnit_Configuration.this.getStateObject().myParams=new ConfigRunParameters();
        }
        if (DefaultJUnit_Configuration.this.getStateObject().myParams.getMake()) {
          RunUtil.makeBeforeRun(project,all);
        }
        testRunner.value.setConfigParameters(DefaultJUnit_Configuration.this.getStateObject().myParams);
        if (DefaultJUnit_Configuration.this.getStateObject().myParams != null && DefaultJUnit_Configuration.this.getStateObject().myParams.getUseAlternativeJRE()) {
          testRunner.value.setJavaHomePath(DefaultJUnit_Configuration.this.getStateObject().myParams.getAlternativeJRE());
        }
        ModelAccess.instance().runReadAction(new Runnable(){
          public void run(){
            testRunner.value.run(all);
          }
        }
);
        process=testRunner.value.getProcess();
        if (process != null) {
          BLProcessHandler processHandler=new BLProcessHandler(runComponent.getConsole(),process,"Test",Charset.defaultCharset());
          runComponent.onStart(processHandler);
          handler=new BLProcessHandler(runComponent.getConsole(),process,"Test",Charset.defaultCharset());
        }
      }
      final JComponent finalConsoleComponent=consoleComponent;
      final Runnable finalConsoleDispose=consoleDispose;
      final ProcessHandler finalHandler=handler;
      return new ExecutionResult(){
        public ExecutionConsole getExecutionConsole(){
          return new ExecutionConsole(){
            public void dispose(){
              if (finalConsoleDispose == null) {
                return;
              }
              finalConsoleDispose.run();
            }
            public JComponent getComponent(){
              return finalConsoleComponent;
            }
            public JComponent getPreferredFocusableComponent(){
              return finalConsoleComponent;
            }
          }
;
        }
        public AnAction[] getActions(){
          return ListSequence.fromList(actions).toGenericArray(AnAction.class);
        }
        public ProcessHandler getProcessHandler(){
          return finalHandler;
        }
      }
;
    }
    public RunnerSettings getRunnerSettings(){
      return null;
    }
    public ConfigurationPerRunnerSettings getConfigurationSettings(){
      return null;
    }
  }
;
}
