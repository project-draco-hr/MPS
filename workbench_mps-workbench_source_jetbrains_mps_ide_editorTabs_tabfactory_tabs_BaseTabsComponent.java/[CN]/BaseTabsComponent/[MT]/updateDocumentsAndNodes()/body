{
  List<Document> editedDocumentsNew=new ArrayList<Document>();
  List<SNodePointer> editedNodesNew=new ArrayList<SNodePointer>();
  Map<EditorTabDescriptor,List<SNode>> result=new THashMap<EditorTabDescriptor,List<SNode>>();
  getTabRemovalListener().clearAspects();
  for (  EditorTabDescriptor d : myPossibleTabs) {
    List<SNode> nodes=new ArrayList<SNode>();
    for (    SNode n : d.getNodes(myBaseNode.getNode())) {
      if (n == null)       continue;
      nodes.add(n);
    }
    if (nodes.isEmpty())     continue;
    result.put(d,nodes);
    for (    SNode node : nodes) {
      getTabRemovalListener().aspectAdded(node.getContainingRoot());
      SNodePointer nodePointer=new SNodePointer(node);
      editedNodesNew.add(nodePointer);
      editedDocumentsNew.add(MPSUndoUtil.getDoc(nodePointer));
    }
  }
  myEditedDocuments=editedDocumentsNew;
  myEditedNodes=editedNodesNew;
  return result;
}
