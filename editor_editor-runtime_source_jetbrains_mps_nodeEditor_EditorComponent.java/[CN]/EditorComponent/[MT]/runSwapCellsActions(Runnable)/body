{
  try {
    myCellSwapInProgress=true;
    EditorContext ec=getEditorContext();
    boolean needsSavingState=ec != null;
    if (getRootCell() != null && getRootCell().getSNode() != null && getRootCell().getSNode().isDisposed()) {
      needsSavingState=false;
    }
    if (needsSavingState) {
      EditorCell sc=getSelectedCell();
      if (sc != null) {
        myRecentlySelectedCellInfo=sc.getCellInfo();
      }
      Object memento=ec.createMemento();
      action.run();
      ec.pushTracerTask("restoring memento",true);
      ec.setMemento(memento);
      ec.popTracerTask();
    }
 else {
      action.run();
    }
    myRecentlySelectedCellInfo=null;
  }
  finally {
    myCellSwapInProgress=false;
  }
}
