{
  final List<DefaultSModelDescriptor> modelDescriptors=new ArrayList<DefaultSModelDescriptor>();
  final List<SModelDescriptor> scopeModelDescriptors=new ArrayList<SModelDescriptor>();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      for (      SModelDescriptor d : scope.getOwnModelDescriptors()) {
        scopeModelDescriptors.add(d);
      }
    }
  }
);
  for (  SModelDescriptor modelDescriptor : scopeModelDescriptors) {
    if (!SModelStereotype.isUserModel(modelDescriptor))     continue;
    int persistenceVersion=-1;
    if (modelDescriptor.getLoadingState() != ModelLoadingState.NOT_LOADED) {
      persistenceVersion=modelDescriptor.getSModel().getPersistenceVersion();
    }
 else {
      if (modelDescriptor instanceof DefaultSModelDescriptor) {
        IFile file=((DefaultSModelDescriptor)modelDescriptor).getModelFile();
        if (file != null) {
          try {
            persistenceVersion=ModelPersistence.loadDescriptor(file).getHeader().getPersistenceVersion();
          }
 catch (          ModelReadException e) {
          }
        }
      }
    }
    if (persistenceVersion != -1 && persistenceVersion < ModelPersistence.LAST_VERSION) {
      modelDescriptors.add((DefaultSModelDescriptor)modelDescriptor);
    }
  }
  if (modelDescriptors.isEmpty()) {
    if (!silent) {
      JOptionPane.showMessageDialog(mainframe,"No Models To Upgrade Found");
    }
    return;
  }
  boolean dialogOk=false;
  if (!silent) {
    UpdatePersistenceDialog updatePersistenceDialog=new UpdatePersistenceDialog(modelDescriptors,mainframe,unitDescription,false);
    updatePersistenceDialog.showDialog();
    dialogOk=updatePersistenceDialog.getAnswer();
  }
  if (silent || dialogOk) {
    ModelAccess.instance().runWriteAction(new Runnable(){
      public void run(){
        upgradePersistence(modelDescriptors,ModelPersistence.LAST_VERSION);
      }
    }
);
  }
}
