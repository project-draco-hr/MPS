{
synchronized (myLock) {
    if (myReloadSession == null) {
      myReloadSession=new ReloadSession(getReloadListeners());
    }
    final ReloadSession reloadSession=myReloadSession;
    for (    final VFileEvent event : events) {
      String filePath=event.getPath();
      VirtualFile file=VFileSystem.getFile(filePath);
      if (file == null)       continue;
      if (file.isDirectory() && file.exists() && (file.getChildren() != null)) {
        if (isUnderSignificantRoots(VFileSystem.toFile(file))) {
          VFileSystem.processFilesRecursively(file,new Processor<VirtualFile>(){
            public boolean process(            VirtualFile file){
              processBeforeEvent(new VFileEventDecorator(event,file.getPath()),file.getPath(),reloadSession);
              return true;
            }
          }
);
        }
      }
 else       if (!file.isDirectory()) {
        processBeforeEvent(event,filePath,reloadSession);
      }
    }
  }
}
