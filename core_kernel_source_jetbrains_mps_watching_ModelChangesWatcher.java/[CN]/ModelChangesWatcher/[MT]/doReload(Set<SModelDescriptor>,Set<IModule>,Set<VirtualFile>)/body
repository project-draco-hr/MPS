{
  boolean needToReloadLibraries=false;
  if (!addedModules.isEmpty()) {
    needToReloadLibraries=showNeedToReloadLibrariesDialog(addedModules);
  }
  final boolean needToReloadLibrariesTmp=needToReloadLibraries;
  ProgressManager.getInstance().run(new Modal(null,"Reloading",false){
    public void run(    @NotNull final ProgressIndicator progressIndicator){
      if (needToReloadLibrariesTmp) {
        progressIndicator.setText("Updating Modules");
        LibraryManager.getInstance().update();
        return;
      }
      if (!modulesToReload.isEmpty()) {
        ModelAccess.instance().runReadAction(new Runnable(){
          public void run(){
            reloadModules(progressIndicator,modulesToReload);
          }
        }
);
      }
      reloadModels(progressIndicator,modelsToReload);
    }
  }
);
}
