{
  if (allMethods != null) {
    return Sequence.fromIterable(Sequence.fromArray(allMethods)).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return prefix == null || SPropertyOperations.getString(it,"name").startsWith(prefix);
      }
    }
).toListSequence();
  }
  List<SNode> result=ListSequence.fromList(new ArrayList());
  Set<String> overridenSignatures=SetSequence.fromSet(new HashSet<String>());
  for (  String name : SetSequence.fromSet(MapSequence.fromMap(nameToMethods).keySet())) {
    if (prefix == null || name.startsWith(prefix)) {
      Iterable<SNode> methods=MapSequence.fromMap(nameToMethods).get(name);
      ListSequence.fromList(result).addSequence(Sequence.fromIterable(methods));
      SetSequence.fromSet(overridenSignatures).addSequence(Sequence.fromIterable(methods).select(new ISelector<SNode,String>(){
        public String select(        SNode it){
          return getSignatureForOverriding(it,classifier);
        }
      }
));
    }
  }
  Map<String,Set<SNode>> groups=MapSequence.fromMap(new HashMap<String,Set<SNode>>());
  for (  SNode extendedClassifier : Sequence.fromIterable(extendedClassifiers)) {
    for (    SNode method : ListSequence.fromList(((Scope)BehaviorManager.getInstance().invoke(Object.class,extendedClassifier,"virtual_getVisibleMembers_8083692786967356611",new Class[]{SNode.class,SNode.class,SNode.class},classifier,kind)).getAvailableElements(prefix)).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return SNodeOperations.isInstanceOf(it,NameUtil.nodeFQName(kind));
      }
    }
).select(new ISelector<SNode,SNode>(){
      public SNode select(      SNode it){
        return SNodeOperations.cast(it,"jetbrains.mps.baseLanguage.structure.BaseMethodDeclaration");
      }
    }
)) {
      String signature=getSignatureForOverriding(method,classifier);
      if (!(SetSequence.fromSet(overridenSignatures).contains(signature))) {
        if (MapSequence.fromMap(groups).containsKey(signature)) {
          SetSequence.fromSet(MapSequence.fromMap(groups).get(signature)).addElement(method);
        }
 else {
          MapSequence.fromMap(groups).put(signature,SetSequence.fromSetAndArray(new HashSet<SNode>(),method));
        }
      }
    }
  }
  for (  IMapping<String,Set<SNode>> group : MapSequence.fromMap(groups)) {
    ListSequence.fromList(result).addSequence(Sequence.fromIterable(getMethodsFromGroup(group.value())));
  }
  if (prefix == null) {
    allMethods=ListSequence.fromList(result).select(new ISelector<SNode,SNode>(){
      public SNode select(      SNode it){
        return SNodeOperations.cast(it,"jetbrains.mps.baseLanguage.structure.BaseMethodDeclaration");
      }
    }
).toGenericArray(SNode.class);
  }
  return result;
}
