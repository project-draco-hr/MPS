{
  if (SNodeOperations.getContainingRoot(library) == SNodeOperations.getContainingRoot(contextNode)) {
    return;
  }
  SNode target=SNodeOperations.as(artifacts.toOriginalNode(library),MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),6057319140845467763l,"jetbrains.mps.build.structure.BuildSource_JavaLibrary"));
  if (target == null || SNodeOperations.getModel(target).getModule() instanceof TransientModelsModule) {
    return;
  }
  if (BuildSource_JavaLibrary_Behavior.call_canExportByParts_5610619299014309362(target)) {
    List<Tuples._2<SNode,Boolean>> result=ListSequence.fromList(new ArrayList<Tuples._2<SNode,Boolean>>());
    for (    SNode element : ListSequence.fromList(SLinkOperations.getChildren(target,MetaAdapterFactory.getContainmentLink(new UUID(8755280088213897754l,-5075149991798053422l),6057319140845467763l,6057319140845478673l,"elements")))) {
      SNode jcp=SNodeOperations.as(element,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),3717132724152913083l,"jetbrains.mps.build.structure.BuildSource_JavaLibraryCP"));
      if ((jcp == null)) {
        return;
      }
      SNode classpath=SLinkOperations.getTarget(jcp,MetaAdapterFactory.getContainmentLink(new UUID(8755280088213897754l,-5075149991798053422l),3717132724152913083l,3717132724152913085l,"classpath"));
      if (SNodeOperations.isInstanceOf(classpath,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),1258644073388922138l,"jetbrains.mps.build.structure.BuildSource_JavaJar"))) {
        Tuples._2<SNode,String> resource=artifacts.getResource(SLinkOperations.getTarget(SNodeOperations.cast(classpath,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),1258644073388922138l,"jetbrains.mps.build.structure.BuildSource_JavaJar")),MetaAdapterFactory.getContainmentLink(new UUID(8755280088213897754l,-5075149991798053422l),1258644073388922138l,3717132724152837090l,"path")));
        SNode jarArtifact=SNodeOperations.as(resource._0(),MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),7389400916848036997l,"jetbrains.mps.build.structure.BuildLayout_Node"));
        if (jarArtifact != null) {
          ListSequence.fromList(result).addElement(MultiTuple.<SNode,Boolean>from(jarArtifact,isNotEmptyString(resource._1())));
        }
      }
 else       if (SNodeOperations.isInstanceOf(classpath,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014446503l,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJar"))) {
        Tuples._2<SNode,Boolean> requiredJar=requireJar(artifacts,SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(classpath,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014446503l,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJar")),MetaAdapterFactory.getContainmentLink(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014446503l,5610619299014446504l,"extJar")),MetaAdapterFactory.getReferenceLink(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014309452l,5610619299014309453l,"jar")),contextNode);
        if (requiredJar != null) {
          ListSequence.fromList(result).addElement(requiredJar);
        }
      }
 else       if (SNodeOperations.isInstanceOf(classpath,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014531832l,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJarFolder"))) {
        SNode requiredJarFolder=requireJarFolder(artifacts,SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(classpath,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014531832l,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJarFolder")),MetaAdapterFactory.getContainmentLink(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014531832l,5610619299014531834l,"extFolder")),MetaAdapterFactory.getReferenceLink(new UUID(8755280088213897754l,-5075149991798053422l),5610619299014531647l,5610619299014531648l,"folder")),contextNode);
        if (requiredJarFolder != null) {
          ListSequence.fromList(result).addElement(MultiTuple.<SNode,Boolean>from(requiredJarFolder,true));
        }
      }
 else {
        ListSequence.fromList(result).clear();
        break;
      }
    }
    if (ListSequence.fromList(result).isNotEmpty()) {
      artifacts.needsFetch(contextNode);
      for (      Tuples._2<SNode,Boolean> pair : ListSequence.fromList(result)) {
        if ((boolean)pair._1()) {
          builder.addWithContent(pair._0());
        }
 else {
          builder.add(pair._0());
        }
      }
      return;
    }
  }
  SNode artifact=SNodeOperations.as(artifacts.findArtifact(target),MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),7389400916848036997l,"jetbrains.mps.build.structure.BuildLayout_Node"));
  if (artifact != null) {
    artifacts.needsFetch(contextNode);
    if (SNodeOperations.isInstanceOf(artifact,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),2913098736709465755l,"jetbrains.mps.build.structure.BuildLayout_ExportAsJavaLibrary"))) {
      ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(artifact,MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),2913098736709465755l,"jetbrains.mps.build.structure.BuildLayout_ExportAsJavaLibrary")),MetaAdapterFactory.getContainmentLink(new UUID(8755280088213897754l,-5075149991798053422l),4701820937132344003l,7389400916848037006l,"children"))).select(new ISelector<SNode,SNode>(){
        public SNode select(        SNode it){
          return SNodeOperations.as(artifacts.findArtifact(it),MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),7389400916848036997l,"jetbrains.mps.build.structure.BuildLayout_Node"));
        }
      }
).visitAll(new IVisitor<SNode>(){
        public void visit(        SNode it){
          if (it != null) {
            builder.add(it);
          }
        }
      }
);
    }
 else {
      builder.add(artifact,target);
    }
  }
}
