{
  if (SNodeOperations.getContainingRoot(library) == SNodeOperations.getContainingRoot(contextNode)) {
    return;
  }
  SNode target=SNodeOperations.as(artifacts.toOriginalNode(library),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x540febaa6144b873L,"jetbrains.mps.build.structure.BuildSource_JavaLibrary"));
  if (target == null || SNodeOperations.getModel(target).getModule() instanceof TransientModelsModule) {
    return;
  }
  if ((boolean)BuildSource_JavaLibrary__BehaviorDescriptor.canExportByParts_id4RsV8qJGJnM.invoke(target)) {
    List<Tuples._2<SNode,Boolean>> result=ListSequence.fromList(new ArrayList<Tuples._2<SNode,Boolean>>());
    for (    SNode element : ListSequence.fromList(SLinkOperations.getChildren(target,MetaAdapterFactory.getContainmentLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x540febaa6144b873L,0x540febaa6144e311L,"elements")))) {
      SNode jcp=SNodeOperations.as(element,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x3395e884b61d4cbbL,"jetbrains.mps.build.structure.BuildSource_JavaLibraryCP"));
      if ((jcp == null)) {
        return;
      }
      SNode classpath=SLinkOperations.getTarget(jcp,MetaAdapterFactory.getContainmentLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x3395e884b61d4cbbL,0x3395e884b61d4cbdL,"classpath"));
      if (SNodeOperations.isInstanceOf(classpath,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x11779a1dbcff551aL,"jetbrains.mps.build.structure.BuildSource_JavaJar"))) {
        Tuples._2<SNode,String> resource=artifacts.getResource(SLinkOperations.getTarget(SNodeOperations.cast(classpath,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x11779a1dbcff551aL,"jetbrains.mps.build.structure.BuildSource_JavaJar")),MetaAdapterFactory.getContainmentLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x11779a1dbcff551aL,0x3395e884b61c23e2L,"path")));
        SNode jarArtifact=SNodeOperations.as(resource._0(),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node"));
        if (jarArtifact != null) {
          ListSequence.fromList(result).addElement(MultiTuple.<SNode,Boolean>from(jarArtifact,isNotEmptyString(resource._1())));
        }
      }
 else       if (SNodeOperations.isInstanceOf(classpath,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb50da7L,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJar"))) {
        Tuples._2<SNode,Boolean> requiredJar=requireJar(artifacts,SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(classpath,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb50da7L,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJar")),MetaAdapterFactory.getContainmentLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb50da7L,0x4ddcec86afb50da8L,"extJar")),MetaAdapterFactory.getReferenceLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb2f64cL,0x4ddcec86afb2f64dL,"jar")),contextNode);
        if (requiredJar != null) {
          ListSequence.fromList(result).addElement(requiredJar);
        }
      }
 else       if (SNodeOperations.isInstanceOf(classpath,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb65af8L,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJarFolder"))) {
        SNode requiredJarFolder=requireJarFolder(artifacts,SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(classpath,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb65af8L,"jetbrains.mps.build.structure.BuildSource_JavaLibraryExternalJarFolder")),MetaAdapterFactory.getContainmentLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb65af8L,0x4ddcec86afb65afaL,"extFolder")),MetaAdapterFactory.getReferenceLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4ddcec86afb65a3fL,0x4ddcec86afb65a40L,"folder")),contextNode);
        if (requiredJarFolder != null) {
          ListSequence.fromList(result).addElement(MultiTuple.<SNode,Boolean>from(requiredJarFolder,true));
        }
      }
 else {
        ListSequence.fromList(result).clear();
        break;
      }
    }
    if (ListSequence.fromList(result).isNotEmpty()) {
      artifacts.needsFetch(contextNode);
      for (      Tuples._2<SNode,Boolean> pair : ListSequence.fromList(result)) {
        if ((boolean)pair._1()) {
          builder.addWithContent(pair._0());
        }
 else {
          builder.add(pair._0());
        }
      }
      return;
    }
  }
  SNode artifact=SNodeOperations.as(artifacts.findArtifact(target),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node"));
  if (artifact != null) {
    artifacts.needsFetch(contextNode);
    if (SNodeOperations.isInstanceOf(artifact,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x286d67dde534f69bL,"jetbrains.mps.build.structure.BuildLayout_ExportAsJavaLibrary"))) {
      ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(artifact,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x286d67dde534f69bL,"jetbrains.mps.build.structure.BuildLayout_ExportAsJavaLibrary")),MetaAdapterFactory.getContainmentLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4140393b234482c3L,0x668c6cfbafac4c8eL,"children"))).select(new ISelector<SNode,SNode>(){
        public SNode select(        SNode it){
          return SNodeOperations.as(artifacts.findArtifact(it),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafac4c85L,"jetbrains.mps.build.structure.BuildLayout_Node"));
        }
      }
).visitAll(new IVisitor<SNode>(){
        public void visit(        SNode it){
          if (it != null) {
            builder.add(it);
          }
        }
      }
);
    }
 else {
      builder.add(artifact,target);
    }
  }
}
