{
  EditorCell actionCell=selectedCell;
  while (actionCell != null) {
    boolean conditionSatisfied=false;
    if (action.getCaretPolicy() == EditorCellKeyMapAction.CARET_AT_ANY_POSITION) {
      conditionSatisfied=true;
    }
 else     if (action.getCaretPolicy() == actualCaretPosition) {
      if (action.getCaretPolicy() == EditorCellKeyMapAction.CARET_AT_FIRST_POSITION) {
        conditionSatisfied=(actionCell.findChild(CellFinders.FIRST_SELECTABLE_LEAF,true) == selectedCell) && isStrictlyFirstCaretPosition(selectedCell);
      }
 else       if (action.getCaretPolicy() == EditorCellKeyMapAction.CARET_AT_LAST_POSITION) {
        conditionSatisfied=(actionCell.findChild(CellFinders.LAST_SELECTABLE_LEAF,true) == selectedCell) && isStrictlyLastCaretPosition(selectedCell);
      }
 else {
        conditionSatisfied=true;
      }
    }
    try {
      if (conditionSatisfied && canExecuteKeyMapAction(action,keyEvent,actionCell,editorContext)) {
        return actionCell;
      }
    }
 catch (    Exception e) {
      LOG.error(e);
      return null;
    }
    if (actionCell == keymapOwnerCell) {
      return null;
    }
    actionCell=(EditorCell)actionCell.getParent();
  }
  return null;
}
