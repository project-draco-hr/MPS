{
  for (int i=0; i < node.getChildCount(); i++) {
    MPSTreeNode child=(MPSTreeNode)node.getChildAt(i);
    if (myBuilder.isNamespaceNode(child)) {
      @SuppressWarnings("unchecked") T nsNode=(T)child;
      compactNodes(nsNode);
    }
  }
  if (node.getParent() != null && node.getChildCount() == 1 && myBuilder.isNamespaceNode((MPSTreeNode)node.getChildAt(0))) {
    @SuppressWarnings("unchecked") T child=(T)node.getChildAt(0);
    myBuilder.setName(node,myBuilder.getName(node) + "." + myBuilder.getName(child));
    Enumeration children=child.children();
    List<MPSTreeNode> oldChildren=new ArrayList<MPSTreeNode>();
    while (children.hasMoreElements()) {
      oldChildren.add((MPSTreeNode)children.nextElement());
    }
    for (    MPSTreeNode c : oldChildren) {
      child.remove(c);
      node.add(c);
    }
    node.remove(child);
  }
}
