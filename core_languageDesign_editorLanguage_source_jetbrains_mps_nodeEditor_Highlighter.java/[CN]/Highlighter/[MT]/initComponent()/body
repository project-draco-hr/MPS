{
  if (myThread != null && myThread.isAlive()) {
    LOG.error("trying to initialize a Highlighter being already initialized");
    return;
  }
  myClassLoaderManager.addReloadHandler(new ReloadAdapter(){
    public void onReload(){
      myCheckedOnceEditors.clear();
    }
  }
);
  myGlobalSModelEventsManager.addGlobalCommandListener(new SModelCommandListener(){
    public void eventsHappenedInCommand(    List<SModelEvent> events){
synchronized (EVENTS_LOCK) {
        myLastEvents.addAll(events);
      }
    }
  }
);
  myThread=new Thread("Highlighter"){
{
      setDaemon(true);
    }
    public void run(){
      if (IdeMain.isTestMode())       return;
      CommandProcessor commandProcessor=CommandProcessor.instance();
      try {
        while (true) {
          while (commandProcessor.isInsideCommand()) {
            Thread.sleep(200);
          }
          doUpdate();
          if (myStopThread) {
            break;
          }
          Thread.sleep(300);
        }
      }
 catch (      Exception e) {
        LOG.error(e);
      }
    }
  }
;
  myThread.start();
}
