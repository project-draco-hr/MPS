{
  List<MappingScript> preMappingScripts=ruleManager.getPreMappingScripts();
  if (!preMappingScripts.isEmpty()) {
    boolean needToCloneInputMode=!myDiscardTransients;
    if (!needToCloneInputMode) {
      for (      MappingScript preMappingScript : preMappingScripts) {
        if (preMappingScript.getScriptKind() == MappingScriptKind.pre_process_input_model) {
          if (preMappingScript.getModifiesModel()) {
            needToCloneInputMode=true;
            break;
          }
        }
      }
    }
    if (needToCloneInputMode) {
      SModel currentInputModel_clone=createTransientModel();
      if (myLogger.needsInfo()) {
        myLogger.info("clone model '" + currentInputModel.getSModelFqName() + "' --> '"+ currentInputModel_clone.getSModelFqName()+ "'");
      }
      CloneUtil.cloneModel(currentInputModel,currentInputModel_clone,currentInputModel == mySessionContext.getOriginalInputModel());
      if (!myDiscardTransients) {
        mySessionContext.getGenerationTracer().registerPreMappingScripts(currentInputModel,currentInputModel_clone,preMappingScripts);
      }
      recycleWasteModel(currentInputModel);
      currentInputModel=currentInputModel_clone;
    }
  }
  for (  MappingScript preMappingScript : preMappingScripts) {
    if (preMappingScript.getScriptKind() != MappingScriptKind.pre_process_input_model) {
      myLogger.warning(preMappingScript.getNode(),"skip script '" + preMappingScript + "' ("+ preMappingScript.getModel().getSModelFqName()+ ") - wrong script kind");
      continue;
    }
    if (myLogger.needsInfo()) {
      myLogger.info(preMappingScript.getNode(),"pre-process '" + preMappingScript + "' ("+ preMappingScript.getModel().getSModelFqName()+ ")");
    }
    ITemplateGenerator templateGenerator=new TemplateGenerator(mySessionContext,myProgressMonitor,myLogger,ruleManager,currentInputModel,currentInputModel,myIsStrict,ttrace);
    templateGenerator.getExecutor().executeMappingScript(preMappingScript,currentInputModel);
  }
  return currentInputModel;
}
