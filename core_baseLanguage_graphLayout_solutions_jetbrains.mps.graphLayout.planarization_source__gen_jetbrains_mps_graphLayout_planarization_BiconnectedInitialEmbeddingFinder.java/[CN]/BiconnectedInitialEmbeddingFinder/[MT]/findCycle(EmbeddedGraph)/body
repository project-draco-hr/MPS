{
  Set<Node> visited=SetSequence.fromSet(new HashSet<Node>());
  List<Dart> darts=ListSequence.fromList(new ArrayList<Dart>());
  Graph graph=embeddedGraph.getGraph();
  Node cur=graph.getNode(0);
  Edge prevEdge=null;
  while (!(SetSequence.fromSet(visited).contains(cur))) {
    SetSequence.fromSet(visited).addElement(cur);
    Edge next=ListSequence.fromList(cur.getEdges()).getElement(0);
    if (next == prevEdge) {
      next=ListSequence.fromList(cur.getEdges()).getElement(1);
    }
    ListSequence.fromList(darts).addElement(new Dart(next,cur));
    cur=next.getOpposite(cur);
    prevEdge=next;
  }
  List<Dart> path=ListSequence.fromList(new ArrayList<Dart>());
  boolean inCycle=false;
  for (  Dart dart : ListSequence.fromList(darts)) {
    if (dart.getSource() == cur) {
      inCycle=true;
    }
    if (inCycle) {
      ListSequence.fromList(path).addElement(dart);
    }
  }
  Face innerFace=new Face(graph);
  for (  Dart dart : ListSequence.fromList(path)) {
    innerFace.addNext(dart);
  }
  Face outerFace=new Face(graph);
  for (  Dart dart : ListSequence.fromList(path).reversedList()) {
    outerFace.addNext(new Dart(dart.getEdge(),dart.getTarget()));
  }
  embeddedGraph.addFace(innerFace);
  embeddedGraph.addFace(outerFace);
  embeddedGraph.setOuterFace(outerFace);
}
