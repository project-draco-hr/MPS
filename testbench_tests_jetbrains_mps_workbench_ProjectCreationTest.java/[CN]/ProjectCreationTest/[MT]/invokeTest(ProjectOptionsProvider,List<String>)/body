{
  final Reference<Throwable> refThrowable=new Reference<Throwable>();
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            myTmpDir=IFileUtils.createTmpDir();
            try {
              ProjectFactory factory=new ProjectFactory(null,projectOptionsProvider.getProjectOptions(myTmpDir));
              myProject=factory.createProject();
              factory.activate();
              myProject.save();
            }
 catch (            ProjectNotCreatedException e) {
              Assert.fail();
            }
          }
 catch (          Throwable t) {
            refThrowable.set(t);
          }
        }
      }
);
    }
  }
,ModalityState.defaultModalityState());
  if (!refThrowable.isNull()) {
    throw new RuntimeException(refThrowable.get());
  }
  Exception exception=ThreadUtils.runInUIThreadAndWait(new Runnable(){
    @Override public void run(){
      try {
        ProjectUtil.closeAndDispose(myProject);
      }
 catch (      Throwable t) {
        refThrowable.set(t);
      }
    }
  }
);
  if (exception != null) {
    throw new RuntimeException(exception);
  }
  checkFilePathList(myTmpDir,expectedPathList);
}
