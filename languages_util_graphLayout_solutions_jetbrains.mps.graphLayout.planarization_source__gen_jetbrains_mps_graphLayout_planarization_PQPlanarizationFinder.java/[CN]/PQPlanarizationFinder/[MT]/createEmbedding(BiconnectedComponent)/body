{
  Graph componentGraph=new Graph();
  Set<Node> nodes=component.getNodes();
  EmbeddedGraph graphEmbedding=new EmbeddedGraph(myGraph);
  boolean manyNodeComponent=SetSequence.<Node>fromSet(nodes).count() > 1;
  if (manyNodeComponent) {
    Map<Node,Node> nodeMap=MapSequence.<Node,Node>fromMap(new HashMap<Node,Node>());
    Map<Node,Node> invertedNodeMap=MapSequence.<Node,Node>fromMap(new HashMap<Node,Node>());
    Map<Edge,Edge> invertedEdgeMap=MapSequence.<Edge,Edge>fromMap(new HashMap<Edge,Edge>());
    for (    Node node : SetSequence.<Node>fromSet(nodes)) {
      Node componentNode=componentGraph.createNode();
      MapSequence.<Node,Node>fromMap(nodeMap).put(node,componentNode);
      MapSequence.<Node,Node>fromMap(invertedNodeMap).put(componentNode,node);
    }
    for (    Node node : SetSequence.<Node>fromSet(component.getNodes())) {
      for (      Edge edge : ListSequence.<Edge>fromList(node.getEdges(Edge.Direction.FRONT))) {
        Node target=edge.getTarget();
        if (SetSequence.<Node>fromSet(nodes).contains(target)) {
          Edge newEdge=componentGraph.connect(MapSequence.<Node,Node>fromMap(nodeMap).get(node),MapSequence.<Node,Node>fromMap(nodeMap).get(target));
          MapSequence.<Edge,Edge>fromMap(invertedEdgeMap).put(newEdge,edge);
        }
      }
    }
    if (SHOW_LOG > 0) {
      System.out.println("COMPONENT!!! " + componentGraph.getNumNodes() + "  : "+ ListSequence.<Edge>fromList(componentGraph.getEdges()).count());
      System.out.println("map: " + nodeMap);
    }
    PQPlanarityTest pqPlanarityTest=new PQPlanarityTest();
    Set<Edge> removed=pqPlanarityTest.removeEdgesToPlanarity(componentGraph,GraphOrientation.orientST(componentGraph));
    EmbeddedGraph componentEmbedding;
    if (SetSequence.<Edge>fromSet(removed).count() == 0) {
      componentEmbedding=pqPlanarityTest.getEmbedding(componentGraph,GraphOrientation.orientST(componentGraph));
    }
 else {
      for (      Edge edge : SetSequence.<Edge>fromSet(removed)) {
        componentGraph.removeEdge(edge);
      }
      BiconnectedComponent tree=BiconnectedComponent.createTree(componentGraph);
      componentEmbedding=createEmbedding(tree);
      for (      Edge edge : SetSequence.<Edge>fromSet(removed)) {
        componentGraph.addEdge(edge);
      }
    }
    for (    Face componentFace : ListSequence.<Face>fromList(componentEmbedding.getFaces())) {
      Face graphFace=new Face(myGraph);
      for (      Dart dart : ListSequence.<Dart>fromList(componentFace.getDarts())) {
        graphFace.addLast(new Dart(MapSequence.<Edge,Edge>fromMap(invertedEdgeMap).get(dart.getEdge()),MapSequence.<Node,Node>fromMap(invertedNodeMap).get(dart.getSource())));
      }
      graphEmbedding.addFace(graphFace);
      if (componentEmbedding.isOuterFace(componentFace)) {
        graphEmbedding.setOuterFace(graphFace);
      }
    }
  }
 else {
    Face fakeFace=new Face(myGraph);
    graphEmbedding.addFace(fakeFace);
    graphEmbedding.setOuterFace(fakeFace);
  }
  for (  BiconnectedComponent child : ListSequence.<BiconnectedComponent>fromList(component.getChildren())) {
    EmbeddedGraph childEmbedding=createEmbedding(child);
    Object connection=component.getConnection(child);
    Edge bridge=null;
    if (connection instanceof Edge) {
      bridge=((Edge)connection);
    }
    Node cutpoint=component.getCutpoint(child);
    Node childCutpoint=component.getChildCutpoint(child);
    Face outerChildFace;
    if (ListSequence.<Face>fromList(childEmbedding.getFaces()).count() > 1) {
      outerChildFace=childEmbedding.findContainingFace(ListSequence.<Node>fromListAndArray(new ArrayList<Node>(),childCutpoint));
    }
 else {
      outerChildFace=childEmbedding.getOuterFace();
    }
    if (bridge != null) {
      if (ListSequence.<Dart>fromList(outerChildFace.getDarts()).count() > 0) {
        outerChildFace.makeEndsWith(bridge.getOpposite(cutpoint));
      }
      childEmbedding.addLastDart(outerChildFace,new Dart(bridge,bridge.getOpposite(cutpoint)));
      childEmbedding.addLastDart(outerChildFace,new Dart(bridge,cutpoint));
    }
    if (!(manyNodeComponent)) {
      graphEmbedding=childEmbedding;
      manyNodeComponent=true;
    }
 else {
      Face face=graphEmbedding.findContainingFace(ListSequence.<Node>fromListAndArray(new ArrayList<Node>(),cutpoint));
      boolean isOuter=graphEmbedding.isOuterFace(face);
      graphEmbedding.removeFace(face);
      childEmbedding.removeFace(outerChildFace);
      Face newFace=new Face(myGraph);
      for (      Dart dart : ListSequence.<Dart>fromList(face.makeEndsWith(cutpoint))) {
        newFace.addLast(dart);
      }
      for (      Dart dart : ListSequence.<Dart>fromList(outerChildFace.makeEndsWith(cutpoint))) {
        newFace.addLast(dart);
      }
      graphEmbedding.addFace(newFace);
      if (isOuter) {
        graphEmbedding.setOuterFace(newFace);
      }
      for (      Face childFace : ListSequence.<Face>fromList(childEmbedding.getFaces())) {
        graphEmbedding.addFace(childFace);
      }
    }
  }
  return graphEmbedding;
}
