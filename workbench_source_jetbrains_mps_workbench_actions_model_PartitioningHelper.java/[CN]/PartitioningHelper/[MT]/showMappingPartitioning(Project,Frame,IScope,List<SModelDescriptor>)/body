{
  SModel inputModel=models.get(0).getSModel();
  GenerationPlan plan=new GenerationPlan(inputModel,scope);
  Map<MappingPriorityRule,GeneratorDescriptor> myRule2Generator=new HashMap<MappingPriorityRule,GeneratorDescriptor>();
  for (  Generator generator : plan.getGenerators()) {
    GeneratorDescriptor generatorDescriptor=generator.getModuleDescriptor();
    for (    MappingPriorityRule rule : generatorDescriptor.getPriorityRules()) {
      myRule2Generator.put(rule,generatorDescriptor);
    }
  }
  MessagesViewTool messagesView=project.getComponent(MessagesViewTool.class);
  messagesView.resetAutoscrollOption();
  messagesView.add(new Message(MessageKind.INFORMATION,"================================="));
  for (  Generator generator : plan.getGenerators()) {
    List<MappingPriorityRule> rules=((GeneratorDescriptor)generator.getModuleDescriptor()).getPriorityRules();
    List<Pair<MappingPriorityRule,String>> strings=GenerationPartitioningUtil.toStrings(rules,true);
    for (    Pair<MappingPriorityRule,String> string : strings) {
      Message msg=new Message(MessageKind.INFORMATION," " + string.second);
      msg.setHintObject(generator.getModuleReference());
      messagesView.add(msg);
    }
  }
  messagesView.add(new Message(MessageKind.INFORMATION,"================================="));
  if (plan.hasConflictingPriorityRules()) {
    messagesView.openToolLater(true);
    messagesView.add(new Message(MessageKind.ERROR,PartitioningHelper.class,"Conflicting mapping priority rules encountered:"));
    List<Pair<MappingPriorityRule,String>> messagesFull=plan.getConflictingPriorityRulesAsStrings();
    for (    Pair<MappingPriorityRule,String> message : messagesFull) {
      Message msg=new Message(MessageKind.ERROR,PartitioningHelper.class,message.second);
      GeneratorDescriptor generatorDescriptor=myRule2Generator.get(message.first);
      msg.setHintObject(generatorDescriptor.getModuleReference());
      messagesView.add(msg);
    }
    messagesView.add(new Message(MessageKind.INFORMATION,"================================="));
    JOptionPane.showMessageDialog(frame,"Conflicting mapping priority rules encountered","Generation plan error",JOptionPane.WARNING_MESSAGE);
  }
  String text="";
  for (int step=0; step < plan.getStepCount(); step++) {
    List<TemplateMappingConfiguration> mappingSet=plan.getMappingConfigurations(step);
    text=text + " [ " + (step + 1)+ " ]\n";
    List<String> strings=GenerationPartitioningUtil.toStrings(mappingSet);
    for (    String string : strings) {
      text=text + " " + string+ "\n";
    }
    text+="\n";
  }
  OutputViewTool viewTool=OutputViewTool.getOutputViewTool(project);
  viewTool.clear();
  viewTool.append("---------------------  mappings partitioning  -----------------------------------\n\n");
  viewTool.append(text);
  viewTool.append("---------------------------------------------------------------------------------\n");
  List<SNode> roots=new ArrayList<SNode>();
  for (  SModelDescriptor md : models) {
    SModel model=md.getSModel();
    for (    SNode root : model.roots()) {
      roots.add(root);
    }
  }
  ConnectedComponentPartitioner ccp=new ConnectedComponentPartitioner(roots);
  viewTool.append(ccp.toString());
  viewTool.openToolLater(true);
}
