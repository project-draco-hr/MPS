{
  SNode body=createMethodBody();
  List<SNode> params=new ArrayList<SNode>();
  Map<SNode,SNode> inputToParams=this.createInputParameters(body,params);
  Map<SNode,SNode> inputMapping=this.createInputVaryablesMapping(inputToParams,this.myParameters.getNodesToRefactor());
  this.myMatches=new MethodDuplicatesFinder(this.myParameters.getNodesToRefactor(),inputMapping,params,this.getOutputReferences()).findDuplicates(SNodeOperations.getNodeAncestor(ListSequence.fromList(this.myParameters.getNodesToRefactor()).first(),MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x101d9d3ca30L,"jetbrains.mps.baseLanguage.structure.Classifier"),false,false));
  this.replaceInputVariablesByParameters(SLinkOperations.getChildren(body,MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc56b200L,0xf8cc6bf961L,"statement")),inputToParams);
  SNode newMethod=this.createNewMethod(SNodeOperations.copyNode(this.getMethodType()),params,body);
  this.addMethod(newMethod);
  MethodMatch exactMatch=this.createMatch(this.myParameters.getNodesToRefactor(),inputMapping,params);
  this.replaceMatch(exactMatch,newMethod);
  MethodOptimizer.optimize(body);
  return newMethod;
}
