{
  if (!(myModule instanceof Language)) {
    return;
  }
  myLanguage=((Language)myModule);
{
    final SearchScope scope=CommandUtil.createScope(myModule);
    QueryExecutionContext context=new QueryExecutionContext(){
      public SearchScope getDefaultSearchScope(){
        return scope;
      }
    }
;
    Collection<SNode> allSideTransformActions=CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x108fad1c116L,"jetbrains.mps.lang.actions.structure.SideTransformHintSubstituteActions"));
    for (    SNode actions : CollectionSequence.fromCollection(allSideTransformActions)) {
      for (      SNode builder : ListSequence.fromList(SLinkOperations.getChildren(actions,MetaAdapterFactory.getContainmentLink(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x108fad1c116L,0x108fad1c117L,"actionsBuilder")))) {
        addBuilderToMap(actions,builder);
        addBuilderToMenuMap(actions,builder);
      }
    }
    Set<SNode> actionsKeySet=myActionsToConceptAndTagToBuilder.keySet();
    for (    SNode actions : SetSequence.fromSet(actionsKeySet)) {
      Map<Pair<SNode,String>,List<SNode>> conceptAndTagToBuilder=myActionsToConceptAndTagToBuilder.get(actions);
      for (      Pair<SNode,String> key : SetSequence.fromSet(conceptAndTagToBuilder.keySet())) {
        migrateSideTransformActions(actions,key.o1,key.o2,conceptAndTagToBuilder.get(key));
      }
    }
    Iterable<SNode> cellsWithTags=CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,"jetbrains.mps.lang.editor.structure.EditorCellModel"))).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(it,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x11beb039542L,0x11beb040d06L,"styleItem")),MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x11abb1e8d85L,"jetbrains.mps.lang.editor.structure.SideTransformAnchorTagStyleClassItem"))).isNotEmpty();
      }
    }
);
    for (    SNode cell : Sequence.fromIterable(cellsWithTags)) {
      String tag=SPropertyOperations.getString_def(Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x11beb039542L,0x11beb040d06L,"styleItem")),MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x11abb1e8d85L,"jetbrains.mps.lang.editor.structure.SideTransformAnchorTagStyleClassItem"))).first(),MetaAdapterFactory.getProperty(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x11abb1e8d85L,0x11abb1e8d86L,"tag"),null);
      if (eq_syzi2_a0b0i0c0m(tag,"")) {
        continue;
      }
      SNode concept=getConceptDeclaration(cell);
      if (concept == null) {
        continue;
      }
      SNode menu;
      menu=getOrFindMainMenu(concept,tag);
      if (menu == null) {
        continue;
      }
      SNode transformationMenuReference;
      transformationMenuReference=createTransformationMenuReference(menu,concept);
      if (transformationMenuReference != null) {
        SLinkOperations.setTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x3a52dff8e5ebd740L,"transformationMenu"),transformationMenuReference);
      }
    }
    Iterable<SNode> cellsWithApplySideTransform=CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,"jetbrains.mps.lang.editor.structure.EditorCellModel"))).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return (SLinkOperations.getTarget(it,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x10f3514bb7cL,"menuDescriptor")) != null) && Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(SLinkOperations.getTarget(it,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x10f3514bb7cL,"menuDescriptor")),MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x10f34f6aaacL,0x10f34f82910L,"cellMenuPart")),MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x72449b609d0e77bbL,"jetbrains.mps.lang.editor.structure.CellMenuPart_ApplySideTransforms"))).isNotEmpty();
      }
    }
);
    Map<Pair<SNode,Set<Pair<String,String>>>,SNode> appliesToAdditionalMenu=MapSequence.fromMap(new HashMap<Pair<SNode,Set<Pair<String,String>>>,SNode>());
    for (    SNode cell : Sequence.fromIterable(cellsWithApplySideTransform)) {
      Iterable<SNode> applySideTransforms=SNodeOperations.ofConcept(SLinkOperations.getChildren(SLinkOperations.getTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x10f3514bb7cL,"menuDescriptor")),MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x10f34f6aaacL,0x10f34f82910L,"cellMenuPart")),MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x72449b609d0e77bbL,"jetbrains.mps.lang.editor.structure.CellMenuPart_ApplySideTransforms"));
      SNode conceptDeclaration=getConceptDeclaration(cell);
      Pair<SNode,Set<Pair<String,String>>> key=new Pair<SNode,Set<Pair<String,String>>>(conceptDeclaration,new HashSet<Pair<String,String>>(Sequence.fromIterable(applySideTransforms).select(new ISelector<SNode,Pair<String,String>>(){
        public Pair<String,String> select(        SNode it){
          return new Pair<String,String>(SPropertyOperations.getString_def(it,MetaAdapterFactory.getProperty(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x72449b609d0e77bbL,0x72449b609d0f1475L,"side"),null),SPropertyOperations.getString_def(it,MetaAdapterFactory.getProperty(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x72449b609d0e77bbL,0xc14e9fba94cb682L,"tag"),null));
        }
      }
).toListSequence()));
      Map<SNode,Integer> conceptToCounter=MapSequence.fromMap(new HashMap<SNode,Integer>());
      SNode additionalMenu=MapSequence.fromMap(appliesToAdditionalMenu).get(key);
      SNode currentTransformationMenu=SLinkOperations.getTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x3a52dff8e5ebd740L,"transformationMenu"));
      if (currentTransformationMenu != null || additionalMenu == null) {
        additionalMenu=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x4e0f93d8a0ac4ee8L,"jetbrains.mps.lang.editor.structure.TransformationMenu_Named"));
        MapSequence.fromMap(appliesToAdditionalMenu).put(key,additionalMenu);
        ActionMigrationHelper.getEditorAspect(myLanguage).addRootNode(additionalMenu);
        SLinkOperations.setTarget(additionalMenu,MetaAdapterFactory.getReferenceLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x169efbc9a9048c53L,0x5b7b4c4d511049b4L,"conceptDeclaration"),conceptDeclaration);
        SPropertyOperations.set(additionalMenu,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name"),SLinkOperations.getTarget(additionalMenu,MetaAdapterFactory.getReferenceLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x169efbc9a9048c53L,0x5b7b4c4d511049b4L,"conceptDeclaration")) + "_ApplySideTransforms");
        if (MapSequence.fromMap(conceptToCounter).get(conceptDeclaration) == null) {
          MapSequence.fromMap(conceptToCounter).put(conceptDeclaration,1);
        }
 else {
          SPropertyOperations.set(additionalMenu,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name"),SPropertyOperations.getString_def(additionalMenu,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name"),"") + conceptToCounter);
          MapSequence.fromMap(conceptToCounter).put(conceptDeclaration,MapSequence.fromMap(conceptToCounter).get(conceptDeclaration) + 1);
        }
        SNode section=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x6ec02d9918b4efbcL,"jetbrains.mps.lang.editor.structure.TransformationMenuSection"));
        ListSequence.fromList(SLinkOperations.getChildren(section,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x6ec02d9918b4efbcL,0x6ec02d9918b4efbdL,"locations"))).addElement(_quotation_createNode_syzi2_a0a7a7a9a2a21());
        ListSequence.fromList(SLinkOperations.getChildren(additionalMenu,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x4e0f93d8a0c11832L,0x16be955f384efffcL,"sections"))).addElement(section);
        for (        SNode applySideTransform : Sequence.fromIterable(applySideTransforms)) {
          String tag=SPropertyOperations.getString_def(applySideTransform,MetaAdapterFactory.getProperty(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x72449b609d0e77bbL,0xc14e9fba94cb682L,"tag"),null);
          SNode location=createLocation(fromApplySideTransfrom(applySideTransform));
          SNode includeMenu=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xae2d2fe1c9d6be2L,"jetbrains.mps.lang.editor.structure.TransformationMenuPart_IncludeMenu"));
          SLinkOperations.setTarget(includeMenu,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xae2d2fe1c9d6be2L,0x1a0027b1197f7335L,"location"),location);
          SNode menu;
          menu=getOrFindMainMenu(conceptDeclaration,tag);
          if (menu != null) {
            SNode transformationMenuReference;
            transformationMenuReference=createTransformationMenuReference(menu,conceptDeclaration);
            if (transformationMenuReference != null) {
              SLinkOperations.setTarget(includeMenu,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xae2d2fe1c9d6be2L,0x5d3b34577b3f7ee5L,"menuReference"),transformationMenuReference);
            }
          }
          ListSequence.fromList(SLinkOperations.getChildren(section,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x6ec02d9918b4efbcL,0x6ec02d9918b4efbfL,"parts"))).addElement(includeMenu);
        }
      }
      for (      SNode applySideTransform : Sequence.fromIterable(applySideTransforms)) {
        CommentUtil.commentOut(applySideTransform);
      }
      if ((currentTransformationMenu != null)) {
        SNode includeSection=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x6ec02d9918b4efbcL,"jetbrains.mps.lang.editor.structure.TransformationMenuSection"));
        ListSequence.fromList(SLinkOperations.getChildren(includeSection,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x6ec02d9918b4efbcL,0x6ec02d9918b4efbdL,"locations"))).addSequence(ListSequence.fromList(Arrays.asList(_quotation_createNode_syzi2_a0a0b0l0j0c0m(),_quotation_createNode_syzi2_b0a0b0l0j0c0m())));
        ListSequence.fromList(SLinkOperations.getChildren(includeSection,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x6ec02d9918b4efbcL,0x6ec02d9918b4efbfL,"parts"))).addElement(_quotation_createNode_syzi2_a0a2a11a9a2a21(SNodeOperations.copyNode(SLinkOperations.getTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x3a52dff8e5ebd740L,"transformationMenu")))));
        ListSequence.fromList(SLinkOperations.getChildren(additionalMenu,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x4e0f93d8a0c11832L,0x16be955f384efffcL,"sections"))).addElement(includeSection);
      }
      SLinkOperations.setTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x3a52dff8e5ebd740L,"transformationMenu"),SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5d3b34577b3cff09L,"jetbrains.mps.lang.editor.structure.TransformationMenuReference_Named")));
      SLinkOperations.setTarget(SNodeOperations.cast(SLinkOperations.getTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x3a52dff8e5ebd740L,"transformationMenu")),MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5d3b34577b3cff09L,"jetbrains.mps.lang.editor.structure.TransformationMenuReference_Named")),MetaAdapterFactory.getReferenceLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5d3b34577b3cff09L,0x5d3b34577b3cff0aL,"menu"),additionalMenu);
      if (ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x10f3514bb7cL,"menuDescriptor")),MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x10f34f6aaacL,0x10f34f82910L,"cellMenuPart"))).isEmpty()) {
        CommentUtil.commentOut(SLinkOperations.getTarget(cell,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0xf9eafb9a39L,0x10f3514bb7cL,"menuDescriptor")));
      }
    }
  }
  ActionMigrationHelper.addMissingImports(myNewlyCreatedMenus,ActionMigrationHelper.getEditorAspect(myLanguage),ActionMigrationHelper.getActionsAspect(myLanguage),myLanguage.getRepository());
}
