{
  Set<String> roles=new HashSet<String>();
  for (  SNode child : expectedNode.getChildren()) {
    roles.add(child.getRoleInParent());
  }
  for (  SNode child : actualNode.getChildren()) {
    roles.add(child.getRoleInParent());
  }
  for (  String role : roles) {
    List<SNode> expectedChildren=expectedNode.getChildren(role);
    List<SNode> actualChildren=actualNode.getChildren(role);
    assertEquals(getErrorString("child count in role " + role,expectedNode,actualNode),expectedChildren.size(),actualChildren.size());
    Iterator<SNode> actualIterator=actualChildren.iterator();
    for (    SNode expectedChild : expectedChildren) {
      SNode actualChild=actualIterator.next();
      assertEquals(getErrorString("children in role " + role,expectedNode,actualNode),expectedChild.getNodeId(),actualChild.getNodeId());
      assertDeepNodeEquals(expectedChild,actualChild);
    }
  }
}
