{
  SNode res=(SNode)CopyUtil.copy(SLinkOperations.getTarget(SLinkOperations.getTarget(_context.getNode(),"containerDeclaration",false),"factory",true));
  List<SNode> tvDecls=SLinkOperations.getTargets(SLinkOperations.getTarget(_context.getNode(),"containerDeclaration",false),"typeVariableDeclaration",true);
  if (ListSequence.fromList(tvDecls).isNotEmpty()) {
    ArrayList<SNode> types=new ArrayList<SNode>(2);
    if ((SLinkOperations.getTarget(_context.getNode(),"keyType",true) != null)) {
      types.add(SLinkOperations.getTarget(_context.getNode(),"keyType",true));
    }
    if ((SLinkOperations.getTarget(_context.getNode(),"valueType",true) != null)) {
      types.add(SLinkOperations.getTarget(_context.getNode(),"valueType",true));
    }
    for (    SNode tvr : SNodeOperations.getDescendants(res,"jetbrains.mps.baseLanguage.structure.TypeVariableReference",false,new String[]{})) {
      SNodeOperations.replaceWithAnother(tvr,SNodeOperations.copyNode(ClassifierTypeUtil.getTypeCoercedToClassifierType(types.get(ListSequence.fromList(tvDecls).indexOf(SLinkOperations.getTarget(tvr,"typeVariableDeclaration",false))))));
    }
  }
  return res;
}
