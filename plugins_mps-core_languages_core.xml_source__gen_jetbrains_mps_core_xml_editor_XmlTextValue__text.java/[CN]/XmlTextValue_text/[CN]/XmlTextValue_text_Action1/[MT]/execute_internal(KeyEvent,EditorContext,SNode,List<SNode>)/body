{
  int index=((EditorCell_Label)editorContext.getSelectedCell()).getCaretPosition();
  SNode attr=SNodeOperations.cast(SNodeOperations.getParent(node),"jetbrains.mps.core.xml.structure.XmlAttribute");
  int currIndex=ListSequence.fromList(SLinkOperations.getTargets(attr,"value",true)).indexOf(node);
  String currText=SPropertyOperations.getString(node,"text");
  if (index < currText.length()) {
    SNode newText=SModelOperations.createNewNode(SNodeOperations.getModel(node),null,"jetbrains.mps.core.xml.structure.XmlTextValue");
    SPropertyOperations.set(newText,"text",currText.substring(index));
    SPropertyOperations.set(node,"text",currText.substring(0,index));
    ListSequence.fromList(SLinkOperations.getTargets(attr,"value",true)).insertElement(currIndex + 1,newText);
  }
  SNode newRef=SModelOperations.createNewNode(SNodeOperations.getModel(node),null,"jetbrains.mps.core.xml.structure.XmlEntityRefValue");
  ListSequence.fromList(SLinkOperations.getTargets(attr,"value",true)).insertElement(currIndex + 1,newRef);
  editorContext.selectWRTFocusPolicy(newRef);
}
