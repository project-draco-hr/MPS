{
  List<SNode> result=new ArrayList<SNode>();
  for (  final SNode oldPart : ListSequence.fromList(oldParts)) {
    if (SNodeOperations.isInstanceOf(oldPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121dfa84e4L,"jetbrains.mps.lang.actions.structure.AddMenuPart"))) {
      for (      SNode oldSubPart : ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(oldPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121dfa84e4L,"jetbrains.mps.lang.actions.structure.AddMenuPart")),MetaAdapterFactory.getContainmentLink(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121e8bfbfdL,0x1121e8c6f00L,"part")))) {
        if (SNodeOperations.isInstanceOf(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121e328443L,"jetbrains.mps.lang.actions.structure.SimpleItemSubstitutePart"))) {
          SNode action=createSimpleAction(SNodeOperations.cast(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121e328443L,"jetbrains.mps.lang.actions.structure.SimpleItemSubstitutePart")));
          result.add(action);
        }
 else         if (SNodeOperations.isInstanceOf(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121ecab8a6L,"jetbrains.mps.lang.actions.structure.ParameterizedSubstituteMenuPart"))) {
          SNode action=createParameterizedAction(SNodeOperations.cast(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121ecab8a6L,"jetbrains.mps.lang.actions.structure.ParameterizedSubstituteMenuPart")));
          result.add(action);
        }
 else         if (SNodeOperations.isInstanceOf(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1122264243cL,"jetbrains.mps.lang.actions.structure.ConceptsSubstituteMenuPart"))) {
          SNode part=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x49f6d25f12102816L,"jetbrains.mps.lang.editor.structure.SubstituteMenuPart_Concepts"));
          SLinkOperations.setTarget(part,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x49f6d25f12102816L,0x27a7ea2e01598c0cL,"concepts"),SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x27a7ea2e015982b3L,"jetbrains.mps.lang.editor.structure.QueryFunction_SubstituteMenu_Concepts")));
          SLinkOperations.setTarget(SLinkOperations.getTarget(part,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x49f6d25f12102816L,0x27a7ea2e01598c0cL,"concepts")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x108bbca0f48L,0x108bbd29b4aL,"body"),createNewStatementList(SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1122264243cL,"jetbrains.mps.lang.actions.structure.ConceptsSubstituteMenuPart")),MetaAdapterFactory.getContainmentLink(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1122264243cL,0x11222701290L,"query")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x108bbca0f48L,0x108bbd29b4aL,"body"))));
          List<SNode> expressionsToWrap=ListSequence.fromList(new ArrayList<SNode>());
          SNode body=SLinkOperations.getTarget(SLinkOperations.getTarget(part,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x49f6d25f12102816L,0x27a7ea2e01598c0cL,"concepts")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x108bbca0f48L,0x108bbd29b4aL,"body"));
          SNode lastStatement=ActionMigrationHelper.getLastStatement(body);
          if (SNodeOperations.isInstanceOf(lastStatement,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc56b213L,"jetbrains.mps.baseLanguage.structure.ExpressionStatement")) && !(SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SNodeOperations.cast(lastStatement,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc56b213L,"jetbrains.mps.baseLanguage.structure.ExpressionStatement")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc56b213L,0xf8cc56b214L,"expression")),MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf940cd6167L,"jetbrains.mps.baseLanguage.structure.NullLiteral")))) {
            ListSequence.fromList(expressionsToWrap).addElement(SLinkOperations.getTarget(SNodeOperations.cast(lastStatement,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc56b213L,"jetbrains.mps.baseLanguage.structure.ExpressionStatement")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc56b213L,0xf8cc56b214L,"expression")));
          }
          ListSequence.fromList(expressionsToWrap).addSequence(ListSequence.fromList(SNodeOperations.getNodeDescendants(body,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc67c7feL,"jetbrains.mps.baseLanguage.structure.ReturnStatement"),false,new SAbstractConcept[]{})).select(new ISelector<SNode,SNode>(){
            public SNode select(            SNode it){
              return SLinkOperations.getTarget(SNodeOperations.cast(it,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc67c7feL,"jetbrains.mps.baseLanguage.structure.ReturnStatement")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf8cc67c7feL,0xf8cc6bf96cL,"expression"));
            }
          }
));
          ListSequence.fromList(expressionsToWrap).visitAll(new IVisitor<SNode>(){
            public void visit(            SNode expression){
              SNode outputConcept=SLinkOperations.getTarget(SNodeOperations.cast(oldPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121dfa84e4L,"jetbrains.mps.lang.actions.structure.AddMenuPart")),MetaAdapterFactory.getReferenceLink(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x1121e8bfbfdL,0x1121e8c4fafL,"concept"));
              SNode expressionToReplaceWith=_quotation_createNode_uzg6hh_a0b0a0a8a1a0a0a0b0f(outputConcept);
              SNodeOperations.replaceWithAnother(expression,expressionToReplaceWith);
              SLinkOperations.setTarget(SNodeOperations.cast(SLinkOperations.getTarget(SNodeOperations.cast(SLinkOperations.getTarget(SNodeOperations.cast(expressionToReplaceWith,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xfb4ed32b7fL,"jetbrains.mps.baseLanguage.structure.ParenthesizedExpression")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xfb4ed32b7fL,0xfb4ed32b80L,"expression")),MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf940dabe4aL,"jetbrains.mps.baseLanguage.structure.CastExpression")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0xf940dabe4aL,0xf940dabe4cL,"expression")),MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x116b46a08c4L,"jetbrains.mps.baseLanguage.structure.DotExpression")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x116b46a08c4L,0x116b46a4416L,"operand"),expression);
            }
          }
);
          result.add(part);
        }
 else         if (SNodeOperations.isInstanceOf(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x11222a8b06bL,"jetbrains.mps.lang.actions.structure.WrapperSubstituteMenuPart"))) {
          SNode wrapper=SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5cc5669cafd1be9bL,"jetbrains.mps.lang.editor.structure.SubstituteMenuPart_Wrapper"));
          SLinkOperations.setTarget(wrapper,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5cc5669cafd1be9bL,0x5480a271c0d515beL,"reference"),_quotation_createNode_uzg6hh_a0b0c0a0a0a1a5(SLinkOperations.getTarget(SNodeOperations.cast(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x11222a8b06bL,"jetbrains.mps.lang.actions.structure.WrapperSubstituteMenuPart")),MetaAdapterFactory.getReferenceLink(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x11222a8b06bL,0x11222abec60L,"wrappedConcept"))));
          SLinkOperations.setTarget(wrapper,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5cc5669cafd1be9bL,0x5cc5669cafed6e4cL,"handler"),SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5cc5669cafd1c001L,"jetbrains.mps.lang.editor.structure.QueryFunction_SubstituteMenu_WrapperHandler")));
          SLinkOperations.setTarget(SLinkOperations.getTarget(wrapper,MetaAdapterFactory.getContainmentLink(0x18bc659203a64e29L,0xa83a7ff23bde13baL,0x5cc5669cafd1be9bL,0x5cc5669cafed6e4cL,"handler")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x108bbca0f48L,0x108bbd29b4aL,"body"),createNewStatementList(SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(oldSubPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x11222a8b06bL,"jetbrains.mps.lang.actions.structure.WrapperSubstituteMenuPart")),MetaAdapterFactory.getContainmentLink(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x11222a8b06bL,0x11222abbbb6L,"wrapperBlock")),MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x108bbca0f48L,0x108bbd29b4aL,"body"))));
          result.add(wrapper);
        }
      }
    }
 else     if (SNodeOperations.isInstanceOf(oldPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x112c58682cfL,"jetbrains.mps.lang.actions.structure.ConceptSubstitutePart"))) {
      result.add(_quotation_createNode_uzg6hh_a0a0a0a0b0f(SLinkOperations.getTarget(SNodeOperations.cast(oldPart,MetaAdapterFactory.getConcept(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x112c58682cfL,"jetbrains.mps.lang.actions.structure.ConceptSubstitutePart")),MetaAdapterFactory.getReferenceLink(0xaee9cad2acd44608L,0xaef20004f6a1cdbdL,0x112c58682cfL,0x112c58871bdL,"concept"))));
    }
  }
  return result;
}
