{
  Set<IModule> owningModules=SModelRepository.getInstance().getOwners(model,IModule.class);
  if (owningModules.isEmpty()) {
    LOG.error("couldn't create module context for node:" + "\ncouldn't find owner module for model '" + model.getModelUID() + "'");
    return null;
  }
  IModule module;
  if (owningModules.size() == 1 || !askIfMany) {
    module=owningModules.iterator().next();
  }
 else {
    Frame frame=null;
    AbstractProjectFrame projectFrame=project.getComponent(AbstractProjectFrame.class);
    if (projectFrame != null) {
      frame=projectFrame.getMainFrame();
    }
    ChooseModuleDialog md=new ChooseModuleDialog("Choose Context Module",frame,owningModules);
    md.showDialog();
    module=md.getResult();
  }
  return new ModuleContext(module,project);
}
