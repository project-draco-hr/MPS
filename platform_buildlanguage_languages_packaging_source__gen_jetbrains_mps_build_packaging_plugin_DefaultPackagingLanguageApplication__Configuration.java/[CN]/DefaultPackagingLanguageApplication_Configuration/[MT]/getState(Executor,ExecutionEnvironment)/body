{
  return new RunProfileState(){
    @Nullable public ExecutionResult execute(    Executor executor,    @NotNull ProgramRunner runner) throws ExecutionException {
      final ConsoleViewImpl consoleView=StacktraceUtil.createConsoleView(MPSDataKeys.PROJECT.getData(environment.getDataContext()));
      JComponent consoleComponent=null;
      Runnable consoleDispose=null;
      final List<AnAction> actions=ListSequence.fromList(new ArrayList<AnAction>());
      ProcessHandler handler=null;
      final SModelDescriptor currentModel=MPSDataKeys.CONTEXT_MODEL.getData(environment.getDataContext());
      final IOperationContext context=MPSDataKeys.OPERATION_CONTEXT.getData(environment.getDataContext());
      final Project project=MPSDataKeys.PROJECT.getData(environment.getDataContext());
      final ConfigRunParameters javaRunParameters=DefaultPackagingLanguageApplication_Configuration.this.getStateObject().myJavaRunParameters.copy();
      final SNode node=DefaultPackagingLanguageApplication_Configuration.this.getNodeForExecution(environment.getProject(),(javaRunParameters).getMake());
{
        ListSequence.fromList(actions).addSequence(ListSequence.fromList(new _FunctionTypes._return_P0_E0<List<AnAction>>(){
          public List<AnAction> invoke(){
{
              final List<AnAction> actionsList=ListSequence.fromListAndArray(new ArrayList<AnAction>(),consoleView.createConsoleActions());
              return actionsList;
            }
          }
        }
.invoke()));
        consoleComponent=consoleView.getComponent();
        consoleDispose=new Runnable(){
          public void run(){
            Disposer.dispose(consoleView);
          }
        }
;
        final Wrappers._T<ExecutionException> ex=new Wrappers._T<ExecutionException>(null);
        handler=(ProcessHandler)new _FunctionTypes._return_P0_E2<Object,ExecutionException,ExecutionException>(){
          public Object invoke() throws ExecutionException, ExecutionException {
            try {
              final Wrappers._T<SNode> configuration=new Wrappers._T<SNode>();
              final Wrappers._boolean isSelectedByUser=new Wrappers._boolean();
              ModelAccess.instance().runReadAction(new Runnable(){
                public void run(){
                  configuration.value=ListSequence.fromList(SLinkOperations.getTargets(node,"configuration",true)).first();
                  isSelectedByUser.value=ListSequence.fromList(SLinkOperations.getTargets(node,"configuration",true)).count() > 1;
                }
              }
);
              if (isSelectedByUser.value) {
                configuration.value=ConfigurationChooser.chooseConfiguration(node,configuration.value);
              }
              if (configuration.value == null) {
                throw new ExecutionException("Configuration is not selected.");
              }
              File file=GenerateTextFromBuild.generate(configuration.value,currentModel,context,project,true);
              if (file == null) {
                throw new ExecutionException("No executable file were generated.");
              }
              AntScriptRunner runner=new AntScriptRunner(javaRunParameters);
              Process process=runner.run(file);
              return new DefaultProcessHandler(consoleView,process,runner.getCommandString());
            }
 catch (            ExecutionException e) {
              ex.value=e;
              return null;
            }
          }
        }
.invoke();
        if (ex.value != null) {
          throw ex.value;
        }
      }
      final JComponent finalConsoleComponent=consoleComponent;
      final Runnable finalConsoleDispose=consoleDispose;
      final ProcessHandler finalHandler=handler;
      if (finalHandler == null) {
        return null;
      }
      return new ExecutionResult(){
        public ExecutionConsole getExecutionConsole(){
          return new ExecutionConsole(){
            public void dispose(){
              if (finalConsoleDispose == null) {
                return;
              }
              finalConsoleDispose.run();
            }
            public JComponent getComponent(){
              return finalConsoleComponent;
            }
            public JComponent getPreferredFocusableComponent(){
              return finalConsoleComponent;
            }
          }
;
        }
        public AnAction[] getActions(){
          return ListSequence.fromList(actions).toGenericArray(AnAction.class);
        }
        public ProcessHandler getProcessHandler(){
          return finalHandler;
        }
      }
;
    }
    public RunnerSettings getRunnerSettings(){
      return null;
    }
    public ConfigurationPerRunnerSettings getConfigurationSettings(){
      return null;
    }
  }
;
}
