{
  final List<EditorCell_Label> cells=allCells();
  List<Integer> startCellPosition=new ArrayList<Integer>();
  List<Integer> endCellPosition=new ArrayList<Integer>();
  StringBuilder sourceBuilder=new StringBuilder();
  boolean doubleSpace=false;
  for (  EditorCell_Label cell : cells) {
    if (cell.getStyle().get(StyleAttributes.PADDING_LEFT).getValue() >= 1.0 && !doubleSpace) {
      sourceBuilder.append(" ");
    }
    startCellPosition.add(sourceBuilder.length());
    sourceBuilder.append(cell.getRenderedText());
    endCellPosition.add(sourceBuilder.length());
    if (cell.getStyle().get(StyleAttributes.PADDING_RIGHT).getValue() >= 1.0) {
      sourceBuilder.append(" ");
      doubleSpace=true;
    }
 else {
      doubleSpace=false;
    }
  }
  List<Integer> resultIndex=new ArrayList<Integer>();
  List<Integer> startHighlightPosition=new ArrayList<Integer>();
  List<Integer> endHighlightPosition=new ArrayList<Integer>();
  Matcher matcher=getPattern().matcher(sourceBuilder.toString());
  while (matcher.find()) {
    int index=0;
    while (index < cells.size() && !((startCellPosition.get(index) <= matcher.start()) && (endCellPosition.get(index) > matcher.start()))) {
      index++;
    }
    if (index == cells.size()) {
      break;
    }
    myCells.add(cells.get(index));
    CellLayout cellLayout=cells.get(index).getParent().getCellLayout();
    int highlightLength=0;
    while (startCellPosition.get(index) < matcher.end()) {
      resultIndex.add(index);
      startHighlightPosition.add(Math.max(0,matcher.start() - startCellPosition.get(index)));
      endHighlightPosition.add(Math.min(matcher.end(),endCellPosition.get(index)) - startCellPosition.get(index));
      highlightLength++;
      index++;
    }
    index--;
    if (cellLayout instanceof CellLayout_Horizontal && !cellLayout.equals(cells.get(index).getParent().getCellLayout())) {
      for (int i=0; i < highlightLength; i++) {
        resultIndex.remove(resultIndex.size() - 1);
        startHighlightPosition.remove(startHighlightPosition.size() - 1);
        endHighlightPosition.remove(endHighlightPosition.size() - 1);
      }
      myCells.remove(myCells.size() - 1);
    }
  }
  myOwner=new EditorMessageOwner(){
  }
;
  if (!myCells.isEmpty()) {
    highlight(resultIndex,startHighlightPosition,endHighlightPosition);
  }
}
