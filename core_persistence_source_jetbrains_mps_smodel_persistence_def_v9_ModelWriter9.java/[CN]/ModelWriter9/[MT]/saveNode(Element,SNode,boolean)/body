{
  nodeElement.setAttribute(ModelPersistence9.CONCEPT_ID,myHelper.getConceptIndex(node.getConcept().getId()));
  nodeElement.setAttribute(ModelPersistence9.ID,node.getNodeId().toString());
  if (node.getParent() != null) {
    DocUtil.setNotNullAttribute(nodeElement,ModelPersistence9.ROLE_ID,myHelper.getNodeRoleIndex(node.getContainmentLink()));
  }
  String info=Util9.genNodeInfo(PersistenceRegistry.getInstance().getModelEnvironmentInfo(),node);
  DocUtil.setNotNullAttribute(nodeElement,ModelPersistence9.NODE_INFO,info);
  for (  SProperty pid : node.getProperties()) {
    Element propertyElement=new Element(ModelPersistence9.PROPERTY);
    propertyElement.setAttribute(ModelPersistence9.ROLE_ID,myHelper.getPropertyIndex(pid));
    DocUtil.setNotNullAttribute(propertyElement,ModelPersistence9.VALUE,node.getProperty(pid));
    nodeElement.addContent(propertyElement);
  }
  for (  SReference reference : node.getReferences()) {
    Element linkElement=new Element(ModelPersistence9.REFERENCE);
    linkElement.setAttribute(ModelPersistence9.ROLE_ID,myHelper.getReferenceRoleIndex(reference.getReferenceLink()));
    linkElement.setAttribute(ModelPersistence9.TARGET_NODE_ID,myHelper.getRefTarget(reference));
    DocUtil.setNotNullAttribute(linkElement,ModelPersistence9.RESOLVE_INFO,Util9.genResolveInfo(reference));
    nodeElement.addContent(linkElement);
  }
  if (saveChildren) {
    for (    SNode childNode : node.getChildren()) {
      Element childElement=new Element(ModelPersistence9.NODE);
      saveNode(childElement,childNode,true);
      nodeElement.addContent(childElement);
    }
  }
}
