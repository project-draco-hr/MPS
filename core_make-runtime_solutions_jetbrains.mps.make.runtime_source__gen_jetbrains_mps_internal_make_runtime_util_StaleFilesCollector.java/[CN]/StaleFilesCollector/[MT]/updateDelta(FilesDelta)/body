{
  final Set<IFile> filesToKeep=SetSequence.fromSet(new HashSet<IFile>());
  delta.acceptVisitor(new FilesDelta.Visitor(){
    @Override public boolean acceptWritten(    IFile file){
      SetSequence.fromSet(filesToKeep).addElement(file);
      return true;
    }
    @Override public boolean acceptKept(    IFile file){
      SetSequence.fromSet(filesToKeep).addElement(file);
      return true;
    }
  }
);
  for (  IFile f : collectFilesToDelete(filesToKeep)) {
    delta.stale(f);
  }
}
