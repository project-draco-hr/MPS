{
  HashSet<org.jetbrains.mps.openapi.model.SModelReference> allRefTargets=new HashSet<org.jetbrains.mps.openapi.model.SModelReference>();
  HashSet<org.jetbrains.mps.openapi.model.SModelReference> sourceModels=new HashSet<org.jetbrains.mps.openapi.model.SModelReference>();
  for (  SNode n : nodes) {
    if (myNeedConcepts) {
      myConcepts.add(n.getConcept());
    }
    if (myNeedLanguages) {
      myUsedLanguages.add(n.getConcept().getLanguage());
    }
    if (myNeedCrossModel) {
      final org.jetbrains.mps.openapi.model.SModel sourceModel=n.getModel();
      if (sourceModel != null) {
        sourceModels.add(sourceModel.getReference());
      }
      for (      SReference ref : n.getReferences()) {
        final org.jetbrains.mps.openapi.model.SModelReference targetModel=ref.getTargetSModelReference();
        if (targetModel != null) {
          allRefTargets.add(targetModel);
        }
      }
    }
  }
  if (myNeedCrossModel) {
    allRefTargets.removeAll(sourceModels);
    myCrossModelReferences.addAll(allRefTargets);
  }
  return this;
}
