{
  final List<SNode> pathToRoot=SModelUtils.getPathToRoot(e.getReference().getSourceNode());
  myCommandQueue.runTask(new Runnable(){
    public void run(){
      if (!(checkLoaded())) {
        return;
      }
      fireChangeUpdateStarted();
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          if (isAncestorAlreadyAdded(pathToRoot)) {
            return;
          }
          final SNodeId sourceNodeId=e.getReference().getSourceNode().getSNodeId();
          removeChanges(OldSetReferenceChange.class,new _FunctionTypes._return_P1_E0<Boolean,OldSetReferenceChange>(){
            public Boolean invoke(            OldSetReferenceChange ch){
              return ch.getAffectedNodeId().equals(sourceNodeId) && ch.getRole().equals(e.getReference().getRole());
            }
          }
);
          addChange(new DeleteReferenceChange(sourceNodeId,e.getModel(),e.getReference()),e.getAffectedRoot());
        }
      }
);
      fireChangeUpdateFinished();
    }
  }
);
}
