{
  waitForSomething(new Runnable(){
    public void run(){
      final FileStatus statusBefore=myFileStatusManager.getStatus(file);
      final _FunctionTypes._return_P0_E0<? extends Boolean> shouldStopWaiting=(expectedFileStatus == null ? new _FunctionTypes._return_P0_E0<Boolean>(){
        public Boolean invoke(){
          return statusBefore != myFileStatusManager.getStatus(file);
        }
      }
 : new _FunctionTypes._return_P0_E0<Boolean>(){
        public Boolean invoke(){
          return expectedFileStatus == myFileStatusManager.getStatus(file);
        }
      }
);
      final Wrappers._T<FileStatusListener> listener=new Wrappers._T<FileStatusListener>();
      final _FunctionTypes._void_P0_E0 stopIfNeeded=new _FunctionTypes._void_P0_E0(){
        public void invoke(){
          if (shouldStopWaiting.invoke()) {
            myFileStatusManager.removeFileStatusListener(listener.value);
            waitCompleted();
          }
        }
      }
;
      listener.value=new FileStatusListener(){
        public void fileStatusesChanged(){
          stopIfNeeded.invoke();
        }
        public void fileStatusChanged(        @NotNull VirtualFile f){
          stopIfNeeded.invoke();
        }
      }
;
      myFileStatusManager.addFileStatusListener(listener.value);
      task.run();
      VcsDirtyScopeManager.getInstance(myIdeaProject).fileDirty(file);
      myChangeListManager.ensureUpToDate(false);
      stopIfNeeded.invoke();
    }
  }
);
}
