{
  if (node == null) {
    return Collections.emptyList();
  }
  if (menuLookup == null) {
    menuLookup=new DefaultMenuLookup(LanguageRegistry.getInstance(myEditorContext.getRepository()),node.getConcept());
  }
  if (myKeyStack.contains(menuLookup)) {
    LOG.error("Menu for key '" + menuLookup + "' requested more than once, returning empty menu to prevent endless recursion");
    LOG.error("Current menu key stack: " + myKeyStack);
    return Collections.emptyList();
  }
  myKeyStack.addLast(menuLookup);
  List<MenuItem> result=createItemsInternal(menuLookup,node);
  myKeyStack.removeLast();
  return result;
}
