{
  final ModelFactory defaultModelFactory=PersistenceFacade.getInstance().getDefaultModelFactory();
  final ModelFactory perRootModelFactory=PersistenceRegistry.getInstance().getFolderModelFactory(FilePerRootModelPersistence.FACTORY_ID);
{
    final SearchScope scope=CommandUtil.createScope(p);
    QueryExecutionContext context=new QueryExecutionContext(){
      public SearchScope getDefaultSearchScope(){
        return scope;
      }
    }
;
    Iterable<PersistenceVersionAware> models=Sequence.fromIterable(CommandUtil.models(CommandUtil.createConsoleScope(null,false,context))).ofType(PersistenceVersionAware.class).where(new IWhereFilter<PersistenceVersionAware>(){
      public boolean accept(      PersistenceVersionAware it){
        return it.getPersistenceVersion() < 9;
      }
    }
).where(new IWhereFilter<PersistenceVersionAware>(){
      public boolean accept(      PersistenceVersionAware it){
        return it.getModelFactory() == defaultModelFactory || it.getModelFactory() == perRootModelFactory;
      }
    }
);
    Sequence.fromIterable(models).visitAll(new IVisitor<PersistenceVersionAware>(){
      public void visit(      PersistenceVersionAware model){
        model.load();
        model.setPersistenceVersion(9);
        ((EditableSModel)model).setChanged(true);
        ((EditableSModel)model).save();
      }
    }
);
    Sequence.fromIterable(models).select(new ISelector<PersistenceVersionAware,DataSource>(){
      public DataSource select(      PersistenceVersionAware it){
        return it.getSource();
      }
    }
).select(new ISelector<DataSource,IFile>(){
      public IFile select(      DataSource it){
        if (it instanceof FileDataSource) {
          IFile modelFile=as_jjkivq_a0a0a0a0a0a0a0a0g0d0e(it,FileDataSource.class).getFile();
          String modelPath=modelFile.getPath();
          return FileSystem.getInstance().getFileByPath(modelPath.substring(0,modelPath.length() - MPSExtentions.DOT_MODEL.length()) + MPSExtentions.DOT_REFACTORINGS);
        }
 else         if (it instanceof FilePerRootDataSource) {
          return as_jjkivq_a0a0a0a0a0a0a0a0g0d0e_0(it,FilePerRootDataSource.class).getFile(MPSExtentions.DOT_REFACTORINGS);
        }
 else {
          return null;
        }
      }
    }
).where(new IWhereFilter<IFile>(){
      public boolean accept(      IFile it){
        return it != null && it.exists();
      }
    }
).visitAll(new IVisitor<IFile>(){
      public void visit(      IFile it){
        it.delete();
      }
    }
);
  }
  return true;
}
