{
  File mpsPluginHome=null;
  String mpsCoreRes=getResource(MPSGenerationLauncher.class);
  if (mpsCoreRes.endsWith(".jar")) {
    mpsPluginHome=new File(mpsCoreRes).getParentFile().getParentFile();
  }
 else   if (mpsCoreRes.endsWith("classes")) {
    mpsPluginHome=new File(mpsCoreRes).getParentFile();
  }
  File[] pathsToLook=new File[]{new File(mpsPluginHome,"classes"),new File(mpsPluginHome,"lib"),new File(new File(mpsPluginHome,"languages"),"generate.ant.task.jar")};
  Set<File> classPaths=new LinkedHashSet<File>();
  for (  File path : pathsToLook) {
    if (!(path.exists()) || (!(path.isDirectory()) && !(path.getAbsolutePath().endsWith(".jar")))) {
      throw new Exception(mpsPluginHome + " is invalid MPS home path: path " + path+ " does not exist or is not a directory or a jar file.");
    }
 else     if (!(path.isDirectory())) {
      classPaths.add(path.getAbsoluteFile());
    }
 else {
      gatherAllClassesAndJarsUnder(path,classPaths);
    }
  }
  File classes=new File(mpsPluginHome,"classes");
  if (classes.exists()) {
    classPaths.add(classes);
  }
  return classPaths;
}
