{
  SNode newNode=doSubstitute(pattern);
  if (context != null) {
    if (newNode == null) {
      context.flushEvents();
      EditorCell selectedCell=context.getNodeEditorComponent().getSelectedCell();
      selectedCell.getContainingBigCell().synchronizeViewWithModel();
      context.getNodeEditorComponent().relayout();
      if (selectedCell instanceof EditorCell_Label && ((EditorCell_Label)selectedCell).isEditable()) {
        EditorCell_Label cell=(EditorCell_Label)selectedCell;
        cell.end();
      }
    }
 else {
      context.selectWRTFocusPolicy(newNode,true);
    }
  }
  return newNode;
}
