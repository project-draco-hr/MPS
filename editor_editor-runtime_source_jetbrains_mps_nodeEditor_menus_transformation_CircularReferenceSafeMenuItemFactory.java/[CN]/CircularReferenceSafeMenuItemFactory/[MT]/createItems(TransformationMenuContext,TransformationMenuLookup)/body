{
  Key key=new Key(menuLookup,context.getNode());
  if (myKeyStack.contains(key)) {
    LOG.error("Menu for key '" + key + "' requested more than once, returning empty menu to prevent endless recursion");
    LOG.error("Current menu key stack: " + myKeyStack);
    return Collections.emptyList();
  }
  myKeyStack.addLast(key);
  try {
    Collection<TransformationMenu> menus=menuLookup.lookup(myUsedLanguages);
    if (menus.isEmpty()) {
      return Collections.emptyList();
    }
    List<MenuItem> result=new ArrayList<>();
    for (    TransformationMenu menu : menus) {
      result.addAll(menu.createMenuItems(context));
    }
    return result;
  }
  finally {
    myKeyStack.removeLast();
  }
}
