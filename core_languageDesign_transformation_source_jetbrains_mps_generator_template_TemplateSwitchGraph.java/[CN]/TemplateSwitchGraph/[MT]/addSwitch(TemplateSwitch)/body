{
  if (myTemplateSwitchToGraphNodeMap.get(templateSwitch) != null) {
    throw new RuntimeException("Couldn't add template switch more then once: " + templateSwitch.getDebugText());
  }
  TemplateSwitchGraphNode switchNode=new TemplateSwitchGraphNode(templateSwitch);
  myTemplateSwitchToGraphNodeMap.put(templateSwitch,switchNode);
  TemplateSwitch modifiedSwitch=templateSwitch.getModifiedSwitch();
  if (modifiedSwitch != null) {
    TemplateSwitchGraphNode modifiedSwitchNode=myTemplateSwitchToGraphNodeMap.get(modifiedSwitch);
    if (modifiedSwitchNode == null) {
      modifiedSwitchNode=addSwitch(modifiedSwitch);
    }
    switchNode.myModifiedSwitchNode=modifiedSwitchNode;
    modifiedSwitchNode.myModifierSwitchNodes.add(switchNode);
  }
  return switchNode;
}
