{
  super(project,project.getBaseDir());
  myProject=project;
  List<ModuleTreeNode> moduleNodes=new LinkedList<ModuleTreeNode>();
  MPSProject mpsProject=project.getComponent(MPSProject.class);
  if (mpsProject != null) {
    List<? extends SModule> modules=mpsProject.getModules();
    for (    SModule m : modules) {
      if (m instanceof AbstractModule) {
        if (((AbstractModule)m).getDescriptorFile().exists()) {
          moduleNodes.add(new ModuleTreeNode(project,(AbstractModule)m));
        }
      }
    }
  }
  Collections.sort(moduleNodes,new jetbrains.mps.ide.projectPane.logicalview.nodes.ModuleTreeNodeComparator());
  MyNamespaceTreeBuilder builder=new MyNamespaceTreeBuilder();
  for (  ModuleTreeNode mtn : moduleNodes) {
    builder.addNode(mtn);
  }
  builder.fillNode(this);
  VirtualFile baseDir=project.getBaseDir();
  if (baseDir != null) {
    VirtualFile[] files=baseDir.getChildren();
    for (    VirtualFile f : files) {
      if (!f.isDirectory()) {
        add(new FileTreeNode(project,f));
      }
    }
  }
}
