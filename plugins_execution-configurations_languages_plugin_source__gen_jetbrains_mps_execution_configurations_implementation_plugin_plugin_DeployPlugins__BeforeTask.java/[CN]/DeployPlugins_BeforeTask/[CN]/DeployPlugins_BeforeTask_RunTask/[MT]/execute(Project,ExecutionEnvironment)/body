{
  if (ListSequence.fromList(myPlugins).isEmpty()) {
    return true;
  }
  final Project projectFinal=project;
  final Wrappers._T<Tuples._2<SModel,File>> deployScript=new Wrappers._T<Tuples._2<SModel,File>>();
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    public void run(){
      ModelAccess.instance().executeCommand(new Runnable(){
        public void run(){
          deployScript.value=DeployScriptCreator.createDeployScript(projectFinal,myPlugins);
        }
      }
,ProjectHelper.toMPSProject(projectFinal));
    }
  }
,ModalityState.NON_MODAL);
  File deployScriptFile=deployScript.value._1();
  SModel deployScriptModel=deployScript.value._0();
  MakeSession session=new MakeSession(new ProjectOperationContext(ProjectHelper.toMPSProject(project)),null,true);
  boolean generationSuccessful=IMakeService.INSTANCE.get().openNewSession(session);
  if (generationSuccessful) {
    Future<IResult> future=IMakeService.INSTANCE.get().make(session,new ModelsToResources(new ProjectOperationContext(ProjectHelper.toMPSProject(project)),Sequence.<SModel>singleton(deployScriptModel)).resources(false));
    IResult result=null;
    try {
      result=future.get();
    }
 catch (    CancellationException ignore) {
    }
catch (    InterruptedException ignore) {
    }
catch (    ExecutionException ignore) {
    }
    generationSuccessful&=(result != null) && result.isSucessful();
  }
  final SModule deployScriptModule=deployScriptModel.getModule();
  FileUtil.delete(new File(((AbstractModule)deployScriptModule).getOutputPath().getPath().replace("/",File.separator)));
  FileUtil.delete(new File(FileGenerationUtil.getCachesDir(((AbstractModule)deployScriptModule).getOutputPath()).getPath().replace("/",File.separator)));
  ModelAccess.instance().runWriteAction(new Runnable(){
    public void run(){
      MPSModuleRepository.getInstance().unregisterModule(deployScriptModule,ProjectHelper.toMPSProject(projectFinal));
    }
  }
);
  if (!(generationSuccessful)) {
    FileUtil.delete(deployScriptFile.getParentFile());
    return false;
  }
  final ConsoleView console=ConsoleCreator.createConsoleView(project,false);
  console.addMessageFilter(new StandaloneMPSStackTraceFilter(project));
  final Wrappers._T<ProcessHandler> process=new Wrappers._T<ProcessHandler>();
  try {
    process.value=OutputRedirector.redirect(new Ant_Command().setTargetName_String("buildDependents assemble").createProcess(deployScriptFile.getAbsolutePath()),new ConsoleProcessListener(console));
  }
 catch (  com.intellij.execution.ExecutionException e) {
    if (LOG.isEnabledFor(Priority.ERROR)) {
      LOG.error("Can not deploy plugins",e);
    }
    FileUtil.delete(deployScriptFile.getParentFile());
    return false;
  }
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    public void run(){
      Executor executor=DefaultRunExecutor.getRunExecutorInstance();
      DefaultActionGroup group=new DefaultActionGroup();
      JPanel consolePanel=new JPanel(new BorderLayout());
      consolePanel.add(ActionManager.getInstance().createActionToolbar(ActionPlaces.UNKNOWN,group,false).getComponent(),BorderLayout.WEST);
      consolePanel.add(console.getComponent(),BorderLayout.CENTER);
      Icon icon=null;
      String iconPath=MacrosFactory.forModule((AbstractModule)ModuleRepositoryFacade.getInstance().getModule(PersistenceFacade.getInstance().createModuleReference("798100da-4f0a-421a-b991-71f8c50ce5d2(jetbrains.mps.build)"))).expandPath("${language_descriptor}/icons/buildProject.png");
      if ((iconPath != null && iconPath.length() > 0)) {
        icon=IconManager.loadIcon(iconPath,false);
      }
      RunContentDescriptor descriptor=new RunContentDescriptor(console,process.value,consolePanel,"Deploy plugins",icon);
      group.add(ActionManager.getInstance().getAction("Stop"));
      group.addSeparator();
      group.add(new CloseAction(executor,descriptor,projectFinal));
      ExecutionManager.getInstance(projectFinal).getContentManager().showRunContent(executor,descriptor);
    }
  }
,ModalityState.NON_MODAL);
  int exitCode=ProcessHandlerBuilder.startAndWait(process.value);
  if (exitCode != 0) {
    FileUtil.delete(deployScriptFile.getParentFile());
    return false;
  }
  FileUtil.copyDir(new File(deployScriptFile.getParentFile(),"build" + File.separator + "artifacts"+ File.separator+ "deploy"),myDeployLocation);
  FileUtil.delete(deployScriptFile.getParentFile());
  return true;
}
