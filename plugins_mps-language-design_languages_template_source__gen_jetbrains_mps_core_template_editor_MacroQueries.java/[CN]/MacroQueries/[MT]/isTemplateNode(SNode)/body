{
  if (SNodeOperations.getAncestor(node,"jetbrains.mps.core.template.structure.MtlTemplate",false,false) == null) {
    return false;
  }
  SNode current=node;
  while (SNodeOperations.getParent(current) != null) {
    if (SNodeOperations.isAttribute(SNodeOperations.getParent(current))) {
      return false;
    }
    if (SNodeOperations.isInstanceOf(SNodeOperations.getParent(current),"jetbrains.mps.core.template.structure.MtlTemplate")) {
      return SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(current),"jetbrains.mps.core.template.structure.MtlTemplate"),"template",true) == current;
    }
    current=SNodeOperations.getParent(current);
  }
  return false;
}
