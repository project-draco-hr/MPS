{
  Set<File> classPath=new LinkedHashSet<File>();
  String mpsHome=getProject().getProperty("artifacts.mps");
  String pluginHome=getProject().getProperty("artifacts.mpsPlugin");
  String ideaHome=getProject().getProperty("artifacts.IDEA");
  String mpsCoreHome=getProject().getProperty("artifacts.mpsBootstrapCore");
  String mpsWorkbenchHome=getProject().getProperty("artifacts.mpsWorkbench");
  if ((mpsHome != null && mpsHome.length() > 0)) {
    gatherAllClassesAndJarsUnder(new File(mpsHome,"lib"),classPath);
  }
 else   if ((pluginHome != null && pluginHome.length() > 0) && (ideaHome != null && ideaHome.length() > 0)) {
    gatherAllClassesAndJarsUnder(new File(ideaHome,"lib"),classPath);
    gatherAllClassesAndJarsUnder(new File(pluginHome,"mps-core/lib"),classPath);
  }
 else   if ((mpsCoreHome != null && mpsCoreHome.length() > 0) && (ideaHome != null && ideaHome.length() > 0)) {
    gatherAllClassesAndJarsUnder(new File(mpsCoreHome,"lib"),classPath);
    gatherAllClassesAndJarsUnder(new File(ideaHome,"lib"),classPath);
    if ((mpsWorkbenchHome != null && mpsWorkbenchHome.length() > 0)) {
      gatherAllClassesAndJarsUnder(new File(mpsWorkbenchHome,"lib"),classPath);
    }
  }
 else {
    throw new BuildException("Dependency on MPS build scripts is required to generate MPS modules.");
  }
  return classPath;
}
