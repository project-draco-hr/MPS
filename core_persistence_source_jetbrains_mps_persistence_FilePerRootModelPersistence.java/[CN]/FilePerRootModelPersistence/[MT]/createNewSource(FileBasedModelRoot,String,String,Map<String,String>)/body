{
  options.put(ModelFactory.OPTION_MODELNAME,modelName);
  options.put(ModelFactory.OPTION_MODULEREF,modelRoot.getModule().getModuleReference().toString());
  Collection<String> sourceRoots=new LinkedHashSet<String>(modelRoot.getFiles(FileBasedModelRoot.SOURCE_ROOTS));
  if (sourceRoots.isEmpty()) {
    throw new IOException("empty list of source roots");
  }
  final boolean isModelRootInLanguage=modelRoot.getModule() instanceof Language;
  if (sourceRoot == null || !sourceRoots.contains(sourceRoot)) {
    String tmpSR=null;
    for (    String sr : sourceRoots) {
      if (isModelRootInLanguage && DefaultModelRoot.isLanguageAspectsSourceRoot(sr)) {
        continue;
      }
      if (sourceRoot != null && FileUtil.isSubPath(sr,sourceRoot)) {
        tmpSR=sourceRoot;
        break;
      }
      tmpSR=tmpSR == null ? sr : tmpSR;
    }
    if (tmpSR == null) {
      throw new IOException("no suitable source root found");
    }
    sourceRoot=(sourceRoot != null && sourceRoot.equals(tmpSR)) ? sourceRoot : tmpSR;
  }
  IFile folder;
  if (options.containsKey(ModelFactory.OPTION_RELPATH)) {
    String path=sourceRoot + File.separatorChar + options.get(ModelFactory.OPTION_RELPATH);
    folder=FileSystem.getInstance().getFileByPath(path);
  }
 else {
    folder=FileSystem.getInstance().getFileByPath(sourceRoot).getDescendant(modelName);
  }
  if (folder.getDescendant(FilePerRootDataSource.HEADER_FILE).exists()) {
    throw new IOException("model already exists");
  }
  return new FilePerRootDataSource(folder,modelRoot);
}
