{
  Collection<String> sourceRoots=new LinkedHashSet<String>(modelRoot.getFiles(FileBasedModelRoot.SOURCE_ROOTS));
  if (sourceRoots.isEmpty()) {
    throw new IOException("empty list of source roots");
  }
  if (sourceRoot == null || !sourceRoots.contains(sourceRoot)) {
    sourceRoot=null;
    for (    String sr : sourceRoots) {
      if (modelRoot instanceof DefaultModelRoot && ((DefaultModelRoot)modelRoot).isLanguageAspectsSourceRoot(sr)) {
        continue;
      }
      sourceRoot=sr;
      break;
    }
    if (sourceRoot == null) {
      throw new IOException("no suitable source root found");
    }
  }
  IFile folder=FileSystem.getInstance().getFileByPath(sourceRoot + File.separator + NameUtil.pathFromNamespace(modelName));
  if (folder.getDescendant(FilePerRootDataSource.HEADER_FILE).exists()) {
    throw new IOException("model already exists");
  }
  return new FilePerRootDataSource(folder,modelRoot);
}
