{
  if (outputDir == null)   throw new RuntimeException("unspecified output path for file generation.");
  if (!status.isOk()) {
    return false;
  }
  File outputRootDirectory=new File(outputDir);
  GeneratorManager gm=context.getComponent(GeneratorManager.class);
  Map<SNode,String> outputNodeContents=new LinkedHashMap<SNode,String>();
  boolean ok=true;
  if (!generateText(context,status,outputNodeContents,outputDir)) {
    return false;
  }
  Set<File> generatedFiles=new HashSet<File>();
  Set<File> directories=new HashSet<File>();
  generateFiles(status,outputRootDirectory,gm,outputNodeContents,generatedFiles,directories);
  MPSVCSManager manager=context.getProject().getComponent(MPSVCSManager.class);
  manager.addFilesToVcs(new ArrayList<File>(generatedFiles),false);
  refreshGeneratedFiles(generatedFiles);
  directories.add(getDefaultOutputDir(status.getInputModel(),outputRootDirectory));
  cleanUp(context,generatedFiles,directories);
  return ok;
}
