{
  SModule module=scope.resolve(reference);
  if (module != null && !(moduleClass.isInstance(module))) {
    throw new IllegalStateException();
  }
  return (T)module;
}
