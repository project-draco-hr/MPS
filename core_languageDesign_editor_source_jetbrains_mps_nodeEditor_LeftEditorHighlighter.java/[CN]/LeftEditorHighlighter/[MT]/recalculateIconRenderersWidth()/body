{
  myLineToRenderersMap.clear();
  for (  EditorMessageIconRenderer renderer : myIconRenderers) {
    int yCoordinate=getIconCoordinate(renderer);
    if (yCoordinate < 0) {
      continue;
    }
    List<IconRendererLayoutConstraint> renderersForLine=myLineToRenderersMap.get(yCoordinate);
    if (renderersForLine == null) {
      renderersForLine=new SortedList(myIconRenderersComparator);
      myLineToRenderersMap.put(yCoordinate,renderersForLine);
    }
    renderersForLine.add(new IconRendererLayoutConstraint(renderer));
  }
  myIconRenderersWidth=0;
  myMaxIconHeight=0;
  int[] sortedYCoordinates=myLineToRenderersMap.keys();
  Arrays.sort(sortedYCoordinates);
  int lastRowLowerBound=-1;
  int lastRowWidth=-1;
  for (  int y : sortedYCoordinates) {
    List<IconRendererLayoutConstraint> row=myLineToRenderersMap.get(y);
    if (row.size() == 0) {
      continue;
    }
    int maxIconHeight=0;
    for (    IconRendererLayoutConstraint rendererConstraint : row) {
      maxIconHeight=Math.max(maxIconHeight,rendererConstraint.getIconRenderer().getIcon().getIconHeight());
    }
    myMaxIconHeight=Math.max(myMaxIconHeight,maxIconHeight);
    int rowUpperBoundY=y - maxIconHeight / 2;
    int offset;
    if (lastRowLowerBound > 0 && lastRowLowerBound >= rowUpperBoundY) {
      offset=lastRowWidth;
    }
 else {
      offset=LEFT_GAP;
    }
    for (    IconRendererLayoutConstraint rendererConstraint : row) {
      rendererConstraint.setX(offset);
      offset+=rendererConstraint.getIconRenderer().getIcon().getIconWidth() + GAP_BETWEEN_ICONS;
    }
    lastRowLowerBound=rowUpperBoundY + maxIconHeight;
    lastRowWidth=offset;
    myIconRenderersWidth=Math.max(myIconRenderersWidth,lastRowWidth);
  }
}
