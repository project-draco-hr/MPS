{
  ModelAccess.assertLegalWrite();
  final jetbrains.mps.smodel.SModel oldSModel=getCurrentModelInternal();
  if (oldSModel != null) {
    (oldSModel).setModelDescriptor(null);
  }
  replacer.run();
  jetbrains.mps.smodel.SModel newModel=getCurrentModelInternal();
  if (newModel != null) {
    (newModel).setModelDescriptor(this);
  }
  notifyModelReplaced(oldSModel.getModelDescriptor());
  MPSModuleRepository.getInstance().invalidateCaches();
}
