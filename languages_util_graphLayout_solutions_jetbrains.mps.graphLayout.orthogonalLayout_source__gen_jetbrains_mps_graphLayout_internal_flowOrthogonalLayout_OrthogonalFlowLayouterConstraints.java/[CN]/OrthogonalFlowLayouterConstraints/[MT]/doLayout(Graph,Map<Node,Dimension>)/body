{
  Graph copy=new Graph();
  Map<Node,Node> nodeMap=MapSequence.<Node,Node>fromMap(new HashMap<Node,Node>());
  Map<Edge,Edge> edgeMap=MapSequence.<Edge,Edge>fromMap(new HashMap<Edge,Edge>());
  Map<Node,Dimension> copySizes=MapSequence.<Node,Dimension>fromMap(new LinkedHashMap<Node,Dimension>(16,(float)0.75,false));
  for (  Node node : ListSequence.<Node>fromList(graph.getNodes())) {
    Node copyNode=copy.createNode();
    MapSequence.<Node,Node>fromMap(nodeMap).put(node,copyNode);
    MapSequence.<Node,Dimension>fromMap(copySizes).put(copyNode,MapSequence.<Node,Dimension>fromMap(nodeSizes).get(node));
  }
  for (  Edge edge : ListSequence.<Edge>fromList(graph.getEdges())) {
    MapSequence.<Edge,Edge>fromMap(edgeMap).put(edge,copy.connect(MapSequence.<Node,Node>fromMap(nodeMap).get(edge.getSource()),MapSequence.<Node,Node>fromMap(nodeMap).get(edge.getTarget())));
  }
  GraphLayout copyLayout=getLayoutCorruptGraph(copy,copySizes);
  GraphLayout layout=GraphLayoutFactory.createGraphLayout(graph);
  for (  Node node : ListSequence.<Node>fromList(graph.getNodes())) {
    layout.setLayoutFor(node,copyLayout.getNodeLayout(MapSequence.<Node,Node>fromMap(nodeMap).get(node)));
  }
  for (  Edge edge : ListSequence.<Edge>fromList(graph.getEdges())) {
    Edge copyEdge=MapSequence.<Edge,Edge>fromMap(edgeMap).get(edge);
    List<Point> copyEdgeLayout=copyLayout.getEdgeLayout(copyEdge);
    if (copyEdge.getSource() != MapSequence.<Node,Node>fromMap(nodeMap).get(edge.getSource())) {
      copyEdgeLayout=ListSequence.<Point>fromList(copyEdgeLayout).reversedList();
    }
    layout.setLayoutFor(edge,copyEdgeLayout);
  }
  Rectangle rect=layout.getContainingRectangle();
  layout=layout.shift(20 - rect.x,20 - rect.y);
  return layout;
}
