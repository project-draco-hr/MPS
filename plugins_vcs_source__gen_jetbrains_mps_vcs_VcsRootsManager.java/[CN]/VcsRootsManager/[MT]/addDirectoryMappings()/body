{
  MPSProject mpsProject=myProject.getComponent(MPSProject.class);
  List<IModule> allModules=mpsProject.getModules();
  final Map<AbstractVcs,Set<VirtualFile>> vcss=new HashMap<AbstractVcs,Set<VirtualFile>>();
  for (  IModule module : allModules) {
    if (module.isPackaged()) {
      continue;
    }
    IFile descriptor=module.getDescriptorFile();
    if (descriptor == null) {
      continue;
    }
    VirtualFile file=VirtualFileUtils.getVirtualFile(descriptor.getParent());
    discoverMappingsForFile(vcss,file);
    List<SModelRoot> modelRoots=module.getSModelRoots();
    for (    SModelRoot root : modelRoots) {
      discoverMappingsForFile(vcss,LocalFileSystem.getInstance().findFileByPath(root.getPath()));
    }
  }
  StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
    public void run(){
      final List<VcsDirectoryMapping> vcsMappings=createMappings(vcss);
      mergeWithCurrentOnes(vcsMappings);
      myVcsManager.setDirectoryMappings(vcsMappings);
    }
  }
);
}
