{
  EditorCell contextCell=context.getSelectedCell();
  SNode node=contextCell.getSNode();
  SNode linkDeclaration=SNodeOperations.cast(((jetbrains.mps.nodeEditor.cells.EditorCell)contextCell).getLinkDeclaration(),"jetbrains.mps.lang.structure.structure.LinkDeclaration");
  SNode genuineLinkDeclaration=SModelUtil.getGenuineLinkDeclaration(linkDeclaration);
  if (linkDeclaration != null && SPropertyOperations.hasValue(genuineLinkDeclaration,"metaClass","reference","reference")) {
    String role=SPropertyOperations.getString(genuineLinkDeclaration,"role");
    AttributeOperations.createAndSetAttrbiute(node,new IAttributeDescriptor.LinkAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.pattern.structure.LinkPatternVariableDeclaration"),role),"jetbrains.mps.lang.pattern.structure.LinkPatternVariableDeclaration");
  }
 else {
    AttributeOperations.createAndSetAttrbiute(node,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.pattern.structure.Pattern")),"jetbrains.mps.lang.pattern.structure.PatternVariableDeclaration");
  }
}
