{
  Project p=PlatformDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext(this));
  IdeFocusManager focusManager;
  if (p != null) {
    focusManager=IdeFocusManager.getInstance(p);
  }
 else {
    focusManager=IdeFocusManagerHeadless.INSTANCE;
  }
  focusManager.requestFocus(this,true);
  focusManager.doWhenFocusSettlesDown(new Runnable(){
    public void run(){
      TreePath path=getClosestPathForLocation(e.getX(),e.getY());
      if (path == null)       return;
      Object lastPathComponent=path.getLastPathComponent();
      if (lastPathComponent instanceof MPSTreeNode && ((MPSTreeNode)lastPathComponent).canBeOpened()) {
        MPSTreeNode nodeToClick=(MPSTreeNode)lastPathComponent;
        if ((e.getClickCount() == 1 && isAutoOpen())) {
          nodeToClick.autoscroll();
        }
 else         if (e.getClickCount() == 2) {
          nodeToClick.doubleClick();
        }
        e.consume();
      }
 else       if (e.getButton() == MouseEvent.BUTTON3) {
        if (!isPathSelected(path)) {
          setSelectionPath(path);
        }
      }
      if (e.isPopupTrigger())       showPopup(e.getX(),e.getY());
    }
  }
);
}
