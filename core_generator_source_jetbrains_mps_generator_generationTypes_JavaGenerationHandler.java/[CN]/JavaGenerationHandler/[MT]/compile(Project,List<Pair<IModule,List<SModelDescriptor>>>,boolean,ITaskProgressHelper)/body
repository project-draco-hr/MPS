{
  boolean compiledSuccessfully=generationOK;
  if (generationOK) {
    long compilationStart=System.currentTimeMillis();
    boolean needToReload=false;
    Set<SModelDescriptor> toInvalidate=new HashSet<SModelDescriptor>();
    for (    Pair<IModule,List<SModelDescriptor>> moduleListPair : input) {
      IModule module=moduleListPair.o1;
      if (module != null && module.reloadClassesAfterGeneration()) {
        needToReload=true;
      }
      boolean compilationResult=compileModuleInMPS(module,progressHelper);
      compiledSuccessfully=compiledSuccessfully && compilationResult;
      toInvalidate.addAll(moduleListPair.o2);
    }
    for (    SModelDescriptor sm : toInvalidate) {
      ModelGenerationStatusManager.getInstance().invalidateData(sm);
    }
    if (compiledSuccessfully && needToReload) {
      reloadClasses(progressHelper);
    }
    info("Compilation finished in " + (System.currentTimeMillis() - compilationStart) + " ms");
  }
  return compiledSuccessfully;
}
