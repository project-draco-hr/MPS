{
  jetbrains.mps.openapi.editor.cells.EditorCell focusedCell=findCellWhichAttractsFocus(selectedCell,true,true);
  if (focusedCell == null) {
    focusedCell=selectedCell;
  }
  if (focusedCell.getStyle().get(StyleAttributes.FOCUS_POLICY) == jetbrains.mps.editor.runtime.style.FocusPolicy.FIRST_EDITABLE_CELL || focusedCell.getStyle().get(StyleAttributes.FOCUS_POLICY) == jetbrains.mps.editor.runtime.style.FocusPolicy.ATTRACTS_RECURSIVELY) {
    jetbrains.mps.openapi.editor.cells.EditorCell result=((EditorCell)focusedCell).findChild(CellFinders.or(CellFinders.FIRST_ERROR,CellFinders.FIRST_EDITABLE));
    if (result != null) {
      return result;
    }
  }
  while (focusedCell instanceof EditorCell_Collection && ((EditorCell_Collection)focusedCell).isTransparentCollection()) {
    focusedCell=((EditorCell_Collection)focusedCell).getChildAt(0);
  }
  return focusedCell;
}
