{
  Selection selection=selectionManager.getSelection();
  if (selection == null) {
    return null;
  }
  List<EditorCell> selectedCells=selection.getSelectedCells();
  EditorCell cell=myHome ? selectedCells.get(0) : selectedCells.get(selectedCells.size() - 1);
  EditorCell leaf=myHome ? ((jetbrains.mps.nodeEditor.cells.EditorCell)cell).getLeafToLeft(jetbrains.mps.nodeEditor.cells.CellConditions.SELECTABLE) : ((jetbrains.mps.nodeEditor.cells.EditorCell)cell).getLeafToRight(jetbrains.mps.nodeEditor.cells.CellConditions.SELECTABLE);
  if (leaf != null) {
    return leaf;
  }
  return myHome ? CellTraversalUtil.getPrevLeaf(cell,CellConditions.SELECTABLE) : CellTraversalUtil.getNextLeaf(cell,CellConditions.SELECTABLE);
}
