{
  Iterable<SNodeId> allRootIds=ListSequence.fromList(jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations.roots(myOldModel,null)).concat(ListSequence.fromList(jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations.roots(myNewModel,null))).select(new ISelector<SNode,SNodeId>(){
    public SNodeId select(    SNode n){
      return n.getNodeId();
    }
  }
);
  for (  SNodeId rootId : SetSequence.fromSetWithValues(new HashSet<SNodeId>(),allRootIds)) {
    buildForNode(myOldModel.getNode(rootId),myNewModel.getNode(rootId));
  }
  buildForMetadata();
  if (withOpposite) {
    myChangeSet.buildOppositeChangeSet();
  }
}
