{
  Iterable<SNodeId> allRootIds=ListSequence.fromList(SModelOperations.getRoots(((org.jetbrains.mps.openapi.model.SModel)myOldModel.getModelDescriptor()),null)).concat(ListSequence.fromList(SModelOperations.getRoots(((org.jetbrains.mps.openapi.model.SModel)myNewModel.getModelDescriptor()),null))).select(new ISelector<SNode,SNodeId>(){
    public SNodeId select(    SNode n){
      return n.getNodeId();
    }
  }
);
  for (  SNodeId rootId : SetSequence.fromSetWithValues(new HashSet<SNodeId>(),allRootIds)) {
    buildForNode(myOldModel.getNode(rootId),myNewModel.getNode(rootId));
  }
  buildForMetadata();
  if (withOpposite) {
    myChangeSet.buildOppositeChangeSet();
  }
}
