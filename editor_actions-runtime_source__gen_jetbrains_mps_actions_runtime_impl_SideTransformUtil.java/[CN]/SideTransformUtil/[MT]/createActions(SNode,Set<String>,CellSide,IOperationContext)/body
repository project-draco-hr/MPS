{
  Set<SNode> conceptsToRemove=SetSequence.fromSet(new HashSet<SNode>());
  List<SNode> removeByConditions=new ArrayList<SNode>();
  List<INodeSubstituteAction> result=ListSequence.fromList(new LinkedList<INodeSubstituteAction>());
  for (  SNode actionBuilder : Sequence.fromIterable(getApplicableActionsBuilders(node,stringTags,cellSide,context))) {
    SetSequence.fromSet(conceptsToRemove).addSequence(ListSequence.fromList(SNodeOperations.getDescendants(actionBuilder,"jetbrains.mps.lang.actions.structure.RemovePart",false,new String[]{})).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return (SLinkOperations.getTarget(it,"conceptToRemove",false) != null);
      }
    }
).select(new ISelector<SNode,SNode>(){
      public SNode select(      SNode it){
        return SLinkOperations.getTarget(it,"conceptToRemove",false);
      }
    }
));
    ListSequence.fromList(removeByConditions).addSequence(ListSequence.fromList(SNodeOperations.getDescendants(actionBuilder,"jetbrains.mps.lang.actions.structure.RemoveSTByConditionPart",false,new String[]{})));
    ListSequence.fromList(result).addSequence(ListSequence.fromList(invokeActionBuilder(actionBuilder,node,cellSide,context)));
  }
  for (  SNode removeByCondition : ListSequence.fromList(removeByConditions)) {
    invokeRemoveByCondition(removeByCondition,ListSequence.fromList(result).iterator(),node,context);
  }
  for (Iterator<INodeSubstituteAction> it=ListSequence.fromList(result).iterator(); it.hasNext(); ) {
    INodeSubstituteAction action=it.next();
    SNode concept=SNodeOperations.cast(action.getOutputConcept(),"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration");
    if (SetSequence.fromSet(conceptsToRemove).contains(concept)) {
      it.remove();
    }
  }
  return result;
}
