{
  if (quotationNode == null) {
    return null;
  }
  SNode aq=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c104658L,"jetbrains.mps.lang.quotation.structure.Antiquotation")));
  if ((aq != null)) {
    SNode expr=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,"jetbrains.mps.lang.quotation.structure.NodeBuilderExpression")));
    SLinkOperations.setTarget(expr,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,0x718e3f4cb7a31330L,"expression"),SLinkOperations.getTarget(aq,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c104656L,0x1168c104657L,"expression")));
    return expr;
  }
  SNode la=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.NodeAttribute(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c10465eL,"jetbrains.mps.lang.quotation.structure.ListAntiquotation")));
  if ((la != null)) {
    SNode expr=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,"jetbrains.mps.lang.quotation.structure.NodeBuilderExpression")));
    SLinkOperations.setTarget(expr,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,0x718e3f4cb7a31330L,"expression"),SLinkOperations.getTarget(la,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c104656L,0x1168c104657L,"expression")));
    return expr;
  }
  SNode result=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20a4aa0L,"jetbrains.mps.lang.quotation.structure.NodeBuilderNode")));
  SLinkOperations.setTarget(result,MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20a4aa0L,0x4bb51009d20b02b1L,"concept"),(SNode)SNodeOperations.asNode(SNodeOperations.getConcept(quotationNode)));
  Collection<SProperty> conceptProperties=SNodeOperations.getConcept(quotationNode).getProperties();
  List<SProperty> properties=CollectionSequence.fromCollection(conceptProperties).sort(new ISelector<SProperty,String>(){
    public String select(    SProperty it){
      return it.getName();
    }
  }
,true).toListSequence();
  for (  SProperty property : properties) {
    SNode attribute=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.PropertyAttribute(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x116aac96587L,"jetbrains.mps.lang.quotation.structure.PropertyAntiquotation"),property));
    String value=quotationNode.getProperty(property);
    if (value == null && attribute == null) {
      continue;
    }
    SNode pval=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0325L,"jetbrains.mps.lang.quotation.structure.NodeBuilderInitProperty")));
    SLinkOperations.setTarget(pval,MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0325L,0x4bb51009d20b0326L,"property"),SNodeOperations.cast(property.getDeclarationNode(),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086bL,"jetbrains.mps.lang.structure.structure.PropertyDeclaration")));
    if (attribute != null) {
      SLinkOperations.setTarget(pval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression"),SLinkOperations.getTarget(attribute,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c104656L,0x1168c104657L,"expression")));
    }
 else {
      SNode dataType=SLinkOperations.getTarget(SLinkOperations.getTarget(pval,MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0325L,0x4bb51009d20b0326L,"property")),MetaAdapterFactory.getReferenceLink(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086bL,0xfc26f42fe5L,"dataType"));
      SLinkOperations.setTarget(pval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression"),(DataTypeDeclaration_Behavior.call_isSimpleBoolean_1220268891062(dataType) ? _quotation_createNode_aytayy_a0a1a0g0l0d(value) : (DataTypeDeclaration_Behavior.call_isSimpleInteger_1220268868375(dataType) ? _quotation_createNode_aytayy_a0a0b0a6a11a3(value) : _quotation_createNode_aytayy_a0a0b0a6a11a3_0(NameUtil.escapeString(value)))));
    }
    ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20a4aa0L,0x4bb51009d20b033bL,"values"))).addElement(pval);
  }
  Set<SReferenceLink> seenRoles=SetSequence.fromSet(new HashSet<SReferenceLink>());
  for (  SReference ref : ListSequence.fromList(SNodeOperations.getReferences(quotationNode))) {
    seenRoles.add(ref.getLink());
    SNode refattr=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.LinkAttribute(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c10465dL,"jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation"),ref.getLink()));
    SNode lval=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20c8e1aL,"jetbrains.mps.lang.quotation.structure.NodeBuilderInitLink")));
    SLinkOperations.setTarget(lval,MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20c8e1aL,0x4bb51009d20c8e1cL,"link"),SNodeOperations.cast(ref.getLink().getDeclarationNode(),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,"jetbrains.mps.lang.structure.structure.LinkDeclaration")));
    if (refattr != null) {
      SNode nbexpr=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,"jetbrains.mps.lang.quotation.structure.NodeBuilderExpression")));
      SLinkOperations.setTarget(nbexpr,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,0x718e3f4cb7a31330L,"expression"),SLinkOperations.getTarget(refattr,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c104656L,0x1168c104657L,"expression")));
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression"),nbexpr);
    }
 else {
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression"),SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a0fa93L,"jetbrains.mps.lang.quotation.structure.NodeBuilderRef"))));
      SLinkOperations.setTarget(SNodeOperations.cast(SLinkOperations.getTarget(lval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression")),MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a0fa93L,"jetbrains.mps.lang.quotation.structure.NodeBuilderRef")),MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a0fa93L,0x718e3f4cb7a0fa95L,"target"),SNodeOperations.as(SLinkOperations.getTargetNode(ref),MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,"jetbrains.mps.lang.core.structure.INamedConcept")));
    }
    ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20a4aa0L,0x4bb51009d20b033bL,"values"))).addElement(lval);
  }
  for (  SNode refAQ : ListSequence.fromList(SNodeOperations.getChildren(quotationNode)).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return SNodeOperations.isInstanceOf(it,MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c10465dL,"jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation"));
    }
  }
).select(new ISelector<SNode,SNode>(){
    public SNode select(    SNode it){
      return SNodeOperations.cast(it,MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c10465dL,"jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation"));
    }
  }
)) {
    if (!(seenRoles.add(LinkAttribute_Behavior.call_getLink_1341860900489573894(refAQ)))) {
      continue;
    }
    seenRoles.add(LinkAttribute_Behavior.call_getLink_1341860900489573894(refAQ));
    SNode lval=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20c8e1aL,"jetbrains.mps.lang.quotation.structure.NodeBuilderInitLink")));
    SLinkOperations.setTarget(lval,MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20c8e1aL,0x4bb51009d20c8e1cL,"link"),SNodeOperations.cast(LinkAttribute_Behavior.call_getLink_1341860900489573894(refAQ).getDeclarationNode(),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,"jetbrains.mps.lang.structure.structure.LinkDeclaration")));
    SNode nbexpr=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,"jetbrains.mps.lang.quotation.structure.NodeBuilderExpression")));
    SLinkOperations.setTarget(nbexpr,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a3132eL,0x718e3f4cb7a31330L,"expression"),SLinkOperations.getTarget(refAQ,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c104656L,0x1168c104657L,"expression")));
    SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression"),nbexpr);
    ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20a4aa0L,0x4bb51009d20b033bL,"values"))).addElement(lval);
  }
  Map<SNode,SNode> map=MapSequence.fromMap(new HashMap<SNode,SNode>());
  for (  SNode child : SNodeOperations.getChildren(quotationNode)) {
    if (SNodeOperations.isInstanceOf(child,MetaAdapterFactory.getInterfaceConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x1168c104656L,"jetbrains.mps.lang.quotation.structure.AbstractAntiquotation"))) {
      continue;
    }
    SNode link=SNodeOperations.cast(child.getContainmentLink().getDeclarationNode(),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979bd086aL,"jetbrains.mps.lang.structure.structure.LinkDeclaration"));
    if ((link == null)) {
      if (LOG.isEnabledFor(Level.ERROR)) {
        LOG.error("cannot find link `" + child.getContainmentLink().getName() + "' in "+ BehaviorReflection.invokeVirtual(String.class,SLinkOperations.getTarget(result,MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20a4aa0L,0x4bb51009d20b02b1L,"concept")),"virtual_getFqName_1213877404258",new Object[]{}));
      }
    }
    boolean multipleLink=link != null && !(LinkDeclaration_Behavior.call_isSingular_1213877254557(link));
    SNode c=convert(child);
    SNode lval;
    if (MapSequence.fromMap(map).containsKey(link)) {
      lval=MapSequence.fromMap(map).get(link);
    }
 else {
      lval=SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20c8e1aL,"jetbrains.mps.lang.quotation.structure.NodeBuilderInitLink")));
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getReferenceLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20c8e1aL,0x4bb51009d20c8e1cL,"link"),link);
      ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20a4aa0L,0x4bb51009d20b033bL,"values"))).addElement(lval);
      if (multipleLink) {
        MapSequence.fromMap(map).put(link,lval);
        SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression"),SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a2df32L,"jetbrains.mps.lang.quotation.structure.NodeBuilderList"))));
      }
    }
    if (multipleLink) {
      ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(SLinkOperations.getTarget(lval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression")),MetaAdapterFactory.getConcept(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a2df32L,"jetbrains.mps.lang.quotation.structure.NodeBuilderList")),MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x718e3f4cb7a2df32L,0x718e3f4cb7a2df33L,"nodes"))).addElement(c);
    }
 else {
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(0x3a13115c633c4c5cL,0xbbcc75c4219e9555L,0x4bb51009d20b0339L,0x4bb51009d20b0336L,"expression"),c);
    }
  }
  return result;
}
