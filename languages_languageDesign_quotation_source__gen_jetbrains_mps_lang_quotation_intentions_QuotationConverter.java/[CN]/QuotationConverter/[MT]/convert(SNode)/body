{
  if (quotationNode == null) {
    return null;
  }
  SNode aq=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.NodeAttribute("jetbrains.mps.lang.quotation.structure.Antiquotation"));
  if ((aq != null)) {
    SNode expr=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderExpression",null);
    SLinkOperations.setTarget(expr,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709752110l,8182547171709752112l,"expression"),SLinkOperations.getTarget(aq,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),1196350785110l,1196350785111l,"expression")));
    return expr;
  }
  SNode la=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.NodeAttribute("jetbrains.mps.lang.quotation.structure.ListAntiquotation"));
  if ((la != null)) {
    SNode expr=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderExpression",null);
    SLinkOperations.setTarget(expr,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709752110l,8182547171709752112l,"expression"),SLinkOperations.getTarget(la,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),1196350785110l,1196350785111l,"expression")));
    return expr;
  }
  SNode result=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderNode",null);
  SLinkOperations.setTarget(result,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993910961l,"concept"),SNodeOperations.getConceptDeclaration(quotationNode));
  List<String> propertyNames=ListSequence.fromListWithValues(new ArrayList<String>(),quotationNode.getPropertyNames());
  Collections.sort(propertyNames);
  for (  String property : propertyNames) {
    SNode attribute=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.PropertyAttribute("jetbrains.mps.lang.quotation.structure.PropertyAntiquotation",property));
    SNode pval=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderInitProperty",null);
    SLinkOperations.setTarget(pval,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911077l,5455284157993911078l,"property"),AbstractConceptDeclaration_Behavior.call_findPropertyDeclaration_1219835742593(SLinkOperations.getTarget(result,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993910961l,"concept")),property));
    if (attribute != null) {
      SLinkOperations.setTarget(pval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression"),SLinkOperations.getTarget(attribute,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),1196350785110l,1196350785111l,"expression")));
    }
 else {
      SNode dataType=SLinkOperations.getTarget(SLinkOperations.getTarget(pval,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911077l,5455284157993911078l,"property")),MetaAdapterFactory.getReferenceLink(new UUID(-4094437568663370681l,-8968368868337559369l),1071489288299l,1082985295845l,"dataType"));
      SLinkOperations.setTarget(pval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression"),(DataTypeDeclaration_Behavior.call_isSimpleBoolean_1220268891062(dataType) ? _quotation_createNode_aytayy_a0a1a0d0l0d(quotationNode.getProperty(property)) : (DataTypeDeclaration_Behavior.call_isSimpleInteger_1220268868375(dataType) ? _quotation_createNode_aytayy_a0a0b0a3a11a3(quotationNode.getProperty(property)) : _quotation_createNode_aytayy_a0a0b0a3a11a3_0(NameUtil.escapeString(quotationNode.getProperty(property))))));
    }
    ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993911099l,"values"))).addElement(pval);
  }
  Set<String> seenRoles=SetSequence.fromSet(new HashSet<String>());
  for (  SReference ref : ListSequence.fromList(SNodeOperations.getReferences(quotationNode))) {
    seenRoles.add(SLinkOperations.getRole(ref));
    SNode refattr=AttributeOperations.getAttribute(quotationNode,new IAttributeDescriptor.LinkAttribute("jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation",SLinkOperations.getRole(ref)));
    SNode lval=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderInitLink",null);
    SLinkOperations.setTarget(lval,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157994012186l,5455284157994012188l,"link"),SNodeOperations.as(SModelSearchUtil.findMostSpecificLinkDeclaration(SLinkOperations.getTarget(result,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993910961l,"concept")),SLinkOperations.getRole(ref)),MetaAdapterFactory.getConcept(new UUID(-4094437568663370681l,-8968368868337559369l),1071489288298l,"jetbrains.mps.lang.structure.structure.LinkDeclaration")));
    if (refattr != null) {
      SNode nbexpr=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderExpression",null);
      SLinkOperations.setTarget(nbexpr,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709752110l,8182547171709752112l,"expression"),SLinkOperations.getTarget(refattr,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),1196350785110l,1196350785111l,"expression")));
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression"),nbexpr);
    }
 else {
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression"),SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderRef",null));
      SLinkOperations.setTarget(SNodeOperations.cast(SLinkOperations.getTarget(lval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression")),MetaAdapterFactory.getConcept(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709614739l,"jetbrains.mps.lang.quotation.structure.NodeBuilderRef")),MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709614739l,8182547171709614741l,"target"),SNodeOperations.as(SLinkOperations.getTargetNode(ref),MetaAdapterFactory.getConcept(new UUID(-3554657779850784990l,-7236703803128771572l),1169194658468l,"jetbrains.mps.lang.core.structure.INamedConcept")));
    }
    ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993911099l,"values"))).addElement(lval);
  }
  for (  SNode refAQ : ListSequence.fromList(SNodeOperations.getChildren(quotationNode)).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return SNodeOperations.isInstanceOf(it,MetaAdapterFactory.getConcept(new UUID(4184707567256882268l,-4914423608129972907l),1196350785117l,"jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation"));
    }
  }
).select(new ISelector<SNode,SNode>(){
    public SNode select(    SNode it){
      return SNodeOperations.cast(it,MetaAdapterFactory.getConcept(new UUID(4184707567256882268l,-4914423608129972907l),1196350785117l,"jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation"));
    }
  }
)) {
    if (!(seenRoles.add(SPropertyOperations.getString(refAQ,MetaAdapterFactory.getProperty(new UUID(-3554657779850784990l,-7236703803128771572l),3364660638048049745l,1757699476691236116l,"linkRole"))))) {
      continue;
    }
    seenRoles.add(SPropertyOperations.getString(refAQ,MetaAdapterFactory.getProperty(new UUID(-3554657779850784990l,-7236703803128771572l),3364660638048049745l,1757699476691236116l,"linkRole")));
    SNode lval=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderInitLink",null);
    SLinkOperations.setTarget(lval,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157994012186l,5455284157994012188l,"link"),SNodeOperations.as(SModelSearchUtil.findMostSpecificLinkDeclaration(SLinkOperations.getTarget(result,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993910961l,"concept")),SPropertyOperations.getString(refAQ,MetaAdapterFactory.getProperty(new UUID(-3554657779850784990l,-7236703803128771572l),3364660638048049745l,1757699476691236116l,"linkRole"))),MetaAdapterFactory.getConcept(new UUID(-4094437568663370681l,-8968368868337559369l),1071489288298l,"jetbrains.mps.lang.structure.structure.LinkDeclaration")));
    SNode nbexpr=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderExpression",null);
    SLinkOperations.setTarget(nbexpr,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709752110l,8182547171709752112l,"expression"),SLinkOperations.getTarget(refAQ,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),1196350785110l,1196350785111l,"expression")));
    SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression"),nbexpr);
    ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993911099l,"values"))).addElement(lval);
  }
  Map<SNode,SNode> map=MapSequence.fromMap(new HashMap<SNode,SNode>());
  for (  SNode child : SNodeOperations.getChildren(quotationNode)) {
    if (SNodeOperations.isInstanceOf(child,MetaAdapterFactory.getConcept(new UUID(4184707567256882268l,-4914423608129972907l),1196350785110l,"jetbrains.mps.lang.quotation.structure.AbstractAntiquotation"))) {
      continue;
    }
    SNode link=SNodeOperations.as(SModelSearchUtil.findMostSpecificLinkDeclaration(SLinkOperations.getTarget(result,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993910961l,"concept")),SNodeOperations.getContainingLinkRole(child)),MetaAdapterFactory.getConcept(new UUID(-4094437568663370681l,-8968368868337559369l),1071489288298l,"jetbrains.mps.lang.structure.structure.LinkDeclaration"));
    if ((link == null)) {
      if (LOG.isEnabledFor(Level.ERROR)) {
        LOG.error("cannot find link `" + SNodeOperations.getContainingLinkRole(child) + "' in "+ BehaviorReflection.invokeVirtual(String.class,SLinkOperations.getTarget(result,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993910961l,"concept")),"virtual_getFqName_1213877404258",new Object[]{}));
      }
    }
    boolean multipleLink=link != null && !(LinkDeclaration_Behavior.call_isSingular_1213877254557(link));
    SNode c=convert(child);
    SNode lval;
    if (MapSequence.fromMap(map).containsKey(link)) {
      lval=MapSequence.fromMap(map).get(link);
    }
 else {
      lval=SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderInitLink",null);
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getReferenceLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157994012186l,5455284157994012188l,"link"),link);
      ListSequence.fromList(SLinkOperations.getChildren(result,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993863840l,5455284157993911099l,"values"))).addElement(lval);
      if (multipleLink) {
        MapSequence.fromMap(map).put(link,lval);
        SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression"),SConceptOperations.createNewNode("jetbrains.mps.lang.quotation.structure.NodeBuilderList",null));
      }
    }
    if (multipleLink) {
      ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(SLinkOperations.getTarget(lval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression")),MetaAdapterFactory.getConcept(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709738802l,"jetbrains.mps.lang.quotation.structure.NodeBuilderList")),MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),8182547171709738802l,8182547171709738803l,"nodes"))).addElement(c);
    }
 else {
      SLinkOperations.setTarget(lval,MetaAdapterFactory.getContainmentLink(new UUID(4184707567256882268l,-4914423608129972907l),5455284157993911097l,5455284157993911094l,"expression"),c);
    }
  }
  return result;
}
