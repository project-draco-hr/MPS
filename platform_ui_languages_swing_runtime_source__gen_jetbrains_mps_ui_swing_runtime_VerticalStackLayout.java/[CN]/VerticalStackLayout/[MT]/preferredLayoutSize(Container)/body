{
synchronized (container.getTreeLock()) {
    Insets ins=container.getInsets();
    int w=0;
    int h=0;
    Component selected=null;
    for (    Component cmp : container.getComponents()) {
      if (this.isSelected(cmp)) {
        selected=cmp;
      }
 else {
        Dimension ps=cmp.getPreferredSize();
        h+=ps.height;
        w=Math.max(w,ps.width);
      }
    }
    if (selected != null) {
      Dimension box=container.getSize();
      int maxHeight=box.height - ins.top - ins.bottom;
      Dimension ps=selected.getPreferredSize();
      h=Math.max(maxHeight,ps.height);
      w=Math.max(w,ps.width);
    }
    Dimension dim=new Dimension();
    dim.setSize(ins.left + w + ins.right,ins.top + h + ins.bottom);
    return dim;
  }
}
