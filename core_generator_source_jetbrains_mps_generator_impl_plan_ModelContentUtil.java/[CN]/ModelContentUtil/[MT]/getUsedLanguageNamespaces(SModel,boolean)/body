{
  if (isTemplateModel) {
    return getUsedLanguageNamespacesInTemplateModel(model);
  }
  if (SModelStereotype.isGeneratorModel(model)) {
    TemplateModelScanner templateModelScanner=new TemplateModelScanner(model);
    templateModelScanner.scan();
    Set<String> namespaces=new HashSet<String>(templateModelScanner.getQueryLanguages());
    for (    ModuleReference ref : ((jetbrains.mps.smodel.SModelInternal)model).engagedOnGenerationLanguages()) {
      namespaces.add(ref.getModuleFqName());
    }
    return namespaces;
  }
  Set<String> namespaces=new HashSet<String>();
  for (  ModuleReference ref : ((jetbrains.mps.smodel.SModelInternal)model).engagedOnGenerationLanguages()) {
    namespaces.add(ref.getModuleFqName());
  }
  for (  SNode root : model.getRootNodes()) {
    namespaces.add(NameUtil.namespaceFromConceptFQName(root.getConcept().getId()));
    for (    SNode child : jetbrains.mps.util.SNodeOperations.getDescendants(root,null)) {
      namespaces.add(NameUtil.namespaceFromConceptFQName(child.getConcept().getId()));
    }
  }
  SModel modelDescriptor=model.getModelDescriptor();
  if (modelDescriptor != null && modelDescriptor.getModule() instanceof Language && LanguageAspect.BEHAVIOR.is(modelDescriptor)) {
    namespaces.add(BootstrapLanguages.BEHAVIOR.getModuleFqName());
  }
  return namespaces;
}
