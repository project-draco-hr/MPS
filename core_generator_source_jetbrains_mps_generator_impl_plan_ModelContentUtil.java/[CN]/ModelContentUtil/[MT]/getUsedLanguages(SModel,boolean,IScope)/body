{
  Set<String> namespaces=new HashSet<String>();
  for (  jetbrains.mps.project.structure.modules.ModuleReference ref : model.engagedOnGenerationLanguages()) {
    namespaces.add(ref.getModuleFqName());
  }
  for (  SNode root : model.roots()) {
    collectLanguageNamespaces(root,namespaces,isTemplateModel);
  }
  List<Language> result=new ArrayList<Language>();
  for (  String namespace : namespaces) {
    Language language=scope.getLanguage(new ModuleReference(namespace));
    if (language != null) {
      result.add(language);
    }
 else {
      LOG.error("couldn't find language for namespace '" + namespace + "' in scope: "+ scope);
    }
  }
  return result;
}
