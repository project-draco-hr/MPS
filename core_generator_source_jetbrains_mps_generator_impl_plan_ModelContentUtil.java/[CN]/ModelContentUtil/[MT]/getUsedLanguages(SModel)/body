{
  Set<SLanguage> namespaces=new HashSet<SLanguage>();
  namespaces.addAll(((jetbrains.mps.smodel.SModelInternal)model).getLanguagesEngagedOnGeneration());
  if (SModelStereotype.isGeneratorModel(model)) {
    ModelScanner templateModelScanner=new ModelScanner();
    templateModelScanner.scanInLegacyMode(model);
    namespaces.addAll(templateModelScanner.getQueryLanguages());
    return namespaces;
  }
  for (  SLanguage language : new ModelDependencyScanner().usedLanguages(true).crossModelReferences(false).walk(model).getUsedLanguages()) {
    namespaces.add(language);
  }
  for (  SLanguage language : ModelsAutoImportsManager.getLanguages(model.getModule(),model)) {
    namespaces.add(language);
  }
  return namespaces;
}
