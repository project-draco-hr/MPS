{
  if (SHOW_LOG > 0) {
    System.out.println("CONSTRUCTING THE EMBEDDING!!!");
  }
  Set<Edge> edges=removeEdgesToPlanarity(graph,stNumbering);
  if (SetSequence.<Edge>fromSet(edges).count() > 0) {
    throw new RuntimeException("trying to get embedding of nonplanar graph!!!" + edges);
  }
  EdgesOrder order=((QNode)ListSequence.<PQNode>fromList(myTree.getRoot().getChildren()).first()).getEdgesOrder();
  Node[] nodeOrder=new Node[graph.getNumNodes()];
  for (  Node node : ListSequence.<Node>fromList(graph.getNodes())) {
    nodeOrder[MapSequence.<Node,Integer>fromMap(stNumbering).get(node)]=node;
  }
  EmbeddedGraph embeddedGraph;
  embeddedGraph=createEmbeddedGraphFromInEdges(graph,Arrays.asList(nodeOrder));
  if (SHOW_LOG > 0) {
    System.out.println(embeddedGraph);
  }
  return embeddedGraph;
}
