{
  while (!myStack.isEmpty()) {
    final Iterator<T> top=myStack.peek();
    if (top.hasNext()) {
      final T next=top.next();
      if (next == null || !mySeen.add(next)) {
        continue;
      }
      Iterator<T> new_=children(next);
      if (new_ != null) {
        myStack.push(new_);
        if (myLeavesOnly) {
          continue;
        }
      }
      return next;
    }
    myStack.pop();
  }
  return null;
}
