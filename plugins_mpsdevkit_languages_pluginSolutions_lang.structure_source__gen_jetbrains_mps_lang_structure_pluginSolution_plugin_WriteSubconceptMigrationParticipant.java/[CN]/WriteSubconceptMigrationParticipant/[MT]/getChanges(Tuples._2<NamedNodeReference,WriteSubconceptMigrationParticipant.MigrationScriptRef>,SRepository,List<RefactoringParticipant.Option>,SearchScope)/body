{
  if (initialState == null || !(ListSequence.fromList(selectedOptions).contains(LanguageStructureMigrationParticipant.OPTION)) || !(ListSequence.fromList(selectedOptions).contains(UpdateReferencesParticipantBase.OPTION)) || searchScope.resolve(initialState._1().getLanguage()) != null) {
    return ListSequence.fromList(new ArrayList<RefactoringParticipant.Change<Tuples._2<NamedNodeReference,WriteSubconceptMigrationParticipant.MigrationScriptRef>,Void>>());
  }
{
    final SearchScope scope=CommandUtil.createScope(searchScope);
    QueryExecutionContext context=new QueryExecutionContext(){
      public SearchScope getDefaultSearchScope(){
        return scope;
      }
    }
;
    List<SNode> subConcepts=ListSequence.fromList(new ArrayList<SNode>());
    ListSequence.fromList(subConcepts).addSequence(CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979ba0450L,"jetbrains.mps.lang.structure.structure.ConceptDeclaration"),false)).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return eq_8k3jue_a0a0a0a0a0a0a3a2a01(check_8k3jue_a0a0a0a0a0b0c0k(SLinkOperations.getTarget(it,MetaAdapterFactory.getReferenceLink(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979ba0450L,0xf979be93cfL,"extends"))),initialState._0().reference());
      }
    }
).toListSequence());
    ListSequence.fromList(subConcepts).addSequence(CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103556dcafL,"jetbrains.mps.lang.structure.structure.InterfaceConceptDeclaration"),false)).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return ListSequence.fromList(SLinkOperations.getChildren(it,MetaAdapterFactory.getContainmentLink(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103556dcafL,0x110356e9df4L,"extends"))).any(new IWhereFilter<SNode>(){
          public boolean accept(          SNode it){
            return eq_8k3jue_a0a0a0a0a0a0a0a0a0a0a4a2a01(it.getReference(),initialState._0().reference());
          }
        }
);
      }
    }
).toListSequence());
    ListSequence.fromList(subConcepts).addSequence(CollectionSequence.fromCollection(CommandUtil.instances(CommandUtil.createConsoleScope(null,false,context),MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979ba0450L,"jetbrains.mps.lang.structure.structure.ConceptDeclaration"),false)).where(new IWhereFilter<SNode>(){
      public boolean accept(      SNode it){
        return ListSequence.fromList(SLinkOperations.getChildren(it,MetaAdapterFactory.getContainmentLink(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0xf979ba0450L,0x110358d693eL,"implements"))).any(new IWhereFilter<SNode>(){
          public boolean accept(          SNode it){
            return eq_8k3jue_a0a0a0a0a0a0a0a0a0a0a5a2a01(it.getReference(),initialState._0().reference());
          }
        }
);
      }
    }
).toListSequence());
    List<Language> subModules=ListSequence.fromList(subConcepts).select(new ISelector<SNode,SModule>(){
      public SModule select(      SNode it){
        return SNodeOperations.getModel(it).getModule();
      }
    }
).distinct().ofType(Language.class).toListSequence();
    List<RefactoringParticipant.Change<Tuples._2<NamedNodeReference,WriteSubconceptMigrationParticipant.MigrationScriptRef>,Void>> changes=ListSequence.fromList(subModules).select(new ISelector<Language,RefactoringParticipant.Change<Tuples._2<NamedNodeReference,WriteSubconceptMigrationParticipant.MigrationScriptRef>,Void>>(){
      public RefactoringParticipant.Change<Tuples._2<NamedNodeReference,WriteSubconceptMigrationParticipant.MigrationScriptRef>,Void> select(      final Language subModule){
        RefactoringParticipant.Change<Tuples._2<NamedNodeReference,WriteSubconceptMigrationParticipant.MigrationScriptRef>,Void> change=new MoveNodeRefactoringParticipant.ChangeBase<Tuples._2<NamedNodeReference,WriteSubconceptMigrationParticipant.MigrationScriptRef>,Void>(){
          public SearchResults getSearchResults(){
            SearchResults searchResults=new SearchResults();
            searchResults.add(new SearchResult<SModule>(subModule,"induced migration script"));
            return searchResults;
          }
          public void confirm(          Void finalState,          SRepository repository,          RefactoringSession refactoringSession){
            LanguageStructureMigrationParticipant.MigrationBuilder migrationBuilder=LanguageStructureMigrationParticipant.MigrationBuilder.getBuilder(refactoringSession,subModule);
            migrationBuilder.addPart(createIncludeMigrationPart_8k3jue_a0a1a1a0a0a0a0a0a5a2a01(SNodeOperations.cast(initialState._1().resolve(repository),MetaAdapterFactory.getInterfaceConcept(0x9074634404fd4286L,0x97d5b46ae6a81709L,0x47bb811da2acc4d6L,"jetbrains.mps.lang.migration.structure.IMigrationUnit"))));
          }
        }
;
        return change;
      }
    }
).toListSequence();
    return changes;
  }
}
