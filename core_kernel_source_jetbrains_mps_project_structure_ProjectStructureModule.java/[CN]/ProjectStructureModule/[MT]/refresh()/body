{
  ModelAccess.assertLegalWrite();
  Set<SModelReference> old=new HashSet<SModelReference>(myModels.keySet());
  for (  IModule module : MPSModuleRepository.getInstance().getAllModules()) {
    if (!(module instanceof Solution || module instanceof Language || module instanceof DevKit)) {
      continue;
    }
    SModelReference ref=getSModelReference(module);
    if (myModels.containsKey(ref)) {
      old.remove(ref);
      ProjectStructureSModelDescriptor descriptor=myModels.get(ref);
      descriptor.dropModel();
    }
 else {
      createModel(module);
    }
  }
  for (  SModelReference mm : old) {
    ProjectStructureSModelDescriptor model=myModels.get(mm);
    if (model != null) {
      removeModel(model);
    }
  }
}
