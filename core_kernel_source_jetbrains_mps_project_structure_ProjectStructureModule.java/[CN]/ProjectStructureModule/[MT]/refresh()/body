{
  ModelAccess.assertLegalWrite();
  Set<SModelFqName> old=new HashSet<SModelFqName>(myModels.keySet());
  for (  IModule module : MPSModuleRepository.getInstance().getAllModules()) {
    if (!(module instanceof Solution || module instanceof Language || module instanceof DevKit)) {
      continue;
    }
    SModelFqName fq=getModelFqName(module);
    if (myModels.containsKey(fq)) {
      old.remove(fq);
      ProjectStructureSModelDescriptor descriptor=myModels.get(fq);
      descriptor.dropModel();
    }
 else {
      createModel(module);
    }
  }
  for (  SModelFqName mm : old) {
    ProjectStructureSModelDescriptor model=myModels.get(mm);
    if (model != null) {
      removeModel(model);
    }
  }
}
