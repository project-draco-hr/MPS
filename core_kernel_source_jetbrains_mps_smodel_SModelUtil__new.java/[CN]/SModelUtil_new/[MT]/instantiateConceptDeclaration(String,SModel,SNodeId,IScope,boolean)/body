{
  boolean isNotProjectModel=model == null || !ProjectModels.isProjectModel(model.getSModelReference());
  if (isNotProjectModel) {
    String fqName=ModelConstraints.getDefaultConcreteConceptFqName(conceptFqName);
    if (fqName != null) {
      conceptFqName=fqName;
    }
  }
  if (conceptFqName.indexOf(".structure.") == -1) {
    String conceptName=NameUtil.shortNameFromLongName(conceptFqName);
    String languageNamespace=NameUtil.namespaceFromLongName(conceptFqName);
    conceptFqName=languageNamespace + ".structure." + conceptName;
  }
  jetbrains.mps.smodel.SNode newNode=new jetbrains.mps.smodel.SNode(conceptFqName);
  if (nodeId != null) {
    newNode.setId(nodeId);
  }
  if (fullNodeStructure && isNotProjectModel) {
    SNode conceptDeclaration=SModelUtil.findConceptDeclaration(conceptFqName,scope);
    createNodeStructure(conceptDeclaration,newNode,model);
  }
  return newNode;
}
