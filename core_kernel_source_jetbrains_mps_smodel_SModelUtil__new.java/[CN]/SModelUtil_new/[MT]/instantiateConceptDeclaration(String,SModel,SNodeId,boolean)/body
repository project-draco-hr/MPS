{
  boolean isNotProjectModel=model == null || !TemporaryModels.isTemporary(model);
  if (isNotProjectModel) {
    String fqName=ModelConstraints.getDefaultConcreteConceptFqName(conceptFqName);
    if (fqName != null) {
      conceptFqName=fqName;
    }
  }
  jetbrains.mps.smodel.SNode newNode=new jetbrains.mps.smodel.SNode(conceptFqName);
  if (nodeId != null) {
    newNode.setId(nodeId);
  }
  if (fullNodeStructure && isNotProjectModel) {
    SNode conceptDeclaration=SModelUtil.findConceptDeclaration(conceptFqName);
    createNodeStructure(conceptDeclaration,newNode,model);
  }
  return newNode;
}
