{
  boolean isNotProjectModel=model == null || !TemporaryModels.isTemporary(model);
  if (isNotProjectModel) {
    SConcept concreteConcept=ModelConstraints.getDefaultConcreteConcept(concept);
    if (concreteConcept != null) {
      concept=concreteConcept;
    }
  }
  if (!(concept instanceof SConcept)) {
    concept=MetaAdapterByDeclaration.asInstanceConcept(concept);
  }
  jetbrains.mps.smodel.SNode newNode=new jetbrains.mps.smodel.SNode(((SConcept)concept));
  if (nodeId != null) {
    newNode.setId(nodeId);
  }
  if (fullNodeStructure && isNotProjectModel) {
    createNodeStructure(((SConcept)concept),newNode,model);
  }
  return newNode;
}
