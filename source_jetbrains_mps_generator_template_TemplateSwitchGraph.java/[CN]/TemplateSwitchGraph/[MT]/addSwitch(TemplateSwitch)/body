{
  if (myTemplateSwitchToGraphNodeMap.get(templateSwitch) != null) {
    throw new RuntimeException("Couldn't add template switch more then once: " + templateSwitch.getDebugText());
  }
  SwitchGraphNode switchNode=new SwitchGraphNode(templateSwitch);
  myTemplateSwitchToGraphNodeMap.put(templateSwitch,switchNode);
  TemplateSwitch modifiedSwitch=templateSwitch.getModifiedSwitch();
  if (modifiedSwitch != null) {
    SwitchGraphNode modifiedSwitchNode=myTemplateSwitchToGraphNodeMap.get(modifiedSwitch);
    if (modifiedSwitchNode == null) {
      modifiedSwitchNode=addSwitch(modifiedSwitch);
    }
    switchNode.modifiedSwitchNode=modifiedSwitchNode;
    modifiedSwitchNode.modifierSwitchNodes.add(switchNode);
  }
  return switchNode;
}
