{
  final VirtualFile[] files=PlatformDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
  if (files == null || files.length == 0)   return;
  String message=createConfirmationMessage(files);
  int returnValue=Messages.showYesNoDialog(message,"Delete",Messages.getQuestionIcon());
  if (returnValue != 0)   return;
  Arrays.sort(files,FileComparator.getInstance());
  CommandProcessor.getInstance().executeCommand((Project)dataContext.getData(PlatformDataKeys.PROJECT.getName()),new Runnable(){
    public void run(){
      ModelAccess.instance().runWriteAction(new Runnable(){
        public void run(){
          for (          final VirtualFile file : files) {
            try {
              file.delete(this);
            }
 catch (            IOException e) {
              ApplicationManager.getApplication().invokeLater(new Runnable(){
                public void run(){
                  Messages.showMessageDialog("Could not erase file or folder: " + file.getName(),"Error",Messages.getErrorIcon());
                }
              }
);
            }
          }
        }
      }
);
    }
  }
,null,null,null);
}
