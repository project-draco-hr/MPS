{
  md.setNamespace(FileUtil.getNameWithoutExtension(file.getName()));
  md.setUUID(UUID.randomUUID().toString());
  InputStreamReader r=null;
  try {
    r=new InputStreamReader(file.openInputStream(),jetbrains.mps.util.FileUtil.DEFAULT_CHARSET);
    char[] buf=new char[1024];
    int readChars=r.read(buf);
    String s=new String(buf,0,readChars);
    Pattern pattern=Pattern.compile(HEADER_PATTERN);
    for (    String line : s.split("\n")) {
      Matcher m=pattern.matcher(line);
      if (m.matches()) {
        md.setNamespace(m.group(3));
        md.setUUID(m.group(4));
      }
    }
  }
 catch (  IOException e) {
    if (log.isErrorEnabled()) {
      log.error("",e);
    }
  }
 finally {
    jetbrains.mps.util.FileUtil.closeFileSafe(r);
  }
  setTimestamp(md,file);
  md.setLoadException((exception.getCause() == null ? exception : exception.getCause()));
}
