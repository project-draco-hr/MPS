{
  if (type != null) {
    return new ModelRootDescriptor(type,m);
  }
  Memento manager=m.getChild("manager");
  if (manager == null) {
    String path=FileUtil.stripLastSlashes(m.get("path"));
    if (moduleContentRoot != null && (path.startsWith(moduleContentRoot + "/") || path.equals(moduleContentRoot))) {
      String relPath=path.substring(moduleContentRoot.length());
      while (relPath.startsWith("/")) {
        relPath=relPath.substring(1);
      }
      ModelRootDescriptor result=null;
      if (moduleDefaultRoot[0] == null) {
        m=new MementoImpl();
        m.put("contentPath",moduleContentRoot);
        moduleDefaultRoot[0]=new ModelRootDescriptor(PersistenceRegistry.DEFAULT_MODEL_ROOT,m);
        result=moduleDefaultRoot[0];
      }
 else {
        m=moduleDefaultRoot[0].getMemento();
      }
      Memento sr=m.createChild("sourceRoot");
      sr.put("location",(relPath.isEmpty() ? "." : relPath));
      return result;
    }
    m=new MementoImpl();
    m.put("contentPath",path);
    Memento sourceRoot=m.createChild("sourceRoot");
    sourceRoot.put("location",".");
    return new ModelRootDescriptor(PersistenceRegistry.DEFAULT_MODEL_ROOT,m);
  }
 else   if (matches(manager,LanguageID.JAVA_MANAGER)) {
    String path=m.get("path");
    m=new MementoImpl();
    m.put("path",path);
    return new ModelRootDescriptor(PersistenceRegistry.JAVA_CLASSES_ROOT,m);
  }
 else {
    return new ModelRootDescriptor(PersistenceRegistry.OBSOLETE_MODEL_ROOT,m);
  }
}
