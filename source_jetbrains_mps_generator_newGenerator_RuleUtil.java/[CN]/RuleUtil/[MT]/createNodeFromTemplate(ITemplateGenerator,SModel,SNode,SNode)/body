{
  SNode outputNode=ModelPersistence.createNodeInstance(templateNode.getClass().getName(),outputModel);
  if (outputNode == null) {
    generator.showErrorMessage(null,templateNode,"'createNodeFromTemplate' cannot create root node");
    return null;
  }
  outputModel.addLanguage(templateNode.getLanguage(generator.getScope()));
  for (  String property : templateNode.getProperties().keySet()) {
    outputNode.setProperty(property,templateNode.getProperty(property),false);
  }
  for (  SNode templateChildNode : templateNode.getChildren()) {
    if (templateChildNode instanceof PropertyMacro) {
      MacroUtil.expandPropertyMacro(generator,(PropertyMacro)templateChildNode,sourceNode,templateNode,outputNode);
    }
 else {
      SNode outputChildNode=createNodeFromTemplate(generator,outputModel,templateChildNode,sourceNode);
      if (outputChildNode != null) {
        outputNode.addChild(templateNode.getRoleOf(templateChildNode),outputChildNode);
      }
    }
  }
  return outputNode;
}
