{
  ParentSettings settings=isSelectionPaintedOnAncestor(parentSettings);
  if (!settings.isSelectionPainted()) {
    if (!parentSettings.isSkipBackground()) {
      if (getCellBackgroundColor() != null) {
        g.setColor(getCellBackgroundColor());
        paintBackground(g);
      }
    }
    boolean hasMessages=false;
    List<EditorMessage> messages=getMessages(EditorMessage.class);
    for (    EditorMessage message : messages) {
      if (message != null && message.isBackground()) {
        message.paint(g,getEditor(),this);
        hasMessages=true;
      }
    }
    settings=ParentSettings.createBackgroundlessSetting(hasMessages).combineWith(parentSettings);
  }
  paintSelectionIfRequired(g,parentSettings);
  return settings;
}
