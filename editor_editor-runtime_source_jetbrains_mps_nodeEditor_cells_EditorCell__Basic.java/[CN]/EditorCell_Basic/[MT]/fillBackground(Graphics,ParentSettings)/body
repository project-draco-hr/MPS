{
  ParentSettings settings=isSelectionPaintedOnAncestor(parentSettings);
  if (!settings.isSelectionPainted()) {
    if (!parentSettings.isSkipBackground()) {
      Color backgroundColor=getStyle().get(StyleAttributes.BACKGROUND_COLOR);
      if (backgroundColor != null) {
        g.setColor(backgroundColor);
        paintBackground(g);
      }
    }
    boolean hasMessages=false;
    for (    EditorMessage message : CellMessagesUtil.getMessages(this,EditorMessage.class)) {
      if (message != null && message.showInEditor() && message.isBackground()) {
        message.paint(g,getEditor(),this);
        hasMessages=true;
      }
    }
    settings=ParentSettings.createBackgroundlessSetting(hasMessages).combineWith(parentSettings);
  }
  paintSelectionIfRequired(g,parentSettings);
  return settings;
}
