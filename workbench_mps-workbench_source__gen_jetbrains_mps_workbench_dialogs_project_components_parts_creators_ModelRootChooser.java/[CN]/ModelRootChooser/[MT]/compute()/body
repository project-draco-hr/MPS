{
  PersistenceFacade pReg=PersistenceRegistry.getInstance();
  Iterable<String> ti=pReg.getTypeIds();
  int index=Messages.showChooseDialog("select","type",Sequence.fromIterable(ti).toGenericArray(String.class),Sequence.fromIterable(ti).first(),null);
  if (index == -1) {
    return null;
  }
  String selectedType=Sequence.fromIterable(ti).take(index + 1).last();
  ModelRoot mr=pReg.getModelRootFactory(selectedType).create();
  if (PersistenceRegistry.DEFAULT_MODEL_ROOT.equals(selectedType) || PersistenceRegistry.OBSOLETE_MODEL_ROOT.equals(selectedType)) {
    TreeFileChooser chooser=new TreeFileChooser();
    chooser.setInitialFile(myBundleHome);
    chooser.setMode(TreeFileChooser.MODE_FILES_AND_DIRECTORIES);
    IFile dir=chooser.showDialog(myOwner.getMainComponent());
    if (dir == null) {
      return null;
    }
    if (PersistenceRegistry.DEFAULT_MODEL_ROOT.equals(selectedType)) {
      DefaultModelRoot result=new DefaultModelRoot();
      result.setPath(dir.getPath());
      return result.toDescriptor();
    }
 else {
      SModelRoot result=new SModelRoot(null);
      result.setPath(dir.getPath());
      return result.toDescriptor();
    }
  }
  final ModelRootSettingsEditor editor=PersistenceComponent.getModelRootSettingsEditor(mr.getType());
  editor.reset(null,mr);
  new BaseDialog(null){
    protected JComponent getMainComponent(){
      return editor.getComponent();
    }
  }
.showDialog();
  editor.apply(mr);
  MementoImpl memento=new MementoImpl();
  mr.save(memento);
  return new ModelRootDescriptor(mr.getType(),memento);
}
