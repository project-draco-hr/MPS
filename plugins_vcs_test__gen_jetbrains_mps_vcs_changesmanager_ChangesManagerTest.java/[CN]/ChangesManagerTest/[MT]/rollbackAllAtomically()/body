{
  checkRootStatuses();
  String stringBeforeAll=getChangeSetString(myUiDiff.getChangeSet());
  final SModel model=myUiDiff.getModelDescriptor();
  List<SNodeReference> affectedRootPointers=ListSequence.fromList(check_4gxggu_a0a0a5a65(myUiDiff.getChangeSet())).select(new ISelector<ModelChange,SNodeReference>(){
    public SNodeReference select(    ModelChange ch){
      return ((SNodeReference)new SNodePointer(myUiDiff.getModelDescriptor().getSModelReference(),ch.getRootId()));
    }
  }
).distinct().toListSequence();
  final List<ModelChange> oppositeChanges=ListSequence.fromList(check_4gxggu_a0a0g0ec(myUiDiff.getChangeSet())).select(new ISelector<ModelChange,ModelChange>(){
    public ModelChange select(    ModelChange ch){
      return ch.getOppositeChange();
    }
  }
).toListSequence();
  runCommandAndWait(new Runnable(){
    public void run(){
      final NodeCopier nc=new NodeCopier(((BaseSModelDescriptor)model).getSModelInternal());
      ListSequence.fromList(oppositeChanges).where(new IWhereFilter<ModelChange>(){
        public boolean accept(        ModelChange ch){
          return ch instanceof NodeGroupChange;
        }
      }
).visitAll(new IVisitor<ModelChange>(){
        public void visit(        ModelChange ch){
          ((NodeGroupChange)ch).prepare();
        }
      }
);
      ListSequence.fromList(oppositeChanges).visitAll(new IVisitor<ModelChange>(){
        public void visit(        ModelChange ch){
          ch.apply(model,nc);
        }
      }
);
      nc.restoreIds(true);
    }
  }
);
  waitAndCheck(myUiDiff);
  Assert.assertTrue(ListSequence.fromList(check_4gxggu_a0a9a65(myUiDiff.getChangeSet())).isEmpty());
  MapSequence.fromMap(myExpectedFileStatuses).removeKey("ui.DocumentLayout");
  MapSequence.fromMap(myExpectedFileStatuses).removeKey("ui.HTMLPanel");
  checkRootStatuses();
  undoAndCheck(myUiDiff,Arrays.asList(ListSequence.fromList(affectedRootPointers).first()),false);
  Assert.assertEquals(stringBeforeAll,getChangeSetString(myUiDiff.getChangeSet()));
  MapSequence.fromMap(myExpectedFileStatuses).put("ui.DocumentLayout",FileStatus.MODIFIED);
  MapSequence.fromMap(myExpectedFileStatuses).put("ui.HTMLPanel",FileStatus.MODIFIED);
  checkRootStatuses();
}
