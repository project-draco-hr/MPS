{
  if (IdeMain.isTestMode())   return;
  DescriptorsPersistence.saveProjectDescriptor(myProjectFile,myProjectDescriptor);
  if (myWorkspaceFile != null) {
    try {
      if (!myWorkspaceFile.exists()) {
        myWorkspaceFile.createNewFile();
      }
      Element root=new Element(COMPONENTS);
      for (      Class cls : myContext.getComponentInterfaces()) {
        Object component=myContext.get(cls);
        if (component instanceof IExternalizableComponent) {
          Element componentElement=new Element(COMPONENT);
          componentElement.setAttribute(CLASS,cls.getName());
          if (component.getClass().getClassLoader() instanceof BundleClassLoader) {
            BundleClassLoader bcl=(BundleClassLoader)component.getClass().getClassLoader();
            componentElement.setAttribute(BUNDLE,bcl.getBundle().getName());
          }
          ((IExternalizableComponent)component).write(componentElement,this);
          root.addContent(componentElement);
        }
      }
      Document document=new Document(root);
      JDOMUtil.writeDocument(document,myWorkspaceFile);
    }
 catch (    Exception e) {
      LOG.error(e);
    }
  }
}
