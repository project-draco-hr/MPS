{
  final Wrappers._T<SModel> createdModel=new Wrappers._T<SModel>(null);
  ((MPSProject)MapSequence.fromMap(_params).get("project")).getRepository().getModelAccess().executeCommand(new Runnable(){
    public void run(){
      createdModel.value=SModuleOperations.createModelWithAdjustments(SModelStereotype.withStereotype(NewSubTestModel_Action.this.getTestModelName(_params),SModelStereotype.TESTS),ModelRootUtil.getModelRoot(((SModel)MapSequence.fromMap(_params).get("model"))));
      if (createdModel.value == null) {
        if (LOG.isEnabledFor(Level.WARN)) {
          LOG.warn("Can't create submodel " + SModelStereotype.withStereotype(NewSubTestModel_Action.this.getTestModelName(_params),SModelStereotype.TESTS) + " for model "+ ((SModel)MapSequence.fromMap(_params).get("model")).getModelName());
        }
        return;
      }
      ((SModelInternal)createdModel.value).addModelImport(((SModel)MapSequence.fromMap(_params).get("model")).getReference(),false);
      for (      jetbrains.mps.smodel.SModel.ImportElement importElement : ((SModelInternal)((SModel)MapSequence.fromMap(_params).get("model"))).importedModels()) {
        ((SModelInternal)createdModel.value).addModelImport(((SModel)MapSequence.fromMap(_params).get("model")).getReference(),false);
      }
      for (      SLanguage importedLanguage : ((SModelInternal)((SModel)MapSequence.fromMap(_params).get("model"))).importedLanguageIds()) {
        ((SModelInternal)createdModel.value).addLanguage(importedLanguage);
      }
      for (      SModuleReference devKit : ((SModelInternal)((SModel)MapSequence.fromMap(_params).get("model"))).importedDevkits()) {
        ((SModelInternal)createdModel.value).addDevKit(devKit);
      }
      ProjectPane.getInstance(((Project)MapSequence.fromMap(_params).get("ideaProject"))).selectModel(createdModel.value,false);
    }
  }
);
}
