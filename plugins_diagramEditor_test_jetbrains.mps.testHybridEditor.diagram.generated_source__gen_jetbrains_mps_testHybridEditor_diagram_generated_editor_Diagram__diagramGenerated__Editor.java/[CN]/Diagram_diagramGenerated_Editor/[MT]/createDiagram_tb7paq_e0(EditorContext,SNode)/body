{
  final List<SNode> blocks=ListSequence.fromList(new ArrayList<SNode>());
  final List<SNode> connectors=ListSequence.fromList(new ArrayList<SNode>());
  createChildCells_tb7paq_e0(SLinkOperations.getTargets(node,"newBlocks",true),editorContext,blocks,connectors);
  createChildCells_tb7paq_e0(SLinkOperations.getTargets(node,"newConnectors",true),editorContext,blocks,connectors);
  final DiagramCell editorCell=new DiagramCell(editorContext,node){
    public Mapper<SNode,DiagramView> getMapper(){
      return new Mapper<SNode,DiagramView>(node,new ConnectionRoutingView(new OrthogonalRouter())){
        @Override protected void registerSynchronizers(        Mapper.SynchronizersConfiguration configuration){
          super.registerSynchronizers(configuration);
          configuration.add(Synchronizers.<SNode,View>forSimpleRole(this,blocks,getTarget().itemsView.children(),new MapperFactory<SNode,View>(){
            public Mapper<? extends SNode,? extends View> createMapper(            SNode node){
              EditorCell blockCell=editorContext.createNodeCell(node);
              if (blockCell instanceof BlockCell) {
                addEditorCell(blockCell);
                return ((BlockCell)blockCell).getMapper();
              }
              return null;
            }
          }
));
          configuration.add(Synchronizers.<SNode,Connection>forSimpleRole(this,connectors,getTarget().connections,new MapperFactory<SNode,Connection>(){
            public Mapper<? extends SNode,? extends Connection> createMapper(            SNode node){
              EditorCell connectorCell=editorContext.createNodeCell(node);
              if (connectorCell instanceof ConnectorCell) {
                addEditorCell(connectorCell);
                return ((ConnectorCell)connectorCell).getMapper();
              }
              return null;
            }
          }
));
          configuration.add(Synchronizers.forObservableRole(this,myConnectionSingleList,getTarget().connections,new MapperFactory<PolyLineConnection,Connection>(){
            public Mapper<? extends PolyLineConnection,? extends Connection> createMapper(            PolyLineConnection source){
              return new Mapper<PolyLineConnection,Connection>(source,source){
              }
;
            }
          }
));
        }
      }
;
    }
  }
;
  editorCell.setBlockSubstituteInfo(new SubstituteInfoPartExt[]{editorCell.createNewDiagramNodeActions(node,SConceptOperations.findConceptDeclaration("jetbrains.mps.testHybridEditor.structure.BlockInstance"),SLinkOperations.findLinkDeclaration("jetbrains.mps.testHybridEditor.structure.Diagram","newBlocks"),new _FunctionTypes._void_P3_E0<SNode,Integer,Integer>(){
    public void invoke(    SNode node,    Integer x,    Integer y){
      SPropertyOperations.set(SNodeOperations.cast(node,"jetbrains.mps.testHybridEditor.structure.BlockInstance"),"name","block");
      SPropertyOperations.set(SNodeOperations.cast(node,"jetbrains.mps.testHybridEditor.structure.BlockInstance"),"x","" + (x));
      SPropertyOperations.set(SNodeOperations.cast(node,"jetbrains.mps.testHybridEditor.structure.BlockInstance"),"y","" + (y));
    }
  }
)});
  editorCell.setConnectorSubstituteInfo(new SubstituteInfoPartExt[]{editorCell.createNewDiagramConnectorActions(node,SConceptOperations.findConceptDeclaration("jetbrains.mps.testHybridEditor.structure.ConnectorInstance"),SLinkOperations.findLinkDeclaration("jetbrains.mps.testHybridEditor.structure.Diagram","newConnectors"),new _FunctionTypes._return_P4_E0<Boolean,SNode,Object,SNode,Object>(){
    public Boolean invoke(    SNode from,    Object fromId,    SNode to,    Object toId){
      return SNodeOperations.isInstanceOf(from,"jetbrains.mps.testHybridEditor.structure.BlockInstance") && fromId instanceof SNode && SNodeOperations.isInstanceOf(to,"jetbrains.mps.testHybridEditor.structure.BlockInstance")&& toId == null;
    }
  }
,new _FunctionTypes._void_P5_E0<SNode,SNode,Object,SNode,Object>(){
    public void invoke(    SNode node,    SNode from,    Object fromId,    SNode to,    Object toId){
      SNode connector=SNodeOperations.cast(node,"jetbrains.mps.testHybridEditor.structure.ConnectorInstance");
      SLinkOperations.setTarget(SLinkOperations.getTarget(connector,"source",true),"block",SNodeOperations.cast(from,"jetbrains.mps.testHybridEditor.structure.BlockInstance"),false);
      final SNode port=((SNode)fromId);
      SLinkOperations.setTarget(SLinkOperations.getTarget(connector,"source",true),"metaPort",ListSequence.fromList(SLinkOperations.getTargets(SLinkOperations.getTarget(SNodeOperations.cast(from,"jetbrains.mps.testHybridEditor.structure.BlockInstance"),"metaBlock",false),"outMetaPorts",true)).findFirst(new IWhereFilter<SNode>(){
        public boolean accept(        SNode it){
          return eq_tb7paq_a0a0a0a0a2a3a0a0e0a0a0a7a11(it,port);
        }
      }
),false);
      SLinkOperations.setTarget(SLinkOperations.getTarget(connector,"target",true),"block",SNodeOperations.cast(to,"jetbrains.mps.testHybridEditor.structure.BlockInstance"),false);
    }
  }
)});
  editorCell.activateBlockInfo();
  editorCell.getRootMapper().attachRoot();
  editorCell.setCellId("Diagram_tb7paq_e0");
  return editorCell;
}
