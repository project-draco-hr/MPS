{
  if (((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files")) == null) {
    return "???";
  }
  SNode path=SLinkOperations.getTarget(_context.getNode(),MetaAdapterFactory.getReferenceLink(new UUID(934837630734519964l,-6831122735637083229l),4964617264469340766l,4964617264469340767l,"targetPath"));
  final String pathText=BehaviorReflection.invokeVirtual(String.class,path,"virtual_getRelativePath_5481553824944787371",new Object[]{});
  String result=ListSequence.fromList(SLinkOperations.getChildren(((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._2(),MetaAdapterFactory.getContainmentLink(new UUID(934837630734519964l,-6831122735637083229l),7655580649838764660l,4356762679305686649l,"jarLocations"))).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return eq_x583g4_a0a0a0a0a0a0a3a51(BehaviorReflection.invokeVirtual(String.class,SLinkOperations.getTarget(it,MetaAdapterFactory.getContainmentLink(new UUID(934837630734519964l,-6831122735637083229l),4356762679305675652l,4356762679305675653l,"path")),"virtual_getRelativePath_5481553824944787371",new Object[]{}),pathText);
    }
  }
).select(new ISelector<SNode,String>(){
    public String select(    SNode it){
      return SPropertyOperations.getString(it,MetaAdapterFactory.getProperty(new UUID(934837630734519964l,-6831122735637083229l),4356762679305675652l,4356762679305675654l,"packagedLocation"));
    }
  }
).first();
  if (result != null) {
    return result;
  }
  LocalArtifacts outputFiles=((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._0();
  Tuples._2<SNode,String> location=outputFiles.getResource(path);
  if (location._0() == null) {
    String jarName=BehaviorReflection.invokeVirtual(String.class,path,"virtual_getLastSegment_1368030936106771141",new Object[]{Context.defaultContext(_context).getMacros(path)});
    _context.showErrorMessage(path,"cannot find `" + jarName + "' in local layout");
    return "???";
  }
  SNode container=((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._1();
  try {
    return new ArtifactsRelativePathHelper(outputFiles,container).getRelativePath(SNodeOperations.cast(location._0(),MetaAdapterFactory.getConcept(new UUID(8755280088213897754l,-5075149991798053422l),7389400916848036997l,"jetbrains.mps.build.structure.BuildLayout_Node"))) + location._1();
  }
 catch (  ArtifactsRelativePathHelper.RelativePathException ex) {
    String jarName=BehaviorReflection.invokeVirtual(String.class,path,"virtual_getLastSegment_1368030936106771141",new Object[]{Context.defaultContext(_context).getMacros(path)});
    _context.showErrorMessage(_context.getNode(),"cannot build relative path to `" + jarName + "': "+ ex.getMessage());
    return "";
  }
}
