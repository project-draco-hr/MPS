{
  if (((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files")) == null) {
    return "???";
  }
  SNode path=SLinkOperations.getTarget(_context.getNode(),"targetPath",false);
  final String pathText=BehaviorReflection.invokeVirtual(String.class,path,"virtual_getRelativePath_5481553824944787371",new Object[]{});
  String result=ListSequence.fromList(SLinkOperations.getTargets(((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._2(),"jarLocations",true)).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return eq_x583g4_a0a0a0a0a0a0a3a71(BehaviorReflection.invokeVirtual(String.class,SLinkOperations.getTarget(it,"path",true),"virtual_getRelativePath_5481553824944787371",new Object[]{}),pathText);
    }
  }
).select(new ISelector<SNode,String>(){
    public String select(    SNode it){
      return SPropertyOperations.getString(it,"packagedLocation");
    }
  }
).first();
  if (result != null) {
    return result;
  }
  LocalArtifacts outputFiles=((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._0();
  Tuples._2<SNode,String> location=outputFiles.getResource(path);
  if (location._0() == null) {
    String jarName=BehaviorReflection.invokeVirtual(String.class,path,"virtual_getLastSegment_1368030936106771141",new Object[]{Context.defaultContext(_context).getMacros(path)});
    _context.showErrorMessage(path,"cannot find `" + jarName + "' in local layout");
    return "???";
  }
  SNode container=((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._1();
  try {
    return new ArtifactsRelativePathHelper(outputFiles,container).getRelativePath(SNodeOperations.cast(location._0(),"jetbrains.mps.build.structure.BuildLayout_Node")) + location._1();
  }
 catch (  ArtifactsRelativePathHelper.RelativePathException ex) {
    String jarName=BehaviorReflection.invokeVirtual(String.class,path,"virtual_getLastSegment_1368030936106771141",new Object[]{Context.defaultContext(_context).getMacros(path)});
    _context.showErrorMessage(_context.getNode(),"cannot build relative path to `" + jarName + "': "+ ex.getMessage());
    return "";
  }
}
