{
  Iterable<? extends ZipEntry> entries=CollectionUtil.asIterable(myZipFile.entries());
  for (  ZipEntry entry : entries) {
    if (entry.isDirectory()) {
      String name=entry.getName();
      if (name.endsWith("/")) {
        name=name.substring(0,name.length() - 1);
      }
      buildDirectoryCaches(name);
    }
 else {
      String name=entry.getName();
      int packEnd=name.lastIndexOf('/');
      String dir;
      String fileName;
      if (packEnd == -1) {
        dir="";
        fileName=name;
      }
 else {
        dir=packEnd > 0 ? name.substring(0,packEnd) : name;
        fileName=name.substring(packEnd + 1);
      }
      buildDirectoryCaches(dir);
      getFilesFor(dir).add(fileName);
      if (dir.length() > 0) {
        myEntries.put(dir + "/" + fileName,entry);
      }
 else {
        myEntries.put(fileName,entry);
      }
    }
  }
}
