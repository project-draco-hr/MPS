{
  List<SNode> lvdecls=new ArrayList<SNode>();
  for (  SNode desc : SNodeOperations.getDescendants(closure,null,false)) {
    if (SNodeOperations.isInstanceOf(desc,"jetbrains.mps.baseLanguage.structure.LocalVariableReference") && closure == SNodeOperations.getAncestor(desc,"jetbrains.mps.closures.structure.ClosureLiteral",false,false)) {
      SNode lvd=SLinkOperations.getTarget(desc,"variableDeclaration",false);
      if (closure != SNodeOperations.getAncestor(lvd,"jetbrains.mps.closures.structure.ClosureLiteral",false,false)) {
        if (!(lvdecls.contains(SLinkOperations.getTarget(desc,"variableDeclaration",false)))) {
          lvdecls.add(SLinkOperations.getTarget(desc,"variableDeclaration",false));
        }
      }
    }
  }
  with_decls:   for (Iterator<SNode> it=lvdecls.iterator(); it.hasNext(); ) {
    SNode lvd=it.next();
    SNode sl=SNodeOperations.getAncestor(lvd,"jetbrains.mps.baseLanguage.structure.StatementList",false,false);
    for (    SNode desc : SNodeOperations.getDescendants(sl,null,false)) {
      if (SNodeOperations.isInstanceOf(desc,"jetbrains.mps.baseLanguage.structure.LocalVariableReference") && SLinkOperations.getTarget(desc,"variableDeclaration",false) == lvd) {
        if (SNodeOperations.isInstanceOf(SNodeOperations.getParent(desc),"jetbrains.mps.baseLanguage.structure.AssignmentExpression") && SLinkOperations.getTarget(SNodeOperations.getParent(desc),"lValue",true) == desc) {
          continue with_decls;
        }
      }
    }
    it.remove();
  }
  return lvdecls;
}
