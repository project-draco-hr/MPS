{
  if (path == null) {
    return null;
  }
  if (moduleSourceDir != null && path.startsWith(MacrosFactory.MODULE)) {
    String relPath=path.substring(path.indexOf('}') + 1);
    return IFileUtils.getCanonicalPath(moduleSourceDir.getDescendant(relPath));
  }
  if (path.startsWith("${")) {
    int index=path.indexOf("}");
    if (index == -1) {
      reporter.report("invalid macro in `" + path + "'",null,null);
      return path;
    }
    String macroName=path.substring(2,index);
    SNode found=null;
    for (    SNode macro : Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(SNodeOperations.getNodeAncestor(originalModule,MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4df58c6f18f84a13L,"jetbrains.mps.build.structure.BuildProject"),false,false),MetaAdapterFactory.getContainmentLink(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x4df58c6f18f84a13L,0x4df58c6f18f84a22L,"macros")),MetaAdapterFactory.getConcept(0x798100da4f0a421aL,0xb99171f8c50ce5d2L,0x668c6cfbafadd002L,"jetbrains.mps.build.structure.BuildFolderMacro")))) {
      if (eq_krgnbt_a0a0f0d0f4(SPropertyOperations.getString(macro,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name")),macroName)) {
        found=macro;
        break;
      }
    }
    if (found == null) {
      reporter.report("macro is not declared in build script: " + path,null,null);
      return path;
    }
    String localPath=BuildFolderMacro__BehaviorDescriptor.evaluate_id4jjtc7WZOzA.invoke(found,Context.defaultContext(genContext));
    if (localPath == null) {
      reporter.report("cannot resolve local path: " + path + ", macro has no default value",found,null);
      return path;
    }
    String relPath=path.substring(index + 1);
    return IFileUtils.getCanonicalPath(FileSystem.getInstance().getFileByPath(localPath).getDescendant(relPath));
  }
  return path;
}
