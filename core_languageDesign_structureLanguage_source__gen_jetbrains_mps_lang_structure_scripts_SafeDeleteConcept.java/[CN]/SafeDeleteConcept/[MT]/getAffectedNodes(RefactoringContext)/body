{
{
    SNode node=refactoringContext.getSelectedNode();
    SearchResults searchResults=FindUtils.getSearchResults(ActionEventData.createProgressIndicator(),refactoringContext.getSelectedNode(),GlobalScope.getInstance(),"jetbrains.mps.lang.structure.findUsages.ConceptInstances_Finder","jetbrains.mps.lang.structure.findUsages.NodeAndDescendantsUsages_Finder");
    refactoringContext.setParameter("sourceLanguage",Language.getLanguageFor(SNodeOperations.getModel(node).getModelDescriptor()));
    if (((Language)refactoringContext.getParameter("sourceLanguage")) != null) {
      SModelDescriptor editorModelDescriptor=((Language)refactoringContext.getParameter("sourceLanguage")).getEditorModelDescriptor();
      List searchResultsList=searchResults.getSearchResults();
      if (editorModelDescriptor != null) {
        refactoringContext.setParameter("conceptEditorDeclaration",SModelUtil_new.findEditorDeclaration(editorModelDescriptor.getSModel(),((AbstractConceptDeclaration)SNodeOperations.getAdapter(node))));
        if (((ConceptEditorDeclaration)refactoringContext.getParameter("conceptEditorDeclaration")) != null) {
          SNode editorNode=((ConceptEditorDeclaration)refactoringContext.getParameter("conceptEditorDeclaration")).getNode();
          for (          SearchResult<SNode> searchResult : new ArrayList<SearchResult<SNode>>((Collection)searchResultsList)) {
            if (searchResult.getObject().getContainingRoot() == editorNode) {
              searchResults.remove(searchResult);
            }
          }
        }
      }
      SModelDescriptor behaviorModelDescriptor=((Language)refactoringContext.getParameter("sourceLanguage")).getBehaviorModelDescriptor();
      if (behaviorModelDescriptor != null) {
        refactoringContext.setParameter("conceptBehavior",SModelUtil_new.findBehaviorDeclaration(behaviorModelDescriptor.getSModel(),((AbstractConceptDeclaration)SNodeOperations.getAdapter(node))));
        if (((ConceptBehavior)refactoringContext.getParameter("conceptBehavior")) != null) {
          SNode behaviorNode=((ConceptBehavior)refactoringContext.getParameter("conceptBehavior")).getNode();
          for (          SearchResult<SNode> searchResult : new ArrayList<SearchResult<SNode>>((Collection)searchResultsList)) {
            if (searchResult.getObject().getContainingRoot() == behaviorNode) {
              searchResults.remove(searchResult);
            }
          }
        }
      }
    }
    return searchResults;
  }
}
