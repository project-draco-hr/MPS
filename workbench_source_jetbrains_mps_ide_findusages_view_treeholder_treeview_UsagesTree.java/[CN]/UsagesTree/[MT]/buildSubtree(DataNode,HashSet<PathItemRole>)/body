{
  List<UsagesTreeNode> children=new ArrayList<UsagesTreeNode>();
  for (  DataNode child : root.getChildren()) {
    children.addAll(buildSubtree(child,nodeCategories));
  }
  BaseNodeData data=root.getData();
  if (nodeCategories.contains(data.getRole())) {
    UsagesTreeNode node=new UsagesTreeNode("");
    node.setNodeIdentifier(data.getPlainText());
    node.setIcon(data.getIcon());
    node.setUserObject(root);
    String invalid=data.isInvalid() ? "<font color=red>[Invalid]</font> " : "";
    String caption=data.getText(new TextOptions(myAdditionalInfoNeeded,true));
    if (data.isExcluded()) {
      node.setText(invalid + "<font color=gray><s>" + caption+ "</s></font>");
    }
 else {
      node.setText(invalid + caption);
    }
    for (    UsagesTreeNode child : children) {
      node.add(child);
    }
    children.clear();
    children.add(node);
  }
  return children;
}
