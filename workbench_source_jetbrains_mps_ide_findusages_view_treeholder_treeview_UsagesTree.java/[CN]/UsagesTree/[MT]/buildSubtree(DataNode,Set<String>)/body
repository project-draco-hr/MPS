{
  List<UsagesTreeNode> children=new ArrayList<UsagesTreeNode>();
  for (  DataNode child : root.getChildren()) {
    children.addAll(buildSubtree(child,nodeCategories));
  }
  BaseNodeData data=root.getData();
  if (nodeCategories.contains(data.getCreatorID())) {
    UsagesTreeNode node=new UsagesTreeNode("");
    node.setNodeIdentifier(data.getPlainText());
    String invalid=data.isInvalid() ? "<font color=red>[Invalid]</font> " : "";
    node.setText(invalid + data.getText(new TextOptions(myAdditionalInfoNeeded,myCountersNeeded)));
    node.setIcon(data.getIcon());
    node.setUserObject(root);
    for (    UsagesTreeNode child : children) {
      node.add(child);
    }
    children.clear();
    children.add(node);
  }
  return children;
}
