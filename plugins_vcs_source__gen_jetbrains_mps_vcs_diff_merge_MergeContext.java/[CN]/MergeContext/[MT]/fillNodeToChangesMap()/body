{
  for (  ModelChange change : Sequence.<ModelChange>fromIterable(getAllChanges())) {
    SNodeId nodeId=null;
    if (change instanceof NodeGroupChange) {
      nodeId=((NodeGroupChange)change).getParentNodeId();
    }
 else     if (change instanceof NodeChange) {
      nodeId=((NodeChange)change).getAffectedNodeId();
    }
 else     if (change instanceof AddRootChange || change instanceof DeleteRootChange) {
      nodeId=change.getRootId();
    }
    if (nodeId != null) {
      if (MapSequence.<SNodeId,List<ModelChange>>fromMap(myNodeToChanges).get(nodeId) == null) {
        MapSequence.<SNodeId,List<ModelChange>>fromMap(myNodeToChanges).put(nodeId,ListSequence.<ModelChange>fromList(new ArrayList<ModelChange>()));
      }
      ListSequence.<ModelChange>fromList(MapSequence.<SNodeId,List<ModelChange>>fromMap(myNodeToChanges).get(nodeId)).addElement(change);
    }
  }
}
