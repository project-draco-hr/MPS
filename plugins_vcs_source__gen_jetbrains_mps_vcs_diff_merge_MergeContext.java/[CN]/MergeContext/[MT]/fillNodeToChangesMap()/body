{
  for (  ModelChange change : Sequence.fromIterable(getAllChanges())) {
    SNodeId nodeId=null;
    if (change instanceof NodeGroupChange) {
      nodeId=((NodeGroupChange)change).getParentNodeId();
    }
 else     if (change instanceof NodeChange) {
      nodeId=((NodeChange)change).getAffectedNodeId();
    }
 else     if (change instanceof AddRootChange || change instanceof DeleteRootChange) {
      nodeId=change.getRootId();
    }
    if (nodeId != null) {
      if (MapSequence.fromMap(myNodeToChanges).get(nodeId) == null) {
        MapSequence.fromMap(myNodeToChanges).put(nodeId,ListSequence.fromList(new ArrayList<ModelChange>()));
      }
      ListSequence.fromList(MapSequence.fromMap(myNodeToChanges).get(nodeId)).addElement(change);
    }
  }
}
