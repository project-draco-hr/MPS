{
  if (outputPath == null)   throw new RuntimeException("Unspecified output path. Please specify one.");
  LOG.debug("Generating to root : " + outputPath);
  String packageName=JavaNameUtil.packageNameForModelFqName(sourceModel.getFQName());
  File outputPathFile=new File(outputPath + File.separator + packageName.replace('.',File.separatorChar));
  LOG.debug("Generating to folder : " + outputPathFile.getAbsolutePath());
  if (!outputPathFile.exists()) {
    outputPathFile.mkdirs();
  }
  if (targetModel.importsLanguage("jetbrains.mps.xml")) {
    XmlFileGenerator xmlFileGenerator=new XmlFileGenerator(outputPathFile,packageName,false);
    Iterator<SemanticNode> roots=targetModel.roots();
    while (roots.hasNext()) {
      SemanticNode node=roots.next();
      xmlFileGenerator.generateXmlFile((jetbrains.mps.xml.Element)node);
    }
  }
 else {
    JavaFileGenerator javaFileGenerator=new JavaFileGenerator(outputPathFile,packageName,false);
    Iterator<SemanticNode> roots=targetModel.roots();
    while (roots.hasNext()) {
      SemanticNode node=roots.next();
      javaFileGenerator.generateJavaFile((Classifier)node);
    }
  }
}
