{
  expandReferenceMacro(ref);
  if (myOutputTargetNode != null) {
    return createStaticReference(ref,myOutputTargetNode);
  }
  if (myResolveInfoForDynamicResolve != null) {
    return createDynamicReference(ref,myResolveInfoForDynamicResolve,new DynamicReferenceOrigin(getMacroNodeRef(),null));
  }
  if (!ref.getLink().isOptional()) {
    return createInvalidReference(ref,myResolver.getDefaultResolveInfo());
  }
  return null;
}
