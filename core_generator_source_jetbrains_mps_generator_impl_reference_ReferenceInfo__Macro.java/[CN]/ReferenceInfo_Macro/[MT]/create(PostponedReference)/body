{
  expandReferenceMacro(ref);
  if (myOutputTargetNode != null) {
    return createStaticReference(ref,myOutputTargetNode);
  }
  if (myResolveInfoForDynamicResolve != null) {
    final SReference dr=createDynamicReference(ref,myResolveInfoForDynamicResolve,new DynamicReferenceOrigin(getMacroNodeRef(),null));
    ref.getGenerator().registerDynamicReference(dr);
    return dr;
  }
  if (!ref.getLink().isOptional()) {
    return createInvalidReference(ref,myResolver.getDefaultResolveInfo());
  }
  return null;
}
