{
  if (file.getFileSystem() instanceof IoFileSystem) {
    file=FileSystemExtPoint.getFS().getFile(file.getPath());
    if (file instanceof IdeaFile) {
      return ((IdeaFile)file).getVirtualFile();
    }
  }
 else   if (file instanceof IdeaFile) {
    return ((IdeaFile)file).getVirtualFile();
  }
 else {
    LOG.warn("Unknown file " + file);
  }
  return null;
}
