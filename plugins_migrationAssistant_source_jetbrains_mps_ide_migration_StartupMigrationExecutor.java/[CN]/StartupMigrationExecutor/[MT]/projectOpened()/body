{
  if (!myMigrationManager.isMigrationRequired())   return;
  StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
    public void run(){
      if (!myState.reloadFinished) {
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          @Override public void run(){
            VirtualFileManager.getInstance().syncRefresh();
            myState.reloadFinished=true;
            ProjectManagerEx.getInstance().reloadProject(myProject);
          }
        }
);
      }
 else {
        myState.reloadFinished=false;
        final boolean[] success=new boolean[1];
        MigrationAssistantWizard wizard=new MigrationAssistantWizard(myProject,myMigrationManager,success);
        wizard.showAndGetOk().doWhenDone(new Consumer<Boolean>(){
          @Override public void consume(          Boolean finished){
            if (!finished)             return;
            if (!success[0])             return;
            ModelAccess.instance().runWriteAction(new Runnable(){
              @Override public void run(){
                MPSModuleRepository.getInstance().saveAll();
              }
            }
);
            ApplicationManager.getApplication().runWriteAction(new Runnable(){
              @Override public void run(){
                ProjectManagerEx.getInstance().reloadProject(myProject);
              }
            }
);
          }
        }
);
      }
    }
  }
);
}
