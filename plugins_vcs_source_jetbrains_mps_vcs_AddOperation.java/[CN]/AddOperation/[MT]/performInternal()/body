{
  Set<VirtualFile> filesToCheckStatuses=new HashSet<VirtualFile>(myVirtualFilesToAdd);
  myVirtualFilesToAdd.clear();
  for (  File f : myFilesToAdd) {
    VirtualFile virtualFile=VFileSystem.refreshAndGetFile(f);
    if (virtualFile != null && !isIgnored(virtualFile)) {
      filesToCheckStatuses.add(virtualFile);
    }
 else     if (virtualFile == null && f.exists()) {
      LOG.error("Cannot find virtual file for IO file " + f);
    }
  }
  if (myRecursive) {
    filesToCheckStatuses.addAll(getAllChildren(filesToCheckStatuses,new LinkedHashSet<VirtualFile>()));
  }
  reliablyGetUnversionedFiles(filesToCheckStatuses,myVirtualFilesToAdd,myVirtualFilesToRevertDeletedStatus);
  askAndPerform();
}
