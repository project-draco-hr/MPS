{
  List<VirtualFile> filesToRevert=new ArrayList<VirtualFile>(myVirtualFilesToRevertDeletedStatus.keySet());
  if (mySilently || myConfirmationOption.getValue() == VcsShowConfirmationOption.Value.DO_ACTION_SILENTLY) {
    reallyPerform(filesToRevert,myVirtualFilesToAdd);
  }
 else   if (myConfirmationOption.getValue() == VcsShowConfirmationOption.Value.DO_NOTHING_SILENTLY) {
    return;
  }
 else {
    final Collection<VirtualFile> filesToProcess=new ArrayList<VirtualFile>();
    final List<VirtualFile> virtualFileList=CollectionUtil.union(myVirtualFilesToAdd,filesToRevert);
    if (!virtualFileList.isEmpty()) {
      final AbstractVcsHelper helper=AbstractVcsHelper.getInstance(myProject);
      ThreadUtils.runInUIThreadAndWait(new Runnable(){
        @Override public void run(){
          Collection<VirtualFile> dialogResult=helper.selectFilesToProcess(virtualFileList,"Add Files To Vcs",null,"Add File To Vcs","Do you want to add the following file to Vcs?\n{0}\n\nIf you say NO, you can still add it later manually.",myConfirmationOption);
          if (dialogResult != null) {
            filesToProcess.addAll(dialogResult);
          }
        }
      }
);
    }
    if (!filesToProcess.isEmpty()) {
      reallyPerform(CollectionUtil.intersect(filesToRevert,filesToProcess),CollectionUtil.intersect(myVirtualFilesToAdd,filesToProcess));
    }
  }
}
