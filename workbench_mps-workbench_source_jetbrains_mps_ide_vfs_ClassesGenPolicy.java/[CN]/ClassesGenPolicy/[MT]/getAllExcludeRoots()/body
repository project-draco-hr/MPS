{
  final Set<VirtualFile> roots=new HashSet<VirtualFile>();
  ModelAccess.instance().runReadAction(new Runnable(){
    @Override public void run(){
      for (      SModule module : MPSModuleRepository.getInstance().getModules()) {
        JavaModuleFacet facet=module.getFacet(JavaModuleFacet.class);
        if (facet == null)         continue;
        IFile classesGen=facet.getClassesGen();
        if (classesGen == null)         continue;
        if (classesGen.getName().endsWith("." + MPSExtentions.MPS_ARCH))         continue;
        VirtualFile classesGenVF=VirtualFileUtils.getVirtualFile(classesGen);
        if (classesGenVF != null) {
          roots.add(classesGenVF);
        }
        if (((AbstractModule)module).getModuleSourceDir() != null && ((AbstractModule)module).getModuleSourceDir().getDescendant("classes") != null) {
          VirtualFile classesVF=VirtualFileUtils.getVirtualFile(((AbstractModule)module).getModuleSourceDir().getDescendant("classes"));
          if (classesVF != null) {
            roots.add(classesVF);
          }
        }
      }
    }
  }
);
  return roots;
}
