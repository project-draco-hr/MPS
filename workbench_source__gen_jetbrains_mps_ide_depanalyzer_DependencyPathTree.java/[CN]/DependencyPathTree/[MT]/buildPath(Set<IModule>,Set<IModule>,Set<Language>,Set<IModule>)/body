{
  List<MPSTreeNode> result=ListSequence.fromList(new ArrayList<MPSTreeNode>());
  for (  IModule m : SetSequence.fromSet(from)) {
    if (SetSequence.fromSet(visited).contains(m)) {
      continue;
    }
    if (SetSequence.fromSet(dependency).contains(m)) {
      ListSequence.fromList(result).addElement(new DependencyTreeLeafNode(m,null));
    }
 else {
      SetSequence.fromSet(visited).addElement(m);
      Set<IModule> mdep=m.getDependenciesManager().getRequiredModules();
      List<MPSTreeNode> m2=buildPath(mdep,dependency,usedLanguage,visited);
      if (ListSequence.fromList(m2).isNotEmpty()) {
        final MPSTreeNode node=new DependencyTreeNode(m,null);
        ListSequence.fromList(m2).visitAll(new IVisitor<MPSTreeNode>(){
          public void visit(          MPSTreeNode it){
            node.add(it);
          }
        }
);
        ListSequence.fromList(result).addElement(node);
      }
    }
  }
  return result;
}
