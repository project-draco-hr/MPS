{
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      List<ModelChange> changes=getChangeGroup().getChanges();
      final SModel model=ListSequence.fromList(changes).first().getChangeSet().getOldModel();
      final NodeCopier nc=new NodeCopier(model);
      ListSequence.fromList(changes).ofType(NodeGroupChange.class).visitAll(new IVisitor<NodeGroupChange>(){
        public void visit(        NodeGroupChange ch){
          ch.prepare();
        }
      }
);
      ListSequence.fromList(changes).visitAll(new IVisitor<ModelChange>(){
        public void visit(        ModelChange ch){
          ch.apply(model,nc);
        }
      }
);
      nc.restoreIds(true);
    }
  }
);
}
