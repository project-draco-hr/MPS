{
  ListSequence.fromList(SNodeOperations.getNodeDescendants(node,null,false,new SConcept[]{})).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return ListSequence.fromList(SNodeOperations.getChildren(it)).isEmpty();
    }
  }
).visitAll(new IVisitor<SNode>(){
    public void visit(    SNode it){
      transformNodeToProperVariableReference(it,containerModel);
    }
  }
);
  for (  SNode d : ListSequence.fromList(SNodeOperations.getNodeDescendants(node,null,true,new SConcept[]{}))) {
    replaceStubReferences(d,containerModel);
  }
}
