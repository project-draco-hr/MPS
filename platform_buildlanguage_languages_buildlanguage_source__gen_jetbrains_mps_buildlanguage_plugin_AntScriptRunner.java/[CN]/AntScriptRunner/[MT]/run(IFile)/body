{
  List<String> parameters=ListSequence.fromList(new ArrayList<String>());
  addBasicParameters(parameters,file);
  AntScriptRunner.addMacroValues(parameters);
  addProgramParameters(parameters);
  this.myBuilder=new ProcessBuilder(ListSequence.fromListWithValues(new ArrayList<String>(),parameters));
  IFile workingDir;
  if (this.myRunParameters.getWorkingDirectory() != null && StringUtils.isNotEmpty(this.myRunParameters.getWorkingDirectory())) {
    workingDir=FileSystem.getInstance().getFileByPath(this.myRunParameters.getWorkingDirectory());
  }
 else {
    workingDir=file.getParent();
  }
  this.myBuilder.directory(new File(workingDir.getPath()));
  try {
    return this.myBuilder.start();
  }
 catch (  IOException e) {
    LOG.error("Can't run script " + file + ": "+ e.getMessage(),e);
    throw new ProcessNotCreatedException(e.getMessage(),e,this.getCommandLine(workingDir.getPath()));
  }
}
