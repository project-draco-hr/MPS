{
  List<String> parameters=ListSequence.fromList(new ArrayList<String>());
  AntScriptRunner.addBasicParameters(parameters,file);
  AntScriptRunner.addMacroValues(parameters);
  if (programParams != null && StringUtils.isNotEmpty(programParams)) {
    List<String> commandLineList=Sequence.fromIterable(Sequence.fromArray(programParams.split("\\s+"))).toListSequence();
    ListSequence.fromList(parameters).addSequence(ListSequence.fromList(commandLineList));
  }
  this.myBuilder=new ProcessBuilder(ListSequence.fromListWithValues(new ArrayList<String>(),parameters));
  File workingDirFile;
  if (workingDir != null && StringUtils.isNotEmpty(workingDir)) {
    workingDirFile=new File(workingDir);
  }
 else {
    workingDirFile=file.getParentFile();
  }
  this.myBuilder.directory(workingDirFile);
  try {
    return this.myBuilder.start();
  }
 catch (  IOException e) {
    LOG.error("Can't run script " + file + ": "+ e.getMessage(),e);
    throw new ProcessNotCreatedException(e.getMessage(),e,this.getCommandLine(workingDirFile.getAbsolutePath()));
  }
}
