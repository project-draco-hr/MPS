{
  final List<SNode> pathToRoot=SModelUtils.getPathToRoot(e.getReference().getSourceNode());
  myCommandQueue.runTask(new Runnable(){
    public void run(){
      if (!(checkLoaded())) {
        return;
      }
      fireChangeUpdateStarted();
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          final SReference reference=e.getReference();
          if (isAncestorAlreadyAdded(pathToRoot)) {
            return;
          }
          final SNodeId sourceNodeId=reference.getSourceNode().getSNodeId();
          removeChanges(DeleteReferenceChange.class,new _FunctionTypes._return_P1_E0<Boolean,DeleteReferenceChange>(){
            public Boolean invoke(            DeleteReferenceChange ch){
              return ch.getAffectedNodeId().equals(sourceNodeId) && ch.getRole().equals(reference.getRole());
            }
          }
);
          SNode baseTargetNode=check_8870979023098932944(myBaseVersionModel.getNodeById(sourceNodeId),reference);
          if (baseTargetNode != null && new SNodePointer(baseTargetNode).equals(new SNodePointer(reference.getTargetSModelReference(),reference.getTargetNodeId()))) {
            return;
          }
          addChange(new SetReferenceChange(sourceNodeId,e.getModel(),e.getReference(),e.getReference().getTargetNode()),e.getAffectedRoot());
        }
      }
);
      fireChangeUpdateFinished();
    }
  }
);
}
