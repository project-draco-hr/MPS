{
  final ReferentConstraintContext context=new ReferentConstraintContext(getModel(),exists,getContextNode(),contextRole,position,enclosingNode,referenceNode,linkTarget,containingLink);
  try {
    if (scopeProvider != null) {
      Scope searchScope=scopeProvider.createScope(getOperationContext(getModule()),context);
      if (searchScope != null) {
        if (reference != null && searchScope instanceof Adapter) {
          return new RefAdapter(((Adapter)searchScope).getSearchScope(),reference);
        }
        return searchScope;
      }
    }
    return new ModelPlusImportedScope(getModel(),false,MetaAdapterByDeclaration.getConcept(linkTarget));
  }
 catch (  Exception t) {
    LOG.error(t,getContextNode());
    return new ErrorScope("can't create search scope for role `" + genuineRole + "' in '"+ sourceNodeConcept.getName()+ "'");
  }
}
