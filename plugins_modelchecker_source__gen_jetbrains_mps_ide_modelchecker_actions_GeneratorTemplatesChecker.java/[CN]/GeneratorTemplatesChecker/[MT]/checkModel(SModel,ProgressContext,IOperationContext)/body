{
  if (!(SModelStereotype.isGeneratorModel(model))) {
    return Collections.emptyList();
  }
  final List<SearchResult<ModelCheckerIssue>> results=ListSequence.fromList(new ArrayList<SearchResult<ModelCheckerIssue>>());
  String title="Checking " + SModelOperations.getModelName(model) + " for cross-templates references...";
  if (!(progressContext.checkAndUpdateIndicator(title))) {
    return results;
  }
  new TemplateModelScanner(model){
    @Override public void scan(){
      for (      SNode root : SModelOperations.getRoots(model,null)) {
        if (AttributeOperations.getAttribute(root,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.generator.structure.RootTemplateAnnotation"))) != null) {
          scanTemplateNode(root);
        }
      }
    }
    @Override protected void scanTemplateNode(    SNode node){
      if (node == null) {
        return;
      }
      try {
        for (        SReference ref : Sequence.fromIterable(SNodeOperations.getReferences(node))) {
          if ((AttributeOperations.getAttribute(node,new IAttributeDescriptor.LinkAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.generator.structure.ReferenceMacro"),SLinkOperations.getRole(ref))) != null)) {
            continue;
          }
          SNode target=ref.getTargetNodeSilently();
          if (target == null) {
            continue;
          }
          if (!(SModelStereotype.isGeneratorModel(SNodeOperations.getModel(target)))) {
            continue;
          }
          SNode root=SNodeOperations.getContainingRoot(target);
          if (AttributeOperations.getAttribute(root,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.generator.structure.RootTemplateAnnotation"))) == null) {
            continue;
          }
          if (root == SNodeOperations.getContainingRoot(node)) {
            continue;
          }
          addIssue(results,node,"Reference across root templates in role `" + SLinkOperations.getRole(ref) + "', use mapping label or reference macro",ModelChecker.SEVERITY_WARNING,"reference across templates",null);
        }
      }
 catch (      Exception ex) {
      }
      super.scanTemplateNode(node);
    }
  }
.scan();
  return results;
}
