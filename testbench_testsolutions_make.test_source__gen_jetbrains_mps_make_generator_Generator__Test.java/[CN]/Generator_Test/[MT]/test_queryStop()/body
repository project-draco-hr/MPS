{
  ScriptBuilder scb=new ScriptBuilder();
  final IScriptController mons=Mockups.monitors(context,"mons");
  final IConfigMonitor cmon=context.mock(IConfigMonitor.class);
  context.checking(new Expectations(){
{
      final Object[] cfg=new Object[1];
      exactly(1).of(mons).runConfigWithMonitor((_FunctionTypes._void_P1_E0<? super IConfigMonitor>)with(new BaseMatcher<Object>(){
        @Override public boolean matches(        Object o){
          cfg[0]=o;
          return true;
        }
        @Override public void describeTo(        Description p0){
        }
      }
));
      will(new Action(){
        @Override public Object invoke(        Invocation invocation) throws Throwable {
          ((_FunctionTypes._void_P1_E0<? super IConfigMonitor>)cfg[0]).invoke(cmon);
          return null;
        }
        @Override public void describeTo(        Description description){
        }
      }
);
      exactly(1).of(mons).setup(with(Expectations.aNonNull(IPropertiesPool.class)),with(Expectations.aNonNull(Iterable.class)),with(Expectations.<Iterable>anything()));
      exactly(1).of(cmon).reportFeedback(with(Expectations.aNonNull(IFeedback.class)));
      final IQuery[] query=new IQuery[1];
      exactly(1).of(cmon).relayQuery(with(new BaseMatcher<IQuery<IOption>>(){
        @Override public boolean matches(        Object o){
          if (o instanceof IQuery) {
            query[0]=(IQuery)o;
            return true;
          }
          return false;
        }
        @Override public void describeTo(        Description p0){
        }
      }
));
      will(new Action(){
        @Override public Object invoke(        Invocation invocation) throws Throwable {
          return Sequence.fromIterable(query[0].options()).last();
        }
        @Override public void describeTo(        Description description){
        }
      }
);
    }
  }
);
  Mockups.allowing(context,mons);
  IScript scr=scb.withFacetName(new IFacet.Name("jetbrains.mps.make.tests.Maker_")).withFacetName(new IFacet.Name("jetbrains.mps.make.tests.Generator_")).withFacetName(new IFacet.Name("jetbrains.mps.make.tests.TextGen_")).withFinalTarget(new ITarget.Name("jetbrains.mps.make.tests.Maker_.Make")).toScript();
  Assert.assertTrue(scr.isValid());
  ITarget dt=scr.finalTarget();
  Assert.assertNotNull(dt);
  Assert.assertEquals(new ITarget.Name("jetbrains.mps.make.tests.Maker_.Make"),dt.getName());
  IResult res=scr.execute(mons,null,new EmptyProgressMonitor());
  Assert.assertNotNull(res);
  Assert.assertFalse(res.isSucessful());
  Assert.assertTrue(Sequence.fromIterable(res.output()).isEmpty());
}
