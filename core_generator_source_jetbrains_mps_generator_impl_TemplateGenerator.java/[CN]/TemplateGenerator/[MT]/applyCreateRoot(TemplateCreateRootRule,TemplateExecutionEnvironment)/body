{
  if (!environment.getQueryExecutor().isApplicable(rule,new DefaultTemplateContext(environment,null,null))) {
    return;
  }
  try {
    Collection<SNode> outputNodes=environment.getQueryExecutor().applyRule(rule,environment);
    if (outputNodes == null) {
      return;
    }
    environment.getTrace().trace(null,GenerationTracerUtil.translateOutput(outputNodes),rule.getRuleNode());
    for (    SNode outputNode : outputNodes) {
      registerRoot(new GeneratedRootDescriptor(outputNode,rule.getRuleNode()));
      setChanged();
    }
  }
 catch (  DismissTopMappingRuleException ex) {
    reportDismissRuleException(ex,rule);
  }
catch (  TemplateProcessingFailureException ex) {
    getLogger().error(rule.getRuleNode(),String.format("couldn't create root node: %s",ex.getMessage()),ex.asProblemDescription());
  }
catch (  GenerationCanceledException ex) {
    throw ex;
  }
catch (  GenerationFailureException ex) {
    throw ex;
  }
catch (  GenerationException e) {
    getLogger().error(rule.getRuleNode(),"internal error: " + e.toString());
  }
}
