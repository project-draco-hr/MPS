{
  if (jetbrains.mps.util.SNodeOperations.isRegistered(inputNode)) {
    inputNode=CopyUtil.copy(inputNode);
  }
synchronized (myAdditionalInputNodes) {
    if (!myAdditionalInputNodes.containsKey(inputNode)) {
      Iterable<SNode> thisAndDesc=IterableUtil.merge(Collections.singleton(inputNode),inputNode.getDescendants());
      for (      SNode n : thisAndDesc) {
        myAdditionalInputNodes.put(n,Boolean.TRUE);
      }
    }
  }
  return copyNodeFromInputNode(mappingName,templateNode,templateNodeId,inputNode,reductionContext,new boolean[]{false});
}
