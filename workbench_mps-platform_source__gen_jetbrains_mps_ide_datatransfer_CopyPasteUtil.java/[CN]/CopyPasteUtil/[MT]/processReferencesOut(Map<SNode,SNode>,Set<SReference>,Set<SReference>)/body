{
  for (  SReference sourceReference : allReferences) {
    SNode oldSourceNode=sourceReference.getSourceNode();
    SNode newSourceNode=sourceNodesToNewNodes.get(oldSourceNode);
    SNode oldTargetNode=sourceReference.getTargetNode();
    SNode newTargetNode=sourceNodesToNewNodes.get(oldTargetNode);
    SReference newReference;
    if (newTargetNode != null) {
      newReference=jetbrains.mps.smodel.SReference.create(sourceReference.getLink(),newSourceNode,newTargetNode);
    }
 else {
      if ((jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations.isInstanceOf(newSourceNode,MetaAdapterFactory.getInterfaceConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x11857355952L,"jetbrains.mps.baseLanguage.structure.IMethodCall")) || jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations.isInstanceOf(newSourceNode,MetaAdapterFactory.getConcept(0xf3061a5392264cc5L,0xa443f952ceaf5816L,0x101de48bf9eL,"jetbrains.mps.baseLanguage.structure.ClassifierType"))) && oldTargetNode != null) {
        newReference=jetbrains.mps.smodel.SReference.create(sourceReference.getLink(),newSourceNode,oldTargetNode);
      }
 else {
        String resolveInfo=(oldTargetNode == null ? ((jetbrains.mps.smodel.SReference)sourceReference).getResolveInfo() : oldTargetNode.getName());
        if (resolveInfo != null) {
          if (oldTargetNode != null && SNodeUtil.isAccessible(oldTargetNode,MPSModuleRepository.getInstance())) {
            newReference=new StaticReference(sourceReference.getLink(),newSourceNode,oldTargetNode.getModel().getReference(),oldTargetNode.getNodeId(),resolveInfo);
          }
 else {
            newReference=new StaticReference(sourceReference.getLink(),newSourceNode,null,null,resolveInfo);
          }
          referencesRequireResolve.add(newReference);
        }
 else         if (oldTargetNode != null) {
          newReference=jetbrains.mps.smodel.SReference.create(sourceReference.getLink(),newSourceNode,oldTargetNode);
        }
 else {
          continue;
        }
      }
    }
    newSourceNode.setReference(newReference.getLink(),newReference);
  }
}
