{
  for (  SReference sourceReference : allReferences) {
    SNode oldSourceNode=sourceReference.getSourceNode();
    SNode newSourceNode=sourceNodesToNewNodes.get(oldSourceNode);
    SNode oldTargetNode=sourceReference.getTargetNode();
    SNode newTargetNode=sourceNodesToNewNodes.get(oldTargetNode);
    SReference newReference;
    if (newTargetNode != null) {
      newReference=jetbrains.mps.smodel.SReference.create(sourceReference.getLink(),newSourceNode,newTargetNode);
    }
 else {
      if (oldTargetNode != null) {
        newReference=jetbrains.mps.smodel.SReference.create(sourceReference.getLink(),newSourceNode,oldTargetNode.getModel().getReference(),oldTargetNode.getNodeId());
      }
 else       if (((jetbrains.mps.smodel.SReference)sourceReference).getResolveInfo() != null) {
        newReference=new StaticReference(sourceReference.getLink(),newSourceNode,null,null,((jetbrains.mps.smodel.SReference)sourceReference).getResolveInfo());
      }
 else {
        continue;
      }
    }
    newSourceNode.setReference(newReference.getLink(),newReference);
  }
}
