{
  necessaryImports.clear();
  necessaryLanguages.clear();
  Set<SNode> sourceNodes=sourceNodesToNewNodes.keySet();
  for (  SNode node : sourceNodes) {
    necessaryLanguages.add((SModuleReference)jetbrains.mps.project.structure.modules.ModuleReference.create(node.getConcept().getLanguage().getPresentation(),MPSModuleRepository.getInstance()));
  }
  for (  SReference ref : allReferences) {
    if (sourceNodesToNewNodes.get(ref.getTargetNode()) == null) {
      SModelReference targetModelReference=ref.getTargetSModelReference();
      if (targetModelReference != null) {
        necessaryImports.add(((jetbrains.mps.smodel.SModelReference)targetModelReference).update());
      }
    }
  }
}
