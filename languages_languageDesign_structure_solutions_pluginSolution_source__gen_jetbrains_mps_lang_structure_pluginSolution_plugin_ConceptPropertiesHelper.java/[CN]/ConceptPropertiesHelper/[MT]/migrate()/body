{
  final Set<SNode> conceptPropertyUsages=SetSequence.fromSet(new HashSet<SNode>());
  final Set<SNode> conceptPropertyDeclarationUsages=SetSequence.fromSet(new HashSet<SNode>());
  final Set<SNode> accessUsages=SetSequence.fromSet(new HashSet<SNode>());
  final Set<SNode> cellUsages=SetSequence.fromSet(new HashSet<SNode>());
  final Set<SNode> conceptLinkUsages=SetSequence.fromSet(new HashSet<SNode>());
  final Set<SNode> conceptLinkDeclarationUsages=SetSequence.fromSet(new HashSet<SNode>());
  final Set<SNode> linkAccessUsages=SetSequence.fromSet(new HashSet<SNode>());
  final Set<SearchResult<SNode>> allUsages=SetSequence.fromSet(new HashSet<SearchResult<SNode>>());
  Set<SNode> usages=filterAttributeConceptPropertiesAndLinksUsaages(((Collection)FindUsagesFacade.getInstance().findInstances(scope,nodesToFind(),false,new EmptyProgressMonitor())));
  boolean usageIsFound;
  for (  SNode usage : SetSequence.fromSet(usages)) {
    usageIsFound=true;
    if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.lang.structure.structure.ConceptProperty") && needToMigrate(usage)) {
      SetSequence.fromSet(conceptPropertyUsages).addElement(SNodeOperations.cast(usage,"jetbrains.mps.lang.structure.structure.ConceptProperty"));
    }
 else     if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.lang.smodel.structure.SConceptPropertyAccess") && needToMigrate(usage)) {
      SetSequence.fromSet(accessUsages).addElement(SNodeOperations.cast(usage,"jetbrains.mps.lang.smodel.structure.SConceptPropertyAccess"));
    }
 else     if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.lang.editor.structure.CellModel_ConceptProperty")) {
      SetSequence.fromSet(cellUsages).addElement(SNodeOperations.cast(usage,"jetbrains.mps.lang.editor.structure.CellModel_ConceptProperty"));
    }
 else     if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.lang.structure.structure.ReferenceConceptLink") && needToMigrate(usage)) {
      SetSequence.fromSet(conceptLinkUsages).addElement(SNodeOperations.cast(usage,"jetbrains.mps.lang.structure.structure.ReferenceConceptLink"));
    }
 else     if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.lang.smodel.structure.SConceptLinkAccess") && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SNodeOperations.cast(usage,"jetbrains.mps.lang.smodel.structure.SConceptLinkAccess"),"conceptLinkDeclaration",false),"jetbrains.mps.lang.structure.structure.ReferenceConceptLinkDeclaration")) {
      SetSequence.fromSet(linkAccessUsages).addElement(SNodeOperations.cast(usage,"jetbrains.mps.lang.smodel.structure.SConceptLinkAccess"));
    }
 else     if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration") && needToMigrate(usage) && (AttributeOperations.getAttribute(SNodeOperations.cast(usage,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration"),new IAttributeDescriptor.NodeAttribute("jetbrains.mps.lang.structure.structure.MigratedToMethodAnnotation")) == null)&& neq_azpnkk_a0a4b0l0m(SNodeOperations.getAncestor(usage,"jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration",false,false),SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.core.structure.BaseConcept"))) {
      SetSequence.fromSet(conceptPropertyDeclarationUsages).addElement(SNodeOperations.cast(usage,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration"));
    }
 else     if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.lang.structure.structure.ReferenceConceptLinkDeclaration") && needToMigrate(usage) && (AttributeOperations.getAttribute(SNodeOperations.cast(usage,"jetbrains.mps.lang.structure.structure.ReferenceConceptLinkDeclaration"),new IAttributeDescriptor.NodeAttribute("jetbrains.mps.lang.structure.structure.MigratedToMethodAnnotation")) == null)) {
      SetSequence.fromSet(conceptLinkDeclarationUsages).addElement(SNodeOperations.cast(usage,"jetbrains.mps.lang.structure.structure.ReferenceConceptLinkDeclaration"));
    }
 else {
      usageIsFound=false;
    }
    if (usageIsFound) {
      SetSequence.fromSet(allUsages).addElement(new SearchResult<SNode>(usage,""));
    }
  }
  Set<SNode> searchedNodes=SetSequence.fromSet(new HashSet<SNode>());
  SetSequence.fromSet(searchedNodes).addSequence(SetSequence.fromSet(conceptPropertyDeclarationUsages));
  SetSequence.fromSet(searchedNodes).addSequence(SetSequence.fromSet(conceptLinkDeclarationUsages));
  final SearchResults searchResults=new SearchResults<SNode>(searchedNodes,SetSequence.fromSet(allUsages).toListSequence());
  showRefactoringView(new _FunctionTypes._void_P0_E0(){
    public void invoke(){
      doMigrate(conceptPropertyDeclarationUsages,conceptLinkDeclarationUsages,cellUsages,accessUsages,conceptPropertyUsages,linkAccessUsages,conceptLinkUsages);
      for (      SNode conceptProperty : SetSequence.fromSet(conceptPropertyUsages)) {
        SNodeOperations.deleteNode(conceptProperty);
      }
      for (      SNode conceptLink : SetSequence.fromSet(conceptLinkUsages)) {
        SNodeOperations.deleteNode(conceptLink);
      }
    }
  }
,searchResults);
}
