{
  Map<SNode,SNode> cplToMethodMap=MapSequence.fromMap(new HashMap<SNode,SNode>());
  Map<SNode,List<SNode>> completedConceptsbyDeclaration=MapSequence.fromMap(new HashMap<SNode,List<SNode>>());
  for (  SNode conceptPropertyLinkDecl : SetSequence.fromSet(conceptPropertyLinkDeclarations)) {
    SNode migratedToMethodAnnotation=SConceptOperations.createNewNode("jetbrains.mps.lang.structure.structure.MigratedToMethodAnnotation",null);
    SNode deprecatedNodeAnnotation=SConceptOperations.createNewNode("jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation",null);
    if (SNodeOperations.isInstanceOf(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration")) {
      SNode method=replaceConceptPropertyDeclarations(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration"),conceptPropertyUsages);
      MapSequence.fromMap(cplToMethodMap).put(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration"),method);
      SLinkOperations.setTarget(migratedToMethodAnnotation,"method",method,false);
      AttributeOperations.setAttribute(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration"),new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.structure.structure.MigratedToMethodAnnotation")),migratedToMethodAnnotation);
      AttributeOperations.setAttribute(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptPropertyDeclaration"),new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation")),deprecatedNodeAnnotation);
    }
 else     if (SNodeOperations.isInstanceOf(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptLinkDeclaration")) {
      SNode method=replaceConceptLinkDeclaration(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptLinkDeclaration"),conceptLinkUsages);
      MapSequence.fromMap(cplToMethodMap).put(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptLinkDeclaration"),method);
      MapSequence.fromMap(completedConceptsbyDeclaration).put(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptLinkDeclaration"),new ArrayList<SNode>());
      SLinkOperations.setTarget(migratedToMethodAnnotation,"method",method,false);
      AttributeOperations.setAttribute(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptLinkDeclaration"),new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.structure.structure.MigratedToMethodAnnotation")),migratedToMethodAnnotation);
      AttributeOperations.setAttribute(SNodeOperations.cast(conceptPropertyLinkDecl,"jetbrains.mps.lang.structure.structure.ConceptLinkDeclaration"),new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.structure.structure.DeprecatedNodeAnnotation")),deprecatedNodeAnnotation);
    }
  }
  for (  SNode conceptProperty : SetSequence.fromSet(conceptPropertyUsages)) {
    replaceConceptPropertyUsages(conceptProperty,getMethodFromMapOrFromAnnotation(cplToMethodMap,SLinkOperations.getTarget(conceptProperty,"conceptPropertyDeclaration",false)));
  }
  for (  SNode access : SetSequence.fromSet(accessUsages)) {
    replaceAccessUsages(access,getMethodFromMapOrFromAnnotation(cplToMethodMap,SLinkOperations.getTarget(access,"conceptProperty",false)));
  }
  for (  SNode cell : SetSequence.fromSet(cellUsages)) {
    replaceCellUsages(cell,getMethodFromMapOrFromAnnotation(cplToMethodMap,SLinkOperations.getTarget(cell,"relationDeclaration",false)));
  }
  for (  SNode conceptLink : SetSequence.fromSet(conceptLinkUsages)) {
    replaceConceptLinkUsages(conceptLink,getMethodFromMapOrFromAnnotation(cplToMethodMap,SLinkOperations.getTarget(conceptLink,"conceptLinkDeclaration",false)),completedConceptsbyDeclaration);
  }
  for (  SNode access : SetSequence.fromSet(accessLinkUsages)) {
    replaceAccessLinkUsages(access,getMethodFromMapOrFromAnnotation(cplToMethodMap,SLinkOperations.getTarget(access,"conceptLinkDeclaration",false)));
  }
}
