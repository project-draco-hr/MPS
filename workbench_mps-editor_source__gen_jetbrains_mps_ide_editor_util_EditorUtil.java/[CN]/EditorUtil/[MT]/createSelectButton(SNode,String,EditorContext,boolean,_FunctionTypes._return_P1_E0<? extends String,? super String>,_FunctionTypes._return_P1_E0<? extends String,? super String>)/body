{
  String filename=expandPath.invoke(sourceNode.getProperty(propertyName));
  final File baseFile=(filename == null ? null : new File(filename));
  final JButton button=new JButton();
  button.setAction(new AbstractAction("..."){
    public void actionPerformed(    ActionEvent e){
      Component root=SwingUtilities.getRoot(button);
      JFrame frame=(root instanceof JFrame ? (JFrame)root : null);
      TreeFileChooser chooser=new TreeFileChooser();
      chooser.setMode((files ? TreeFileChooser.MODE_FILES : TreeFileChooser.MODE_DIRECTORIES));
      chooser.setContext(context.getOperationContext());
      if (baseFile != null && baseFile.exists()) {
        chooser.setInitialFile(FileSystem.getInstance().getFileByPath(baseFile.getAbsolutePath()));
      }
      IFile result=chooser.showDialog(frame);
      if (result == null) {
        return;
      }
      final String pathToShow=shrinkPath.invoke(result.getPath());
      ModelAccess.instance().runWriteActionInCommand(new Runnable(){
        public void run(){
          sourceNode.setProperty(propertyName,pathToShow);
        }
      }
);
    }
  }
);
  return button;
}
