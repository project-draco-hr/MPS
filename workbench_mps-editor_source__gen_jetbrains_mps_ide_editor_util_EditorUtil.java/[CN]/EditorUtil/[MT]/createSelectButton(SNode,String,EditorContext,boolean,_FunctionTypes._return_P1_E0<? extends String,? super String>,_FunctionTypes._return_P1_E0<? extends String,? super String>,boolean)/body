{
  String filename=expandPath.invoke(SNodeAccessUtil.getProperty(sourceNode,propertyName));
  final File baseFile=(filename == null ? null : new File(filename));
  final JButton button=new JButton();
  button.setAction(new AbstractAction("..."){
    public void actionPerformed(    ActionEvent e){
      Component root=SwingUtilities.getRoot(button);
      JFrame frame=(root instanceof JFrame ? (JFrame)root : null);
      TreeFileChooser chooser=new TreeFileChooser();
      chooser.setMode((files ? TreeFileChooser.MODE_FILES : TreeFileChooser.MODE_DIRECTORIES));
      chooser.setContext(context.getOperationContext());
      if (baseFile != null && baseFile.exists()) {
        chooser.setInitialFile(FileSystem.getInstance().getFileByPath(baseFile.getAbsolutePath()));
      }
      final Wrappers._T<IFile> result=new Wrappers._T<IFile>(chooser.showDialog(frame));
      if (result.value == null) {
        return;
      }
      if (copy) {
        ModelAccess.instance().requireWrite(new Runnable(){
          public void run(){
            SModelDescriptor model=sourceNode.getModel().getModelDescriptor();
            String outputRoot=model.getModule().getBundleHome().getPath() + File.separator + "icons";
            IFile outputRootFile=FileSystem.getInstance().getFileByPath(outputRoot);
            String source=MacrosFactory.forModuleFile(model.getModule().getDescriptorFile()).expandPath(result.value.getPath());
            IFile sourceFile=FileSystem.getInstance().getFileByPath(source);
            IFileUtils.copyFileContent(sourceFile,outputRootFile.getDescendant(sourceFile.getName()));
            result.value=outputRootFile.getDescendant(sourceFile.getName());
          }
        }
);
      }
      final String pathToShow=shrinkPath.invoke(result.value.getPath());
      ModelAccess.instance().runWriteActionInCommand(new Runnable(){
        public void run(){
          SNodeAccessUtil.setProperty(sourceNode,propertyName,pathToShow);
        }
      }
);
    }
  }
);
  return button;
}
