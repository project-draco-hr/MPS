{
  Map<String,String> oldProperties=(Map<String,String>)oldNode.getProperties();
  Map<String,String> newProperties=(Map<String,String>)newNode.getProperties();
  for (  String name : SetSequence.<String>fromSet(MapSequence.fromMap(oldProperties).keySet()).union(SetSequence.<String>fromSet(MapSequence.fromMap(newProperties).keySet()))) {
    PropertySupport propertySupport=new ChangeSetBuilder.DefaultPropertySupport();
    if (ApplicationManager.getApplication() != null) {
      SNode propertyDeclaration=oldNode.getPropertyDeclaration(name);
      if (propertyDeclaration != null) {
        propertySupport=PropertySupport.getPropertySupport(propertyDeclaration);
      }
    }
    String oldPresentableValue=propertySupport.fromInternalValue(MapSequence.<String,String>fromMap(oldProperties).get(name));
    String newPresentableValue=propertySupport.fromInternalValue(MapSequence.<String,String>fromMap(newProperties).get(name));
    if (!(ObjectUtils.equals(oldPresentableValue,newPresentableValue))) {
      myChangeSet.add(new SetPropertyChange(myChangeSet,oldNode.getSNodeId(),name,MapSequence.<String,String>fromMap(newProperties).get(name)));
    }
  }
}
