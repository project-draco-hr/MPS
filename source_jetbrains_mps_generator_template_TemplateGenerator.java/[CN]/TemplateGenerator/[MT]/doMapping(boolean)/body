{
  checkMonitorCanceled();
  int oldErrorCount=getErrorCount();
  RuleManager ruleManager=new RuleManager(this);
  myRuleUtil=new RuleUtil(ruleManager);
  ruleManager.setRuleUtil(myRuleUtil);
  ruleManager.getReductionRuleManager().setRuleUtil(myRuleUtil);
  if (isPrimary) {
    ruleManager.applyCreateRootRules();
  }
  ruleManager.applyMappingRules();
  for (  Root_MappingRule rootMappingRule : ruleManager.getRoot_MappingRules()) {
    checkMonitorCanceled();
    myRuleUtil.applyRoot_MappingRule(rootMappingRule);
  }
  checkMonitorCanceled();
  getGeneratorSessionContext().clearCopiedRootsSet();
  List<SNode> copiedOutputRoots=copyRootsFromInputModel(ruleManager);
  for (  SNode copiedOutputRoot : copiedOutputRoots) {
    getGeneratorSessionContext().registerCopiedRoot(copiedOutputRoot);
    myOutputModel.addRoot(copiedOutputRoot);
  }
  for (  SNode outputRootNode : copiedOutputRoots) {
    checkMonitorCanceled();
    ruleManager.getReductionRuleManager().applyReductionRules(findInputNodeById(outputRootNode.getSNodeId()));
  }
  for (  WeavingRule weavingRule : ruleManager.getWeavingRules()) {
    checkMonitorCanceled();
    myRuleUtil.applyWeavingRule(weavingRule);
  }
  for (  Weaving_MappingRule weavingMappingRule : ruleManager.getWeaving_MappingRules()) {
    checkMonitorCanceled();
    myRuleUtil.applyWeavingMappingRule(weavingMappingRule);
  }
  checkMonitorCanceled();
  myDelayedChanges.doAllChanges();
  for (  SNode copiedRoot : copiedOutputRoots) {
    checkMonitorCanceled();
    invalidateReferencesInCopiedNode(copiedRoot);
  }
  revalidateAllReferences();
  checkMonitorCanceled();
  reportWasErrors(getErrorCount() - oldErrorCount);
}
