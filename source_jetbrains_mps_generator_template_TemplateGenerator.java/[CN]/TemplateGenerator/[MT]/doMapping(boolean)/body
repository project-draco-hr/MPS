{
  checkMonitorCanceled();
  int oldErrorCount=getErrorCount();
  RuleManager ruleManager=new RuleManager(this);
  myRuleUtil=new RuleUtil(ruleManager);
  if (isPrimary) {
    ruleManager.applyCreateRootRules();
  }
  ruleManager.applyMappingRules();
  ruleManager.applyRoot_MappingRules();
  checkMonitorCanceled();
  getGeneratorSessionContext().clearCopiedRootsSet();
  List<SNode> copiedOutputRoots=copyRootsFromInputModel(ruleManager);
  for (  SNode copiedOutputRoot : copiedOutputRoots) {
    getGeneratorSessionContext().registerCopiedRoot(copiedOutputRoot);
    myOutputModel.addRoot(copiedOutputRoot);
  }
  for (  SNode outputRootNode : copiedOutputRoots) {
    checkMonitorCanceled();
    ruleManager.applyReductionRules(findInputNodeById(outputRootNode.getSNodeId()));
  }
  ruleManager.applyWeavingRules();
  ruleManager.applyWeaving_MappingRules();
  myDelayedChanges.doAllChanges();
  for (  SNode copiedRoot : copiedOutputRoots) {
    checkMonitorCanceled();
    invalidateReferencesInCopiedNode(copiedRoot);
  }
  revalidateAllReferences();
  checkMonitorCanceled();
  reportWasErrors(getErrorCount() - oldErrorCount);
}
