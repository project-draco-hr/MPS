{
  try {
    List<ITestNodeWrapper> allTests=ListSequence.fromList(success).union(ListSequence.fromList(failure)).toListSequence();
    ProcessHandler process=new JUnit_Command().createProcess(allTests);
    TestRunState runState=new TestRunState(allTests);
    CheckTestStateListener checkListener=new CheckTestStateListener(success,failure);
    runState.addListener(checkListener);
    TestEventsDispatcher eventsDispatcher=new TestEventsDispatcher(runState);
    OutputRedirector.redirect(process,new UnitTestProcessListener(eventsDispatcher));
    int exitcode=ProcessHandlerBuilder.startAndWait(process,30 * 1000);
    if (exitcode != ListSequence.fromList(failure).count()) {
      Assert.fail("Exit code must be equal to " + ListSequence.fromList(failure).count() + ", but "+ exitcode);
    }
 else     if (exitcode < 0) {
      Assert.fail("Process is running for too long");
    }
    if (isNotEmptyString(checkListener.getMessages())) {
      Assert.fail(checkListener.getMessages());
    }
  }
 catch (  ExecutionException e) {
    Assert.fail();
  }
}
