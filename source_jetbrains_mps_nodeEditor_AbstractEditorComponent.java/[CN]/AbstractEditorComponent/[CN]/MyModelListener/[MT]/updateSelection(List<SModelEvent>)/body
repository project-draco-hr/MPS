{
  SModelEvent lastAdd=null;
  SModelEvent lastRemove=null;
  List<SNode> childAddedEventNodes=new ArrayList<SNode>();
  for (  SModelEvent e : events) {
    if (e instanceof SModelChildEvent) {
      SModelChildEvent ce=(SModelChildEvent)e;
      if (ce.isAdded()) {
        lastAdd=ce;
        childAddedEventNodes.add(ce.getChild());
      }
      if (ce.isRemoved())       lastRemove=ce;
    }
    if (e instanceof SModelReferenceEvent) {
      SModelReferenceEvent re=(SModelReferenceEvent)e;
      if (re.isAdded())       lastAdd=re;
      if (re.isRemoved())       lastRemove=re;
    }
  }
  if (lastAdd != null) {
    if (lastAdd instanceof SModelChildEvent) {
      List<NodesParetoFrontier.NodeBox> frontier=NodesParetoFrontier.findParetoFrontier(childAddedEventNodes);
      SNode addedChild=frontier.get(frontier.size() - 1).getNode();
      EditorCell cell=findNodeCell(addedChild);
      changeSelectionWRTFocusPolicy(cell);
      return;
    }
 else     if (lastAdd instanceof SModelReferenceEvent) {
      SModelReferenceEvent re=(SModelReferenceEvent)lastAdd;
      selectRefCell(re.getReference());
      return;
    }
 else {
    }
  }
  if (lastRemove != null) {
    if (lastRemove instanceof SModelChildEvent) {
      SModelChildEvent ce=(SModelChildEvent)lastRemove;
      int index=ce.getChildIndex();
      String role=ce.getChildRole();
      SNode parent=ce.getParent();
      if (parent.getChildCount() > index) {
        SNode child=parent.getChildAt(index);
        if (role.equals(child.getRole_())) {
          changeSelectionWRTFocusPolicy(findNodeCell(child));
          return;
        }
      }
      if (index != 0) {
        SNode child=parent.getChildAt(index - 1);
        if (role.equals(child.getRole_())) {
          changeSelectionWRTFocusPolicy(findNodeCell(child));
          return;
        }
      }
      EditorCell nullCell=findNodeCellWithRole(parent,role);
      if (nullCell == null) {
        changeSelectionWRTFocusPolicy(findNodeCell(parent));
      }
 else {
        changeSelectionWRTFocusPolicy(nullCell);
      }
      return;
    }
    if (lastRemove instanceof SModelReferenceEvent) {
      SModelReferenceEvent re=(SModelReferenceEvent)lastRemove;
      SReference ref=re.getReference();
      SNode sourceNode=ref.getSourceNode();
      String role=ref.getRole();
      EditorCell nullCell=findNodeCellWithRole(sourceNode,role);
      if (nullCell == null) {
        changeSelectionWRTFocusPolicy(findNodeCell(sourceNode));
      }
 else {
        changeSelectionWRTFocusPolicy(nullCell);
      }
    }
  }
}
