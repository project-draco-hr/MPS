{
  if (newSelectedCell != null) {
    System.out.println("change selection to " + newSelectedCell.getSNode());
  }
 else {
    System.out.println("change selection to null");
  }
  new Throwable().printStackTrace(System.out);
  clearSelectionStack();
  Stack<EditorCell_Collection> foldedParents=new Stack<EditorCell_Collection>();
  if (newSelectedCell != null) {
    for (    EditorCell_Collection collection : CollectionUtil.iteratorAsIterable(newSelectedCell.parents())) {
      if (collection.isFolded()) {
        foldedParents.push(collection);
      }
    }
    boolean toRelayout=!foldedParents.isEmpty();
    while (!foldedParents.isEmpty()) {
      EditorCell_Collection collection=foldedParents.pop();
      collection.unfold(true);
    }
    if (toRelayout)     relayout();
  }
  setSelectionDontClearStack(newSelectedCell,resetLastCaretX,scroll);
}
