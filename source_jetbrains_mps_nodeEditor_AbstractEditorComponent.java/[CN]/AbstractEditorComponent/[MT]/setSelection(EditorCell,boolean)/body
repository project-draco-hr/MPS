{
  if (resetLastCaretX) {
    resetLastCaretX();
  }
  if (newSelectedCell == mySelectedCell) {
    return;
  }
  myNodeSubstituteChooser.setVisible(false);
  myNodeRangeSelection.deactivate();
  EditorCell oldSelection=mySelectedCell;
  if (mySelectedCell != null) {
    mySelectedCell.setSelected(false);
  }
  mySelectedCell=newSelectedCell;
  if (mySelectedCell != null) {
    mySelectedCell.setSelected(true);
  }
  if (mySelectedCell != null) {
    Rectangle selectionRect=new Rectangle(newSelectedCell.getX(),newSelectedCell.getY(),newSelectedCell.getWidth() + 30,newSelectedCell.getHeight());
    Rectangle fakeRect=new Rectangle(0,newSelectedCell.getY(),newSelectedCell.getWidth(),newSelectedCell.getHeight());
    scrollRectToVisible(fakeRect);
    scrollRectToVisible(selectionRect);
  }
  repaint();
  fireCellSelectionChanged(oldSelection,newSelectedCell);
}
