{
  if (myNodeSubstituteChooser.isVisible()) {
    return true;
  }
  if (editorCell != null && editorCell.getSubstituteInfo() != null) {
    NodeSubstitutePatternEditor patternEditor=editorCell.createSubstitutePatternEditor();
    if (resetPattern) {
      patternEditor.setCaretPosition(0);
    }
    String pattern=patternEditor.getPattern();
    INodeSubstituteInfo substituteInfo=editorCell.getSubstituteInfo();
    boolean trySubstituteNow=!(substituteInfo instanceof INodeSubstituteActionList) || !patternEditor.getText().equals(substituteInfo.getOriginalText()) || pattern.equals(patternEditor.getText());
    if (trySubstituteNow && substituteInfo.canSubstitute(pattern)) {
      SemanticNode semanticNode=substituteInfo.doSubstitute(pattern);
      if (semanticNode != null) {
        semanticNode.getSemanticModel().fireNodeAddedEvent(semanticNode);
      }
      return true;
    }
 else {
      myNodeSubstituteChooser.setNodeSubstituteInfo(editorCell.getSubstituteInfo());
      myNodeSubstituteChooser.setPatternEditor(patternEditor);
      myNodeSubstituteChooser.setLocationRelative(editorCell);
      myNodeSubstituteChooser.setVisible(true);
      return true;
    }
  }
  return false;
}
