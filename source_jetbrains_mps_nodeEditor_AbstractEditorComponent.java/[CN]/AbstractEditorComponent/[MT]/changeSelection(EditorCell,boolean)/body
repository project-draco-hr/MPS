{
  if (resetLastCaretX) {
    resetLastCaretX();
  }
  if (newSelectedCell == mySelectedCell) {
    return;
  }
  myNodeSubstituteChooser.setVisible(false);
  myNodeRangeSelection.deactivate();
  myCellRangeSelection.deactivate();
  EditorCell oldSelection=mySelectedCell;
  if (mySelectedCell != null) {
    mySelectedCell.setSelected(false);
  }
  mySelectedCell=newSelectedCell;
  if (mySelectedCell != null) {
    mySelectedCell.setSelected(true);
  }
  if (mySelectedCell != null) {
    JScrollBar hScrollBar=myScrollPane.getHorizontalScrollBar();
    JScrollBar vScrollBar=myScrollPane.getVerticalScrollBar();
    Rectangle viewRect=myScrollPane.getViewport().getViewRect();
    int x=mySelectedCell.getX() - 20;
    int y=mySelectedCell.getY() - 20;
    int w=mySelectedCell.getWidth() + 40;
    int h=mySelectedCell.getHeight() + 40;
    if (x < viewRect.x) {
      hScrollBar.setValue(x);
    }
 else     if (x + w > viewRect.x + viewRect.width) {
      hScrollBar.setValue(x + w - viewRect.width);
    }
    if (y < viewRect.y) {
      vScrollBar.setValue(y);
    }
 else     if (y + h > viewRect.y + viewRect.height) {
      vScrollBar.setValue(y + h - viewRect.height);
    }
  }
  repaint();
  fireCellSelectionChanged(oldSelection,newSelectedCell);
}
