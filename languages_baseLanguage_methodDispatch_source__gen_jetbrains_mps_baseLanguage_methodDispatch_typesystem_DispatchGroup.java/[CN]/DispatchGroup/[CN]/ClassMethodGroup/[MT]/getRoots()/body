{
  Set<SNode> roots=SetSequence.fromSet(new HashSet<SNode>());
  Iterable<Iterator<SNode>> paths=MapSequence.fromMap(methods).select(new ISelector<IMapping<SNode,SNode>,Iterator<SNode>>(){
    public Iterator<SNode> select(    IMapping<SNode,SNode> it){
      return Sequence.fromIterable(DispatchUtil.ancestors(it.key(),false)).iterator();
    }
  }
);
  while (Sequence.fromIterable(paths).count() > 0) {
    List<Iterator<SNode>> unendedPaths=ListSequence.fromList(new ArrayList<Iterator<SNode>>());
    for (    Iterator<SNode> p : Sequence.fromIterable(paths)) {
      SNode c=p.next();
      if (MapSequence.fromMap(methods).containsKey(c)) {
        SetSequence.fromSet(roots).addElement(c);
      }
 else {
        ListSequence.fromList(unendedPaths).addElement(p);
      }
    }
    paths=unendedPaths;
  }
  return roots;
}
