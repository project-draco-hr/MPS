{
  List<Edge> fullHistory=ListSequence.fromList(new LinkedList<Edge>());
  List<Edge> history=MapSequence.fromMap(myHistory).get(edge);
  if (history == null) {
    ListSequence.fromList(fullHistory).addElement(edge);
  }
 else {
    Node cur=edge.getSource();
    for (    Edge newEdge : history) {
      if (!(checkConnection(cur,newEdge))) {
        throw new RuntimeException("history is broken: edge " + edge + " history: "+ history);
      }
      List<Edge> newHistory=getHistory(newEdge);
      if (!(checkConnection(cur,ListSequence.fromList(newHistory).first()))) {
        newHistory=ListSequence.fromList(newHistory).reversedList();
      }
      ListSequence.fromList(fullHistory).addSequence(ListSequence.fromList(newHistory));
      cur=newEdge.getOpposite(cur);
    }
  }
  return fullHistory;
}
