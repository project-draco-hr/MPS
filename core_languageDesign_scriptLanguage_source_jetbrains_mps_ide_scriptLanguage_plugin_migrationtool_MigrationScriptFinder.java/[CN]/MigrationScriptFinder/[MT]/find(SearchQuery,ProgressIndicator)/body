{
  SearchResults<SNode> results=new SearchResults<SNode>();
  IScope queryScope=query.getScope();
  List<AbstractMigrationRefactoring> migrationRefactorings=new ArrayList<AbstractMigrationRefactoring>();
  List<BaseMigrationScript> scriptInstances=MigrationScriptUtil.getScriptInstances(myScripts,myContext);
  for (  BaseMigrationScript scriptInstance : scriptInstances) {
    List<IRefactoring> refactorings=scriptInstance.getRefactorings();
    for (    IRefactoring refactoring : refactorings) {
      migrationRefactorings.add((AbstractMigrationRefactoring)refactoring);
    }
  }
  indicator.setText("Searching applicable nodes");
  for (  AbstractMigrationRefactoring migrationRefactoring : migrationRefactorings) {
    if (indicator.isCanceled()) {
      break;
    }
    indicator.setText2(migrationRefactoring.getName());
    Set<SNode> instances=FindUsagesManager.getInstance().findInstances(MigrationScriptUtil.getApplicableConcept(migrationRefactoring),queryScope,null,false);
    for (    SNode instance : instances) {
      if (MigrationScriptUtil.isApplicableRefactoring(instance,migrationRefactoring)) {
        String category=migrationRefactoring.getAdditionalInfo();
        SearchResult<SNode> result=new SearchResult<SNode>(instance,category);
        myMigrationBySearchResult.put(result,migrationRefactoring);
        results.getSearchResults().add(result);
      }
    }
  }
  indicator.setText("Searching applicable nodes " + (indicator.isCanceled() ? "canceled" : "finished"));
  indicator.setText2("");
  return results;
}
