{
  int references=is.readInt();
  for (; references > 0; references--) {
    int kind=is.readInt();
    SNodeId targetNodeId=kind == 1 ? is.readNodeId() : null;
    DynamicReferenceOrigin origin=kind == 3 ? new DynamicReferenceOrigin(is.readNodePointer(),is.readNodePointer()) : null;
    String role=is.readString();
    SModelReference modelRef=is.readModelReference();
    if (modelRef != null && LOCAL.equals(modelRef)) {
      modelRef=myModelReference;
    }
    String resolveInfo=is.readString();
    if (kind == 1) {
      SReference reference=new StaticReference(role,node,modelRef,targetNodeId,resolveInfo);
      node.setReference(reference.getRole(),reference);
    }
 else     if (kind == 2 || kind == 3) {
      DynamicReference reference=new DynamicReference(role,node,modelRef,resolveInfo);
      if (origin != null) {
        reference.setOrigin(origin);
      }
      node.setReference(reference.getRole(),reference);
    }
 else {
      throw new IOException("unknown reference type");
    }
  }
}
