{
  FolderModelFactory factory=PersistenceRegistry.getInstance().getFolderModelFactory("file-per-root");
  if (factory == null || factory.isBinary()) {
    return null;
  }
  try {
    InMemoryMultiStreamDataSource source=new InMemoryMultiStreamDataSource();
    factory.save(model,source);
    if (isHeader) {
      return source.getContent(MPSExtentions.DOT_MODEL_HEADER,FileUtil.DEFAULT_CHARSET_NAME);
    }
 else {
      for (      String name : source.getAvailableStreams()) {
        if (name.equals(MPSExtentions.DOT_MODEL_HEADER))         continue;
        return source.getContent(name,FileUtil.DEFAULT_CHARSET_NAME);
      }
    }
  }
 catch (  UnsupportedDataSourceException ex) {
    ex.printStackTrace();
  }
catch (  ModelSaveException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
  }
  return null;
}
