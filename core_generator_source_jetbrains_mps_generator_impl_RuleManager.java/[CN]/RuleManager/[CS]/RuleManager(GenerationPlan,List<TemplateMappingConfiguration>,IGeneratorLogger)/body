{
  myTemplateSwitchGraph=plan.getTemplateSwitchGraph();
  if (myTemplateSwitchGraph == null)   throw new IllegalStateException("switch graph is not initialized");
  initialize(configurations,logger);
  myRuleFinder=initRules(configurations);
  myModelMap=new HashMap<SModelReference,TemplateModel>();
  for (  TemplateModel m : plan.getTemplateModels()) {
    myModelMap.put(m.getSModelReference(),m);
  }
}
