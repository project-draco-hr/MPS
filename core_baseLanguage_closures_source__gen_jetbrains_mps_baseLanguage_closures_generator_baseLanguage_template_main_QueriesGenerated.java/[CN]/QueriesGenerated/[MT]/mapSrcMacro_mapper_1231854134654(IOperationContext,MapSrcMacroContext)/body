{
  for (  SNode desc : SNodeOperations.getDescendants(_context.getNode(),null,false)) {
    if (SNodeOperations.isInstanceOf(desc,"jetbrains.mps.baseLanguage.closures.structure.InvokeFunctionOperation") && SNodeOperations.isInstanceOf(TypeChecker.getInstance().getTypeOf(SNodeOperations.getParent(desc)),"jetbrains.mps.baseLanguage.closures.structure.UnrestrictedFunctionType")) {
      desc.putUserObject("__invokeFunctionOperation__",Boolean.TRUE);
      break;
    }
  }
  SNode copy=CopyUtil.copyAndPreserveId(_context.getNode());
  for (  SNode desc : SNodeOperations.getDescendants(copy,null,false)) {
    if (desc.getUserObject("__invokeFunctionOperation__") != null) {
      SNode de=SNodeOperations.getParent(desc);
      SNode lvr=SConceptOperations.createNewNode("jetbrains.mps.baseLanguage.structure.LocalVariableReference",null);
      List<SNode> stmts=SLinkOperations.getTargets(_context.getParentOutputNode(),"statement",true);
      SLinkOperations.setTarget(lvr,"variableDeclaration",SLinkOperations.getTarget(stmts.get(0),"localVariableDeclaration",true),false);
      SNodeOperations.replaceWithAnother(de,lvr);
      break;
    }
  }
  return copy;
}
