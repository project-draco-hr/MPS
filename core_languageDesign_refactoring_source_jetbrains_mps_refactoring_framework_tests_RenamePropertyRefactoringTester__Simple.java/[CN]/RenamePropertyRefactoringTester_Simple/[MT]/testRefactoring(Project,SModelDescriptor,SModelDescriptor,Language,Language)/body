{
  RenameProperty renameProperty=new RenameProperty();
  final RefactoringContext refactoringContext=new RefactoringContext(OldRefactoringAdapter.createAdapterFor(renameProperty));
  refactoringContext.setCurrentOperationContext(ProjectOperationContext.get(project));
  final String newPropertyName="niceProperty";
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      SModelDescriptor structureModelDescriptor=testRefactoringLanguage.getStructureModelDescriptor();
      SModel model=structureModelDescriptor.getSModel();
      SNode node=SModelOperations.getRootByName(model,"YetAnotherGoodConcept");
      ConceptDeclaration concept=(ConceptDeclaration)BaseAdapter.fromNode(node);
      SNode property=concept.getPropertyDeclarations().get(0).getNode();
      refactoringContext.setSelectedProject(project);
      refactoringContext.setSelectedNode(property);
      refactoringContext.setSelectedModel(structureModelDescriptor);
      refactoringContext.setParameter(RenameProperty.newName,newPropertyName);
    }
  }
);
  new RefactoringTestFacade().doExecuteInTest(refactoringContext);
  final boolean[] result=new boolean[]{false};
  ThreadUtils.runInUIThreadAndWait(new Runnable(){
    public void run(){
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          try {
            if (sandbox1.getLoadingState() != ModelLoadingState.NOT_LOADED) {
              System.err.println("test environment is invalid: model sandbox1 is already initialized, should be not");
              result[0]=false;
              return;
            }
            SModel sModel=sandbox1.getSModel();
            SNode root=sModel.rootsIterator().next();
            SNode firstChild=root.getChildren("anotherGoodConcept").get(0);
            String propertyValue=firstChild.getProperty(newPropertyName);
            result[0]="cat".equals(propertyValue);
          }
 catch (          Throwable t) {
            t.printStackTrace();
            result[0]=false;
            return;
          }
        }
      }
);
    }
  }
);
  return result[0];
}
