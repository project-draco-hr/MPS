{
  if (node == null) {
    return null;
  }
  SNode type=getRepresentative(node);
  if (TypesUtil.isVariable(type)) {
    if (variablesMet.contains(type)) {
      reportRecursiveType(type);
    }
    variablesMet.add(type);
  }
  if (type != node) {
    SNode result=expandNode(type,variablesMet);
    variablesMet.remove(type);
    return result;
  }
 else {
    replaceChildren(node,variablesMet);
    replaceReferences(node,variablesMet);
    return node;
  }
}
