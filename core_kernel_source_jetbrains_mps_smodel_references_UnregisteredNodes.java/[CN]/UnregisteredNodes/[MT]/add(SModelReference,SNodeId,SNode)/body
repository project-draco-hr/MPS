{
  boolean showError=false;
synchronized (myLock) {
    if (myMap.contains(reference,id) && myMap.get(reference,id) != node) {
      showError=true;
    }
    myMap.put(reference,id,node);
  }
  if (showError) {
switch (myWarningLevel) {
case ERROR:
      IllegalStateException ex=new IllegalStateException("attempt to put another node with same key: " + reference + "#"+ id);
    LOG.error(ex,ex);
  break;
case WARNING:
LOG.warn("attempt to put another node with same key: " + reference + "#"+ id+ ". Undo can be broken.");
myWarningLevel=WarningLevel.SILENT;
break;
case SILENT:
break;
}
}
}
