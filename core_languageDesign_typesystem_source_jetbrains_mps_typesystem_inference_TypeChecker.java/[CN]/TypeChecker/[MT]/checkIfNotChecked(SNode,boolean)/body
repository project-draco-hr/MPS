{
  SNode containingRoot=node.getContainingRoot();
  if (containingRoot == null)   return false;
  NodeTypesComponent component=NodeTypesComponentsRepository.getInstance().getNodeTypesComponent(node.getContainingRoot());
  if (!myCheckedRoots.contains(containingRoot) || component == null) {
    component=NodeTypesComponentsRepository.getInstance().createNodeTypesComponent(node.getContainingRoot());
    checkRoot(containingRoot);
    if (useNonTypesystemRules) {
      component.applyNonTypesystemRulesToRoot(null);
    }
  }
  return true;
}
