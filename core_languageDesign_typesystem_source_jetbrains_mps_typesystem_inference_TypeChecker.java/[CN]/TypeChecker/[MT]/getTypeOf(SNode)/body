{
  if (node == null)   return null;
  fireNodeTypeAccessed(node);
  TypeCheckingContext context;
  if (isGenerationMode() || isTransformationTestMode()) {
    SNode componentNode=node;
    if (isTransformationTestMode()) {
      componentNode=node.getContainingRoot();
    }
    if (myPerformanceTracer == null) {
      context=NodeTypesComponentsRepository.getInstance().createIsolatedTypeCheckingContext(componentNode);
    }
 else {
      context=NodeTypesComponentsRepository.getInstance().createTracingTypeCheckingContext(componentNode);
    }
  }
 else {
    context=NodeTypesComponentsRepository.getInstance().createTypeCheckingContext(node);
  }
  if (context == null)   return null;
  return context.getTypeOf(node,this);
}
