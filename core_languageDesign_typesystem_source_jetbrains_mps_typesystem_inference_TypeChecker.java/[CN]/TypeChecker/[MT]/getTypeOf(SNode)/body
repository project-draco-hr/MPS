{
  if (node == null)   return null;
  if (myTypesReadListener != null) {
    myTypesReadListener.nodeTypeAccessed(node);
  }
  TypeCheckingContext context=NodeTypesComponentsRepository.getInstance().createTypeCheckingContext(node);
  if (context != null && context.isInEditorQueries()) {
    return getTypeOf_resolveMode(node);
  }
 else   if (myIsGeneration && TypesystemPreferencesComponent.getInstance().isGenerationOptimizationEnabled()) {
    return getTypeOf_generationMode(node);
  }
 else {
    return getTypeOf_normalMode(node);
  }
}
