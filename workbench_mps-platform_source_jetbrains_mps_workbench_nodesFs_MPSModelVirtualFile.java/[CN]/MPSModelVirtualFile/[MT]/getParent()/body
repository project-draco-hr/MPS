{
  return ModelAccess.instance().runReadAction(new Computable<VirtualFile>(){
    @Override public VirtualFile compute(){
      if (myModelReference == null)       return null;
      SModel model=myModelReference.resolve(MPSModuleRepository.getInstance());
      if (model == null)       return null;
      DataSource ds=model.getSource();
      if (ds instanceof FileDataSource) {
        return VirtualFileUtils.getVirtualFile(((FileDataSource)ds).getFile());
      }
 else       if (ds instanceof FolderDataSource) {
        return VirtualFileUtils.getVirtualFile(((FolderDataSource)ds).getFolder());
      }
 else {
        return null;
      }
    }
  }
);
}
