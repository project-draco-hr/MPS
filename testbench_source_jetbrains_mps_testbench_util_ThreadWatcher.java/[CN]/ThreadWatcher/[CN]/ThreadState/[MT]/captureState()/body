{
  allThreads.clear();
  runningThreads.clear();
  long cid=Thread.currentThread().getId();
  ThreadMXBean bean=ManagementFactory.getThreadMXBean();
  for (  ThreadInfo info : bean.getThreadInfo(bean.getAllThreadIds())) {
    if (info != null && cid != info.getThreadId() && info.getThreadState() != Thread.State.NEW && info.getThreadState() != Thread.State.TERMINATED && !IGNORED_THREAD.matcher(info.getThreadName()).matches()) {
      allThreads.put(info.getThreadId(),info);
      if (Thread.State.RUNNABLE == info.getThreadState()) {
        runningThreads.put(info.getThreadId(),info);
      }
    }
  }
}
