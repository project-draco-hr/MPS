{
  if (base == null)   return true;
  if (errors != null)   throw new IllegalStateException("Settled already");
  ThreadState current=new ThreadState();
  ThreadState[] diff;
  long step=100;
  long leftMillis=millis;
  do {
    current.captureState();
    diff=current.diff(base);
    if (diff[0].allThreads.isEmpty() && diff[1].allThreads.isEmpty())     return true;
    try {
      Thread.sleep(step);
    }
 catch (    InterruptedException ignore) {
    }
    leftMillis-=step;
  }
 while (leftMillis >= 0);
  StringBuilder sb=new StringBuilder();
  sb.append("After ").append(millis).append(" ms. --\n");
  if (!diff[0].allThreads.isEmpty()) {
    sb.append("  New:\n");
    diff[0].dump(sb,"    ");
    sb.append("\n");
  }
  if (!diff[1].allThreads.isEmpty()) {
    sb.append("  Killed:\n");
    diff[1].dump(sb,"    ");
    sb.append("\n");
  }
  this.errors=sb.toString();
  return false;
}
