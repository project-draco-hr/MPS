{
  SNode node=null;
  if (treeNode instanceof MPSTreeNodeEx) {
    node=((MPSTreeNodeEx)treeNode).getSNode();
  }
 else   if (treeNode.getParent() instanceof MPSTreeNodeEx) {
    node=((MPSTreeNodeEx)treeNode.getParent()).getSNode();
  }
  SNodeReference nodePointer=null;
  if (node != null) {
    if (node.getModel() == null) {
      return null;
    }
    nodePointer=new SNodePointer(node);
  }
  if (treeNode instanceof SNodeTreeNode || treeNode instanceof ConceptTreeNode) {
    return new NodeFeature(nodePointer);
  }
 else   if (treeNode instanceof PropertyTreeNode && treeNode.getParent() instanceof MPSTreeNodeEx) {
    return new PropertyFeature(nodePointer,((PropertyTreeNode)treeNode).getProperty());
  }
 else   if (treeNode instanceof ReferenceTreeNode) {
    SReference ref=((ReferenceTreeNode)treeNode).getRef();
    return new PropertyFeature(new SNodePointer(ref.getSourceNode()),ref.getRole());
  }
 else   if (treeNode instanceof PropertiesTreeNode) {
    return new PropertiesFeature(nodePointer);
  }
 else   if (treeNode instanceof ReferencesTreeNode) {
    return new ReferencesFeature(nodePointer);
  }
 else   if (treeNode instanceof PackageNode) {
    PackageNode pn=((PackageNode)treeNode);
    return new VirtualPackageFeature(pn.getModelReference(),pn.getPackage());
  }
 else   if (treeNode instanceof SModelTreeNode) {
    return new ModelFeature(((SModelTreeNode)treeNode).getSModelDescriptor().getSModelReference());
  }
  return null;
}
