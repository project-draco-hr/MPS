{
  Set<SModel> modelsToListen=new HashSet<SModel>();
  if (relatedNodes != null) {
    for (    SNode node : relatedNodes) {
      SModel model=node.getModel();
      if (model == null)       continue;
      SModel modelDescriptor=SModelRepository.getInstance().getModelDescriptor(model.getReference());
      if (modelDescriptor != null) {
        modelsToListen.add(modelDescriptor);
      }
    }
  }
  if (relatedRefTargets != null) {
    for (    SNodeReference nodeProxy : relatedRefTargets) {
      SModel model=nodeProxy.getModelReference() == null ? null : SModelRepository.getInstance().getModelDescriptor(nodeProxy.getModelReference());
      if (model != null) {
        modelsToListen.add(model);
      }
    }
  }
  for (  SModel nextModelToListen : modelsToListen) {
    if (!myListeningModels.contains(nextModelToListen)) {
      myModelListener.add(nextModelToListen);
    }
  }
  for (  SModel nextListeningModel : myListeningModels) {
    if (!modelsToListen.contains(nextListeningModel)) {
      myModelListener.remove(nextListeningModel);
    }
  }
  myListeningModels=modelsToListen;
  myRepositoryListener.setUsedModels(modelsToListen);
  myContentAdapter.setMainModel(mainNode.getModel());
  assertListenerAdded(mainNode);
}
