{
  BufferedWriter instWriter=new BufferedWriter(new FileWriter(myInput));
  try {
    Collection<File> dirs=getAllDirs();
    for (    File dir : dirs) {
      final File[] files=dir.listFiles();
      if (files.length == 0)       continue;
      instWriter.newLine();
      instWriter.newLine();
      if (dir.getAbsolutePath().length() > myBaseDir.getAbsolutePath().length()) {
        instWriter.write("SetOutPath \"$INSTDIR\\" + getRelativePath(dir.getAbsolutePath()) + "\"");
      }
 else {
        instWriter.write("SetOutPath $INSTDIR");
      }
      for (      File file : files) {
        if (!file.isDirectory()) {
          instWriter.newLine();
          instWriter.write("File \"" + getRelativePath(file.getAbsolutePath(),myCurrentDir.getAbsolutePath()) + "\"");
        }
      }
    }
  }
  finally {
    instWriter.close();
  }
}
