{
  HashSet<T> rv=new HashSet<T>(myModels);
  HashSet<SModelReference> collected=new HashSet<SModelReference>();
  for (Iterator<T> it=rv.iterator(); it.hasNext(); ) {
    final SModelReference next=it.next().getReference();
    if (collected.contains(next)) {
      throw new IllegalStateException(String.format("There's more than one instance of model identified with reference %s, can't decide which one to publish",next));
    }
    collected.add(next);
    if (!isPublished(next)) {
      it.remove();
    }
  }
  return rv;
}
