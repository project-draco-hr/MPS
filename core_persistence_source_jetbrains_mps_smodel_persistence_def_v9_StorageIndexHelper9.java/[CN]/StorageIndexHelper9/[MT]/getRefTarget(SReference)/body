{
  String target=(ref instanceof StaticReference ? String.valueOf(ref.getTargetNodeId()) : DYNAMIC_REFERENCE_ID);
  SModelReference targetModel=ref.getTargetSModelReference();
  if (targetModel == null)   return target;
  if (targetModel.equals(myModelRef))   return encode(target);
  String index=getImportIndex(targetModel);
  if (index == null) {
    if (LOG.isEnabledFor(Level.ERROR)) {
      LOG.error("model " + targetModel + " not found in index");
    }
    return encode(target);
  }
  return index + MODEL_SEPARATOR_CHAR + encode(target);
}
