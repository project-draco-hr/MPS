{
  FakePsiElement fakePsiContext=new FakePsiElement(){
    public PsiElement getParent(){
      return null;
    }
  }
;
  BaseMPSChooseModel goToNodeModel;
  if (!myUseCache) {
    goToNodeModel=new BaseNodeModel(project){
      public NavigationItem doGetNavigationItem(      SNode node){
        return new BaseNodeItem(node){
          public void navigate(          boolean requestFocus){
            new AddModelItem(project,model,getNode().getModel().getSModelReference(),contextModule).navigate(requestFocus);
          }
        }
;
      }
      public SNode[] find(      IScope scope){
        Condition<SModelDescriptor> cond=new Condition<SModelDescriptor>(){
          public boolean met(          SModelDescriptor modelDescriptor){
            boolean rightStereotype=SModelStereotype.isUserModel(modelDescriptor);
            boolean hasModule=modelDescriptor.getModule() != null;
            return rightStereotype && hasModule;
          }
        }
;
        ConditionalIterable<SModelDescriptor> iter=new ConditionalIterable<SModelDescriptor>(scope.getModelDescriptors(),cond);
        final List<SNode> nodes=new ArrayList<SNode>();
        for (        SModelDescriptor modelDescriptor : iter) {
          SModel model=modelDescriptor.getSModel();
          if (model == null)           continue;
          nodes.addAll(IterableUtil.asCollection(model.roots()));
        }
        return nodes.toArray(new SNode[nodes.size()]);
      }
      @Nullable public String getPromptText(){
        return "Import model that contains root:";
      }
    }
;
  }
 else {
    goToNodeModel=new MPSChooseSNodeDescriptor(project,new RootNodeNameIndex()){
      public NavigationItem doGetNavigationItem(      final BaseSNodeDescriptor object){
        return new RootNodeElement(object){
          public void navigate(          boolean requestFocus){
            SModelDescriptor descriptor=GlobalScope.getInstance().getModelDescriptor(object.getModelReference());
            SModel modelDescriptor=descriptor.getSModel();
            SNode node=object.getNode(modelDescriptor);
            new AddModelItem(project,model,node.getModel().getSModelReference(),contextModule).navigate(requestFocus);
          }
        }
;
      }
      @Nullable public String getPromptText(){
        return "Import model that contains root:";
      }
    }
;
  }
  ChooseByNamePopup popup=MpsPopupFactory.createNodePopup(project,goToNodeModel,initialText);
  popup.invoke(new ChooseByNamePopupComponent.Callback(){
    public void onClose(){
    }
    public void elementChosen(    final Object element){
      ModelAccess.instance().runWriteAction(new Runnable(){
        public void run(){
          ((NavigationItem)element).navigate(true);
        }
      }
);
    }
  }
,ModalityState.current(),true);
}
