{
  final ModuleReference moduleToImport=ModelAccess.instance().runReadAction(new Computable<ModuleReference>(){
    public ModuleReference compute(){
      SModelDescriptor md=SModelRepository.getInstance().getModelDescriptor(getModelReference());
      final ModuleReference moduleReference=md.getModule().getModuleReference();
      if (myModule.getScope().getModelDescriptor(getModelReference()) == null) {
        return moduleReference;
      }
      return null;
    }
  }
);
  if (moduleToImport != null) {
    int res=JOptionPane.showConfirmDialog(getFrame(),"<html>Model <b>" + getModelReference().getSModelFqName() + "</b> is owned by module <b>"+ moduleToImport.getModuleFqName()+ "</b> which is not imported.</html>\n\n"+ "Importing the module will take some time.\n"+ "Do you want to automatically import the module?","Module import",JOptionPane.YES_NO_OPTION);
    if (res == JOptionPane.YES_OPTION) {
      ModelAccess.instance().runWriteActionInCommand(new Runnable(){
        public void run(){
          myModule.addDependency(moduleToImport,false);
          ClassLoaderManager.getInstance().reloadAll(new EmptyProgressIndicator());
        }
      }
);
    }
  }
  ModelAccess.instance().runWriteActionInCommand(new Runnable(){
    public void run(){
      myModel.getSModel().addModelImport(getModelReference(),false);
    }
  }
);
}
