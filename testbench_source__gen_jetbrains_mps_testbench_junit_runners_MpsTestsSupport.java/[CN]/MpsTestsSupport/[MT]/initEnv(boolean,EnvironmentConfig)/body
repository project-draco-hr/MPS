{
  if (ActiveEnvironment.get() == null) {
    CREATED_ENV=(withIdea ? new IdeaEnvironment(config) : new MpsEnvironment(config));
    return CREATED_ENV;
  }
 else {
    if (withIdea && !(ActiveEnvironment.get().hasIdeaInstance())) {
      throw new MpsTestsSupport.ActiveEnvironmentNotSatisfiedException();
    }
    return null;
  }
}
