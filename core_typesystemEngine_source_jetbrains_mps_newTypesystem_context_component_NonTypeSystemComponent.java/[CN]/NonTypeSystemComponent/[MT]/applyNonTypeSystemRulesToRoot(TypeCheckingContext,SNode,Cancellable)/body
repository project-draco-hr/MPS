{
  if (rootNode == null)   return;
  doInvalidate();
  try {
    Queue<SNode> frontier=new LinkedList<SNode>();
    frontier.add(rootNode);
    while (!(frontier.isEmpty())) {
      if (c.isCancelled())       return;
      SNode sNode=frontier.remove();
      applyNonTypesystemRulesToNode(sNode,typeCheckingContext);
      frontier.addAll(IterableUtil.asCollection(sNode.getChildren()));
    }
  }
  finally {
    setInvalidationWasPerformed(false);
  }
}
