{
  IModelPersistence modelPersistence=getPersistence(persistenceVersion);
  if (modelPersistence == null) {
    throw new IllegalArgumentException(String.format("Unknown persistence version %d",persistenceVersion));
  }
  if (persistenceVersion < 9) {
    model.getImplicitImportsSupport().calculateImplicitImports();
  }
  return modelPersistence.getModelWriter(model instanceof DefaultSModel ? ((DefaultSModel)model).getSModelHeader() : null).saveModel(model);
}
