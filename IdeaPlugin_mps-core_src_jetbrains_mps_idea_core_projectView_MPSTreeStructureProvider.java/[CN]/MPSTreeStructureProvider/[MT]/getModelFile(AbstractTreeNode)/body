{
  if (treeNode instanceof MPSPsiElementTreeNode) {
    return getModelFile(treeNode.getParent());
  }
 else   if (treeNode instanceof MPSPsiModelTreeNode) {
    MPSPsiModelTreeNode fileNode=(MPSPsiModelTreeNode)treeNode;
    VirtualFile virtualFile=fileNode.getVirtualFile();
    if (virtualFile == null || virtualFile.getFileType() != MPSFileTypeFactory.MPS_FILE_TYPE)     return null;
    return FileSystem.getInstance().getFileByPath(virtualFile.getPath());
  }
  return null;
}
