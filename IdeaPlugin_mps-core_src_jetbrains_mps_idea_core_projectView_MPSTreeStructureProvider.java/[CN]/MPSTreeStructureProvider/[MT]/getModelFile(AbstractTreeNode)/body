{
  if (treeNode instanceof MPSPsiModelTreeNode) {
    MPSPsiModelTreeNode fileNode=(MPSPsiModelTreeNode)treeNode;
    VirtualFile virtualFile=fileNode.getVirtualFile();
    if (virtualFile == null || virtualFile.getFileType() != MPSFileTypeFactory.MPS_FILE_TYPE && virtualFile.getFileType() != MPSFileTypeFactory.MPS_HEADER_FILE_TYPE) {
      return null;
    }
    return FileSystem.getInstance().getFile(virtualFile.getPath());
  }
 else   if (treeNode instanceof PsiDirectoryNode) {
    VirtualFile virtualFile=((PsiDirectoryNode)treeNode).getVirtualFile();
    if (virtualFile == null) {
      return null;
    }
    IFile ifile=FileSystem.getInstance().getFile(virtualFile.getPath());
    SModel model=SModelFileTracker.getInstance(ProjectHelper.getProjectRepository(treeNode.getProject())).findModel(ifile);
    if (model != null)     return ifile;
  }
  return null;
}
