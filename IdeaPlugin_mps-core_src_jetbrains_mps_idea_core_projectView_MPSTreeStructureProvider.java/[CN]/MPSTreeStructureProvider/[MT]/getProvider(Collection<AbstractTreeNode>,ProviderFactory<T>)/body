{
  if (selected.size() == 0)   return null;
  List<SNodeReference> selectedNodePointers=new ArrayList<SNodeReference>();
  Project project=null;
  EditableSModelDescriptor modelDescriptor=null;
  for (  AbstractTreeNode treeNode : selected) {
    if (!(treeNode instanceof MPSPsiElementTreeNode))     return null;
    MPSPsiRootNode mpsPsiNode=((MPSPsiElementTreeNode)treeNode).getValue();
    if (!mpsPsiNode.isValid())     return null;
    selectedNodePointers.add(mpsPsiNode.getSNodeReference());
    if (project == null) {
      project=treeNode.getProject();
    }
 else     if (project != treeNode.getProject()) {
      return null;
    }
    if (modelDescriptor == null) {
      modelDescriptor=getModel(mpsPsiNode);
    }
 else     if (modelDescriptor != getModel(mpsPsiNode)) {
      return null;
    }
  }
  jetbrains.mps.project.Project mpsProject=ProjectHelper.toMPSProject(project);
  if (mpsProject == null || modelDescriptor == null)   return null;
  SModel sModel=modelDescriptor;
  if (sModel == null)   return null;
  return createProvider.create(selectedNodePointers,modelDescriptor,sModel,mpsProject);
}
