{
  if (parent instanceof PsiFileNode) {
    PsiFileNode fileNode=(PsiFileNode)parent;
    VirtualFile virtualFile=fileNode.getVirtualFile();
    if (virtualFile == null || virtualFile.getFileType() != MPSFileTypeFactory.MODEL_FILE_TYPE)     return children;
    final IFile modelFile=FileSystem.getInstance().getFileByPath(virtualFile.getPath());
    final List<AbstractTreeNode> newChildren=new ArrayList<AbstractTreeNode>(children);
    ModelAccess.instance().runReadAction(new Runnable(){
      @Override public void run(){
        SModelDescriptor descr=SModelRepository.getInstance().findModel(modelFile);
        if (descr == null)         return;
        SModel model=descr.getSModel();
        if (model != null) {
          for (          SNode root : model.roots()) {
            String name;
            try {
              name=root.getName();
            }
 catch (            Exception ex) {
              name="exc: " + ex.getMessage();
            }
            if (name == null) {
              name="unnamed";
            }
            Icon rootIcon=IconManager.getIconFor(root);
            newChildren.add(new MPSProjectViewNode(parent.getProject(),name,rootIcon,new SNodePointer(root),settings));
          }
        }
      }
    }
);
    return newChildren;
  }
  return children;
}
