{
  SRepository repository=ProjectHelper.getProjectRepository(selectedNode.getProject());
  if (selectedNode instanceof MPSPsiElementTreeNode) {
    MPSPsiNodeBase value=((MPSPsiElementTreeNode)selectedNode).getValue();
    return getModel(value);
  }
 else   if (selectedNode instanceof MPSPsiModelTreeNode) {
    MPSPsiModel psiModel=((MPSPsiModelTreeNode)selectedNode).getModel();
    SModel sModel=psiModel.getSModelReference().resolve(repository);
    return (EditableSModel)sModel;
  }
 else   if (selectedNode instanceof PsiDirectoryNode) {
    SModel sModel=SModelFileTracker.getInstance(repository).findModel(VirtualFileUtils.toIFile(((PsiDirectoryNode)selectedNode).getVirtualFile()));
    if (sModel instanceof EditableSModel) {
      return (EditableSModel)sModel;
    }
  }
  return null;
}
