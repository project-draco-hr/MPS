{
  Project ideaProject=p.getProject();
  ModelCheckerTool_Tool tool=ideaProject.getComponent(ProjectPluginManager.class).getTool(ModelCheckerTool_Tool.class);
  if (tool == null)   return;
  ModelCheckerSettings mcSettings=ApplicationManager.getApplication().getComponent(ModelCheckerSettings.class);
  try {
    mcSettings.setMigrationMode(true);
    ModelCheckerViewer res=tool.checkProject(ideaProject,ProjectOperationContext.get(ideaProject),false);
    for (    final ModelCheckerIssue issue : res.getSearchResults().getResultObjects()) {
      ModelAccess.instance().runWriteActionInCommand(new Runnable(){
        public void run(){
          issue.fix();
        }
      }
);
    }
    res=tool.checkProject(ideaProject,ProjectOperationContext.get(ideaProject),true);
    Set<ModelCheckerIssue> problems=res.getSearchResults().getResultObjects();
    myProblems=problems.size();
  }
  finally {
    mcSettings.setMigrationMode(false);
  }
}
