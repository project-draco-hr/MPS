{
  if (stream.readInt() != 0xbeb0beb0)   throw new IOException("bad stream: no start marker");
  int size=stream.readInt();
  List<ModuleHandle> result=new ArrayList<ModuleHandle>(size);
  for (; size > 0; size--) {
    String file=stream.readString();
    ModuleDescriptor descriptor;
    int type=stream.readByte();
    if (type == 1) {
      descriptor=new LanguageDescriptor();
    }
 else     if (type == 2) {
      descriptor=new SolutionDescriptor();
    }
 else     if (type == 3) {
      descriptor=new DevkitDescriptor();
    }
 else {
      throw new IOException("broken stream: invalid descriptor type");
    }
    descriptor.load(stream);
    result.add(new ModuleHandle(FileSystem.getInstance().getFileByPath(file),descriptor));
  }
  return result;
}
