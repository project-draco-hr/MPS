{
  if (!needProcess(file,excludes))   return;
  if (refreshFiles) {
    FileSystem.getInstance().refresh(file);
  }
  if (file.getName().endsWith(JAR)) {
    IFile jarRoot=FileSystem.getInstance().getFileByPath(file.getPath() + JAR_SEPARATOR);
    if (jarRoot != null) {
      readModuleDescriptorsFromFolder(jarRoot,excludes,result,refreshFiles,reader);
    }
  }
 else {
    if (!isModuleFile(file))     return;
    ModuleDescriptor moduleDescriptor=loadDescriptorOnly_internal(file,excludes);
    if (moduleDescriptor != null) {
      T descriptor=reader.read(new ModuleHandle(file,moduleDescriptor));
      if (descriptor != null) {
        result.add(descriptor);
      }
    }
  }
}
