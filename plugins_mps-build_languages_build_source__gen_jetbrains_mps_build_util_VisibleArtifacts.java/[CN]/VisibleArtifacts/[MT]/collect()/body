{
  for (  SNode dep : SLinkOperations.getTargets(project,"dependencies",true)) {
    SNode layoutDependency=SNodeOperations.as(dep,"jetbrains.mps.build.structure.BuildExternalLayoutDependency");
    if (layoutDependency == null) {
      continue;
    }
    SNode target=SLinkOperations.getTarget(layoutDependency,"layout",false);
    collectInExternalLayout(layoutDependency,target);
  }
  for (  SNode dep : SLinkOperations.getTargets(project,"dependencies",true)) {
    SNode projectDependency=SNodeOperations.as(dep,"jetbrains.mps.build.structure.BuildProjectDependency");
    if (projectDependency == null) {
      continue;
    }
    SNode target=SLinkOperations.getTarget(projectDependency,"script",false);
    if (target == project) {
      continue;
    }
    collectInProject(projectDependency,target);
  }
  collectProjectArtifacts();
}
