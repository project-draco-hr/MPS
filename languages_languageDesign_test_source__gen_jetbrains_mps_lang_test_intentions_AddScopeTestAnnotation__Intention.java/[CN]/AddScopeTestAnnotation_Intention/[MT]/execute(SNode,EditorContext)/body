{
  SNode newAnnotation=SConceptOperations.createNewNode("jetbrains.mps.lang.test.structure.ScopesTest",null);
  AttributeOperations.setAttribute(node,new IAttributeDescriptor.NodeAttribute(SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.test.structure.ScopesTest")),newAnnotation);
  Scope scope=ModelConstraints.getScope(((SNode)node).getReferences().get(0));
  for (  SNode avaliable : scope.getAvailableElements(null)) {
    SNode expectedNode=SConceptOperations.createNewNode("jetbrains.mps.lang.test.structure.ScopesExpectedNode",null);
    SLinkOperations.setTarget(expectedNode,"ref",avaliable,false);
    ListSequence.fromList(SLinkOperations.getTargets(newAnnotation,"nodes",true)).addElement(expectedNode);
  }
  editorContext.select(newAnnotation);
}
