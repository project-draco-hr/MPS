{
  for (int i=0; i < HEIGHT; i++) {
    for (int j=0; j < WIDTH; j++) {
      Color cell=Color.WHITE;
      Cell worldCell=world[i][j];
      Icon karelIcon=null;
      if (worldCell.isKaja()) {
        cell=Color.LIGHT_GRAY;
switch (direction) {
case north:
          karelIcon=karelIconNorth;
        break;
case east:
      karelIcon=karelIconEast;
    break;
case south:
  karelIcon=karelIconSouth;
break;
default :
karelIcon=karelIconWest;
}
}
if (worldCell.isWall()) {
cell=Color.RED;
}
final VisualCell currentVisual=visuals[i][j];
final Color cellValue=cell;
int marks=worldCell.getMarks();
final String marksCaption=(marks > 0 ? "" + marks : "");
final Icon cellIcon=karelIcon;
final boolean isStopped=stopped;
try {
SwingUtilities.invokeAndWait(new Runnable(){
@Override public void run(){
if (isStopped) {
frame.setTitle("Robot Kaja - STOPPED");
}
currentVisual.setBackground(cellValue);
currentVisual.setIcon(cellIcon);
currentVisual.setMarks(marksCaption);
currentVisual.setFont(new Font(currentVisual.getFont().getName(),Font.BOLD,18));
}
}
);
}
 catch (Exception e) {
throw new RuntimeException(e);
}
}
}
}
