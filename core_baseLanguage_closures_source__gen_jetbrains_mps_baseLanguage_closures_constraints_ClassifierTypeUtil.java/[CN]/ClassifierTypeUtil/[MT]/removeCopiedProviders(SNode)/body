{
  SNode result=SNodeOperations.copyNode(type);
  if (SNodeOperations.isInstanceOf(result,"jetbrains.mps.lang.typesystem.structure.CopiedTypeProvider")) {
    return SNodeOperations.copyNode(SLinkOperations.getTarget(SNodeOperations.cast(result,"jetbrains.mps.lang.typesystem.structure.CopiedTypeProvider"),"copiedTypeSource",false));
  }
 else {
    for (    SNode descendant : SNodeOperations.getDescendants(result,"jetbrains.mps.lang.typesystem.structure.CopiedTypeProvider",false,new String[]{})) {
      SNodeOperations.replaceWithAnother(descendant,SNodeOperations.copyNode(SLinkOperations.getTarget(descendant,"copiedTypeSource",false)));
    }
    return result;
  }
}
