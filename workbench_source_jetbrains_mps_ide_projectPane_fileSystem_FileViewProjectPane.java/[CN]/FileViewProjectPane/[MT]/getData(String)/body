{
  if (dataId.equals(PlatformDataKeys.VIRTUAL_FILE_ARRAY.getName())) {
    List<VirtualFile> files=new LinkedList<VirtualFile>();
    TreePath[] treePaths=getSelectionPaths();
    if (treePaths != null) {
      for (      TreePath tp : treePaths) {
        Object lastPathComponent=tp.getLastPathComponent();
        if (lastPathComponent instanceof FileNode) {
          FileNode node=(FileNode)lastPathComponent;
          getFiles(node,files);
        }
      }
    }
    return files.toArray(new VirtualFile[files.size()]);
  }
 else   if (dataId.equals(PlatformDataKeys.VIRTUAL_FILE.getName())) {
    TreePath tp=getSelectedPath();
    Object lastPathComponent=tp.getLastPathComponent();
    if (lastPathComponent instanceof FileNode) {
      FileNode node=(FileNode)lastPathComponent;
      return node.getFile();
    }
  }
  return super.getData(dataId);
}
