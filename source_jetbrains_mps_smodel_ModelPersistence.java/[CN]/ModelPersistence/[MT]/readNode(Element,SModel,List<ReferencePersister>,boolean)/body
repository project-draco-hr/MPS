{
  String type=nodeElement.getAttributeValue(TYPE);
  SNode node=createNodeInstance(type,model);
  if (node == null) {
    String error="Error reading model " + model.getUID() + ": couldn't create instance of node id="+ nodeElement.getAttributeValue(ID);
    LOG.errorWithTrace(error);
    firePersisteneceError();
    return null;
  }
  String myOldId=nodeElement.getAttributeValue(ID);
  node.setId(myOldId);
  String cachedExtResolveInfo=nodeElement.getAttributeValue(EXT_RESOLVE_INFO);
  if (!ExternalResolver.isEmptyExtResolveInfo(cachedExtResolveInfo)) {
    model.loadCachedNodeExtResolveInfo(node,cachedExtResolveInfo);
  }
  List properties=nodeElement.getChildren(PROPERTY);
  for (Iterator iterator=properties.iterator(); iterator.hasNext(); ) {
    Element propertyElement=(Element)iterator.next();
    String propertyName=propertyElement.getAttributeValue(NAME);
    String propertyValue=propertyElement.getAttributeValue(VALUE);
    if (propertyValue != null) {
      node.setProperty(propertyName,propertyValue);
    }
  }
  Element attributeElement=nodeElement.getChild(ATTRIBUTE);
  if (attributeElement != null) {
    Element linkElement=attributeElement.getChild(LINK);
    ReferencePersister rp=ReferencePersister.readReferencePersister(linkElement,node,useUIDs);
    SReference attributeReference=rp.createReferenceInModelDoNotAddToSourceNode(model);
    node.setAttributeReference(attributeReference);
  }
  List propertyAttributes=nodeElement.getChildren(PROPERTY_ATTRIBUTE);
  for (  Object o : propertyAttributes) {
    Element propertyAttributeElement=(Element)o;
    String propertyName=propertyAttributeElement.getAttributeValue(NAME);
    Element linkElement=propertyAttributeElement.getChild(LINK);
    ReferencePersister rp=ReferencePersister.readReferencePersister(linkElement,node,useUIDs);
    SReference propertyAttributeReference=rp.createReferenceInModelDoNotAddToSourceNode(model);
    node.putPropertyAtributeReference(propertyName,propertyAttributeReference);
  }
  List linkAttributes=nodeElement.getChildren(LINK_ATTRIBUTE);
  for (  Object o : linkAttributes) {
    Element linkAttributeElement=(Element)o;
    String role=linkAttributeElement.getAttributeValue(ROLE);
    Element linkElement=linkAttributeElement.getChild(LINK);
    ReferencePersister rp=ReferencePersister.readReferencePersister(linkElement,node,useUIDs);
    SReference linkAttributeReference=rp.createReferenceInModelDoNotAddToSourceNode(model);
    node.putLinkAttributeReference(role,linkAttributeReference);
  }
  List links=nodeElement.getChildren(LINK);
  for (Iterator iterator=links.iterator(); iterator.hasNext(); ) {
    Element linkElement=(Element)iterator.next();
    referenceDescriptors.add(ReferencePersister.readReferencePersister(linkElement,node,useUIDs));
  }
  List childNodes=nodeElement.getChildren(NODE);
  for (Iterator iterator=childNodes.iterator(); iterator.hasNext(); ) {
    Element childNodeElement=(Element)iterator.next();
    String role=childNodeElement.getAttributeValue(ROLE);
    SNode childNode=readNode(childNodeElement,model,referenceDescriptors,useUIDs);
    if (childNode != null) {
      node.addChild(role,childNode);
    }
 else {
      LOG.errorWithTrace("Error reading child node in node " + node.getDebugText());
      firePersisteneceError();
    }
  }
  return node;
}
