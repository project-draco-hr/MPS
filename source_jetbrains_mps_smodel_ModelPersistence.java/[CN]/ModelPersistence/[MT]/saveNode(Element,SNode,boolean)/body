{
  Element element=new Element(NODE);
  setNotNullAttribute(element,ROLE,semanticNode.getRole_());
  element.setAttribute(TYPE,semanticNode.getClass().getName());
  element.setAttribute(ID,semanticNode.getId());
  Map<String,String> properties=semanticNode.getProperties();
  Set<String> keys=properties.keySet();
  for (Iterator<String> iterator=keys.iterator(); iterator.hasNext(); ) {
    String propertyName=iterator.next();
    Element propertyElement=new Element(PROPERTY);
    element.addContent(propertyElement);
    propertyElement.setAttribute(NAME,propertyName);
    setNotNullAttribute(propertyElement,VALUE,semanticNode.getProperty(propertyName));
  }
  List<SReference> references=semanticNode.getReferences();
  for (Iterator<SReference> iterator=references.iterator(); iterator.hasNext(); ) {
    SReference semanticReference=iterator.next();
    Element linkElement=new Element(LINK);
    element.addContent(linkElement);
    linkElement.setAttribute(ROLE,semanticReference.getRole());
    linkElement.setAttribute(TARGET_NODE_ID,semanticReference.createReferencedNodeId());
    if (!semanticReference.isGood()) {
      linkElement.setAttribute(BAD,"true");
    }
    String resolveInfo=semanticReference.getResolveInfo();
    if (!semanticReference.isGood() || (saveResolveInfo && resolveInfo != null))     linkElement.setAttribute(RESOLVE_INFO,resolveInfo);
    String targetClassResolveInfo=semanticReference.getTargetClassResolveInfo();
    if (!semanticReference.isGood() || saveResolveInfo && targetClassResolveInfo != null)     linkElement.setAttribute(TARGET_CLASS_RESOLVE_INFO,targetClassResolveInfo);
  }
  List<SNode> children=semanticNode.getChildren();
  for (  SNode childNode : children) {
    saveNode(element,childNode,saveResolveInfo);
  }
  parentElement.addContent(element);
}
