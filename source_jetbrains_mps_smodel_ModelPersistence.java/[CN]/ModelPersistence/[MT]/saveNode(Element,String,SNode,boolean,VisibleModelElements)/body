{
  String theElementName=elementName;
  if (theElementName == null) {
    theElementName=NODE;
  }
  Element element=new Element(theElementName);
  setNotNullAttribute(element,ROLE,node.getRole_());
  String oldStructureClassName=NameUtil.removeStructureFromFqName(node.getConceptFqName());
  element.setAttribute(TYPE,oldStructureClassName);
  element.setAttribute(ID,node.getId());
  Map<String,String> properties=node.getProperties();
  Set<String> keys=properties.keySet();
  for (  String propertyName : keys) {
    Element propertyElement=new Element(PROPERTY);
    element.addContent(propertyElement);
    propertyElement.setAttribute(NAME,propertyName);
    setNotNullAttribute(propertyElement,VALUE,node.getPersistentProperty(propertyName));
  }
  List<SReference> references=node.getReferences();
  for (  SReference reference : references) {
    ReferencePersister.saveReference(element,reference,useUIDs,visibleModelElements);
  }
  List<SNode> children=node.getChildren();
  for (  SNode childNode : children) {
    saveNode(element,null,childNode,useUIDs,visibleModelElements);
  }
  parentElement.addContent(element);
}
