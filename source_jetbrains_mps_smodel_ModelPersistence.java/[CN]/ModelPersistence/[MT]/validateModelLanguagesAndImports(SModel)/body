{
  Set<String> usedLanguages=new HashSet<String>(sourceModel.getLanguageNamespaces());
  Set<SModelUID> importedModels=new HashSet<SModelUID>(sourceModel.getImportedModelUIDs());
  List<? extends SNode> nodes=SModelUtil.allNodes(sourceModel);
  for (  SNode node : nodes) {
    String languageNamespace=SModelUtil.getLanguageNamespace(node);
    if (!usedLanguages.contains(languageNamespace)) {
      usedLanguages.add(languageNamespace);
      sourceModel.addLanguage(languageNamespace);
    }
    List<SReference> references=node.getReferences();
    for (    SReference reference : references) {
      if (reference.isExternal()) {
        ExternalReference externalReference=(ExternalReference)reference;
        SModelUID targetModelUID=externalReference.getTargetModelUID();
        if (!importedModels.contains(targetModelUID)) {
          sourceModel.addImportedModel(targetModelUID);
          importedModels.add(targetModelUID);
        }
      }
    }
  }
  importedModels.clear();
}
