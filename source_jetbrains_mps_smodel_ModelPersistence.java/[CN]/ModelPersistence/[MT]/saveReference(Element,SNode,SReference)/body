{
  Element linkElement=new Element(LINK);
  element.addContent(linkElement);
  linkElement.setAttribute(ROLE,reference.getRole());
  if (reference.isExternal()) {
    ExternalReference externalReference=(ExternalReference)reference;
    SModelUID targetModelUID=externalReference.getTargetModelUID();
    SModel.ImportElement importElement=node.getModel().getImportElement(targetModelUID);
    if (importElement == null) {
      importElement=node.getModel().addImportElement(targetModelUID);
    }
    String extResolveInfo=externalReference.getExtResolveInfo();
    if (ExternalResolver.isEmptyExtResolveInfo(extResolveInfo)) {
      linkElement.setAttribute(TARGET_NODE_ID,importElement.getReferenceID() + "." + reference.getTargetNodeId());
    }
 else {
      linkElement.setAttribute(EXT_RESOLVE_INFO,importElement.getReferenceID() + "." + extResolveInfo);
    }
  }
 else {
    if (reference.isResolved())     linkElement.setAttribute(TARGET_NODE_ID,reference.getTargetNodeId());
    String resolveInfo=reference.getResolveInfo();
    if (!reference.isResolved() && resolveInfo != null)     linkElement.setAttribute(RESOLVE_INFO,resolveInfo);
    String targetClassResolveInfo=reference.getTargetClassResolveInfo();
    if (!reference.isResolved() && targetClassResolveInfo != null)     linkElement.setAttribute(TARGET_CLASS_RESOLVE_INFO,targetClassResolveInfo);
  }
}
