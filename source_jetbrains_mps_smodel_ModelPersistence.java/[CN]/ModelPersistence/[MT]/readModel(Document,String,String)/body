{
  Element rootElement=document.getRootElement();
  String modelNamespace=rootElement.getAttributeValue(NAMESPACE,"");
  SModel model=new SModel(new SModelUID(modelNamespace,modelName,stereotype));
  model.setLoading(true);
  try {
    Element maxRefID=rootElement.getChild(MAX_REFERENCE_ID);
    model.setMaxReferenceID(readIntAttributeValue(maxRefID,VALUE));
  }
 catch (  Throwable e) {
    LOG.error(e);
  }
  List languages=rootElement.getChildren(LANGUAGE);
  for (Iterator iterator=languages.iterator(); iterator.hasNext(); ) {
    Element element=(Element)iterator.next();
    String languageNamespace=element.getAttributeValue(NAMESPACE);
    model.addLanguage(languageNamespace);
  }
  List imports=rootElement.getChildren(IMPORT_ELEMENT);
  for (Iterator iterator=imports.iterator(); iterator.hasNext(); ) {
    Element element=(Element)iterator.next();
    int referenceID=readIntAttributeValue(element,MODEL_REFERENCE_ID);
    String modelUID=element.getAttributeValue(MODEL_UID);
    if (modelUID != null) {
      model.addImportElement(SModelUID.fromString(modelUID),referenceID);
    }
 else {
      String importedModelFQName=NameUtil.longNameFromNamespaceAndName(element.getAttributeValue(NAMESPACE),element.getAttributeValue(NAME));
      String importedModelStereotype=element.getAttributeValue(STEREOTYPE,"");
      model.addImportElement(new SModelUID(importedModelFQName,importedModelStereotype),referenceID);
    }
  }
  ArrayList<ReferenceDescriptor> referenceDescriptors=new ArrayList<ReferenceDescriptor>();
  List children=rootElement.getChildren(NODE);
  for (Iterator iterator=children.iterator(); iterator.hasNext(); ) {
    Element element=(Element)iterator.next();
    SNode semanticNode=readNode(element,model,referenceDescriptors);
    model.addRoot(semanticNode);
  }
  for (  ReferenceDescriptor referenceDescriptor : referenceDescriptors) {
    SReference semanticReference=null;
    semanticReference=SReference.newInstance(referenceDescriptor.role,referenceDescriptor.sourceNode,referenceDescriptor.targetId,referenceDescriptor.isBad,referenceDescriptor.resolveInfo,referenceDescriptor.targetClassResolveInfo);
    if (semanticReference != null)     referenceDescriptor.sourceNode.addSemanticReference(semanticReference);
  }
  model.setLoading(false);
  return model;
}
