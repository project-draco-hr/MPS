{
  final boolean[] reloadingNeeded=new boolean[1];
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      ModuleMaker maker=new ModuleMaker();
      if (needClean) {
        maker.clean(modules,indicator);
      }
      MPSCompilationResult compilationResult=maker.make(modules,indicator);
      reloadingNeeded[0]=compilationResult.isReloadingNeeded();
    }
  }
);
  if (reloadingNeeded[0]) {
    ModelAccess.instance().runWriteAction(new Runnable(){
      public void run(){
        ClassLoaderManager.getInstance().reloadAll(indicator);
      }
    }
);
  }
}
