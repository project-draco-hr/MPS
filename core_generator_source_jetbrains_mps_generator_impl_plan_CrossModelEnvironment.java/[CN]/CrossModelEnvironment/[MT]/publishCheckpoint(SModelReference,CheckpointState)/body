{
  myModule.addModelToKeep(cpState.getCheckpointModel().getReference(),true);
  ModelCheckpoints checkpoints=myTransientCheckpoints.get(originalModel);
  if (checkpoints == null) {
    myTransientCheckpoints.put(originalModel,new ModelCheckpoints(cpState));
  }
 else {
    Collection<CheckpointState> discarded=checkpoints.updateAndDiscardOutdated(cpState);
    HashSet<SModelReference> forgottenCheckpoints=new HashSet<SModelReference>();
    for (    CheckpointState next : discarded) {
      SModelReference cpReference=next.getCheckpointModel().getReference();
      forgottenCheckpoints.add(cpReference);
      myModule.forgetModel(cpReference,true);
    }
    for (    ModelCheckpoints mcp : myTransientCheckpoints.values()) {
      mcp.discardOutdated(forgottenCheckpoints,discarded);
    }
  }
}
