{
  SModel m1=new TestModelFactory().createModel(2,2);
  myTestModelAccess.enableWrite();
  ((SModelBase)m1).attach(myTestRepo);
  final SNode r1=m1.getRootNodes().iterator().next();
  final SNode ffn=new TestModelFactory().createNode();
  final SNodeId r1id=r1.getNodeId();
  Assert.assertEquals(2,IterableUtil.asCollection(m1.getRootNodes()).size());
  Assert.assertEquals(2,IterableUtil.asCollection(r1.getChildren()).size());
  Assert.assertSame(r1,m1.getNode(r1id));
  try {
    ffn.insertChildBefore(ourRole,r1,null);
    Assert.assertEquals(2,IterableUtil.asCollection(m1.getRootNodes()).size());
    Assert.assertTrue(IterableUtil.asCollection(ffn.getChildren()).contains(r1));
    Assert.assertSame(r1,m1.getNode(r1id));
    Assert.assertNull(m1.getNode(r1id).getModel());
    Assert.fail("Insert of a root not detached from a model shall fail");
  }
 catch (  IllegalModelAccessException ignored) {
  }
}
