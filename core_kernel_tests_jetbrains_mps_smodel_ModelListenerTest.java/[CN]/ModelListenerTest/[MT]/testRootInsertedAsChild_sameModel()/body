{
  SModel m1=new TestModelFactory().createModel(2,2);
  myTestModelAccess.enableWrite();
  ((SModelBase)m1).attach(myTestRepo);
  final Iterator<SNode> roots=m1.getRootNodes().iterator();
  final SNode r1=roots.next();
  final SNode r2=roots.next();
  final SNodeId r1id=r1.getNodeId();
  Assert.assertEquals(2,IterableUtil.asCollection(m1.getRootNodes()).size());
  Assert.assertEquals(2,IterableUtil.asCollection(r2.getChildren()).size());
  Assert.assertSame(r1,m1.getNode(r1id));
  try {
    r2.insertChildBefore(ourRole,r1,null);
    Assert.assertEquals(2,IterableUtil.asCollection(m1.getRootNodes()).size());
    Assert.assertEquals(3,IterableUtil.asCollection(r2.getChildren()).size());
    Assert.assertTrue(IterableUtil.asCollection(r2.getChildren()).contains(r1));
    Assert.assertNotNull(r2.getParent());
    Assert.assertSame(r1,m1.getNode(r1id));
    Assert.fail("Insert of a root not detached from a model shall fail");
  }
 catch (  IllegalModelAccessException ignored) {
  }
}
