{
  Map<T,Set<D>> result=new HashMap<T,Set<D>>();
  for (  D data : dataToSort) {
    T group=getGroup(data);
    if (group != null) {
      Set<D> dataForGroup=result.get(group);
      if (dataForGroup == null) {
        dataForGroup=new HashSet<D>();
        result.put(group,dataForGroup);
      }
      dataForGroup.add(data);
    }
  }
  return result;
}
