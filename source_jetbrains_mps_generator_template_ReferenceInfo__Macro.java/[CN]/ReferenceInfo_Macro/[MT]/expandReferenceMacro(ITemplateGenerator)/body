{
  String role=myReferenceMacro.getLink().getRole();
  ReferenceMacro_GetReferent function=myReferenceMacro.getReferentFunction();
  if (function == null) {
    generator.showErrorMessage(getInputNode(),myReferenceMacro.getNode(),"couldn't evaluate reference macro");
    return null;
  }
  String methodName=TemplateFunctionMethodName.referenceMacro_GetReferent(function.getNode());
  SNode outputTargetNode=null;
  try {
    Object result;
    result=QueryMethodGenerated.invoke(methodName,generator.getGeneratorSessionContext(),new ReferenceMacro_ParameterObject(getInputNode(),myTemplateReferenceNode,getOutputSourceNode(),generator.getInputModel(),generator),myReferenceMacro.getModel());
    if (result instanceof SNode) {
      outputTargetNode=(SNode)result;
    }
 else {
      myResolveInfoForDynamicResolve=(String)result;
    }
  }
 catch (  Throwable t) {
    generator.showErrorMessage(getInputNode(),myReferenceMacro.getNode(),"couldn't evaluate reference macro");
    Logger.getLogger(this.getClass()).error(t,myReferenceMacro.getNode());
    return null;
  }
  if (outputTargetNode == null) {
    return null;
  }
  if (outputTargetNode.getModel() == generator.getInputModel()) {
    SNode outputTargetNode_output=generator.findCopiedOutputNodeForInputNode(outputTargetNode);
    if (outputTargetNode_output != null) {
      return outputTargetNode_output;
    }
    generator.showWarningMessage(getOutputSourceNode(),"reference '" + role + "' to input model in output node "+ getOutputSourceNode().getDebugText());
    generator.showInformationMessage(outputTargetNode," -- referent node: " + outputTargetNode.getDebugText());
    generator.showInformationMessage(myReferenceMacro.getNode()," -- template node: " + myReferenceMacro.getNode().getDebugText());
    generator.getGeneratorSessionContext().addTransientModelToKeep(generator.getInputModel());
  }
  return outputTargetNode;
}
