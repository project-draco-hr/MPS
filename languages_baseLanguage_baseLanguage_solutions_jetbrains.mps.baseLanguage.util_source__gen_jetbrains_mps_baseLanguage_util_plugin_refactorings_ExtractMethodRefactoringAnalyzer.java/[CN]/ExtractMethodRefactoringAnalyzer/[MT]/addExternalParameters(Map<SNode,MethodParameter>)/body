{
  SNode list=SNodeOperations.getNodeAncestor(ListSequence.fromList(myPartToExtract).getElement(0),MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1068580123136l,"jetbrains.mps.baseLanguage.structure.StatementList"),false,false);
  while (SNodeOperations.isInstanceOf(SNodeOperations.getParent(list),MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1068580123157l,"jetbrains.mps.baseLanguage.structure.Statement"))) {
    list=SNodeOperations.getNodeAncestor(list,MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1068580123136l,"jetbrains.mps.baseLanguage.structure.StatementList"),false,false);
  }
  Program program=DataFlowManager.getInstance().buildProgramFor(list);
  Set<Instruction> nodeInstructions=SetSequence.fromSet(new HashSet<Instruction>());
  for (  SNode node : ListSequence.fromList(myPartToExtract)) {
    SetSequence.fromSet(nodeInstructions).addSequence(ListSequence.fromList(program.getInstructionsFor(node)));
  }
  AnalysisResult<Set<WriteInstruction>> reachability=program.analyze(new ReachingDefinitionsAnalyzer());
  for (  Instruction instruction : SetSequence.fromSet(nodeInstructions).where(new IWhereFilter<Instruction>(){
    public boolean accept(    Instruction it){
      return it instanceof ReadInstruction;
    }
  }
)) {
    final ReadInstruction read=(ReadInstruction)instruction;
    Set<WriteInstruction> writes=reachability.get(read);
    if (SetSequence.fromSet(writes).where(new IWhereFilter<WriteInstruction>(){
      public boolean accept(      WriteInstruction it){
        return it.getVariable() == read.getVariable();
      }
    }
).isEmpty()) {
      SNode declaration=((SNode)read.getVariable());
      if (MapSequence.fromMap(result).containsKey(declaration)) {
        continue;
      }
      if (SNodeOperations.isInstanceOf(declaration,MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1068390468200l,"jetbrains.mps.baseLanguage.structure.FieldDeclaration")) || SNodeOperations.isInstanceOf(declaration,MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1070462154015l,"jetbrains.mps.baseLanguage.structure.StaticFieldDeclaration"))) {
        continue;
      }
      SNode type=TypeChecker.getInstance().getRuntimeSupport().coerce_(TypeChecker.getInstance().getTypeOf(declaration),HUtil.createMatchingPatternByConceptFQName("jetbrains.mps.baseLanguage.structure.Type"),true);
      SNode reference;
      if (SNodeOperations.isInstanceOf(declaration,MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1068431474542l,"jetbrains.mps.baseLanguage.structure.VariableDeclaration"))) {
        reference=BehaviorReflection.invokeVirtual((Class<SNode>)((Class)Object.class),SNodeOperations.cast(declaration,MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1068431474542l,"jetbrains.mps.baseLanguage.structure.VariableDeclaration")),"virtual_createReference_1213877517482",new Object[]{});
      }
 else {
        reference=((SNode)read.getSource());
      }
      if (SNodeOperations.isInstanceOf(reference,MetaAdapterFactory.getConcept(new UUID(-935030926396207931l,-6610165693999523818l),1068431790191l,"jetbrains.mps.baseLanguage.structure.Expression"))) {
        MapSequence.fromMap(result).put(declaration,new MethodParameter(declaration,type,SPropertyOperations.getString(declaration,MetaAdapterFactory.getProperty(new UUID(-3554657779850784990l,-7236703803128771572l),1169194658468l,1169194664001l,"name")),reference));
      }
    }
  }
}
