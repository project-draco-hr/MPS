{
  if (myClosingBrace.isSelected() || myOpeningBrace.isSelected()) {
    notifyBraceSelected();
    return;
  }
  EditorCell deepestSelection=editor.getDeepestSelectedCell();
  EditorCell lastSelectableLeaf=findChild(CellFinders.LAST_SELECTABLE_LEAF);
  EditorCell firstSelectableLeaf=findChild(CellFinders.FIRST_SELECTABLE_LEAF);
  if (deepestSelection instanceof EditorCell_Brace) {
    EditorCell_Collection braceOwner=deepestSelection.getParent();
    if (braceOwner.myClosingBrace == deepestSelection && braceOwner.findChild(CellFinders.LAST_SELECTABLE_LEAF) == lastSelectableLeaf) {
      enableBraces();
      return;
    }
    if (braceOwner.myOpeningBrace == deepestSelection && braceOwner.findChild(CellFinders.FIRST_SELECTABLE_LEAF) == firstSelectableLeaf) {
      enableBraces();
      return;
    }
  }
  if (lastSelectableLeaf == deepestSelection || firstSelectableLeaf == deepestSelection) {
    enableBraces();
  }
 else {
    disableBraces();
  }
}
