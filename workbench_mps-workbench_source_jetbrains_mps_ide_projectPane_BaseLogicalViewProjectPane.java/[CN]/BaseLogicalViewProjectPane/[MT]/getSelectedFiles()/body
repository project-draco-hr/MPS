{
  List<VirtualFile> selectedFilesList=new LinkedList<VirtualFile>();
  List<SModel> descriptors=getSelectedModels();
  if (descriptors != null) {
    for (    SModel descriptor : descriptors) {
      selectedFilesList.addAll(new FileSystemModelHelper(descriptor).getVirtualFiles());
    }
  }
  List<SModule> modules=getSelectedModules();
  if (modules != null) {
    for (    SModule m : modules) {
      if (!(m instanceof AbstractModule))       continue;
      AbstractModule module=(AbstractModule)m;
      IFile home=module.getModuleSourceDir();
      if (home != null) {
        VirtualFile vfile=VirtualFileUtils.getProjectVirtualFile(home);
        if (vfile != null) {
          selectedFilesList.add(vfile);
        }
      }
      IFile ifile=module.getDescriptorFile();
      if (ifile != null) {
        VirtualFile vfile=VirtualFileUtils.getProjectVirtualFile(ifile);
        if (vfile != null) {
          selectedFilesList.add(vfile);
        }
      }
    }
  }
  if (selectedFilesList.isEmpty()) {
    return null;
  }
  return selectedFilesList.toArray(new VirtualFile[selectedFilesList.size()]);
}
