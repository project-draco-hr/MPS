{
  boolean currentGenerationOK=false;
  IPerformanceTracer ttrace=myOptions.getTracingMode() != GenerationOptions.TRACE_OFF ? new PerformanceTracer("model " + NameUtil.shortNameFromLongName(inputModel.getLongName())) : new NullPerformanceTracer();
  boolean traceTypes=myOptions.getTracingMode() == GenerationOptions.TRACE_TYPES;
  TypeChecker.getInstance().generationStarted(traceTypes ? ttrace : null);
  final GenerationSession generationSession=new GenerationSession(inputModel,invocationContext,this,myCancellationMonitor,myLogger,myTransientModelsComponent.getModule(module),ttrace,myOptions);
  monitor.start(inputModel.getLongName(),10);
  try {
    Logger.addLoggingHandler(generationSession.getLoggingHandler());
    if (!myGenerationHandler.canHandle(inputModel)) {
      LOG.error("Can't generate " + inputModel.getSModelReference().getSModelFqName());
      return true;
    }
    if (myLogger.needsInfo()) {
      myLogger.info("");
      myLogger.info("[model " + inputModel.getSModelReference().getSModelFqName() + (myOptions.isRebuildAll() ? ", rebuilding" : "")+ (myOptions.isGenerateInParallel() ? ", using " + myOptions.getNumberOfThreads() + " threads]" : "]"));
    }
    try {
      currentGenerationOK=GeneratorUtil.runReadInWrite(new GenerationComputable<Boolean>(){
        @Override public Boolean compute() throws GenerationCanceledException {
          GenerationStatus status=generationSession.generateModel(monitor.subTask(9));
          monitor.advance(0);
          status.setOriginalInputModel(inputModel);
          boolean currentGenerationOK=status.isOk();
          checkMonitorCanceled(monitor);
          currentGenerationOK=currentGenerationOK && myGenerationHandler.handleOutput(module,inputModel,status,invocationContext,monitor.subTask(1));
          monitor.advance(0);
          return currentGenerationOK;
        }
      }
);
    }
 catch (    GenerationFailureException e) {
    }
  }
  finally {
    Logger.removeLoggingHandler(generationSession.getLoggingHandler());
    generationSession.discardTransients();
    monitor.done();
    TypeChecker.getInstance().generationFinished();
  }
  String report=ttrace.report();
  if (report != null) {
    myLogger.trace(report);
  }
  return currentGenerationOK;
}
