{
  PQNode newQNode=new QNode();
  newQNode.setState(PQNode.State.PARTIAL);
  boolean firstPartial=true;
  for (  PQNode child : ListSequence.fromList(getChildren())) {
    if (child.getState() == PQNode.State.PARTIAL) {
      List<PQNode> partialChildren=child.getChildren();
      if (!(firstPartial)) {
        ((QNode)child).reverse();
        partialChildren=ListSequence.fromList(partialChildren).reversedList();
      }
      for (      PQNode partialChild : ListSequence.fromList(partialChildren)) {
        newQNode.addLastChild(partialChild);
      }
      firstPartial=false;
    }
 else {
      newQNode.addLastChild(child);
    }
  }
  return newQNode;
}
