{
  PQNode.State curState=initialState;
  QNode candidate=new QNode();
  candidate.getEdgesOrder().merge(getEdgesOrder());
  for (  PQNode child : ListSequence.fromList(getChildren())) {
    if (child.getState() != PQNode.State.PARTIAL) {
      candidate.addLastChild(child);
      curState=child.getState();
    }
 else {
      Iterator<PQNode> partialChildIrt;
      if (curState == PQNode.State.EMPTY) {
        candidate.getEdgesOrder().merge(child.getEdgesOrder());
        partialChildIrt=ListSequence.fromList(child.getChildren()).iterator();
      }
 else {
        child.getEdgesOrder().reverse();
        candidate.getEdgesOrder().merge(child.getEdgesOrder());
        partialChildIrt=ListSequence.fromList(child.getChildren()).reversedList().iterator();
      }
      while (partialChildIrt.hasNext()) {
        candidate.addLastChild(partialChildIrt.next());
      }
      curState=ListSequence.fromList(candidate.getChildren()).last().getState();
    }
  }
  return candidate;
}
