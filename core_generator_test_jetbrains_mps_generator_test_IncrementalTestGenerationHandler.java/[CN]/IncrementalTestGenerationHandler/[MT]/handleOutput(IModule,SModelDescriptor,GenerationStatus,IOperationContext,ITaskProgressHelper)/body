{
  myLastDependencies=null;
  IFile targetDir=FileSystem.getInstance().getFileByPath(module.getOutputFor(inputModel));
  Assert.assertTrue(status.isOk());
  Assert.assertTrue("should be called once",timesCalled++ == 0);
  if (myCheckIncremental) {
    GenerationDependencies dep=status.getDependencies();
    Assert.assertTrue("was not optimized",dep.getFromCacheCount() + dep.getSkippedCount() > 0);
  }
  if (status.isOk()) {
    myLastDependencies=status.getDependencies();
    myFilesDir=FileGenerationUtil.getDefaultOutputDir(inputModel,targetDir);
    IFile cachesDir=FileGenerationUtil.getDefaultOutputDir(inputModel,FileGenerationUtil.getCachesDir(targetDir));
    StreamHandler streamHandler=new CollectingStreamHandler(cachesDir);
    try {
      boolean result=new TextGenerator(streamHandler,BLDependenciesCache.getInstance().getGenerator(),GenerationDependenciesCache.getInstance().getGenerator()).handleOutput(invocationContext,status);
      Assert.assertTrue(result);
    }
  finally {
      streamHandler.dispose();
    }
  }
  return true;
}
