{
  final Map<String,String> macros=MapSequence.fromMap(new HashMap<String,String>());
  for (  IMapping<Object,Object> property : MapSequence.fromMap(System.getProperties())) {
    if (property.key() instanceof String && property.value() instanceof String) {
      String key=(String)property.key();
      String value=(String)property.value();
      if ((key != null && key.length() > 0) && key.startsWith(PATH_MACRO_PREFIX)) {
        CanonicalPath path=new CanonicalPath(value);
        if (path.isValidDirectory()) {
          MapSequence.fromMap(macros).put(key.substring(PATH_MACRO_PREFIX.length()),path.getValue());
        }
      }
    }
  }
  MapPathMacrosProvider provider=new MapPathMacrosProvider(macros);
  PathMacros.getInstance().addMacrosProvider(provider);
  return provider;
}
