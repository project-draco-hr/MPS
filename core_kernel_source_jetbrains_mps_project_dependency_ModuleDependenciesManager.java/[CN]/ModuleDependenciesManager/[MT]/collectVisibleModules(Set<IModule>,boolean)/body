{
  dependencies.add(myModule);
  for (  Dependency dependency : myModule.getDependencies()) {
    if (reexportOnly && !dependency.isReexport())     continue;
    IModule m=MPSModuleRepository.getInstance().getModule(dependency.getModuleRef());
    if (m == null)     continue;
    if (!dependencies.contains(m)) {
      m.getDependenciesManager().collectVisibleModules(dependencies,true);
    }
  }
  if (reexportOnly)   return;
  for (  ModuleReference ref : myModule.getUsedDevkitReferences()) {
    DevKit dk=MPSModuleRepository.getInstance().getDevKit(ref);
    if (dk == null)     continue;
    for (    Solution solution : dk.getAllExportedSolutions()) {
      if (!dependencies.contains(solution)) {
        solution.getDependenciesManager().collectVisibleModules(dependencies,true);
      }
    }
  }
  for (  Language l : getAllUsedLanguages()) {
    for (    StubSolution ss : l.getModuleDescriptor().getStubSolutions()) {
      ModuleReference solutionRef=new ModuleReference(ss.getName(),ss.getId());
      Solution s=MPSModuleRepository.getInstance().getSolution(solutionRef);
      if (!dependencies.contains(s)) {
        s.getDependenciesManager().collectVisibleModules(dependencies,true);
      }
    }
  }
}
