{
  if (path.contains("!")) {
    path=path.substring(0,path.indexOf("!"));
  }
synchronized (this) {
    if (cache == null) {
      ClassLoaderManager.getInstance().addReloadHandler(new ReloadAdapter(){
        public void onReload(){
synchronized (PathItemsReloadableCache.this) {
            MapSequence.fromMap(PathItemsReloadableCache.this.cache).clear();
            PathItemsReloadableCache.this.cache=null;
          }
          ClassLoaderManager.getInstance().removeReloadHandler(this);
        }
      }
);
      this.cache=MapSequence.fromMap(new HashMap<String,PathItem>());
    }
    PathItem pi=MapSequence.fromMap(cache).get(path);
    if (pi == null) {
      try {
        pi=pathItemClass.getDeclaredConstructor(String.class).newInstance(path);
      }
 catch (      Exception checked) {
        throw new PathItemsReloadableCache.CantCreatePathItemException("Exception while creating path item.\n" + "Path: " + path + "\nPath item class: "+ pathItemClass,checked);
      }
      MapSequence.fromMap(cache).put(path,pi);
    }
    return pi;
  }
}
