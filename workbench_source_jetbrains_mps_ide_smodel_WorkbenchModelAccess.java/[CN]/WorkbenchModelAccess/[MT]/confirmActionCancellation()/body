{
  if (((ApplicationEx)ApplicationManager.getApplication()).holdsReadLock()) {
    return true;
  }
  final int[] chosen=new int[1];
  final boolean ownRead=ownReadLock();
  final ProgressIndicator pi=ProgressManager.getInstance().getProgressIndicator();
  try {
    if (ownRead)     getReadLock().unlock();
    ThreadUtils.runInUIThreadAndWait(new Runnable(){
      @Override public void run(){
        if (pi instanceof ProgressWindow && !((ProgressWindow)pi).isBackgrounded()) {
          ((ProgressWindow)pi).background();
        }
        chosen[0]=Messages.showYesNoDialog("The current action is taking too long, do you want to abort it?","Unresponsive Process",null);
      }
    }
);
  }
  finally {
    if (ownRead)     getReadLock().lock();
  }
  return chosen[0] == 0;
}
