{
synchronized (TYPECHECKING_LOCK) {
    if (myCurrentlyChecking)     Collections.emptyList();
    try {
      this.myCurrentlyChecking=true;
      checkRoot(refreshTypes);
      applyNonTypesystemRules();
      final Set<Pair<SNode,List<IErrorReporter>>> nodesWithErrors=getTypechecking().getNodesWithErrors(true);
      final THashSet<Pair<SNode,List<IErrorReporter>>> result=new THashSet<Pair<SNode,List<IErrorReporter>>>(nodesWithErrors);
      result.addAll(getTypechecking().getNodesWithErrors(false));
      return result;
    }
  finally {
      this.myCurrentlyChecking=false;
    }
  }
}
