{
  ObjectInputStream is=new ObjectInputStream(new BufferedInputStream(stream));
  try {
    int version=is.readInt();
    if (version != VERSION) {
      return null;
    }
    String modelReference=is.readUTF();
    SModel m=new TransientSModel(SModelReference.fromString(modelReference));
    m.setLoading(true);
    try {
      List<SNode> roots=loadNodes(m,is);
      for (      SNode root : roots) {
        m.addRoot(root);
      }
    }
 catch (    ClassNotFoundException ex) {
      throw new IOException("cannot load: " + ex.toString());
    }
    return m;
  }
  finally {
    is.close();
  }
}
