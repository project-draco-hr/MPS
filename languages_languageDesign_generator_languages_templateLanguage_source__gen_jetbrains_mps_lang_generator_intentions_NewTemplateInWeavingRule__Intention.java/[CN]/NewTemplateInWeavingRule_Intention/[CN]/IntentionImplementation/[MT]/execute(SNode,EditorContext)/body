{
  SNode applicableConcept=SLinkOperations.getTarget(node,MetaAdapterFactory.getReferenceLink(0xb401a68083254110L,0x8fd384331ff25befL,0x10fc0b64647L,0x10fc0b6e730L,"applicableConcept"));
  String name=CreateFromUsageUtil.getText(editorContext);
  if (name == null || name.length() == 0) {
    name="weave_";
    if (applicableConcept != null) {
      name+=SPropertyOperations.getString(applicableConcept,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name"));
    }
  }
  SNode t=SNodeFactoryOperations.createNewRootNode(SNodeOperations.getModel(node),SNodeFactoryOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0xb401a68083254110L,0x8fd384331ff25befL,0xfe43cb41d0L,"jetbrains.mps.lang.generator.structure.TemplateDeclaration")),null);
  SPropertyOperations.set(t,MetaAdapterFactory.getProperty(0xceab519525ea4f22L,0x9b92103b95ca8c0cL,0x110396eaaa4L,0x110396ec041L,"name"),name);
  SLinkOperations.setTarget(t,MetaAdapterFactory.getReferenceLink(0xb401a68083254110L,0x8fd384331ff25befL,0xfe43cb41d0L,0x1100343ad9eL,"applicableConcept"),applicableConcept);
  MacroIntentionsUtil.copyVirtualPackage(t,node);
  SNode contextNodeType=TypeChecker.getInstance().getTypeOf(SLinkOperations.getTarget(SNodeOperations.cast(node,MetaAdapterFactory.getConcept(0xb401a68083254110L,0x8fd384331ff25befL,0x10fc0d8c573L,"jetbrains.mps.lang.generator.structure.Weaving_MappingRule")),MetaAdapterFactory.getContainmentLink(0xb401a68083254110L,0x8fd384331ff25befL,0x10fc0d8c573L,0x113d0a12fc5L,"contextNodeQuery")));
  if (SNodeOperations.isInstanceOf(contextNodeType,MetaAdapterFactory.getConcept(0x7866978ea0f04cc7L,0x81bc4d213d9375e1L,0x108f968b3caL,"jetbrains.mps.lang.smodel.structure.SNodeType"))) {
    SNode contextNodeConcept=SLinkOperations.getTarget(SNodeOperations.cast(contextNodeType,MetaAdapterFactory.getConcept(0x7866978ea0f04cc7L,0x81bc4d213d9375e1L,0x108f968b3caL,"jetbrains.mps.lang.smodel.structure.SNodeType")),MetaAdapterFactory.getReferenceLink(0x7866978ea0f04cc7L,0x81bc4d213d9375e1L,0x108f968b3caL,0x1090e46ca51L,"concept"));
    if (contextNodeConcept != SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.core.structure.BaseConcept")) {
      if (!(SNodeOperations.isInstanceOf(contextNodeConcept,MetaAdapterFactory.getConcept(0xc72da2b97cce4447L,0x8389f407dc1158b7L,0x1103556dcafL,"jetbrains.mps.lang.structure.structure.InterfaceConceptDeclaration")))) {
        SLinkOperations.setTarget(t,MetaAdapterFactory.getContainmentLink(0xb401a68083254110L,0x8fd384331ff25befL,0xfe43cb41d0L,0xfe43de823bL,"contentNode"),SNodeFactoryOperations.createNewNode(SNodeFactoryOperations.asInstanceConcept(contextNodeConcept),null));
      }
    }
  }
  SNode tr=SNodeFactoryOperations.setNewChild(node,MetaAdapterFactory.getContainmentLink(0xb401a68083254110L,0x8fd384331ff25befL,0x10fc0d8c573L,0x1104fd38a1cL,"ruleConsequence"),SNodeFactoryOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0xb401a68083254110L,0x8fd384331ff25befL,0x11013906056L,"jetbrains.mps.lang.generator.structure.TemplateDeclarationReference")));
  SLinkOperations.setTarget(tr,MetaAdapterFactory.getReferenceLink(0xb401a68083254110L,0x8fd384331ff25befL,0x17e941d108ce3120L,0x17e941d108ce3173L,"template"),t);
  SelectionUtil.selectCell(editorContext,tr,SelectionManager.FIRST_EDITABLE_CELL);
}
