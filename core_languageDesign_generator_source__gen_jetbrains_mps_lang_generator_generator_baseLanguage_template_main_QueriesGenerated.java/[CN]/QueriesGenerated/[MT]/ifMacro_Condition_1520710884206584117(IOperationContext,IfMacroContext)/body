{
  boolean directRef=SNodeOperations.getModel(((SNode)_context.getVariable("template"))) == SNodeOperations.getModel(_context.getNode());
  if (directRef && !(SNodeOperations.isInstanceOf(((SNode)_context.getVariable("template")),"jetbrains.mps.lang.generator.structure.TemplateDeclaration"))) {
    if (SLinkOperations.getTarget(((SNode)_context.getVariable("template")),AttributesRolesUtil.childRoleFromAttributeRole("rootTemplateAnnotation"),true) == null) {
      _context.showErrorMessage(_context.getNode(),"cannot refer template root without template annotation");
      return false;
    }
  }
  return directRef;
}
