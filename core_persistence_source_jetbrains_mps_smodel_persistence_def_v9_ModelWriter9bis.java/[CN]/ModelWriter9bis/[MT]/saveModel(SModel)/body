{
  myMetaInfo=new IdInfoCollector();
  myMetaInfo.fill(sourceModel.getRootNodes());
  myImportsHelper=new ImportsHelper(sourceModel.getReference());
  Element rootElement=new Element(ModelPersistence.MODEL);
  rootElement.setAttribute(ModelPersistence9.REF,myIdEncoder.toText(sourceModel.getReference()));
  saveModelProperties(sourceModel,rootElement);
  rootElement.addContent(buildRegistry());
  for (  SNode root : sourceModel.getRootNodes()) {
    rootElement.addContent(saveNode(root));
  }
  return new Document(rootElement);
}
