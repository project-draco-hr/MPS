{
  final Set<VirtualFile> files=new HashSet<VirtualFile>();
  jetbrains.mps.project.Project mpsProject=ProjectHelper.toMPSProject(project);
  if (mpsProject == null) {
    return files;
  }
  for (  ModuleReference moduleReference : mpsProject.getModuleReferences()) {
    IModule module=ModuleRepositoryFacade.getInstance().getModule(moduleReference);
    for (    final SModelRoot modelRoot : module.getSModelRoots()) {
      ModelAccess.instance().runReadAction(new Runnable(){
        public void run(){
          VirtualFile file=VirtualFileUtils.getVirtualFile(modelRoot.getPath());
          if (file != null) {
            files.add(file);
          }
        }
      }
);
    }
  }
  return files;
}
