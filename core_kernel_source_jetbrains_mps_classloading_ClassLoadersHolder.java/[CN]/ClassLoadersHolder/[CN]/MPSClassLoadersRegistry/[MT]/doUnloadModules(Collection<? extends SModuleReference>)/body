{
  Collection<SModuleReference> unloaded=new LinkedHashSet<SModuleReference>();
  for (  SModuleReference mRef : toUnload) {
    if (!myMPSLoadableModules.containsKey(mRef)) {
      LOG.error("Illegal state: module was not loaded " + mRef);
    }
 else {
      myMPSLoadableModules.remove(mRef);
      unloaded.add(mRef);
    }
  }
  removeClassLoaders(unloaded);
  return unloaded;
}
