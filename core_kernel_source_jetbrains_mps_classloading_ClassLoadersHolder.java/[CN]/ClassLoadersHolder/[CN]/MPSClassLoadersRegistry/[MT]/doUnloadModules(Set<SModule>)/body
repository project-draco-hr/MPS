{
  Set<SModule> unloaded=new LinkedHashSet<SModule>();
  for (  SModule module : toUnload) {
    if (!myMPSLoadableModules.containsKey(module)) {
      LOG.error("Illegal state: module was not loaded " + module);
    }
 else {
      myMPSLoadableModules.remove(module);
      unloaded.add(module);
    }
  }
  removeClassLoaders(unloaded);
  return unloaded;
}
