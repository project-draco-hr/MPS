{
  try {
    MyReadAccessListener listener=new MyReadAccessListener();
    NodeReadAccessCaster.setNodeAccessListener(listener);
    checkTypes(node);
    myCheckedRoots.add(node);
    for (    SNode nodeToDependOn : listener.getNodesToDependOn()) {
      Set<SNode> dependentRoots=myNodesToDependentRoots.get(nodeToDependOn);
      if (dependentRoots == null) {
        dependentRoots=new HashSet<SNode>();
        myNodesToDependentRoots.put(nodeToDependOn,dependentRoots);
      }
      dependentRoots.add(node);
    }
    SModel model=node.getModel();
    model.removeSModelCommandListener(myListener);
    model.removeSModelListener(myListener);
    model.addSModelCommandListener(myListener);
    model.addSModelListener(myListener);
  }
  finally {
    NodeReadAccessCaster.removeNodeAccessListener();
  }
}
