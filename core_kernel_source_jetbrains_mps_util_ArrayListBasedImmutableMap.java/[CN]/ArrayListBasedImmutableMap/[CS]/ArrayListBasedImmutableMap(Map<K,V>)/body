{
  keys=new Object[map.size()];
  values=new Object[map.size()];
  int i=0;
  for (  Map.Entry<K,V> entry : map.entrySet()) {
    keys[i]=entry.getKey();
    values[i++]=entry.getValue();
  }
  keySet=new ArrayBasedImmutableSet<K>(keys);
}
