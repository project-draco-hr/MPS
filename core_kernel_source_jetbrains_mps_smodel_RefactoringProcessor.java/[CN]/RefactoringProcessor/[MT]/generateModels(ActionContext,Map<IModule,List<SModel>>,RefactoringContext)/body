{
  final RefactoringNodeMembersAccessModifier modifier=new RefactoringNodeMembersAccessModifier();
  refactoringContext.setUpMembersAccessModifier(modifier);
  for (  final IModule sourceModule : sourceModels.keySet()) {
    ModelAccess.instance().runWriteAction(new Runnable(){
      public void run(){
        try {
          IOperationContext operationContext=new ModuleContext(sourceModule,context.getOperationContext().getMPSProject());
          final List<SModel> models=sourceModels.get(sourceModule);
          modifier.addModelsToModify(models);
          SNode.setNodeMemeberAccessModifier(modifier);
          List<SModelDescriptor> descriptors=new ArrayList<SModelDescriptor>();
          for (          SModel model : models) {
            descriptors.add(model.getModelDescriptor());
          }
          new GeneratorManager(operationContext.getComponent(Project.class)).generateModels(descriptors,operationContext,IGenerationType.FILES,new EmptyProgressIndicator(),new DefaultMessageHandler(operationContext.getMPSProject()));
        }
  finally {
          SNode.setNodeMemeberAccessModifier(null);
        }
      }
    }
);
  }
}
