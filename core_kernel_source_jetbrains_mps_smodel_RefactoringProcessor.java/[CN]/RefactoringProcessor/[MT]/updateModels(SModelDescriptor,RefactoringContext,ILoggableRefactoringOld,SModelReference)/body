{
  SModel model=modelDescriptor.getSModel();
  refactoringContext.computeCaches();
  SearchResults usages=refactoringContext.getUsages();
  List<SModel> modelsToUpdate=refactoring.getModelsToUpdate(refactoringContext);
  if (refactoring.doesUpdateModel()) {
    if (!refactoringContext.isLocal()) {
      writeInLogAndUpdateModels(initialModelReference,model,refactoringContext);
    }
 else {
      Set<SModel> modelsToProcess=new LinkedHashSet<SModel>();
      if (usages != null) {
        modelsToProcess.addAll(usages.getModelsWithResults());
      }
      modelsToProcess.addAll(modelsToUpdate);
      for (      SModel anotherModel : modelsToProcess) {
        processModel(anotherModel,model,refactoringContext);
      }
    }
  }
}
