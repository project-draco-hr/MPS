{
  SNode mpsLayout=SConceptOperations.createNewNode("jetbrains.mps.build.packaging.structure.MPSLayout",null);
  SModel targetSModel=targetModelDescriptor.getSModel();
  targetSModel.addRoot(mpsLayout);
  SPropertyOperations.set(mpsLayout,"name",name);
  String result=Macros.mpsHomeMacros().shrinkPath(basedir,new File("")).replace("\\",File.separator);
  int index=result.lastIndexOf("}");
  if (index > -1) {
    String macro=result.substring(result.indexOf("{") + 1,index);
    SLinkOperations.setTarget(mpsLayout,"baseDirectory",PackagingLanguageGenerator.createBasedirPath(macro,result.substring(index + 2)),true);
  }
 else {
    SLinkOperations.setTarget(mpsLayout,"baseDirectory",PackagingLanguageGenerator.createBasedirPath("",basedir),true);
  }
  SPropertyOperations.set(mpsLayout,"compile","" + (true));
  SPropertyOperations.set(ListSequence.fromList(SLinkOperations.getTargets(mpsLayout,"configuration",true)).first(),"name","default");
  SNode zip=SConceptOperations.createNewNode("jetbrains.mps.build.packaging.structure.Zip",null);
  SLinkOperations.setTarget(zip,"title",PackagingLanguageGenerator.createSimpleString(name + ".zip"),true);
  SLinkOperations.addChild(mpsLayout,"component",zip);
  SNode folder=PackagingLanguageGenerator.createFolder(name);
  SLinkOperations.addChild(zip,"entry",folder);
  BuildGeneratorImpl.createContent(selectedData,folder,targetSModel);
  targetModelDescriptor.save();
  MPSEditorOpener editorOpener=this.myProject.getComponent(MPSEditorOpener.class);
  editorOpener.openNode(mpsLayout);
}
