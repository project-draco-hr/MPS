{
  SNode mpsLayout=SConceptOperations.createNewNode("jetbrains.mps.build.packaging.structure.MPSLayout",null);
  SModel targetSModel=targetModelDescriptor.getSModel();
  targetSModel.addRoot(mpsLayout);
  SPropertyOperations.set(mpsLayout,"name",name);
  SNode basedirPath;
  String result=Macros.mpsHomeMacros().shrinkPath(basedir,new File("")).replace("\\",File.separator);
  int index=result.lastIndexOf("}");
  if (index > -1) {
    String macro=result.substring(result.indexOf("{") + 1,index);
    basedirPath=PackagingLanguageGenerator.createBasedirPath(macro,result.substring(index + 2));
  }
 else {
    basedirPath=PackagingLanguageGenerator.createBasedirPath("",basedir);
  }
  SLinkOperations.setTarget(mpsLayout,"baseDirectory",basedirPath,true);
  SPropertyOperations.set(mpsLayout,"compile","" + (true));
  SPropertyOperations.set(ListSequence.fromList(SLinkOperations.getTargets(mpsLayout,"configuration",true)).first(),"name","default");
  SNode zip=SConceptOperations.createNewNode("jetbrains.mps.build.packaging.structure.Zip",null);
  SLinkOperations.setTarget(zip,"title",PackagingLanguageGenerator.createSimpleString(name + ".zip"),true);
  ListSequence.fromList(SLinkOperations.getTargets(mpsLayout,"component",true)).addElement(zip);
  SNode folder=PackagingLanguageGenerator.createFolder(name);
  ListSequence.fromList(SLinkOperations.getTargets(zip,"entry",true)).addElement(folder);
  BuildGeneratorImpl.createContent(selectedData,folder,targetSModel);
  return mpsLayout;
}
