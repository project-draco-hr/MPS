{
  for (  IMapping<SNode,SNode> m : MapSequence.fromMap(mapping)) {
    SNode input=m.key();
    SNode output=m.value();
    for (    SReference ref : input.getReferencesIterable()) {
      SNode targetNode=ref.getTargetNodeSilently();
      if (targetNode == null) {
        messageHandler.handle(new Message(MessageKind.ERROR,"broken reference `" + ref.getRole() + "' in "+ input.getDebugText()));
        continue;
      }
      if (MapSequence.fromMap(mapping).containsKey(targetNode)) {
        output.setReferent(ref.getRole(),MapSequence.fromMap(mapping).get(targetNode));
      }
 else {
        output.setReferent(ref.getRole(),targetNode);
      }
    }
  }
  this.mapping=null;
  this.reverseMapping=null;
}
