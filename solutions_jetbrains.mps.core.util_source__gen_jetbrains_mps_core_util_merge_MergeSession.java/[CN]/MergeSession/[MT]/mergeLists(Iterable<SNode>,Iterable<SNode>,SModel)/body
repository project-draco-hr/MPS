{
  final Map<String,List<SNode>> existingNodes=MapSequence.fromMap(new HashMap<String,List<SNode>>());
  Sequence.fromIterable(existing).visitAll(new IVisitor<SNode>(){
    public void visit(    SNode it){
      String signature=getSignature(it);
      if (!(MapSequence.fromMap(existingNodes).containsKey(signature))) {
        MapSequence.fromMap(existingNodes).put(signature,ListSequence.fromList(new LinkedList<SNode>()));
      }
      ListSequence.fromList(MapSequence.fromMap(existingNodes).get(signature)).addElement(it);
    }
  }
);
  final List<SNode> result=new ArrayList<SNode>();
  Sequence.fromIterable(created).visitAll(new IVisitor<SNode>(){
    public void visit(    SNode it){
      String signature=getSignature(it);
      SNode existingNode=(MapSequence.fromMap(existingNodes).containsKey(signature) ? ListSequence.fromList(MapSequence.fromMap(existingNodes).get(signature)).removeElementAt(0) : null);
      ListSequence.fromList(result).addElement(merge(existingNode,it,newmodel));
    }
  }
);
  return result;
}
