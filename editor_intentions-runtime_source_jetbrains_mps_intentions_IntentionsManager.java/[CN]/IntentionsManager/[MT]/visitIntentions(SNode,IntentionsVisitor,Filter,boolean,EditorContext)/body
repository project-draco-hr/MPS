{
  if (node.getModel() == null) {
    return true;
  }
  LanguageRegistry languageRegistry=LanguageRegistry.getInstance(editorContext.getRepository());
  ArrayList<IntentionAspectDescriptor> activeIntentionAspects=new ArrayList<IntentionAspectDescriptor>();
  ArrayList<MigrationRefactoringIntentions> activeIntentionsFromMigrationScripts=new ArrayList<MigrationRefactoringIntentions>();
  for (  SLanguage l : new SLanguageHierarchy(languageRegistry,SModelOperations.getAllLanguageImports(node.getModel())).getExtended()) {
    final LanguageRuntime lr=languageRegistry.getLanguage(l);
    if (lr == null) {
      continue;
    }
    final IntentionAspectDescriptor intentionAspect=lr.getAspect(IntentionAspectDescriptor.class);
    if (intentionAspect != null) {
      activeIntentionAspects.add(intentionAspect);
    }
    final ScriptAspectDescriptor scriptsAspect=lr.getAspect(ScriptAspectDescriptor.class);
    if (scriptsAspect != null) {
      activeIntentionsFromMigrationScripts.add(new MigrationRefactoringIntentions(lr,scriptsAspect));
    }
  }
  for (  SAbstractConcept concept : new UniqueIterator<SAbstractConcept>(new DepthFirstConceptIterator(node.getConcept()))) {
    ArrayList<IntentionFactory> intentionsForConcept=new ArrayList<IntentionFactory>();
    for (    IntentionAspectDescriptor intentionAspect : activeIntentionAspects) {
      final Collection<IntentionFactory> intentions=intentionAspect.getIntentions(concept);
      if (intentions == null) {
        continue;
      }
      intentionsForConcept.addAll(intentions);
    }
    for (    MigrationRefactoringIntentions refactoringIntentions : activeIntentionsFromMigrationScripts) {
      intentionsForConcept.addAll(refactoringIntentions.getIntentions(concept));
    }
    for (    IntentionFactory intentionFactory : intentionsForConcept) {
      if (isAncestor && !intentionFactory.isAvailableInChildNodes()) {
        continue;
      }
      if (!filter.accept(intentionFactory) || !intentionFactory.isApplicable(node,editorContext)) {
        continue;
      }
      if (!visitor.visit(intentionFactory)) {
        return false;
      }
    }
  }
  return true;
}
