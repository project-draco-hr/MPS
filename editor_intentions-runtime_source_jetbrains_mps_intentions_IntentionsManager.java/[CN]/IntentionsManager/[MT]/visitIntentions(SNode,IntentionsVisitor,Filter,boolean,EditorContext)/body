{
  SModelBase model=(SModelBase)node.getModel();
  if (model == null)   return true;
  Collection<SModuleReference> languages=model.getModelDepsManager().getAllImportedLanguages();
  Set<String> langNames=new HashSet<String>();
  for (  SModuleReference l : languages) {
    langNames.add(l.getModuleName());
  }
  for (  String conceptId : LanguageHierarchyCache.getAncestorsNames(node.getConcept().getQualifiedName())) {
    Map<String,Set<IntentionFactory>> concept2FactoriesMap=isAncestor ? myConcept2IntentionFactoriesAvailableInChildNodes : myConcept2IntentionFactories;
    if (concept2FactoriesMap.containsKey(conceptId)) {
      for (      IntentionFactory intentionFactory : concept2FactoriesMap.get(conceptId)) {
        if (!langNames.contains(intentionFactory.getLanguageFqName()))         continue;
        if (!filter.accept(intentionFactory) || !intentionFactory.isApplicable(node,editorContext)) {
          continue;
        }
        if (!visitor.visit(intentionFactory)) {
          return false;
        }
      }
    }
    if (myIntentions.containsKey(conceptId)) {
      for (      Intention intention : myIntentions.get(conceptId)) {
        if (!langNames.contains(intention.getLanguageFqName()))         continue;
        if (isAncestor && !intention.isAvailableInChildNodes()) {
          continue;
        }
        if (!filter.accept(intention) || !intention.isApplicable(node,editorContext)) {
          continue;
        }
        if (!visitor.visit(intention)) {
          return false;
        }
      }
    }
  }
  return true;
}
