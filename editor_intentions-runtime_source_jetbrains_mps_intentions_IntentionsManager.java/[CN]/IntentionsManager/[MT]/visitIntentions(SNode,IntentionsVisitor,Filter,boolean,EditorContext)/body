{
  for (  String conceptId : LanguageHierarchyCache.getAncestorsNames(node.getConcept().getId())) {
    Map<String,Set<IntentionFactory>> concept2FactoriesMap=isAncestor ? myConcept2IntentionFactoriesAvailableInChildNodes : myConcept2IntentionFactories;
    if (concept2FactoriesMap.containsKey(conceptId)) {
      for (      IntentionFactory intentionFactory : concept2FactoriesMap.get(conceptId)) {
        if (!filter.accept(intentionFactory) || !intentionFactory.isApplicable(node,editorContext)) {
          continue;
        }
        if (!visitor.visit(intentionFactory)) {
          return false;
        }
      }
    }
    if (myIntentions.containsKey(conceptId)) {
      for (      Intention intention : myIntentions.get(conceptId)) {
        if (isAncestor && !intention.isAvailableInChildNodes()) {
          continue;
        }
        if (!filter.accept(intention) || !intention.isApplicable(node,editorContext)) {
          continue;
        }
        if (!visitor.visit(intention)) {
          return false;
        }
      }
    }
  }
  return true;
}
