{
  try {
    Set<String> toReload=new LinkedHashSet<String>(myToAdd);
    toReload.retainAll(myToRemove);
    Set<String> toRemove=new LinkedHashSet<String>(myToRemove);
    toRemove.removeAll(myToAdd);
    Set<String> toAdd=new LinkedHashSet<String>(myToAdd);
    toAdd.removeAll(myToRemove);
    if (!toReload.isEmpty()) {
      String[] reloadList=toReload.toArray(new String[0]);
      if (!myUseOSGI) {
        myRuntimeEnvironment.reload(reloadList);
      }
 else {
      }
    }
    if (!toRemove.isEmpty()) {
      if (!myUseOSGI) {
        String[] unloadList=toRemove.toArray(new String[0]);
        myRuntimeEnvironment.unload(unloadList);
      }
 else {
      }
    }
    if (!toAdd.isEmpty()) {
      for (      String moduleUID : toAdd) {
        addModule(moduleUID);
      }
    }
  }
  finally {
    myToRemove.clear();
    myToAdd.clear();
  }
}
