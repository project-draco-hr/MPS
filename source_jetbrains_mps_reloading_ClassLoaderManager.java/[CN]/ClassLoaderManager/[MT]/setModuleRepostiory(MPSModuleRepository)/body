{
  repository.addModuleRepositoryListener(new ModuleRepositoryListener(){
    public void moduleAdded(    IModule module){
      if (myRuntimeEnvironment.get(module.getModuleUID()) == null) {
        if (!myToRemove.contains(module.getModuleUID())) {
          addModule(module.getModuleUID());
        }
 else {
          myToAdd.add(module.getModuleUID());
        }
      }
 else {
        myToAdd.add(module.getModuleUID());
      }
    }
    public void beforeModuleRemoved(    IModule module){
    }
    public void moduleRemoved(    IModule module){
      myToRemove.add(module.getModuleUID());
      if (CommandProcessor.instance().getCurrentCommandKind() == CommandKind.GENERATION) {
        handleAddAndRemoves();
      }
    }
    public void moduleInitialized(    IModule module){
    }
  }
);
}
