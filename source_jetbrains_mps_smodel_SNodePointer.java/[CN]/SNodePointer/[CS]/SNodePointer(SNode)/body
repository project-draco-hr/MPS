{
  if (node.isRegistered()) {
    myModelUID=node.getModel().getUID();
    myNodeId=node.getSNodeId();
    registerPointer(this);
  }
 else {
    myNodeRef=new WeakReference<SNode>(node);
    CommandProcessor.instance().addCommandListener(new CommandAdapter(){
      public void commandFinished(      @NotNull CommandEvent event){
        SNode node=myNodeRef.get();
        if (node == null || node.isRegistered()) {
          CommandProcessor.instance().removeCommandListener(this);
          myNodeRef=null;
          if (node != null) {
            myModelUID=node.getModel().getUID();
            myNodeId=node.getSNodeId();
            registerPointer(SNodePointer.this);
          }
        }
      }
    }
);
  }
}
