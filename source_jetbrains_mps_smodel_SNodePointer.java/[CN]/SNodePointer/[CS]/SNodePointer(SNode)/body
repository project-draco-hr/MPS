{
  myNodeRef=new WeakReference<SNode>(node);
  CommandProcessor.instance().addCommandListener(new CommandAdapter(){
    public void commandFinished(    @NotNull CommandEvent event){
      SNode node=myNodeRef.get();
      if (node == null || node.isRegistered()) {
        CommandProcessor.instance().removeCommandListener(this);
      }
      if (node != null && node.isRegistered()) {
        if (node.getModel().getModelDescriptor() != null) {
          myNodeRef=null;
          myModelUID=node.getModel().getUID();
          myNodeId=node.getSNodeId();
          registerPointer(SNodePointer.this);
        }
      }
    }
  }
);
}
