{
  final Iterable<Integer> numbers=SimpleParallelForSample.createNumbers();
  final String value="Set me to null to see that potential NPE is correctly detected inside a parallel for loop";
{
    final CountDownLatch latch=new CountDownLatch(Sequence.fromIterable(numbers).count());
    final List<Exception> exceptions=new CopyOnWriteArrayList<Exception>();
    for (    final int a : Collections.unmodifiableList(ListSequence.fromListWithValues(new ArrayList<Integer>(),numbers))) {
      final int localA=a;
      Runnable runnable=new Runnable(){
        public void run(){
          try {
            SimpleParallelForSample.Logger.log("Current value: " + localA);
            SimpleParallelForSample.sleep(localA);
            value.length();
            SimpleParallelForSample.Logger.log("Done with " + localA);
          }
 catch (          RuntimeException e) {
            ListSequence.fromList(exceptions).addElement(e);
          }
 finally {
            latch.countDown();
          }
        }
      }
;
      new Thread(runnable).start();
    }
    try {
      latch.await();
    }
 catch (    InterruptedException e) {
      ListSequence.fromList(exceptions).addElement(e);
    }
    if (ListSequence.fromList(exceptions).isNotEmpty()) {
      throw new ParallelLoopException("Some parallel calculations failed",exceptions);
    }
  }
}
