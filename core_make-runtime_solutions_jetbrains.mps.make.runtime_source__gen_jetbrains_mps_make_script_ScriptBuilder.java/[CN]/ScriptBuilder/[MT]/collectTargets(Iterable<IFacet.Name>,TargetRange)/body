{
  List<ITarget> allTargets=ListSequence.<ITarget>fromList(Sequence.<IFacet.Name>fromIterable(sortedFacets).<ITarget>translate(new ITranslator2<IFacet.Name,ITarget>(){
    public Iterable<ITarget> translate(    IFacet.Name fname){
      return MapSequence.<IFacet.Name,IFacet>fromMap(facetsView).get(fname).targets();
    }
  }
).toListSequence()).reversedList();
  for (  ITarget trg : ListSequence.<ITarget>fromList(allTargets)) {
    if (SetSequence.<ITarget.Name>fromSet(requestedTargets).contains(trg.getName())) {
      tr.addTarget(trg);
    }
  }
  for (  ITarget.Name tn : SetSequence.<ITarget.Name>fromSet(requestedTargets)) {
    if (!(tr.hasTarget(tn))) {
      LOG.error("target not found: " + tn);
      error(tn,"target not found: " + tn);
    }
  }
  if (ListSequence.<ValidationError>fromList(errors).isNotEmpty()) {
    return;
  }
  tr.addRelatedPrecursors(Sequence.<IFacet>fromIterable(MapSequence.fromMap(facetsView).values()).<ITarget>translate(new ITranslator2<IFacet,ITarget>(){
    public Iterable<ITarget> translate(    IFacet fct){
      return fct.targets();
    }
  }
));
}
