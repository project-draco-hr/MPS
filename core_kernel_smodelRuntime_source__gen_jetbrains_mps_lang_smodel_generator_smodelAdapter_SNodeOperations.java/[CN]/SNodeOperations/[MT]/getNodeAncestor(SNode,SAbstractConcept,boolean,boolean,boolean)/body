{
  if (node == null) {
    return null;
  }
  int metaLevel=(sameMetaLevel ? SModelUtil_new.getMetaLevel(node) : 0);
  if (root) {
    SNode rootParent=node.getContainingRoot();
    if (rootParent.getModel() != null && isInstanceOf(rootParent,ancestorConcept)) {
      if (!(sameMetaLevel) || SModelUtil_new.getMetaLevel(rootParent) == metaLevel) {
        return rootParent;
      }
    }
    return null;
  }
  SNode outputNode;
  if (inclusion) {
    outputNode=node;
  }
 else {
    outputNode=node.getParent();
  }
  if (outputNode == null) {
    return null;
  }
  if (isInstanceOf(outputNode,ancestorConcept)) {
    if (!(sameMetaLevel) || SModelUtil_new.getMetaLevel(outputNode) == metaLevel) {
      return outputNode;
    }
  }
  while ((outputNode=outputNode.getParent()) != null) {
    if (isInstanceOf(outputNode,ancestorConcept)) {
      if (!(sameMetaLevel) || SModelUtil_new.getMetaLevel(outputNode) == metaLevel) {
        break;
      }
    }
  }
  return outputNode;
}
