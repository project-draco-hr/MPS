{
  File tmp=jetbrains.mps.util.FileUtil.createTmpDir();
  AbstractVcsHelperImpl.writeContentsToFile(ModelUtils.modelToBytes(inMemory),modelFile.getName(),tmp,FS_MEMORY_MERGE_VERSION.MEMORY.getSuffix());
  FileUtil.copy(modelFile.toFile(),new File(tmp.getAbsolutePath() + File.separator + modelFile.getName()+ "."+ FS_MEMORY_MERGE_VERSION.FILE_SYSTEM.getSuffix()));
  File zipfile=ModelUtils.chooseZipFileNameForModelFile(modelFile.getPath());
  jetbrains.mps.util.FileUtil.zip(tmp,zipfile);
  jetbrains.mps.util.FileUtil.delete(tmp);
  return zipfile;
}
