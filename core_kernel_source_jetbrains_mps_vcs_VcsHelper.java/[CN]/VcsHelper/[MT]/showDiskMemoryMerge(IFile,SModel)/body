{
  try {
    File backupFile=null;
    Application application=ApplicationManager.getApplication();
    if (application.isUnitTestMode() || application.isHeadlessEnvironment()) {
      backupFile=doBackup(modelFile,inMemory);
    }
    String message="Model " + inMemory + " has conflicting changes.\n"+ "It was modified on disk and in memory at the same time.\n"+ "Fear not, backup of both versions was created and saved to:\n"+ (backupFile == null ? "test_backup" : backupFile.getAbsolutePath())+ "\n"+ "Which version to use?";
    String title="Model " + inMemory + " has conflicting changes.";
    String diskVersion="Load Disk Version";
    String memoryVersion="Save Memory Version";
    String[] options={diskVersion,memoryVersion};
    int result=com.intellij.openapi.ui.Messages.showDialog(message,title,options,0,com.intellij.openapi.ui.Messages.getQuestionIcon());
    if (result == -1)     return showDiskMemoryMerge(modelFile,inMemory);
    if (options[result].equals(diskVersion)) {
      return false;
    }
 else {
      return true;
    }
  }
 catch (  IOException e) {
    LOG.error(e);
    throw new RuntimeException(e);
  }
}
