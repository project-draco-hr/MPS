{
  final Wrappers._T<SModel> modelCopy=new Wrappers._T<SModel>();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      modelCopy.value=PersistenceUtil.loadModel(PersistenceUtil.saveModel(getTestModel(),getDefaultExt()),getDefaultExt());
    }
  }
);
  makeChangeAndWait(todo);
  final Wrappers._T<ModelChangeSet> diff=new Wrappers._T<ModelChangeSet>();
  ModelAccess.instance().runReadAction(new Runnable(){
    public void run(){
      diff.value=ChangeSetBuilder.buildChangeSet(modelCopy.value,getTestModel());
    }
  }
);
  Assert.assertEquals(ListSequence.fromList(diff.value.getModelChanges()).count(),changes.length);
  for (int i=0; i < changes.length; i++) {
    ModelChange real=ListSequence.fromList(diff.value.getModelChanges()).getElement(i);
    ModelChange expected=changes[i];
    Assert.assertEquals(real.toString(),expected.toString());
  }
}
