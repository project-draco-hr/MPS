{
  IdeMain.setTestMode(IdeMain.TestMode.CORE_TEST);
  TestMain.configureMPS();
  ApplicationManagerEx.getApplicationEx().doNotSave();
  clearSystemClipboard();
  readSystemMacro();
  if (StringUtils.isEmpty(projectName)) {
    for (    Project project : ProjectManagerEx.getInstanceEx().getOpenProjects()) {
      if ((myProject=project.getComponent(MPSProject.class)) != null) {
        break;
      }
    }
    if (myProject == null) {
      Assert.fail("MPS Project was not specfied in test class, no currently open project was not found");
    }
  }
 else {
    this.myProject=TestMain.PROJECT_CONTAINER.getProject(MacrosFactory.mpsHomeMacros().expandPath(projectName,((IFile)null)));
  }
  SwingUtilities.invokeAndWait(new Runnable(){
    public void run(){
      ModelAccess.instance().runWriteActionInCommand(new Runnable(){
        public void run(){
          SModelDescriptor modelDescriptor=SModelRepository.getInstance().getModelDescriptor(SModelReference.fromString(model));
          BaseTransformationTest.this.setModelDescriptor(modelDescriptor);
        }
      }
);
    }
  }
);
  ModelAccess.instance().flushEventQueue();
}
