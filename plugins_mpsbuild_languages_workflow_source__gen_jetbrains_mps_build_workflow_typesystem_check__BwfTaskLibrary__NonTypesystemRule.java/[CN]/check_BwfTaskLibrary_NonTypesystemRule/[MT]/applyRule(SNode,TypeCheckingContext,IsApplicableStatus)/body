{
  Set<SNode> libsSet=new LinkedHashSet<SNode>();
  libsSet.add(lib);
  for (  SNode tldep : SLinkOperations.getTargets(lib,"imports",true)) {
    libsSet.add(SLinkOperations.getTarget(tldep,"target",false));
  }
  TaskLibrariesHelper.closure(libsSet);
  for (  SNode n : lib.getDescendantsIterable(null,true)) {
    for (    SReference ref : n.getReferencesIterable()) {
      SNode targetNode=ref.getTargetNodeSilently();
      if (targetNode != null && !(libsSet.contains(targetNode.getTopmostAncestor()))) {
{
          MessageTarget errorTarget=new NodeMessageTarget();
          IErrorReporter _reporter_2309309498=typeCheckingContext.reportTypeError(n,"broken reference, target is not imported","r:aa7cee44-7e41-4ff3-b944-4eb707b62ad6(jetbrains.mps.build.workflow.typesystem)","1117643560963219163",null,errorTarget);
        }
      }
    }
  }
}
