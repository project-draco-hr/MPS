{
  Condition<SNode> cond=new Condition<SNode>(){
    public boolean met(    SNode node){
      return node.getConcept().isSubConceptOf(SConceptRepository.getInstance().getConcept(BootstrapLanguages.concept_baseLanguage_ClassConcept));
    }
  }
;
  for (  final SModel model : outputModels) {
    Iterable<SNode> iterable=new ConditionalIterable<SNode>(model.getRootNodes(),cond);
    for (    final SNode outputRoot : iterable) {
      if (baseClassLoader == null) {
        baseClassLoader=model.getClass().getClassLoader();
      }
      ClassLoader classLoader=generationHandler.getCompiler().getClassLoader(baseClassLoader);
      try {
        String className=ModelAccess.instance().runReadAction(new Computable<String>(){
          public String compute(){
            return SNodeOperations.getModelLongName(model) + "." + outputRoot.getName();
          }
        }
);
        final Class testClass=Class.forName(className,true,classLoader);
        if (Modifier.isAbstract(testClass.getModifiers()) || Modifier.isInterface(testClass.getModifiers())) {
          continue;
        }
        if (Modifier.isPrivate(testClass.getModifiers())) {
          continue;
        }
        if (testClass.getAnnotation(classLoader.loadClass("jetbrains.mps.MPSLaunch")) != null) {
          continue;
        }
        List<Method> testMethods=new ArrayList<Method>();
        Class<TestCase> testCaseClass=(Class<TestCase>)classLoader.loadClass(TestCase.class.getName());
        boolean isTestCase=testCaseClass.isAssignableFrom(testClass);
        for (        Method method : testClass.getMethods()) {
          if (method.getAnnotation((Class<Annotation>)classLoader.loadClass(Test.class.getName())) != null || (method.getName().startsWith("test") && isTestCase)) {
            testMethods.add(method);
          }
        }
        for (        Method testMethod : testMethods) {
          try {
            final Object instance=testClass.newInstance();
            Method setName=testCaseClass.getMethod("setName",String.class);
            setName.invoke(instance,testMethod.getName());
            Method runMethod=testCaseClass.getMethod("run",classLoader.loadClass(TestResult.class.getName()));
            runMethod.invoke(instance,testResult);
          }
 catch (          Throwable ignored) {
            System.err.println(testClass.getCanonicalName() + ":");
            ignored.printStackTrace();
          }
        }
      }
 catch (      Throwable ignored) {
        ignored.printStackTrace();
      }
    }
  }
}
