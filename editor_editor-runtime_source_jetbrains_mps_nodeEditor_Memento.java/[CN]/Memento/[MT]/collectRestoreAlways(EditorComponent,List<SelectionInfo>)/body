{
  Set<jetbrains.mps.openapi.editor.cells.EditorCell_Collection> visitedCollections=new HashSet<>();
  List<jetbrains.mps.openapi.editor.cells.EditorCell_Collection> result=new ArrayList<>();
  for (  SelectionInfo selectionInfo : selectionInfoStack) {
    Selection selection=selectionInfo.createSelection(nodeEditor);
    if (selection == null) {
      continue;
    }
    for (    EditorCell nextCell : selection.getSelectedCells()) {
      for (jetbrains.mps.openapi.editor.cells.EditorCell_Collection parent=nextCell.getParent(); parent != null; parent=parent.getParent()) {
        if (visitedCollections.add(parent) && parent.isFoldable()) {
          result.add(parent);
        }
      }
    }
  }
  return result.stream();
}
