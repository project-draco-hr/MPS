{
  boolean editorRebuildRequired=editor.setEnabledHints(myEnabledHints);
  editorRebuildRequired=editor.setUseCustomHints(myUseCustomHints) || editorRebuildRequired;
  if (myEditedNodeReference != null) {
    SNode newEditedNode=myEditedNodeReference.resolve(editor.getEditorContext().getRepository());
    if (newEditedNode != null) {
      editor.editNode(newEditedNode);
      editor.getUpdater().flushModelEvents();
      editorRebuildRequired=false;
    }
  }
  if (editorRebuildRequired) {
    editor.rebuildEditorContent();
    editor.getUpdater().flushModelEvents();
  }
  editor.clearFoldedCells();
  editor.clearBracesEnabledCells();
  editor.getUpdater().flushModelEvents();
  boolean needsRelayout=restoreErrors(editor);
  editor.getSelectionManager().setSelectionInfoStack(mySelectionStack);
  for (  CellInfo collectionInfo : myCollectionsWithEnabledBraces) {
    EditorCell collection=collectionInfo.findCell(editor);
    if (!(collection instanceof EditorCell_Collection))     continue;
    if (((EditorCell_Collection)collection).usesBraces()) {
      ((EditorCell_Collection)collection).enableBraces();
    }
  }
  for (  CellInfo collectionInfo : myFolded) {
    needsRelayout=true;
    EditorCell collection=collectionInfo.findCell(editor);
    if (!(collection instanceof EditorCell_Collection))     continue;
    ((EditorCell_Collection)collection).fold(true);
  }
  if (needsRelayout) {
    editor.relayout();
  }
  if (myViewPosition != null) {
    editor.getViewport().setViewPosition(myViewPosition);
  }
}
