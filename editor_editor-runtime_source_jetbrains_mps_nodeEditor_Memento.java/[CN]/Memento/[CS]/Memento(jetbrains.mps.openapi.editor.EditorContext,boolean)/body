{
  EditorComponent nodeEditor=(EditorComponent)context.getEditorComponent();
  SNode editedNode=nodeEditor.getEditedNode();
  if (editedNode == null || SNodeUtil.isAccessible(editedNode,MPSModuleRepository.getInstance())) {
    if (saveEditedNode && editedNode != null) {
      myEditedNodeReference=editedNode.getReference();
    }
    mySelectionStack=nodeEditor.getSelectionManager().getSelectionInfoStack();
    List<Pair<EditorCell,Boolean>> collapseStates=nodeEditor.getCollapseStates();
    Collections.sort(collapseStates,COLLAPSED_STATES_COMPARATOR);
    for (    Pair<EditorCell,Boolean> collapseState : collapseStates) {
      myCollapseStates.add(new Pair<CellInfo,Boolean>(collapseState.o1.getCellInfo(),collapseState.o2));
    }
    for (    EditorCell bracesEnabledCell : nodeEditor.getBracesEnabledCells()) {
      myCollectionsWithEnabledBraces.add(bracesEnabledCell.getCellInfo());
    }
    collectErrors(nodeEditor);
  }
  myViewPosition=nodeEditor.getViewport().getViewPosition();
  myEnabledHints=nodeEditor.getUpdater().getInitialEditorHints();
}
