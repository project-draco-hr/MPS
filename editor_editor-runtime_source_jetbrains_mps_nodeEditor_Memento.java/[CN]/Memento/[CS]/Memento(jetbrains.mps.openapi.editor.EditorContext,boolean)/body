{
  EditorComponent nodeEditor=(EditorComponent)context.getEditorComponent();
  SNode editedNode=nodeEditor.getEditedNode();
  if (editedNode == null || (!jetbrains.mps.util.SNodeOperations.isDisposed(editedNode) && editedNode.getModel() != null && !jetbrains.mps.util.SNodeOperations.isModelDisposed(editedNode.getModel()))) {
    if (saveEditedNode && editedNode != null) {
      myEditedNodeReference=editedNode.getReference();
    }
    mySelectionStack=nodeEditor.getSelectionManager().getSelectionInfoStack();
    ArrayList<EditorCell> foldedCells=new ArrayList<EditorCell>(nodeEditor.getFoldedCells());
    Collections.sort(foldedCells,FOLDED_CELLS_COMPARATOR);
    for (    EditorCell foldedCell : foldedCells) {
      myFolded.add(foldedCell.getCellInfo());
    }
    for (    EditorCell bracesEnabledCell : nodeEditor.getBracesEnabledCells()) {
      myCollectionsWithEnabledBraces.add(bracesEnabledCell.getCellInfo());
    }
    collectErrors(nodeEditor);
  }
  myViewPosition=nodeEditor.getViewport().getViewPosition();
  myUseCustomHints=nodeEditor.getUseCustomHints();
  myEnabledHints=new HashSet<String>(nodeEditor.getEnabledHints());
}
