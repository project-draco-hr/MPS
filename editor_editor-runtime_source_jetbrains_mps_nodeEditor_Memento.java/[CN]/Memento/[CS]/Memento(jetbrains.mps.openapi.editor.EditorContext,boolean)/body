{
  EditorComponent nodeEditor=(EditorComponent)context.getEditorComponent();
  SNode editedNode=nodeEditor.getEditedNode();
  if (editedNode == null || (!jetbrains.mps.util.SNodeOperations.isDisposed(editedNode) && editedNode.getModel() != null && !editedNode.getModel().isDisposed())) {
    mySelectionStack=nodeEditor.getSelectionManager().getSelectionInfoStack();
    ArrayList<EditorCell> foldedCells=new ArrayList<EditorCell>(nodeEditor.getFoldedCells());
    Collections.sort(foldedCells,FOLDED_CELLS_COMPARATOR);
    for (    EditorCell foldedCell : foldedCells) {
      myFolded.add(foldedCell.getCellInfo());
    }
    for (    EditorCell bracesEnabledCell : nodeEditor.getBracesEnabledCells()) {
      myCollectionsWithEnabledBraces.add(bracesEnabledCell.getCellInfo());
    }
    if (full) {
      collectErrors(nodeEditor);
    }
  }
  myViewPosition=nodeEditor.getViewport().getViewPosition();
}
