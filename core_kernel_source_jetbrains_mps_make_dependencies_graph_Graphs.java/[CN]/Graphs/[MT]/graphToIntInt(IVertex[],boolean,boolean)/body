{
  int count=vertices.length;
  int[] temparray=new int[count];
  int[][] result=new int[count][];
  Map<IVertex,Integer> rootIndex=new HashMap<IVertex,Integer>(vertices.length);
  for (int i=0; i < vertices.length; i++) {
    rootIndex.put(vertices[i],i);
  }
  for (int index=0; index < count; index++) {
    IVertex vertex=vertices[index];
    int tsize=0;
    for (    IVertex node : vertex.getNexts()) {
      Integer targetIndex=rootIndex.get(node);
      if (targetIndex != null && (allowSelfLoops || targetIndex != index)) {
        temparray[tsize++]=targetIndex;
      }
    }
    result[index]=new int[tsize];
    if (tsize > 0) {
      System.arraycopy(temparray,0,result[index],0,tsize);
    }
  }
  if (sorted) {
    GraphUtil.sort(result);
  }
  return result;
}
