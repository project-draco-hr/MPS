{
  BasicConfigurator.configure(new NullAppender());
  Logger.getRootLogger().setLevel(getLog4jLevel());
  jetbrains.mps.logging.Logger.addLoggingHandler(new MyMessageHandlerAppender());
  IdeMain.setTestMode(TestMode.CORE_TEST);
  TestMain.configureMPS();
  setMacro();
  loadLibraries();
  com.intellij.openapi.project.Project ideaProject=ProjectManager.getInstance().getDefaultProject();
  File projectFile=FileUtil.createTmpFile();
  MPSProject project=new MPSProject(projectFile,new ProjectDescriptor(),ideaProject);
  ideaProject.getComponent(FileGeneratorManager.class).reloadFileGenerators();
  generateModels(project,collectModelsToGenerate());
  unloadLoadedStuff();
  showStatistic();
}
