{
  BasicConfigurator.configure(new NullAppender());
  Logger.getRootLogger().setLevel(getLog4jLevel());
  jetbrains.mps.logging.Logger.addLoggingHandler(new MyMessageHandlerAppender());
  IdeMain.setTestMode(TestMode.CORE_TEST);
  TestMain.configureMPS();
  setMacro();
  loadLibraries();
  com.intellij.openapi.project.Project ideaProject=ProjectManager.getInstance().getDefaultProject();
  File projectFile=FileUtil.createTmpFile();
  final MPSProject project=new MPSProject(projectFile,new ProjectDescriptor(),ideaProject);
  final List<SModelDescriptor> models=collectModelsToGenerate();
  ClassLoaderManager.getInstance().reloadAll(new EmptyProgressIndicator());
  ModelAccess.instance().runWriteAction(new Runnable(){
    public void run(){
      generateModels(project,models);
    }
  }
);
  unloadLoadedStuff();
  showStatistic();
}
