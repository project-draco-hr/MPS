{
  Logger.getRootLogger().setLevel(myWhatToDo.getLogLevel());
  EnvironmentConfig config=EnvironmentConfig.defaultConfig();
  for (  String jar : myWhatToDo.getLibraryJars()) {
    File jarFile=new File(jar);
    if (!(jarFile.exists())) {
      warning("Library " + jar + " does not exist.");
    }
    config=config.addLib(jar);
  }
  for (  IMapping<String,String> macro : MapSequence.fromMap(myWhatToDo.getMacro())) {
    config=config.addMacro(macro.key(),new File(macro.value()));
  }
  Environment environment=new GeneratorWorker.MyEnvironment(config);
  environment.init();
  setupEnvironment();
  setGenerationProperties();
  boolean doneSomething=false;
  Project project=createDummyProject();
  for (  IMapping<List<String>,Boolean> chunk : MapSequence.fromMap(myWhatToDo.getChunks())) {
    final List<String> modulePaths=chunk.key();
    final Set<SModule> modules=new LinkedHashSet<SModule>();
    project.getModelAccess().runWriteAction(new Runnable(){
      public void run(){
        for (        String modulePath : modulePaths) {
          processModuleFile(new File(modulePath),modules);
        }
      }
    }
);
    Boolean bootstrap=chunk.value();
    if (bootstrap) {
      warning("Found bootstrap chunk " + chunk.key() + ". Generation may be impossible.");
    }
    MpsWorker.ObjectsToProcess go=new MpsWorker.ObjectsToProcess(Collections.EMPTY_SET,modules,Collections.EMPTY_SET);
    if (go.hasAnythingToGenerate()) {
      generate(project,go);
      doneSomething=true;
    }
  }
  if (!(doneSomething)) {
    error("Could not find anything to generate.");
  }
  dispose();
  showStatistic();
}
