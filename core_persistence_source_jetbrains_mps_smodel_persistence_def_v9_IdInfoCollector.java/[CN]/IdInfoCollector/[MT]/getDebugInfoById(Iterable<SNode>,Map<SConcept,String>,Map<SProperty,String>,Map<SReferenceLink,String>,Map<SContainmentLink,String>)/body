{
  DebugRegistry debugRegistry=MPSModuleRepository.getInstance().getDebugRegistry();
  for (  SNode root : rootNodes) {
    for (    SNode n : SNodeUtil.getDescendants(root)) {
      SConcept conceptId=n.getConcept().getId();
      SNode conceptNode=new SConceptAdapterById(conceptId).getConceptDeclarationNode();
      String conceptName=conceptNode != null ? conceptNode.getName() : debugRegistry.getConceptName(conceptId);
      conceptIds.put(conceptId,conceptName);
      if (n.getParent() != null) {
        SContainmentLink roleId=n.getContainmentLink();
        SContainmentLinkAdapter role=new SContainmentLinkAdapter(roleId);
        SConcept linkConceptId=roleId.getConceptId();
        SNode roleNode=role.getLinkNode();
        String roleName;
        if (roleNode != null) {
          SNode linkConcept=roleNode.getContainingRoot();
          if (linkConcept != conceptNode) {
            String linkConceptName=linkConcept.getName();
            conceptIds.put(linkConceptId,linkConceptName);
          }
          roleName=roleNode.getProperty("role");
        }
 else {
          conceptIds.put(linkConceptId,debugRegistry.getConceptName(linkConceptId));
          roleName=debugRegistry.getRefName(roleId);
        }
        roleIds.put(roleId,roleName);
      }
      for (      SProperty pid : n.getProperties()) {
        SPropertyAdapter propId=new SPropertyAdapter(pid);
        SConcept propConceptId=pid.getContainingConcept();
        SNode propNode=propId.getPropertyNode();
        String propName;
        if (propNode != null) {
          SNode propConcept=propNode.getContainingRoot();
          if (propConcept != conceptNode) {
            String propConceptName=propConcept.getName();
            conceptIds.put(propConceptId,propConceptName);
          }
          propName=propNode.getName();
        }
 else {
          conceptIds.put(propConceptId,debugRegistry.getConceptName(propConceptId));
          propName=debugRegistry.getPropertyName(pid);
        }
        propIds.put(pid,propName);
      }
      for (      SReference ref : n.getReferences()) {
        SReferenceLink refId=ref.getReferenceLink();
        SReferenceLinkAdapter refRole=new SReferenceLinkAdapter(refId);
        SNode refNode=refRole.getLinkNode();
        SConcept refConceptId=refId.getConcept();
        String refName;
        if (refNode != null) {
          SNode refConcept=refNode.getContainingRoot();
          if (refConcept != conceptNode) {
            String propConceptName=refConcept.getName();
            conceptIds.put(refConceptId,propConceptName);
          }
          refName=refNode.getProperty("role");
        }
 else {
          conceptIds.put(refConceptId,debugRegistry.getConceptName(refConceptId));
          refName=debugRegistry.getRefName(refId);
        }
        refIds.put(refId,refName);
      }
    }
  }
}
