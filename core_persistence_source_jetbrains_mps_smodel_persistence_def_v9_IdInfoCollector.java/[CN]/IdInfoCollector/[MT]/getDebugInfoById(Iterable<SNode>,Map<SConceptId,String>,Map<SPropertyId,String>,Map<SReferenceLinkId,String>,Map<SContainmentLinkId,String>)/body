{
  for (  SNode root : rootNodes) {
    for (    SNode n : SNodeUtil.getDescendants(root)) {
      SConceptId conceptId=IdHelper.getConceptId(n.getConcept());
      ConceptDescriptor cd=ConceptRegistry.getInstance().getConceptDescriptor(conceptId);
      String name=cd.getConceptFqName();
      SConceptAdapterById concept=new SConceptAdapterById(conceptId,name);
      SNode conceptNode=concept.getDeclarationNode();
      conceptIds.put(conceptId,concept.getQualifiedName());
      if (n.getParent() != null) {
        SContainmentLink role=n.getContainmentLink();
        SContainmentLinkId roleId=IdHelper.getLinkId(role);
        SConceptId linkConceptId=roleId.getConceptId();
        SNode roleNode=role.getDeclarationNode();
        String roleName;
        if (roleNode != null) {
          SNode linkConcept=roleNode.getContainingRoot();
          if (linkConcept != conceptNode) {
            String linkConceptName=linkConcept.getName();
            conceptIds.put(linkConceptId,linkConceptName);
          }
          roleName=roleNode.getProperty("role");
        }
 else {
          conceptIds.put(linkConceptId,role.getContainingConcept().getQualifiedName());
          roleName=role.getRoleName();
        }
        roleIds.put(roleId,roleName);
      }
      for (      SProperty prop : n.getProperties()) {
        SPropertyId propId=IdHelper.getPropertyId(prop);
        SConceptId propConceptId=IdHelper.getConceptId(prop.getContainingConcept());
        SNode propNode=prop.getDeclarationNode();
        String propName;
        if (propNode != null) {
          SNode propConcept=propNode.getContainingRoot();
          if (propConcept != conceptNode) {
            String propConceptName=propConcept.getName();
            conceptIds.put(propConceptId,propConceptName);
          }
          propName=propNode.getName();
        }
 else {
          conceptIds.put(propConceptId,prop.getContainingConcept().getQualifiedName());
          propName=prop.getName();
        }
        propIds.put(propId,propName);
      }
      for (      SReference ref : n.getReferences()) {
        SReferenceLinkId refId=IdHelper.getRefId(ref.getReferenceLink());
        SReferenceLink refRole=ref.getReferenceLink();
        SNode refNode=refRole.getDeclarationNode();
        SConceptId refConceptId=refId.getConceptId();
        String refName;
        if (refNode != null) {
          SNode refConcept=refNode.getContainingRoot();
          if (refConcept != conceptNode) {
            String propConceptName=refConcept.getName();
            conceptIds.put(refConceptId,propConceptName);
          }
          refName=refNode.getProperty("role");
        }
 else {
          conceptIds.put(refConceptId,refRole.getContainingConcept().getQualifiedName());
          refName=refRole.getRoleName();
        }
        refIds.put(refId,refName);
      }
    }
  }
}
