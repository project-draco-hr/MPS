{
  SNode newAnnotation=SConceptOperations.createNewNode("jetbrains.mps.lang.test.structure.AnonymousCellAnnotation",null);
  EditorCell contextCell=editorContext.getContextCell();
  if (contextCell instanceof EditorCell_Label) {
    int caretPosition=((EditorCell_Label)contextCell).getCaretPosition();
    if (caretPosition == ((EditorCell_Label)contextCell).getText().length()) {
      SPropertyOperations.set(newAnnotation,"isLastPosition","" + true);
    }
 else {
      SPropertyOperations.set(newAnnotation,"caretPosition","" + caretPosition);
    }
  }
  SPropertyOperations.set(newAnnotation,"cellId",contextCell.getCellId());
  SLinkOperations.setTarget(node,AttributesRolesUtil.childRoleFromAttributeRole("testNode"),newAnnotation,true);
  editorContext.select(newAnnotation);
}
