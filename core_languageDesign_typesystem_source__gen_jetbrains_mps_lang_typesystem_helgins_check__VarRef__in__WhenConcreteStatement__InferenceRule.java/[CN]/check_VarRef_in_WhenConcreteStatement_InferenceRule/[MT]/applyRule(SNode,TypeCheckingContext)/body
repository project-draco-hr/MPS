{
  SNode ancestor=SNodeOperations.getAncestor(variableReference,"jetbrains.mps.lang.typesystem.structure.WhenConcreteStatement",false,false);
  if (ancestor != null) {
    SNode argument=SLinkOperations.getTarget(ancestor,"argument",true);
    SNode parent=variableReference;
    while (parent != null && parent != ancestor) {
      if (parent == argument) {
        return;
      }
 else {
        parent=SNodeOperations.getParent(parent);
      }
    }
    SNode variableDeclaration=SLinkOperations.getTarget(variableReference,"variableDeclaration",false);
    if (SNodeOperations.isInstanceOf(variableDeclaration,"jetbrains.mps.baseLanguage.structure.FieldDeclaration") || SNodeOperations.isInstanceOf(variableDeclaration,"jetbrains.mps.baseLanguage.structure.StaticFieldDeclaration")) {
      return;
    }
    if (variableDeclaration != null && !(ListSequence.fromList(SNodeOperations.getAncestors(variableDeclaration,"jetbrains.mps.lang.typesystem.structure.WhenConcreteStatement",false)).contains(ancestor))) {
      if (!(SPropertyOperations.getBoolean(variableDeclaration,"isFinal"))) {
        TypeChecker.getInstance().reportTypeError(variableReference,"variable is used inside WHEN CONCRETE block. should be declared final","r:00000000-0000-4000-0000-011c895902b1(jetbrains.mps.lang.typesystem.helgins)","1185875417873");
      }
    }
  }
}
