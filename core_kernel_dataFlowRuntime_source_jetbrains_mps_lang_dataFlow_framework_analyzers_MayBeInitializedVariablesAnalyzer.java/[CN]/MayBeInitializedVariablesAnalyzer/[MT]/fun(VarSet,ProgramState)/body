{
  Instruction instruction=s.getInstruction();
  VarSet result=input;
  if (s.isStart()) {
    result.clear();
  }
  if (instruction instanceof WriteInstruction && !myExclusions.contains(instruction)) {
    WriteInstruction write=(WriteInstruction)instruction;
    result.add(write.getVariableIndex());
  }
  if (instruction instanceof JumpInstruction) {
    JumpInstruction jump=(JumpInstruction)instruction;
    final int to=jump.getJumpTo();
    final int current=s.getIndex();
    if (to < current) {
      final Program program=jump.getProgram();
      for (      Object var : program.getVariables()) {
        final List<Instruction> instructions=program.getInstructionsFor(var);
        if (!instructions.isEmpty()) {
          if (to < instructions.get(0).getIndex()) {
            result.remove(var);
          }
 else {
            result.add(var);
          }
        }
      }
    }
  }
  return result;
}
