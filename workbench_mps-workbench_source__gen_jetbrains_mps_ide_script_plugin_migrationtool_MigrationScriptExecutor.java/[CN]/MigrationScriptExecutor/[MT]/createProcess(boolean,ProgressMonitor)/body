{
  return new Runnable(){
    @Override public void run(){
      final MigrationScriptFinder finder=new MigrationScriptFinder(Collections.singletonList(script),context);
      final MigrationScriptsController controller=new MigrationScriptsController(finder){
        @Override public void runCommand(        Runnable cmd){
          if (spawnCommands) {
            ModelAccess.instance().runCommandInEDT(cmd,getMPSProject());
          }
 else {
            cmd.run();
          }
        }
      }
;
      final ProgressMonitor promon=getOrCreateProgressMonitor(monitor);
      promon.start("Executing \"" + title + "\"",200);
      final List<SearchResult<SNode>>[] searchResults=((List<SearchResult<SNode>>[])new List[1]);
      ModelAccess.instance().runReadAction(new Runnable(){
        @Override public void run(){
          IScope scope=AbstractMigrationScriptHelper.createMigrationScope(Collections.<SModel>emptyList(),getMPSProject().getModules());
          SearchResults results=finder.find(new SearchQuery(scope),promon.subTask(100));
          searchResults[0]=(List<SearchResult<SNode>>)results.getSearchResults();
        }
      }
);
      controller.process(promon.subTask(100),searchResults[0]);
      promon.done();
    }
  }
;
}
