{
  return new Runnable(){
    @Override public void run(){
      final MigrationScriptFinder finder=new MigrationScriptFinder(Collections.singletonList(script),context);
      final MigrationScriptsController controller=new MigrationScriptsController(finder){
        @Override public void runCommand(        Runnable cmd){
          if (spawnCommands) {
            getMPSProject().getModelAccess().executeCommandInEDT(cmd);
          }
 else {
            cmd.run();
          }
        }
      }
;
      final ProgressMonitor promon=getOrCreateProgressMonitor(monitor);
      promon.start("Executing \"" + title + "\"",200);
      final List<SearchResult<SNode>>[] searchResults=((List<SearchResult<SNode>>[])new List[1]);
      getMPSProject().getModelAccess().runReadAction(new Runnable(){
        @Override public void run(){
          SearchResults results=finder.find(new SearchQuery(AbstractMigrationScriptHelper.createMigrationScope(getMPSProject())),promon.subTask(100));
          searchResults[0]=(List<SearchResult<SNode>>)results.getSearchResults();
        }
      }
);
      controller.process(promon.subTask(100),searchResults[0]);
      promon.done();
    }
  }
;
}
