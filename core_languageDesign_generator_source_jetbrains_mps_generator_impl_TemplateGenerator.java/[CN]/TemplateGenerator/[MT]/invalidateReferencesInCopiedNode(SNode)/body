{
  for (  SReference reference : node.getReferencesIterable()) {
    SNode targetNode=reference.getTargetNode();
    if (targetNode == null) {
      showErrorMessage(node,"broken reference '" + reference.getRole() + "' in copied node: "+ node.getDebugText());
      continue;
    }
    if (targetNode.getModel().equals(myInputModel)) {
      ReferenceInfo_CopiedInputNode refInfo=new ReferenceInfo_CopiedInputNode(reference.getRole(),node,reference.getSourceNode(),targetNode);
      PostponedReference newReference=new PostponedReference(refInfo,this);
      node.replaceReference(reference,newReference);
    }
  }
  for (  SNode childNode : node.getChildrenIterable()) {
    invalidateReferencesInCopiedNode(childNode);
  }
}
