{
  checkMonitorCanceled();
  myAreMappingsReady=false;
  ttrace.push("reductions",false);
  List<SNode> copiedRoots=applyReductions(isPrimary);
  ttrace.pop();
  myAreMappingsReady=true;
  ttrace.push("weavings",false);
  applyWeaving_MappingRules();
  ttrace.pop();
  ttrace.push("delayed mappings",false);
  myDelayedChanges.doAllChanges();
  ttrace.pop();
  ttrace.push("restoring references",false);
  for (  SNode copiedRoot : copiedRoots) {
    checkMonitorCanceled();
    invalidateReferencesInCopiedNode(copiedRoot);
  }
  revalidateAllReferences();
  ttrace.pop();
  checkMonitorCanceled();
  return isChanged();
}
