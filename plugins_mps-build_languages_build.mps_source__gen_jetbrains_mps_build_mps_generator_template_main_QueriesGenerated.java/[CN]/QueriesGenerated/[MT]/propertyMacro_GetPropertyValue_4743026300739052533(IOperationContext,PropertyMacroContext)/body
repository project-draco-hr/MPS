{
  if (((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files")) == null) {
    return "???";
  }
  SNode path=(SNode)_context.getNode().getReferent("targetJarPath");
  final String pathText=BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(path);
  String result=ListSequence.fromList(SLinkOperations.getTargets(((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._2(),"jarLocations",true)).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return eq_x583g4_a0a0a0a0a0a0a3a41(BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(it,"path",true)),pathText);
    }
  }
).select(new ISelector<SNode,String>(){
    public String select(    SNode it){
      return SPropertyOperations.getString(it,"packagedLocation");
    }
  }
).first();
  if (result != null) {
    return result;
  }
  LocalArtifacts outputFiles=((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._0();
  Tuples._2<SNode,String> location=outputFiles.getLocalResource(path);
  if (location._0() == null) {
    String jarName=BuildSourcePath_Behavior.call_getLastSegment_1368030936106771141(path,Context.defaultContext(_context).getMacros(path));
    _context.showErrorMessage(path,"cannot find `" + jarName + "' in local layout");
    return "???";
  }
  SNode container=((Tuples._3<LocalArtifacts,SNode,SNode>)_context.getVariable("var:files"))._1();
  try {
    return new ArtifactsRelativePathHelper(outputFiles,container).getRelativePath(SNodeOperations.cast(location._0(),"jetbrains.mps.build.structure.BuildLayout_Node")) + location._1();
  }
 catch (  ArtifactsRelativePathHelper.RelativePathException ex) {
    String jarName=BuildSourcePath_Behavior.call_getLastSegment_1368030936106771141(path,Context.defaultContext(_context).getMacros(path));
    _context.showErrorMessage(_context.getNode(),"cannot build relative path to `" + jarName + "': "+ ex.getMessage());
    return "";
  }
}
