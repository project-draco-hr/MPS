{
  final SNode project=artifacts.getProject();
  RequiredPlugins plugins=new RequiredPlugins(project,artifacts.getGenContext());
  plugins.collectDependencies();
  for (  SNode plugin : Sequence.fromIterable(plugins.getDependency()).where(new IWhereFilter<SNode>(){
    public boolean accept(    SNode it){
      return SNodeOperations.getContainingRoot(it) != project;
    }
  }
)) {
    SNode pluginArtifact=SNodeOperations.as(artifacts.findArtifact(plugin),"jetbrains.mps.build.structure.BuildLayout_Node");
    if (pluginArtifact != null) {
      builder.add(pluginArtifact,plugin);
    }
  }
  DependenciesHelper helper=new DependenciesHelper(artifacts.getGenContext(),artifacts.getProject());
  SNode originalProject=SNodeOperations.as(DependenciesHelper.getOriginalNode(project,artifacts.getGenContext()),"jetbrains.mps.build.structure.BuildProject");
  SNode antMpsModule=SNodeOperations.as(BehaviorReflection.invokeVirtual(Scope.class,originalProject,"virtual_getScope_7722139651431880752",new Object[]{SConceptOperations.findConceptDeclaration("jetbrains.mps.build.structure.BuildSource_JavaModule"),"parts",0}).resolve(originalProject,"ant-mps"),"jetbrains.mps.build.structure.BuildSource_JavaModule");
  if ((antMpsModule != null)) {
    SNode antMpsJar=SNodeOperations.as(artifacts.findArtifact(antMpsModule),"jetbrains.mps.build.structure.BuildLayout_Node");
    if ((antMpsJar != null)) {
      helper.artifacts().put("ant-mps",antMpsJar);
      builder.add(antMpsJar,antMpsModule);
    }
    SNode mpsCore=SNodeOperations.as(SNodeOperations.getContainingRoot(antMpsModule),"jetbrains.mps.build.structure.BuildProject");
    Scope visibleJarsScope=ScopeUtil.getVisibleJarsScope(mpsCore);
    SNode jdom=visibleJarsScope.resolve(mpsCore,"IDEA::lib/jdom.jar");
    if ((jdom != null)) {
      SNode jdomJar=SNodeOperations.as(artifacts.findArtifact(jdom),"jetbrains.mps.build.structure.BuildLayout_Node");
      if ((jdomJar != null)) {
        helper.artifacts().put("jdom",jdomJar);
        builder.add(jdomJar,jdom);
      }
    }
    SNode log4j=visibleJarsScope.resolve(mpsCore,"IDEA::lib/log4j.jar");
    if ((log4j != null)) {
      SNode log4jJar=SNodeOperations.as(artifacts.findArtifact(log4j),"jetbrains.mps.build.structure.BuildLayout_Node");
      if ((log4jJar != null)) {
        helper.artifacts().put("log4j",log4jJar);
        builder.add(log4jJar,log4j);
      }
    }
  }
  VisibleModules visibleModules=new VisibleModules(artifacts.getProject());
  visibleModules.collect();
  SNode gentest=visibleModules.resolve("jetbrains.mps.tool.gentest","3ba7b7cf-6a5a-4981-ba0b-3302e59ffef7");
  if ((gentest != null)) {
    if (SNodeOperations.getContainingRoot(gentest) != SNodeOperations.getContainingRoot(thisNode)) {
      SNode gentestJar=SNodeOperations.as(artifacts.findArtifact(gentest),"jetbrains.mps.build.structure.BuildLayout_Node");
      if (gentestJar != null) {
        helper.artifacts().put(SPropertyOperations.getString(gentest,"uuid"),gentestJar);
        builder.add(gentestJar,gentest);
      }
    }
  }
}
