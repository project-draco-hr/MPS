{
  String jdkHome=Java_Command.getJdkHome();
  if (StringUtils.isEmpty(jdkHome)) {
    throw new ExecutionException("Could not find valid java home.");
  }
  return new Java_Command().setClassPath(Ant_Command.getAntClassPath(myAntLocation)).setProgramParameter(Java_Command.protect("-Djava.home=" + jdkHome) + " " + Java_Command.protect("-Dant.home=" + myAntLocation)+ " "+ IterableUtils.join(Sequence.<String>fromIterable(Ant_Command.getMacroValues()).<String>select(new ISelector<String,String>(){
    public String select(    String it){
      return Java_Command.protect(it);
    }
  }
)," ")+ " "+ ((StringUtils.isNotEmpty(myOptions) ? myOptions + " " : ""))+ "-f "+ Java_Command.protect(antFilePath)+ ((StringUtils.isEmpty(myTargetName) ? "" : " " + myTargetName))).createProcess("org.apache.tools.ant.launch.Launcher");
}
