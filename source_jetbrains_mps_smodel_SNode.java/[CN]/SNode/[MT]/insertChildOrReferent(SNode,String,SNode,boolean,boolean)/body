{
  int index=0;
  if (anchorNode != null) {
    int anchorIndex=-1;
    if (isAggregation) {
      anchorIndex=myChildren.indexOf(anchorNode);
    }
 else {
      for (      SReference reference : myReferences) {
        if (reference.getTargetNode() == anchorNode) {
          anchorIndex=myReferences.indexOf(reference);
        }
      }
    }
    if (!insertBefore) {
      index=anchorIndex + 1;
    }
 else {
      index=anchorIndex;
    }
  }
  if (isAggregation) {
    insertChildAt(index,role,insertNode);
  }
 else {
    insertReferenceAt(index,SReference.newInstance(role,this,insertNode));
  }
}
