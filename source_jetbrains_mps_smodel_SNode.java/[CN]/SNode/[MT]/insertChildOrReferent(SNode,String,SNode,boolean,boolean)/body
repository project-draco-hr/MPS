{
  int index=0;
  if (anchorNode != null) {
    int anchorIndex=-1;
    if (isAggregation) {
      anchorIndex=_children().indexOf(anchorNode);
    }
 else {
      if (myReferences != null) {
        for (        SReference reference : myReferences) {
          if (reference.getTargetNode() == anchorNode) {
            anchorIndex=myReferences.indexOf(reference);
          }
        }
      }
    }
    if (!insertBefore) {
      index=anchorIndex + 1;
    }
 else {
      index=anchorIndex;
    }
  }
  if (isAggregation) {
    insertChildAt(index,role,insertNode);
  }
 else {
    insertReferenceAt(index,SReference.create(role,this,insertNode));
  }
}
