{
  LOG.assertLog(child != null,"Child is null");
  LOG.assertLog(child.getModel() == getModel(),"Can't add child with different model");
  if (child.getParent() != null) {
    throw new RuntimeException(child.getDebugText() + " already has parent: " + child.getParent().getDebugText()+ "\n"+ "Couldn't add it to: "+ this.getDebugText());
  }
  myChildren.add(index,child);
  child.myRoleInParent=role;
  child.myParent=this;
  if (!getModel().isLoading()) {
    UndoManager.instance().undoableActionPerformed(new IUndoableAction(){
      public void undo() throws UnexpectedUndoException {
        removeChildAt(index);
      }
    }
);
  }
  getModel().fireChildAddedEvent(this,role,child,index);
}
