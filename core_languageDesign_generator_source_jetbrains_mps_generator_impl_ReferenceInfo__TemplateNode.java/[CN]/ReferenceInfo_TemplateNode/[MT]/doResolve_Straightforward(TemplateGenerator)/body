{
  SNode outputTargetNode=generator.findOutputNodeByInputAndTemplateNode(getInputNode(),myTemplateTargetNode);
  if (outputTargetNode != null) {
    return outputTargetNode;
  }
  outputTargetNode=generator.findOutputNodeByTemplateNodeUnique(myTemplateTargetNode);
  if (outputTargetNode != null) {
    return outputTargetNode;
  }
  SNode templateParentNode=myTemplateSourceNode.getParent();
  SNode outputParentNode=getOutputSourceNode().getParent();
  while (templateParentNode != null && outputParentNode != null) {
    if (templateParentNode.equals(myTemplateTargetNode)) {
      return outputParentNode;
    }
    templateParentNode=templateParentNode.getParent();
    outputParentNode=outputParentNode.getParent();
  }
  if (myInputHistory != null) {
    for (    SNode historyInputNode : myInputHistory) {
      outputTargetNode=generator.findOutputNodeByInputAndTemplateNode(historyInputNode,myTemplateTargetNode);
      if (outputTargetNode != null) {
        return outputTargetNode;
      }
    }
  }
  return null;
}
