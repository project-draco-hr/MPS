{
  boolean answer=result != null;
  boolean bothMaps=answer != isWeak && result == null;
  ConcurrentHashMap<CacheNodeHandler,ConcurrentHashMap<Class,Pair<SNode,GeneratedMatchingPattern>>> cache1=isWeak ? myCoerceToPatternsCacheWeak : myCoerceToPatternsCache;
  ConcurrentHashMap<CacheNodeHandler,ConcurrentHashMap<Class,Pair<SNode,GeneratedMatchingPattern>>> cache2=isWeak ? myCoerceToPatternsCache : myCoerceToPatternsCacheWeak;
  CacheNodeHandler subtypeHandler=new CacheNodeHandler(subtype);
  ConcurrentHashMap<Class,Pair<SNode,GeneratedMatchingPattern>> map2=null;
  CacheNodeHandler subtypeHandler2=null;
  ConcurrentHashMap<Class,Pair<SNode,GeneratedMatchingPattern>> map=cache1.get(subtypeHandler);
  if (bothMaps) {
    subtypeHandler2=new CacheNodeHandler(subtype);
    map2=cache2.get(subtypeHandler2);
  }
  if (map == null || (bothMaps && map2 == null)) {
synchronized (myCoerceToPatternsCacheLock) {
      map=cache1.get(subtypeHandler);
      if (map == null) {
        map=new ConcurrentHashMap<Class,Pair<SNode,GeneratedMatchingPattern>>();
        cache1.put(subtypeHandler,map);
      }
      if (bothMaps) {
        map2=cache2.get(subtypeHandler2);
        if (map2 == null) {
          map2=new ConcurrentHashMap<Class,Pair<SNode,GeneratedMatchingPattern>>();
          cache2.put(subtypeHandler2,map2);
        }
      }
    }
  }
  map.put(c,new Pair<SNode,GeneratedMatchingPattern>(result,pattern));
}
