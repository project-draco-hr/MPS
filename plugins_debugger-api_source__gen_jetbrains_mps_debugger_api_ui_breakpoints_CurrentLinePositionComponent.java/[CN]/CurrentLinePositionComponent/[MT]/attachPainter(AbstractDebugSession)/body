{
  IStackFrame stackFrame=debugSession.getUiState().getStackFrame();
  if (stackFrame != null) {
    ILocation location=stackFrame.getLocation();
    if (location != null && !((location instanceof NullLocation))) {
      SNode node=TraceInfoUtil.getNode(location.getUnitName(),location.getFileName(),location.getLineNumber());
      if (node != null) {
        final CurrentLinePainter newPainter=new CurrentLinePainter(node);
synchronized (mySessionToContextPainterMap) {
          mySessionToContextPainterMap.put(debugSession,newPainter);
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            @Override public void run(){
              attachPainterAndOpenEditor(newPainter);
            }
          }
);
        }
      }
    }
  }
}
