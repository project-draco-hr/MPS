{
  if (file instanceof MPSNodeVirtualFile) {
    final MPSNodeVirtualFile nodeFile=(MPSNodeVirtualFile)file;
    return ModelAccess.instance().runReadAction(new Computable<Icon>(){
      @Override public Icon compute(){
        if (IconDeferrer.getInstance() instanceof DefaultIconDeferrer) {
          SNode node=MPSEditorUtil.getCurrentEditedNode(project,nodeFile);
          if (node != null) {
            return IconManager.getIconWithoutAdditionalPart(node);
          }
        }
        SNode node=nodeFile.getNode();
        if (node != null) {
          return IconManager.getIconWithoutAdditionalPart(node);
        }
        return null;
      }
    }
);
  }
  return null;
}
