{
  if (action instanceof DefaultChildNodeSubstituteAction) {
    SNode sourceNode=reference.getSourceNode();
    SModel model=sourceNode.getModel();
    DefaultChildNodeSubstituteAction childAction=(DefaultChildNodeSubstituteAction)action;
    try {
      SNode childNode=childAction.createChildNode(childAction.getParameterNode(),model,pattern);
      String role=reference.getRole();
      SNode referent=childNode.getReferent(role);
      sourceNode.setReferent(role,referent);
    }
 catch (    Throwable t) {
      action.doSubstitute(pattern);
    }
  }
  if (action instanceof DefaultReferentNodeSubstituteAction) {
    action.doSubstitute(pattern);
  }
}
