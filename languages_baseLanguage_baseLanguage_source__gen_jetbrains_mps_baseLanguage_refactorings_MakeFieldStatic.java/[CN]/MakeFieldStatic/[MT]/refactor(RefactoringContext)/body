{
  SNode newDeclaration=_quotation_createNode_so6etp_a0a0a(SNodeOperations.copyNode(SLinkOperations.getTarget(((SNode)refactoringContext.getParameter("declaration")),"visibility",true)),SNodeOperations.copyNode(SLinkOperations.getTarget(((SNode)refactoringContext.getParameter("declaration")),"type",true)),SPropertyOperations.getString(((SNode)refactoringContext.getParameter("declaration")),"name"));
  SNode declarationClassifier=SNodeOperations.getAncestor(((SNode)refactoringContext.getParameter("declaration")),"jetbrains.mps.baseLanguage.structure.Classifier",false,false);
  ListSequence.fromList(SLinkOperations.getTargets(declarationClassifier,"member",true)).addElement(newDeclaration);
  for (  SearchResult<SNode> result : ListSequence.fromList(((SearchResults<SNode>)refactoringContext.getParameter("usages")).getSearchResults())) {
    SNode usage=result.getObject();
    SNode replacing;
    if (SNodeOperations.isInstanceOf(usage,"jetbrains.mps.baseLanguage.structure.FieldReferenceOperation")) {
      replacing=SNodeOperations.getParent(usage);
    }
 else {
      replacing=usage;
    }
    SNode newReference;
    if (SNodeOperations.getAncestor(usage,"jetbrains.mps.baseLanguage.structure.Classifier",false,false) != declarationClassifier) {
      newReference=_quotation_createNode_so6etp_a0a0e0d0a(declarationClassifier,newDeclaration);
    }
 else {
      newReference=_quotation_createNode_so6etp_a0a0a4a3a0(newDeclaration);
    }
    SNodeOperations.replaceWithAnother(replacing,newReference);
  }
  SNodeOperations.deleteNode(((SNode)refactoringContext.getParameter("declaration")));
}
