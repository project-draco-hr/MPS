{
  setupEnvironment();
  Map<File,List<String>> mpsProjects=myWhatToDo.getMPSProjectFiles();
  for (  File file : mpsProjects.keySet()) {
    final Project p=myEnvironment.openProject(file);
    info("Loaded project " + p);
    myEnvironment.flushAllEvents();
    try {
      SwingUtilities.invokeAndWait(new Runnable(){
        public void run(){
          try {
            Class<?> euClass=PluginManager.getPlugin(PluginId.getId(MIGRATION_PLUGIN)).getPluginClassLoader().loadClass(TASK_EXEC_CLASS);
            Method method=euClass.getMethod("migrate",Project.class);
            Object result=method.invoke(null,p);
            if (!(((Boolean)result))) {
              info("Nothing to migrate");
            }
          }
 catch (          Exception e) {
            error(e.getMessage());
          }
        }
      }
);
    }
 catch (    InterruptedException e) {
      error(e.getMessage());
    }
catch (    InvocationTargetException e) {
      error(e.getMessage());
    }
    myEnvironment.flushAllEvents();
    myEnvironment.closeProject(p);
  }
  dispose();
}
