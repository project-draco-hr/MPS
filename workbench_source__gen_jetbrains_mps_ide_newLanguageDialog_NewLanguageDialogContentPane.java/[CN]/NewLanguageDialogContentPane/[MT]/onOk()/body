{
  File dir=new File(myThis.getLanguagePath());
  String message=NewModuleCheckUtil.checkModuleDirectory(dir,MPSExtentions.DOT_LANGUAGE,"Language");
  if (message != null) {
    myThis.getDialog().setErrorText(message);
    return;
  }
  if (myThis.getLanguageNamespace().length() == 0) {
    myThis.getDialog().setErrorText("Enter namespace");
    return;
  }
  if (MPSModuleRepository.getInstance().getModuleByUID(myThis.getLanguageNamespace()) != null) {
    myThis.getDialog().setErrorText("Language namespace already exists");
    return;
  }
  if (NameUtil.shortNameFromLongName(myThis.getLanguageNamespace()).length() == 0) {
    myThis.getDialog().setErrorText("Enter valid namespace");
    return;
  }
  myThis.getDialog().dispose();
  final Wrappers._T<Language> language=new Wrappers._T<Language>(null);
  Project project=myThis.getProject().getProject();
  ProgressManager.getInstance().run(new Task.Modal(project,"Creating",false){
    public void run(    @NotNull ProgressIndicator indicator){
      indicator.setIndeterminate(true);
      ModelAccess.instance().runWriteAction(new Runnable(){
        public void run(){
          language.value=myThis.createNewLanguage();
        }
      }
);
    }
  }
);
  ModelAccess.instance().runWriteActionInCommandAsync(new Runnable(){
    public void run(){
      if (!(language.value.getSModelRoots().isEmpty())) {
        LanguageAspect.STRUCTURE.createNew(language.value,false);
        LanguageAspect.EDITOR.createNew(language.value,false);
        LanguageAspect.CONSTRAINTS.createNew(language.value,false);
        LanguageAspect.TYPESYSTEM.createNew(language.value,false);
      }
      if (myThis.myNeedRuntime_f0.isSelected()) {
        Solution runtime=myThis.createRuntimeSolution();
        runtime.createModel(SModelFqName.fromString(myThis.getLanguageNamespace() + ".runtime"),runtime.getSModelRoots().get(0));
      }
      if (myThis.myNeedSandbox_g0.isSelected()) {
        Solution sandbox=myThis.createSandboxSolution();
        SModel createdModel=sandbox.createModel(SModelFqName.fromString(myThis.getLanguageNamespace() + ".sandbox"),sandbox.getSModelRoots().get(0)).getSModel();
        createdModel.addLanguage(myThis.getResult());
        for (        Language extendedLanguage : myThis.getResult().getExtendedLanguages()) {
          createdModel.addLanguage(extendedLanguage);
        }
        for (        ModuleReference addedLanguage : createdModel.getExplicitlyImportedLanguages()) {
          if (sandbox.getScope().getLanguage(addedLanguage) == null) {
            sandbox.addUsedLanguage(addedLanguage);
          }
        }
      }
    }
  }
,myProject != null ? myProject.getProject() : null);
}
