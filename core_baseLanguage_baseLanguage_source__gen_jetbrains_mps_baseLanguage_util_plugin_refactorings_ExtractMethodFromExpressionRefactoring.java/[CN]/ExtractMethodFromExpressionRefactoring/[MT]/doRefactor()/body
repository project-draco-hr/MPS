{
  SNode typeNode=SNodeOperations.copyNode(this.getMethodType());
  SNode body=SConceptOperations.createNewNode("jetbrains.mps.baseLanguage.structure.StatementList",null);
  Map<SNode,SNode> mapping=MapSequence.fromMap(new HashMap<SNode,SNode>());
  if (SNodeOperations.isInstanceOf(typeNode,"jetbrains.mps.baseLanguage.structure.VoidType")) {
    SNode expressionStatement=SConceptOperations.createNewNode("jetbrains.mps.baseLanguage.structure.ExpressionStatement",null);
    SLinkOperations.setTarget(expressionStatement,"expression",SNodeOperations.cast(CopyUtil.copy(this.myExpression,mapping,true),"jetbrains.mps.baseLanguage.structure.Expression"),true);
    ListSequence.fromList(SLinkOperations.getTargets(body,"statement",true)).addElement(expressionStatement);
  }
 else {
    SNode ret=SConceptOperations.createNewNode("jetbrains.mps.baseLanguage.structure.ReturnStatement",null);
    SLinkOperations.setTarget(ret,"expression",SNodeOperations.cast(CopyUtil.copy(this.myExpression,mapping,true),"jetbrains.mps.baseLanguage.structure.Expression"),true);
    ListSequence.fromList(SLinkOperations.getTargets(body,"statement",true)).addElement(ret);
  }
  List<SNode> params=new ArrayList<SNode>();
  Map<SNode,SNode> inputToParams=this.createInputParameters(body,params);
  Map<SNode,SNode> inputMapping=this.createInputVaryablesMapping(inputToParams);
  this.replaceInputVariablesWithParameters(body,inputToParams,mapping);
  SNode newMethod=this.createNewMethod(typeNode,params,body);
  this.addMethod(newMethod);
  MethodMatch exactMatch=this.createMatch(inputMapping);
  this.replaceMatchByMethodCall(exactMatch,params,newMethod);
  return newMethod;
}
