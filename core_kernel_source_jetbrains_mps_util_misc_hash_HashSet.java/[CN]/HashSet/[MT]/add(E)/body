{
  if (key == null) {
    final boolean wasHoldingNull=holdsNull;
    holdsNull=true;
    if (!wasHoldingNull) {
      size=size + 1;
    }
    return !wasHoldingNull;
  }
  final Entry<E>[] table=this.table;
  final int hash=key.hashCode();
  final int index=HashUtil.indexFor(hash,table.length,shift,mask);
  for (Entry<E> e=table[index]; e != null; e=e.hashNext) {
    final E entryKey;
    if (e.keyHash == hash && ((entryKey=e.key) == key || entryKey.equals(key))) {
      return false;
    }
  }
  final Entry<E> e=new Entry<E>(key);
  e.hashNext=table[index];
  table[index]=e;
  size=size + 1;
  if (size > capacity) {
    rehash(HashUtil.nextCapacity(capacity));
  }
  return true;
}
