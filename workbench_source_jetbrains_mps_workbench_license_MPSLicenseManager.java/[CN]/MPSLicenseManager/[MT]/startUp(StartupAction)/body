{
  if (ourPreferences.getBoolean(ACCEPTED,false)) {
    action.proceed();
  }
 else {
    final String licenseText=FileUtil.read(new File(PathManager.getHomePath() + File.separator + "license"+ File.separator+ "mps_license.txt"));
    final boolean[] agreed=new boolean[1];
    ThreadUtils.runInUIThreadAndWait(new Runnable(){
      public void run(){
        AgreementDialog agreementDialog=new AgreementDialog(licenseText,"JetBrains MPS");
        agreementDialog.show();
        agreed[0]=agreementDialog.isAgreed();
      }
    }
);
    if (agreed[0]) {
      ourPreferences.putBoolean(ACCEPTED,true);
      try {
        ourPreferences.sync();
      }
 catch (      BackingStoreException e) {
        throw new RuntimeException(e);
      }
      action.proceed();
    }
  }
}
