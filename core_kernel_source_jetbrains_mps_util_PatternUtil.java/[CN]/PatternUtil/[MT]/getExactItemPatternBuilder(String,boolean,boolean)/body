{
  StringBuilder b=new StringBuilder();
  int state=0;
  for (int i=0; i < text.length(); i++) {
    char c=text.charAt(i);
    state=appendNextChar(c,state,b,useDots,useStarAndQuestionMark);
  }
  if (state == 1) {
    b.append("\\E");
  }
  return b;
}
