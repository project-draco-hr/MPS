{
  Shortcut[] oldShortcuts=keymap.getShortcuts(longId);
  boolean isClear=oldShortcuts.length == 0;
  if (!isClear) {
    for (    Set<String> set : ourClearedActions.values()) {
      if (set.contains(longId)) {
        isClear=true;
        break;
      }
    }
  }
  if (!isClear) {
    if (oldShortcuts.length != 0) {
      myRemovedShortcuts.put(longId,new THashSet<>(Arrays.asList(oldShortcuts)));
      keymap.removeAllActionShortcuts(longId);
    }
  }
  Set<String> actions=ourClearedActions.get(keymap);
  if (actions == null) {
    actions=new THashSet<>();
    ourClearedActions.put(keymap,actions);
  }
  actions.add(longId);
  if (remove) {
    keymap.removeShortcut(longId,s);
  }
  if (replaceAll) {
    keymap.removeAllActionShortcuts(longId);
  }
  if (!remove) {
    keymap.addShortcut(longId,s);
  }
}
