{
  if (FileSystem.getInstance().isFileIgnored(dir.getName()))   return;
  if (!dir.isDirectory())   return;
  for (  ModuleHandle handle : new ModulesMiner().collectModules(dir).getCollectedModules()) {
    if (!seen.add(handle.getDescriptor().getId()))     continue;
    FileDataSource source=new FileDataSource(handle.getFile(),this);
    String stereotype=SModelStereotype.getStubStereotypeForId("project");
    String longName=handle.getDescriptor().getModuleReference().getModuleName();
    SModelId modelId=jetbrains.mps.smodel.SModelId.foreign(stereotype,getModule().getModuleId().toString(),longName);
    SModelReference ref=new jetbrains.mps.smodel.SModelReference(getModule().getModuleReference(),modelId,longName + "@" + stereotype);
    models.add(new ModuleFileSModel(ref,source));
  }
}
