{
  VirtualFile virtualFile=getVirtualFile();
  if (virtualFile instanceof LightVirtualFile) {
    virtualFile=((LightVirtualFile)virtualFile).getOriginalFile();
  }
  if (virtualFile == null || (virtualFile.getFileType() != MPSFileTypeFactory.MPS_FILE_TYPE && virtualFile.getFileType() != MPSFileTypeFactory.MPS_HEADER_FILE_TYPE)) {
    return null;
  }
  final IFile modelFile=FileSystem.getInstance().getFileByPath(virtualFile.getPath());
  FileSourcePsiFile psiFile=ModelAccess.instance().runReadAction(new Computable<FileSourcePsiFile>(){
    @Override public FileSourcePsiFile compute(){
      SModel descr=SModelFileTracker.getInstance().findModel(modelFile);
      if (descr != null) {
        MPSPsiProvider mpsPsiProvider=MPSPsiProvider.getInstance(getManager().getProject());
        MPSPsiModel psiModel=mpsPsiProvider.getPsi(descr);
        return descr instanceof FilePerRootSModel ? new FilePerRootModelPsiFile(MyFileViewProvider.this,descr.getReference(),descr.getModelName()) : new FileSourcePsiFile(MyFileViewProvider.this,descr.getReference(),descr.getModelName());
      }
      return null;
    }
  }
);
  return psiFile;
}
