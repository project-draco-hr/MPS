{
  Set<String> roles=SetSequence.fromSetWithValues(new HashSet<String>(),SNodeOperations.getChildRoles(a,true));
  SetSequence.fromSet(roles).addSequence(SetSequence.fromSet(SNodeOperations.getChildRoles(b,true)));
  for (  String r : SetSequence.fromSet(roles)) {
    Iterable<? extends SNode> ach=a.getChildren(r);
    Iterable<? extends SNode> bch=b.getChildren(r);
    if (IterableUtil.asCollection(ach).size() != IterableUtil.asCollection(bch).size()) {
      return false;
    }
    Iterator<? extends SNode> ai=ach.iterator();
    Iterator<? extends SNode> bi=bch.iterator();
    while (ai.hasNext()) {
      if (!(nodeEquals(ai.next(),bi.next()))) {
        return false;
      }
    }
  }
  return true;
}
