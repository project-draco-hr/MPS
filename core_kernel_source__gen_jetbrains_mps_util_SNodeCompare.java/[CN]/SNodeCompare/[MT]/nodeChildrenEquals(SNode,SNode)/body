{
  Set<String> roles=SetSequence.<String>fromSetWithValues(new HashSet<String>(),a.getChildRoles(true));
  SetSequence.fromSet(roles).addSequence(SetSequence.<String>fromSet(b.getChildRoles()));
  for (  String r : SetSequence.<String>fromSet(roles)) {
    List<SNode> aChildren=a.getChildren(r);
    List<SNode> bChildren=b.getChildren(r);
    if (aChildren.size() != bChildren.size()) {
      return false;
    }
    for (int i=0; i < aChildren.size(); i++) {
      if (!(nodeEquals(aChildren.get(i),bChildren.get(i)))) {
        return false;
      }
    }
  }
  return true;
}
