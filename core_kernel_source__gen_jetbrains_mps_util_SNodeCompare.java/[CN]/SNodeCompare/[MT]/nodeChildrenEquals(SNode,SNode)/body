{
  Set<SContainmentLink> roles=SetSequence.fromSetWithValues(new HashSet<SContainmentLink>(),SNodeOperations.getChildRoles(a,true));
  SetSequence.fromSet(roles).addSequence(SetSequence.fromSet(SNodeOperations.getChildRoles(b,true)));
  for (  SContainmentLink r : SetSequence.fromSet(roles)) {
    List<? extends SNode> aChildren=IterableUtil.asList(a.getChildren(r));
    List<? extends SNode> bChildren=IterableUtil.asList(b.getChildren(r));
    if (aChildren.size() != bChildren.size()) {
      return false;
    }
    for (int i=0; i < aChildren.size(); i++) {
      if (!(nodeEquals(aChildren.get(i),bChildren.get(i)))) {
        return false;
      }
    }
  }
  return true;
}
